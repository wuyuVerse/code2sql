[
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/record/record.go:34:55:GetRecordList",
    "orm_code": "func (s *recordImpl) GetRecordList(ctx context.Context, domainID uint, subdomainList []string) (recordList []mysql.DomainRecord, err error) {\n\twhereMap := make(map[string]interface{})\n\tif domainID == 0 {\n\t\treturn nil, errors.New(\"[sdns] domain is empty\")\n\t}\n\twhereMap[\"domain_id\"] = domainID\n\twhereMap[\"enabled\"] = \"1\"\n\tif len(subdomainList) > 0 {\n\t\tfor key, subdomain := range subdomainList {\n\t\t\tif subdomain == \"\" {\n\t\t\t\tsubdomainList[key] = \"@\"\n\t\t\t}\n\t\t}\n\t\twhereMap[\"sub_domain\"] = subdomainList\n\t}\n\tvar resultList []mysql.DomainRecord\n\ts.WithContext(ctx).Where(whereMap).FindInBatches(&recordList, 1000, func(tx *gorm.DB, batch int) error {\n\t\tresultList = append(resultList, recordList...)\n\t\treturn nil\n\t})\n\treturn resultList, nil\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "subdomainList为空时",
            "sql": "SELECT `id`,`domain_id`,`sub_domain`,`area`,`record_type`,`ttl`,`value`,`enabled`,`status`,`updated_on`,`extra`,`record_type_v1` FROM `domain_records` WHERE `domain_id` = ? AND `enabled` = ? LIMIT 1000;"
          },
          {
            "scenario": "subdomainList不为空时",
            "sql": "SELECT `id`,`domain_id`,`sub_domain`,`area`,`record_type`,`ttl`,`value`,`enabled`,`status`,`updated_on`,`extra`,`record_type_v1` FROM `domain_records` WHERE `domain_id` = ? AND `enabled` = ? AND `sub_domain` IN (?) LIMIT 1000;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/record.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "DomainRecord",
        "code_value": "type DomainRecord struct {\n\tID           uint      `gorm:\"column:id;int unsigned;autoIncrement\" json:\"id\"`      //解析记录ID\n\tDomainID     uint      `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`      //域名ID\n\tSubDomain    string    `gorm:\"column:sub_domain;varchar\" json:\"sub_domain\"`         //主机记录\n\tArea         string    `gorm:\"column:area;varchar\" json:\"area\"`                     //线路\n\tRecordType   string    `gorm:\"column:record_type;enum\" json:\"record_type\"`          //记录类型\n\tTTL          int       `gorm:\"column:ttl;int\" json:\"ttl\"`                           //ttl缓存周期\n\tValue        string    `gorm:\"column:value;varchar\" json:\"value\"`                   //记录值\n\tEnabled      string    `gorm:\"column:enabled;enum\" json:\"enabled\"`                  // \"1\"为开启 \"0\"为暂停\n\tStatus       string    `gorm:\"column:status;enum\" json:\"status\"`                    // 无用字段\n\tUpdatedOn    time.Time `gorm:\"column:updated_on;datetime\" json:\"updated_on\"`        //最后操作时间\n\tExtra        string    `gorm:\"column:extra;varchar\" json:\"extra\"`                   //额外字段\n\tRecordTypeV1 int8      `gorm:\"column:record_type_v1;tinyint\" json:\"record_type_v1\"` //记录类型：1 A, 2 CNAME, 3 MX, 4 URL, 5 NS, 6 TXT, 7 AAAA, 8 SRV, 9 URL1, 10 CAA, 11 SPF, 12 PTR, 13 HTTPS, 14 SVCB\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/record.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (DomainRecord) TableName() string {\n\treturn \"domain_records\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "FindInBatches"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/record/record.go:34:55:GetRecordList",
    "orm_code": "func (s *recordImpl) GetRecordList(ctx context.Context, domainID uint, subdomainList []string) (recordList []mysql.DomainRecord, err error) {\n\twhereMap := make(map[string]interface{})\n\tif domainID == 0 {\n\t\treturn nil, errors.New(\"[sdns] domain is empty\")\n\t}\n\twhereMap[\"domain_id\"] = domainID\n\twhereMap[\"enabled\"] = \"1\"\n\tif len(subdomainList) > 0 {\n\t\tfor key, subdomain := range subdomainList {\n\t\t\tif subdomain == \"\" {\n\t\t\t\tsubdomainList[key] = \"@\"\n\t\t\t}\n\t\t}\n\t\twhereMap[\"sub_domain\"] = subdomainList\n\t}\n\tvar resultList []mysql.DomainRecord\n\ts.WithContext(ctx).Where(whereMap).FindInBatches(&recordList, 1000, func(tx *gorm.DB, batch int) error {\n\t\tresultList = append(resultList, recordList...)\n\t\treturn nil\n\t})\n\treturn resultList, nil\n}",
    "caller": "func (s *sdnsImpl) handleAXFRRecordList(ctx context.Context, xfrRecordList []dns.RR, zone string, conf *mysql.Config, rrSoa *dns.SOA) error {\n\t// 判断同步的记录数是否超过最大限制\n\tmaxRecordCountLimit := int(remotecfg.Get().Service.MaxRRCount)\n\tif len(xfrRecordList)-2 > maxRecordCountLimit {\n\t\tcontent := s.logsRepo.Message(40030, maxRecordCountLimit)\n\t\t_ = s.logsRepo.AddLog(conf, content)\n\t\treturn errors.New(\"[sdns] handleAXFRRecordList record count more than MaxRecordCountLimit\")\n\t}\n\tvar recordList []mysql.DomainRecord\n\t// 把同步到的记录转换为dp的记录格式\n\tfor _, rr := range xfrRecordList {\n\t\tsubdomain, _, err := domainutil.SplitDomain(rr.Header().Name, zone)\n\t\tif err != nil {\n\t\t\tcontent := s.logsRepo.Message(40020)\n\t\t\t_ = s.logsRepo.AddLog(conf, content)\n\t\t\treturn errors.New(\"[sdns] handleAXFRRecordList SplitDomain invalid domain\")\n\t\t}\n\t\tif rr.Header().Rrtype == dns.TypeSOA {\n\t\t\tcontinue\n\t\t}\n\t\tdomainRecord, err := RecordTranslateToDNSPodRecord(rr, conf.DomainID, subdomain)\n\t\tif err != nil {\n\t\t\tlog.Errorf(\"unable translate to dnspod record, error: %s\", err.Error())\n\t\t\tcontinue\n\t\t}\n\t\trecordList = append(recordList, domainRecord)\n\t}\n\n\t// 比对记录\n\tdpRecordList, err := s.recordRepo.GetRecordList(ctx, conf.DomainID, []string{})\n\tif err != nil {\n\t\treturn fmt.Errorf(\"[sdns] handleXFRRecordList GetRecordList %s\", err.Error())\n\t}\n\tcompareRecordList := CompareRecord(dpRecordList, recordList)\n\treturn s.handleDomainRecordAndQueue(ctx, compareRecordList, zone, conf, rrSoa)\n}",
    "sql_statement_list": [
      "SELECT * FROM domain_records WHERE domain_id = ? AND enabled = ? LIMIT 1000;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/record.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "DomainRecord",
        "code_value": "type DomainRecord struct {\n\tID           uint      `gorm:\"column:id;int unsigned;autoIncrement\" json:\"id\"`      //解析记录ID\n\tDomainID     uint      `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`      //域名ID\n\tSubDomain    string    `gorm:\"column:sub_domain;varchar\" json:\"sub_domain\"`         //主机记录\n\tArea         string    `gorm:\"column:area;varchar\" json:\"area\"`                     //线路\n\tRecordType   string    `gorm:\"column:record_type;enum\" json:\"record_type\"`          //记录类型\n\tTTL          int       `gorm:\"column:ttl;int\" json:\"ttl\"`                           //ttl缓存周期\n\tValue        string    `gorm:\"column:value;varchar\" json:\"value\"`                   //记录值\n\tEnabled      string    `gorm:\"column:enabled;enum\" json:\"enabled\"`                  // \"1\"为开启 \"0\"为暂停\n\tStatus       string    `gorm:\"column:status;enum\" json:\"status\"`                    // 无用字段\n\tUpdatedOn    time.Time `gorm:\"column:updated_on;datetime\" json:\"updated_on\"`        //最后操作时间\n\tExtra        string    `gorm:\"column:extra;varchar\" json:\"extra\"`                   //额外字段\n\tRecordTypeV1 int8      `gorm:\"column:record_type_v1;tinyint\" json:\"record_type_v1\"` //记录类型：1 A, 2 CNAME, 3 MX, 4 URL, 5 NS, 6 TXT, 7 AAAA, 8 SRV, 9 URL1, 10 CAA, 11 SPF, 12 PTR, 13 HTTPS, 14 SVCB\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/record.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (DomainRecord) TableName() string {\n\treturn \"domain_records\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "FindInBatches"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/record/record.go:34:55:GetRecordList",
    "orm_code": "func (s *recordImpl) GetRecordList(ctx context.Context, domainID uint, subdomainList []string) (recordList []mysql.DomainRecord, err error) {\n\twhereMap := make(map[string]interface{})\n\tif domainID == 0 {\n\t\treturn nil, errors.New(\"[sdns] domain is empty\")\n\t}\n\twhereMap[\"domain_id\"] = domainID\n\twhereMap[\"enabled\"] = \"1\"\n\tif len(subdomainList) > 0 {\n\t\tfor key, subdomain := range subdomainList {\n\t\t\tif subdomain == \"\" {\n\t\t\t\tsubdomainList[key] = \"@\"\n\t\t\t}\n\t\t}\n\t\twhereMap[\"sub_domain\"] = subdomainList\n\t}\n\tvar resultList []mysql.DomainRecord\n\ts.WithContext(ctx).Where(whereMap).FindInBatches(&recordList, 1000, func(tx *gorm.DB, batch int) error {\n\t\tresultList = append(resultList, recordList...)\n\t\treturn nil\n\t})\n\treturn resultList, nil\n}",
    "caller": "func (s *sdnsImpl) handleIXFRRecordList(ctx context.Context, xfrRecordList []dns.RR, zone string, conf *mysql.Config, rrSoa *dns.SOA) error {\n\txfrRecordList = xfrRecordList[1 : len(xfrRecordList)-1]\n\tnewSerial := strconv.FormatUint(uint64(rrSoa.Serial), 10)\n\tcurrentSerial := \"\"\n\tvar removeSubdomainList []string\n\tvar removeRecordList []mysql.DomainRecord\n\tvar insertRecordList []mysql.DomainRecord\n\tfor _, record := range xfrRecordList {\n\t\tif record.Header().Rrtype == dns.TypeSOA {\n\t\t\tcurrentSerial = strconv.FormatUint(uint64(record.(*dns.SOA).Serial), 10)\n\t\t\tcontinue\n\t\t}\n\t\tsubdomain, _, err := domainutil.SplitDomain(record.Header().Name, zone)\n\t\tif err != nil {\n\t\t\tcontent := s.logsRepo.Message(40020)\n\t\t\t_ = s.logsRepo.AddLog(conf, content)\n\t\t\treturn errors.New(\"[sdns] handleIXFRRecordList SplitDomain invalid domain\")\n\t\t}\n\t\tchangeRecord, err := RecordTranslateToDNSPodRecord(record, conf.DomainID, subdomain)\n\t\tif err != nil {\n\t\t\tlog.Errorf(\"unable translate to dnspod record, error: %s\", err.Error())\n\t\t\tcontinue\n\t\t}\n\t\tif currentSerial != newSerial {\n\t\t\t// 旧版本需要删除的记录\n\t\t\tremoveSubdomainList = append(removeSubdomainList, subdomain)\n\t\t\tremoveRecordList = append(removeRecordList, changeRecord)\n\t\t} else {\n\t\t\t// 新版本需要添加的记录\n\t\t\tinsertRecordList = append(insertRecordList, changeRecord)\n\t\t}\n\t}\n\n\t// 判断同步的记录数是否超过最大限制\n\tdomainInfo, err := s.domainRepo.GetDomainByID(ctx, conf.DomainID)\n\tif err != nil {\n\t\treturn err\n\t}\n\tmaxRecordCountLimit := int(remotecfg.Get().Service.MaxRRCount)\n\tif domainInfo.SubDomains-len(removeRecordList)+len(insertRecordList) > maxRecordCountLimit {\n\t\tcontent := s.logsRepo.Message(40030, maxRecordCountLimit)\n\t\t_ = s.logsRepo.AddLog(conf, content)\n\t\treturn errors.New(\"[sdns] handleIXFRRecordList record count more than MaxRecordCountLimit\")\n\t}\n\t// 数据去重\n\t_ = extra.DeduplicateOriginal(removeSubdomainList)\n\n\t// 比对记录\n\tdpRecordList, err := s.recordRepo.GetRecordList(ctx, conf.DomainID, removeSubdomainList)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"[sdns] handleXFRRecordList GetRecordList %s\", err.Error())\n\t}\n\tcompareRecordList := MatchDeleteRecord(dpRecordList, removeRecordList)\n\tfor _, insertCompareRecord := range insertRecordList {\n\t\tcompareRecordList = append(compareRecordList, CompareRecordResult{\n\t\t\trecord:        insertCompareRecord,\n\t\t\tcompareStatus: CompareRecordStatusAdd,\n\t\t})\n\t}\n\treturn s.handleDomainRecordAndQueue(ctx, compareRecordList, zone, conf, rrSoa)\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "subdomainList为空时",
            "sql": "SELECT * FROM `domain_records` WHERE `domain_id` = ? AND `enabled` = ? LIMIT ?;"
          },
          {
            "scenario": "subdomainList不为空时",
            "sql": "SELECT * FROM `domain_records` WHERE `domain_id` = ? AND `enabled` = ? AND `sub_domain` IN (?,?,?) LIMIT ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/record.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "DomainRecord",
        "code_value": "type DomainRecord struct {\n\tID           uint      `gorm:\"column:id;int unsigned;autoIncrement\" json:\"id\"`      //解析记录ID\n\tDomainID     uint      `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`      //域名ID\n\tSubDomain    string    `gorm:\"column:sub_domain;varchar\" json:\"sub_domain\"`         //主机记录\n\tArea         string    `gorm:\"column:area;varchar\" json:\"area\"`                     //线路\n\tRecordType   string    `gorm:\"column:record_type;enum\" json:\"record_type\"`          //记录类型\n\tTTL          int       `gorm:\"column:ttl;int\" json:\"ttl\"`                           //ttl缓存周期\n\tValue        string    `gorm:\"column:value;varchar\" json:\"value\"`                   //记录值\n\tEnabled      string    `gorm:\"column:enabled;enum\" json:\"enabled\"`                  // \"1\"为开启 \"0\"为暂停\n\tStatus       string    `gorm:\"column:status;enum\" json:\"status\"`                    // 无用字段\n\tUpdatedOn    time.Time `gorm:\"column:updated_on;datetime\" json:\"updated_on\"`        //最后操作时间\n\tExtra        string    `gorm:\"column:extra;varchar\" json:\"extra\"`                   //额外字段\n\tRecordTypeV1 int8      `gorm:\"column:record_type_v1;tinyint\" json:\"record_type_v1\"` //记录类型：1 A, 2 CNAME, 3 MX, 4 URL, 5 NS, 6 TXT, 7 AAAA, 8 SRV, 9 URL1, 10 CAA, 11 SPF, 12 PTR, 13 HTTPS, 14 SVCB\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/record.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (DomainRecord) TableName() string {\n\treturn \"domain_records\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "FindInBatches"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/record/record.go:34:55:GetRecordList",
    "orm_code": "func (s *recordImpl) GetRecordList(ctx context.Context, domainID uint, subdomainList []string) (recordList []mysql.DomainRecord, err error) {\n\twhereMap := make(map[string]interface{})\n\tif domainID == 0 {\n\t\treturn nil, errors.New(\"[sdns] domain is empty\")\n\t}\n\twhereMap[\"domain_id\"] = domainID\n\twhereMap[\"enabled\"] = \"1\"\n\tif len(subdomainList) > 0 {\n\t\tfor key, subdomain := range subdomainList {\n\t\t\tif subdomain == \"\" {\n\t\t\t\tsubdomainList[key] = \"@\"\n\t\t\t}\n\t\t}\n\t\twhereMap[\"sub_domain\"] = subdomainList\n\t}\n\tvar resultList []mysql.DomainRecord\n\ts.WithContext(ctx).Where(whereMap).FindInBatches(&recordList, 1000, func(tx *gorm.DB, batch int) error {\n\t\tresultList = append(resultList, recordList...)\n\t\treturn nil\n\t})\n\treturn resultList, nil\n}",
    "caller": "func (s *sdnsImpl) handleDomainRecordAndQueue(ctx context.Context, compareRecordList []CompareRecordResult,\n\tzone string, conf *mysql.Config, rrSoa *dns.SOA) error {\n\t// 删除/插入变动的记录\n\tremoveRecordIDList := make([]uint, 0)\n\tinsertRecordList := make([]mysql.DomainRecord, 0)\n\tminInsertTime := time.Now().Unix()\n\tvar changeRecordSubdomainList []string\n\tfor _, compareRecord := range compareRecordList {\n\t\tif compareRecord.compareStatus == CompareRecordStatusDelete {\n\t\t\tremoveRecordIDList = append(removeRecordIDList, compareRecord.record.ID)\n\t\t\tchangeRecordSubdomainList = append(changeRecordSubdomainList, compareRecord.record.SubDomain)\n\t\t} else if compareRecord.compareStatus == CompareRecordStatusAdd {\n\t\t\tinsertRecordList = append(insertRecordList, compareRecord.record)\n\t\t\tchangeRecordSubdomainList = append(changeRecordSubdomainList, compareRecord.record.SubDomain)\n\t\t\tif compareRecord.record.UpdatedOn.Unix() < minInsertTime {\n\t\t\t\tminInsertTime = compareRecord.record.UpdatedOn.Unix()\n\t\t\t}\n\t\t}\n\t}\n\n\t// 正式变更前，再次校验辅助DNS开启状态\n\tif !s.sdnsRepo.CheckSlaveDNSOpenStatus(ctx, conf.DomainID) {\n\t\tcontent := s.logsRepo.Message(10006)\n\t\t_ = s.logsRepo.AddLog(conf, content)\n\t\treturn errors.New(\"[sdns] handleDomainRecordAndQueue CheckSlaveDNSOpenStatus close\")\n\t}\n\tdisableRecordRemoveNum, err := s.recordRepo.RemoveDisabledRecord(ctx, conf.DomainID)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"[sdns] handleDomainRecordAndQueue RemoveDisabledRecord %s\", err.Error())\n\t}\n\tidRemoveNum, err := s.recordRepo.RemoveRecordByIDList(ctx, removeRecordIDList)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"[sdns] handleDomainRecordAndQueue RemoveRecordByIDList %s\", err.Error())\n\t}\n\tinsertNum, err := s.recordRepo.AddRecordList(ctx, insertRecordList)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"[sdns] handleDomainRecordAndQueue AddRecordList %s\", err.Error())\n\t}\n\n\t// 触发通知 在new_dnspod中进行es的更新操作\n\tdomainRecordESUpdateTask := DomainRecordESUpdateTask{\n\t\tDomainID:           conf.DomainID,\n\t\tRemoveRecordIDList: removeRecordIDList,\n\t\tInsertTime:         minInsertTime,\n\t\tRetryTime:          0,\n\t}\n\ttaskJSONInfo, err := json.Marshal(&domainRecordESUpdateTask)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"[sdns] handleDomainRecordAndQueue Marshal %s\", err.Error())\n\t}\n\t_ = s.sdnsRepo.SetRPushDomainRecordESUpdate(string(taskJSONInfo))\n\n\t// 插入日志 删除xx条 插入xx条\n\tcontent := s.logsRepo.Message(10005, idRemoveNum+disableRecordRemoveNum, insertNum)\n\t_ = s.logsRepo.AddLog(conf, content)\n\n\t// 获取所有subdomain有变更的解析记录\n\tchangeRecordList, err := s.recordRepo.GetRecordList(ctx, conf.DomainID, changeRecordSubdomainList)\n\tif err != nil {\n\t\treturn fmt.Errorf(\"[sdns] handleXFRRecordList GetRecordList %s\", err.Error())\n\t}\n\t// 去重\n\t_ = extra.DeduplicateOriginal(changeRecordSubdomainList)\n\n\tvar changeRecordListGroupBySubdomain = make(map[string][]mysql.DomainRecord)\n\tfor _, changeRecord := range changeRecordList {\n\t\tchangeRecordListGroupBySubdomain[changeRecord.SubDomain] =\n\t\t\tappend(changeRecordListGroupBySubdomain[changeRecord.SubDomain], changeRecord)\n\t}\n\tfor _, subdomain := range changeRecordSubdomainList {\n\t\tif _, exists := changeRecordListGroupBySubdomain[subdomain]; !exists {\n\t\t\tchangeRecordListGroupBySubdomain[subdomain] = []mysql.DomainRecord{}\n\t\t}\n\t}\n\n\t// 推送队列\n\treturn s.pushQueue(ctx, rrSoa, zone, changeRecordListGroupBySubdomain, conf)\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "changeRecordSubdomainList为空时",
            "sql": "SELECT * FROM `domain_records` WHERE `domain_id` = ? AND `enabled` = ? LIMIT 1000;"
          },
          {
            "scenario": "changeRecordSubdomainList包含子域名时",
            "sql": "SELECT * FROM `domain_records` WHERE `domain_id` = ? AND `enabled` = ? AND `sub_domain` IN (?) LIMIT 1000;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/record.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "DomainRecord",
        "code_value": "type DomainRecord struct {\n\tID           uint      `gorm:\"column:id;int unsigned;autoIncrement\" json:\"id\"`      //解析记录ID\n\tDomainID     uint      `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`      //域名ID\n\tSubDomain    string    `gorm:\"column:sub_domain;varchar\" json:\"sub_domain\"`         //主机记录\n\tArea         string    `gorm:\"column:area;varchar\" json:\"area\"`                     //线路\n\tRecordType   string    `gorm:\"column:record_type;enum\" json:\"record_type\"`          //记录类型\n\tTTL          int       `gorm:\"column:ttl;int\" json:\"ttl\"`                           //ttl缓存周期\n\tValue        string    `gorm:\"column:value;varchar\" json:\"value\"`                   //记录值\n\tEnabled      string    `gorm:\"column:enabled;enum\" json:\"enabled\"`                  // \"1\"为开启 \"0\"为暂停\n\tStatus       string    `gorm:\"column:status;enum\" json:\"status\"`                    // 无用字段\n\tUpdatedOn    time.Time `gorm:\"column:updated_on;datetime\" json:\"updated_on\"`        //最后操作时间\n\tExtra        string    `gorm:\"column:extra;varchar\" json:\"extra\"`                   //额外字段\n\tRecordTypeV1 int8      `gorm:\"column:record_type_v1;tinyint\" json:\"record_type_v1\"` //记录类型：1 A, 2 CNAME, 3 MX, 4 URL, 5 NS, 6 TXT, 7 AAAA, 8 SRV, 9 URL1, 10 CAA, 11 SPF, 12 PTR, 13 HTTPS, 14 SVCB\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/record.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (DomainRecord) TableName() string {\n\treturn \"domain_records\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "FindInBatches"
    ]
  }
]