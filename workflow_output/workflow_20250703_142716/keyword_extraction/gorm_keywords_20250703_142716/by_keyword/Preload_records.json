[
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phy_disk` WHERE `dm_phy_disk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CbsAppIdConsumer) Handle(ctx context.Context, delivery *rabbitmq.Delivery) error {\n\tu, chargeTime, err := c.ParseDelivery(ctx, delivery)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif u == nil {\n\t\tlogs.Info(c.Ctx).\n\t\t\tTime(\"chargeTime\", chargeTime).\n\t\t\tMsg(\"USER_INFO_NOT_FOUND\")\n\t\treturn nil\n\t}\n\n\tchargeDetail := c.GetChargeDetailForSingleUser(u, chargeTime)\n\tif chargeDetail == nil {\n\t\tlogs.Info(c.Ctx).\n\t\t\tUint64(\"appId\", uint64(u.AppId)).\n\t\t\tTime(\"chargeTime\", chargeTime).\n\t\t\tMsg(\"NO_RESOURCE_TO_CHARGE\")\n\t\treturn nil\n\t}\n\treturn c.ProcessChargeDetail(chargeDetail)\n}",
    "sql_statement_list": [
      "SELECT d.id, d.uuid, d.status, d.app_id, d.size, d.phydisk_serial, d.extra, d.zone_id, d.volume_type, d.disk_type, d.read_iops, d.read_bandwidth, d.write_iops, d.write_bandwidth, d.rw_iops, d.rw_bandwidth, d.created, d.updated, p.id, p.serial, p.status, p.zone_id, p.created, p.updated FROM dm_rdisk d LEFT JOIN dm_phydisk p ON d.phydisk_serial = p.serial WHERE d.uuid = ? AND d.app_id = ? LIMIT 1;",
      "SELECT id, uuid, rdisk_uuid, vm_id, device_name, attachment_type, created, updated FROM dm_rdisk_attachment WHERE dm_rdisk_attachment.uuid IN (?);",
      "SELECT id, serial, status, zone_id, created, updated FROM dm_phydisk WHERE dm_phydisk.serial IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *DefunctPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tif err := c.ensureLocks(ctx); err != nil {\n\t\treturn err\n\t}\n\tif c.lvUUID != nil {\n\t\t// 涉及到逻辑卷时，需要先标记逻辑卷为故障\n\t\treturn c.handleBindedVolume(ctx)\n\t} else {\n\t\t// 不涉及到逻辑卷时，直接标记物理卷为故障\n\t\treturn c.handleIdleVolume(ctx)\n\t}\n}",
    "sql_statement_list": [
      "SELECT id, uuid, status, app_id, size, phydisk_serial, extra, zone_id, volume_type, disk_type, read_iops, read_bandwidth, write_iops, write_bandwidth, rw_iops, rw_bandwidth, created, updated FROM dm_rdisk WHERE uuid = ? AND app_id = ? LIMIT 1;",
      "SELECT serial, status, zone_id, created, updated FROM dm_phydisk WHERE serial IN (?);",
      "SELECT id, uuid, attachment_type, attachment_id, created, updated FROM dm_rdisk_attachment WHERE uuid IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *DetachLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByAppIDAndUUID(ctx, c.AppID, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEDetachLogicalVolume, c)\n\n\t// 如果没有挂载到指定的主机上，则直接返回成功\n\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotAttachedToHost) {\n\t\tlogs.Info(ctx).Str(\"uuid\", c.UUID.String()).Str(\"host_ip\", c.IP.String()).\n\t\t\tMsg(\"volume not attached to host\")\n\t\treturn nil\n\t}\n\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, dm_phydisk.id, dm_phydisk.serial, dm_phydisk.status, dm_phydisk.capacity, dm_phydisk.used_capacity, dm_phydisk.zone_id, dm_phydisk.created, dm_phydisk.updated, dm_rdisk_attachment.id, dm_rdisk_attachment.uuid, dm_rdisk_attachment.host_ip, dm_rdisk_attachment.device_path, dm_rdisk_attachment.attached_at, dm_rdisk_attachment.status, dm_rdisk_attachment.created, dm_rdisk_attachment.updated FROM dm_rdisk LEFT JOIN dm_phydisk ON dm_rdisk.phydisk_serial = dm_phydisk.serial LEFT JOIN dm_rdisk_attachment ON dm_rdisk.uuid = dm_rdisk_attachment.uuid WHERE dm_rdisk.uuid = ? AND dm_rdisk.app_id = ? LIMIT 1;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CreateBenchmarkCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tvolSm     = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\tvolRepo   = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\terr       error\n\t)\n\n\tc.relatedVolume, err = volRepo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = volSm.Fire(ctx, c.relatedVolume.State, domain.PVEStartBenchmark, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBenchmark = benchmark.New(benchmark.DiskInfo{\n\t\tSerial: string(c.relatedVolume.Serial),\n\t\tHostIP: c.relatedVolume.IP,\n\t\tBDF:    string(c.relatedVolume.BDF),\n\t})\n\n\tif err = benchRepo.Add(ctx, c.relatedBenchmark); err != nil {\n\t\tdelegate := &benchmarkDelegate{cmd: c}\n\t\tif _err := delegate.TaskFinishCallback(ctx, c.relatedBenchmark); _err != nil {\n\t\t\tlogs.Warn(ctx).Err(_err).Str(\"serial\", string(c.relatedVolume.Serial)).Msg(\"failed to rollback: create bdev\")\n\t\t}\n\t\treturn err\n\t}\n\n\t_, err = benchSm.Fire(ctx, c.relatedBenchmark.Status, benchmark.EventCreateBench,\n\t\tbenchmark.Data{Benchmark: c.relatedBenchmark, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (d *DeleteLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\td.volume, err = repo.FindByID(ctx, d.UUID)\n\tif err != nil {\n\t\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotExists) {\n\t\t\treturn nil\n\t\t}\n\t\treturn err\n\t}\n\n\tif e := d.volume.CheckDelete(); e != nil {\n\t\treturn e\n\t}\n\n\tif d.volume.AppID != d.AppID {\n\t\treturn errors.New(rdiskDomain.ErrAppIDMismatch, \"refuse to delet: app id mismatch\")\n\t}\n\n\td.drgroup, err = app.GetRegistry(ctx).Repositories.DRGroup.FindByMember(ctx, d.AppID, d.volume.UUID.String())\n\tif err != nil {\n\t\tif errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\td.drgroup = nil\n\t\t} else {\n\t\t\treturn err\n\t\t}\n\t}\n\n\tif err := d.checkDRGroupMatch(ctx); err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, d.volume.State, rdiskDomain.LVEMarkToRecycle, d)\n\treturn\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *ConfirmRecycledPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEConfirmRecycled, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *DeleteRDiskBackupCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tsm   = app.GetRegistry(ctx).StateMachines.Backup\n\t\trepo = app.GetRegistry(ctx).Repositories.Backup\n\t)\n\n\tc.relatedVolume, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil || c.relatedVolume == nil || c.relatedVolume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\tc.relatedBackup, err = repo.FindByUUID(ctx, c.BackupID.String())\n\tif err != nil || c.relatedBackup == nil || c.relatedBackup.AppID != c.AppID {\n\t\treturn errors.New(backupDomain.ErrBackupNotExist, \"backup not exists\")\n\t}\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tc.relatedBackup.Status,\n\t\tbackupDomain.EventSoftDeleteBackup,\n\t\tbackupDomain.Data{Delegate: &backupDelegate{Data: c}, Backup: c.relatedBackup})\n\n\treturn\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CreateRDiskBackupCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tlvSm  = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t\tbakSm = app.GetRegistry(ctx).StateMachines.Backup\n\t\trepo  = app.GetRegistry(ctx).Repositories.Backup\n\t)\n\tc.relatedVolume, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil || c.relatedVolume == nil || c.relatedVolume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\t_, err = lvSm.Fire(ctx, c.relatedVolume.State, rdiskDomain.LVEBackupStarted, c)\n\tif err != nil {\n\t\treturn\n\t}\n\n\tlv := c.relatedVolume\n\tbackup := backupDomain.New(\n\t\tlv.AppID,\n\t\tbackupDomain.DiskInfo{\n\t\t\tVolumeUUID: lv.UUID,\n\t\t\tVolumeSize: uint64(lv.Size),\n\t\t\tHostIP:     lv.PhysicalVolume.IP,\n\t\t\tHostBDF:    string(lv.PhysicalVolume.BDF),\n\t\t\tSerial:     string(lv.PhysicalVolume.Serial),\n\t\t},\n\t)\n\tif err := repo.Add(ctx, backup); err != nil {\n\t\treturn err\n\t}\n\tc.relatedBackup = backup\n\t_, err = bakSm.Fire(ctx, backupDomain.StatusInit, backupDomain.EventStartBackup, backupDomain.Data{Delegate: &backupDelegate{Data: c}, Backup: backup})\n\treturn err\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *AttachLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByAppIDAndUUID(ctx, c.AppID, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEAttachLogicalVolume, c)\n\n\t// 如果已经挂载到了指定的主机上，则直接返回成功\n\tif errors.IsCode(err, rdiskDomain.ErrVolumeAlreadyAttachedToHost) {\n\t\tlogs.Info(ctx).Str(\"uuid\", c.UUID.String()).Str(\"host_ip\", c.IP.String()).\n\t\t\tMsg(\"volume already attached to host\")\n\t\treturn nil\n\t}\n\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *ConfirmDeleteLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\t// 如果逻辑卷不存在，则直接返回成功\n\t\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotExists) {\n\t\t\treturn nil\n\t\t}\n\t\treturn err\n\t}\n\n\tif c.volume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrAppIDMismatch, \"failed to confirm delete: app id mismatch\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEDeleteLogicalVolume, c)\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?) ORDER BY `dm_phydisk`.`id`;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?) ORDER BY `dm_rdisk_attachment`.`id`;"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *OfflinePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEOfflinePhysicalVolume, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` = ? AND `dm_rdisk_attachment`.`deleted_at` IS NULL;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` = ? AND `dm_phydisk`.`deleted_at` IS NULL;",
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *DeletePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\t// 如果物理卷不存在，则直接幂等返回\n\t\treturn nil\n\t}\n\n\tvar event = domain.PVEDeletePhysicalVolume\n\tif c.Force && (c.relatedVolume.State == domain.PVSDefunct) {\n\t\t// 这里的实现不太好，状态机的逻辑不应该侵入 cmd\n\t\t// 时间太赶了，后续重构优化吧\n\t\tevent = domain.PVEForceDeleteForDefunct\n\t}\n\n\tif c.relatedVolume.HasBindedPV() {\n\t\treturn errors.New(domain.ErrVolumeBusy, \"logic volume has binded to this physical volume\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, event, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CleanupLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVECleanupLogicalVolume, c)\n\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *ConfirmInitPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\tif c.relatedVolume.IP.String() != c.Host.String() {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume host ip mistmatch\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVECreatePhysicalVolumeOnHost, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CreatePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\n\t// 获取物理卷状态机\n\tsm := app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\trepo := app.GetRegistry(ctx).Repositories.PhysicalVolume\n\n\t// 检查物理卷是否已经存在，如果存在则直接幂等返回\n\tvol1, err := repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil && !errors.IsCode(err, domain.ErrPhysicalVolumeNotExists) {\n\t\tlogs.Warn(ctx).Err(err).Str(\"serial\", c.Serial).Msg(\"failed query existing physical volume\")\n\t\treturn errors.Newf(domain.ErrQueryPhysicalVolumeFailed, \"failed query existing physical volume: %v\", err)\n\t}\n\tvol2, err := repo.FindByIPAndBDF(ctx, c.Host, domain.BDF(c.BDF))\n\tif err != nil && !errors.IsCode(err, domain.ErrPhysicalVolumeNotExists) {\n\t\tlogs.Warn(ctx).Err(err).Str(\"host\", c.Host.String()).Str(\"bdf\", c.BDF).Msg(\"failed query existing physical volume\")\n\t\treturn errors.Newf(domain.ErrQueryPhysicalVolumeFailed, \"failed query existing physical volume: %v\", err)\n\t}\n\tfor _, vol := range []*domain.PhysicalVolume{vol1, vol2} {\n\t\texisted, err := c.checkExisting(ctx, vol)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\tif existed {\n\t\t\treturn nil\n\t\t}\n\t}\n\n\t// 触发事件，创建物理卷\n\t_, err = sm.Fire(ctx,\n\t\tdomain.PVSUnInited,\n\t\tdomain.PVECreatePhysicalVolume,\n\t\tc,\n\t)\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// 创建 Bdev 以及格式化移动到创建物理卷的状态机中\n\n\t// _, err = sm.Fire(ctx,\n\t// \tc.GetPhysicalVolume().State,\n\t// \tdomain.PVECreatePhysicalVolumeOnHost,\n\t// \tc,\n\t// )\n\t// if err != nil {\n\t// \treturn err\n\t// }\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *DeleteBenchmarkCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\terr       error\n\t)\n\n\tbench, err := benchRepo.FindByUUID(ctx, c.BenchmarkUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif bench.DiskInfo.Serial != c.Serial {\n\t\treturn errors.Newf(benchmark.ErrTaskNotFound, \"benchmark serial not match %s, want %s\", c.Serial, bench.DiskInfo.Serial)\n\t}\n\n\t_, err = benchSm.Fire(ctx, bench.Status, benchmark.EventDeleteBench, benchmark.Data{Benchmark: bench, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif err := benchRepo.Delete(ctx, bench); err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CreateLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tpvRepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tlvRepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm     = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\t// 1. 查找底层物理卷\n\tc.selectedPhysicalVolume, err = pvRepo.FindBySerial(ctx, rdiskDomain.Serial(c.PhysicalVolumeSerial))\n\tif err != nil {\n\t\treturn\n\t}\n\n\t// 检查底层物理卷大小是否满足要求\n\tif c.selectedPhysicalVolume.Size < rdiskDomain.Size(c.DiskSize) {\n\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume size %d is smaller than requested size %d\", c.selectedPhysicalVolume.Size, c.DiskSize)\n\t}\n\n\t// 检查底层物理卷性能等级是否满足要求\n\tif c.PerformanceRank != \"\" {\n\t\tif string(c.selectedPhysicalVolume.PerformanceRank) != c.PerformanceRank {\n\t\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume performance rank %s is not match requested rank %s\", c.selectedPhysicalVolume.PerformanceRank, c.PerformanceRank)\n\t\t}\n\t} else {\n\t\tif c.selectedPhysicalVolume.PerformanceRank != rdiskDomain.DefaultPerformanceRank {\n\t\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume performance rank %s is not default rank %s\", c.selectedPhysicalVolume.PerformanceRank, rdiskDomain.DefaultPerformanceRank)\n\t\t}\n\t}\n\n\t// 2. 创建逻辑卷\n\tvol := rdiskDomain.NewLogicalVolume(users.AppID(c.AppID), rdiskDomain.Size(c.DiskSize), rdiskDomain.ZoneID(c.ZoneID))\n\tif c.VolumeType != \"\" {\n\t\tvol.VolumeType = rdiskDomain.VolumeType(c.VolumeType)\n\t}\n\tif c.DiskType != \"\" {\n\t\tvol.DiskType = rdiskDomain.DiskType(c.DiskType)\n\t}\n\terr = lvRepo.Add(ctx, vol)\n\tif err != nil {\n\t\treturn\n\t}\n\tc.createdLogicalVolume = vol\n\n\t// 3. 触发状态机，联动更新逻辑卷和物理卷状态\n\t_, err = sm.Fire(ctx, rdiskDomain.LVSUnInited, rdiskDomain.LVECreateLogicalVolume, c)\n\treturn\n}",
    "sql_statement_list": [
      "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, dm_phydisk.serial, dm_phydisk.status, dm_phydisk.size, dm_phydisk.performance_rank, dm_phydisk.zone_id, dm_phydisk.created, dm_phydisk.updated, dm_rdisk_attachment.id, dm_rdisk_attachment.uuid, dm_rdisk_attachment.vm_uuid, dm_rdisk_attachment.device_name, dm_rdisk_attachment.status, dm_rdisk_attachment.created, dm_rdisk_attachment.updated FROM dm_rdisk LEFT JOIN dm_phydisk ON dm_rdisk.phydisk_serial = dm_phydisk.serial LEFT JOIN dm_rdisk_attachment ON dm_rdisk.uuid = dm_rdisk_attachment.uuid WHERE dm_rdisk.uuid = ? AND dm_rdisk.app_id = ? LIMIT 1;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *UpdateRunningBackupTaskCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepos = app.GetRegistry(ctx).Repositories\n\t\tsm    = app.GetRegistry(ctx).StateMachines.Backup\n\t)\n\n\tbak, err := repos.Backup.FindByUUID(ctx, c.UUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvol, err := repos.LogicalVolume.FindByID(ctx, bak.DiskInfo.VolumeUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBackup = bak\n\tc.relatedVolume = vol\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tbak.Status,\n\t\tbackupDomain.EventUpdateBackupProgress,\n\t\tbackupDomain.Data{Backup: bak, Delegate: &backupDelegate{Data: c}})\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *UpdateLogicalVolumeDRGroupCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tlvView  = app.GetRegistry(ctx).Viewers.LogicalVolume\n\t\tdrgRepo = app.GetRegistry(ctx).Repositories.DRGroup\n\t\tsm      = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t\terr     error\n\t)\n\n\t// 0. 初始化\n\tc.drgroupRef = make(map[string]*drgroup.DRGroup)\n\n\t// 1. 加载所有逻辑卷所在的置放群组\n\tallVolumeUUIDs := make([]string, 0, len(c.UUIDs))\n\tfor _, _uuid := range c.UUIDs {\n\t\tallVolumeUUIDs = append(allVolumeUUIDs, _uuid.String())\n\t}\n\tif groups, err := drgRepo.FindByMembers(ctx, c.AppID, allVolumeUUIDs); err == nil {\n\t\tif err != nil {\n\t\t\tif !errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t\tfor _, group := range groups {\n\t\t\tc.drgroupRef[group.Name] = group\n\t\t\tc.curDRGroupNames = append(c.curDRGroupNames, group.Name)\n\t\t}\n\t} else {\n\t\treturn err\n\t}\n\n\t// 2. 确认已上锁的置放群组和当前一致\n\tif !c.checkLockedDRGroupNames() {\n\t\treturn errors.New(drgroup.ErrGroupModified, \"drgroup changed\")\n\t}\n\n\t// 3. 加载所有逻辑卷的状态，不需要完整实体，因为不会修改 Volume\n\tc.relatedLogicalVolume, err = lvView.FindByIDs(ctx, c.AppID, c.UUIDs)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif len(c.relatedLogicalVolume) < len(c.UUIDs) {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\t// 4. 加载所有目标置放群组，key 为 name\n\tfor _, spec := range c.Specs {\n\t\tvar group *drgroup.DRGroup\n\t\tif _, ok := c.drgroupRef[spec.Name]; ok {\n\t\t\tgroup = c.drgroupRef[spec.Name]\n\t\t} else {\n\t\t\tgroup, err = c.getOrCreateDRGroup(ctx, drgRepo, spec)\n\t\t\tif err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t\tc.drgroupRef[group.Name] = group\n\t\t}\n\n\t\tif spec.Affinity > 0 {\n\t\t\tgroup.Affinity = spec.Affinity\n\t\t}\n\t\tif spec.Type != \"\" {\n\t\t\tgroup.Type = drgroup.LocType(spec.Type)\n\t\t}\n\t}\n\n\t// 5. 对所有逻辑卷执行置放群组变更事件，检查状态是否允许，\n\t//    实际的更新还是在这里执行。\n\tfor _, vol := range c.relatedLogicalVolume {\n\t\terr := sm.Check(ctx, vol.State, rdiskDomain.LVEUpdateDrGroup, c)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\t// 将逻辑卷从原有的置放群组中移除\n\t\tfor _, name := range c.curDRGroupNames {\n\t\t\tc.drgroupRef[name].RemoveMember(vol.UUID.String())\n\t\t}\n\t\t// 将逻辑卷添加到新的置放群组中\n\t\tfor _, spec := range c.Specs {\n\t\t\tsubGroup := spec.SubGroup\n\t\t\tif subGroup == \"\" {\n\t\t\t\t// 如果没有指定子组，则使用远端 SSD UUID 作为子组名称\n\t\t\t\t// 相当于每块盘都是一个子组，相当于没有使用子组功能\n\t\t\t\tsubGroup = vol.UUID.String()\n\t\t\t}\n\t\t\tif err := c.drgroupRef[spec.Name].AddMember(vol.UUID.String(), subGroup, vol.PhysicalVolume.IP.String()); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t}\n\n\tif c.DryRun {\n\t\treturn errors.New(errors.ErrDryRunSuccessExit, \"dry run check success\")\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated` FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` = ?;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` = ?;"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *OnlinePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEOnlinePhysicalVolume, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?) ORDER BY `dm_rdisk_attachment`.`id`;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?) ORDER BY `dm_phydisk`.`id`;",
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *UpdateBenchmarkTask) Handle(ctx context.Context) error {\n\tvar (\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\tvolRepo   = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\terr       error\n\t)\n\n\tc.relatedVolume, err = volRepo.FindBySerial(ctx, rdisk.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBenchmark, err = benchRepo.FindByUUID(ctx, c.BenchmarkUUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = benchSm.Fire(ctx, c.relatedBenchmark.Status, benchmark.EventUpdateBench, benchmark.Data{Benchmark: c.relatedBenchmark, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *UpdateLogicalVolumeFlowControlCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif c.volume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not found\")\n\t}\n\n\tspec := c.volume.FlowControlSpec\n\tif !c.UpdateRequest.UpdateSpec(&spec, c.volume.GetDefaultFlowControlSpec()) {\n\t\t// 没有任何更新，直接返回成功\n\t\treturn nil\n\t}\n\tc.volume.SetFlowControlSpec(spec)\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEUpdateFlowControl, c)\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CleanupDefunctCommand) Handle(ctx context.Context) error {\n\tvar err error\n\tc.lv, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvar sm = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\tvar event = rdiskDomain.LVECleanupDefunct\n\n\tfor _, attachment := range c.lv.Attachments {\n\t\tlogs.Info(ctx).Stringer(\"uuid\", c.UUID).Stringer(\"host\", attachment.IP).Msg(\"cleanup defuncting volume\")\n\t\tsubCmd := &cleanDefunctSubCommand{Parent: c, HostIP: attachment.IP}\n\t\t_, err = sm.Fire(ctx, c.lv.State, event, subCmd)\n\t\tif err != nil {\n\t\t\t// 这里不需要返回错误，因为只要有一个挂载点清理失败，其他挂载点还是需要继续清理的\n\t\t\t// 失败的挂载点会在后台继续清理\n\t\t\tlogs.Error(ctx).Err(err).Stringer(\"uuid\", c.UUID).Stringer(\"host\", attachment.IP).\n\t\t\t\tMsg(\"failed to cleanup defunct volume, retry later.\")\n\t\t}\n\t}\n\n\tif len(c.lv.Attachments) == 0 {\n\t\t// 没有挂载点，直接清理\n\t\t_, err = sm.Fire(ctx, c.lv.State, event, &cleanDefunctSubCommand{Parent: c, HostIP: net.IP{}})\n\t\tif err != nil {\n\t\t\t// 这里不需要返回错误，后续自动重试即可\n\t\t\tlogs.Error(ctx).Err(err).Stringer(\"uuid\", c.UUID).Msg(\"failed to complete cleanup defunct volume\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT `dm_rdisk`.`id`, `dm_rdisk`.`uuid`, `dm_rdisk`.`status`, `dm_rdisk`.`app_id`, `dm_rdisk`.`size`, `dm_rdisk`.`phydisk_serial`, `dm_rdisk`.`extra`, `dm_rdisk`.`zone_id`, `dm_rdisk`.`volume_type`, `dm_rdisk`.`disk_type`, `dm_rdisk`.`read_iops`, `dm_rdisk`.`read_bandwidth`, `dm_rdisk`.`write_iops`, `dm_rdisk`.`write_bandwidth`, `dm_rdisk`.`rw_iops`, `dm_rdisk`.`rw_bandwidth`, `dm_rdisk`.`created`, `dm_rdisk`.`updated` FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *ConfirmDRGroupExistsCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.DRGroup\n\t)\n\tfor _, spec := range c.DRGroup {\n\t\t_, err := repo.FindByName(ctx, users.AppID(c.AppID), spec.Name)\n\t\tif err != nil {\n\t\t\tif errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\t\tgroup := drgroup.New(spec.Name, users.AppID(c.AppID))\n\t\t\t\tif spec.Affinity > 0 {\n\t\t\t\t\tgroup.Affinity = spec.Affinity\n\t\t\t\t}\n\t\t\t\tif spec.Type != \"\" {\n\t\t\t\t\tgroup.Type = drgroup.LocType(spec.Type)\n\t\t\t\t}\n\t\t\t\terr = repo.Add(ctx, group)\n\t\t\t\tif err != nil {\n\t\t\t\t\treturn err\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t}\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *UpdatePhyRDiskCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEUpdatePhysicalVolume, c)\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *RecycleBackupDataCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepos = app.GetRegistry(ctx).Repositories\n\t\tsm    = app.GetRegistry(ctx).StateMachines.Backup\n\t)\n\n\tbak, err := repos.Backup.FindByUUID(ctx, c.UUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvol, err := repos.LogicalVolume.FindByID(ctx, bak.DiskInfo.VolumeUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBackup = bak\n\tc.relatedVolume = vol\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tbak.Status,\n\t\tbackupDomain.EventDeleteBackup,\n\t\tbackupDomain.Data{Backup: bak, Delegate: &backupDelegate{Data: c}})\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_rdisk WHERE uuid = ? AND app_id = ? ORDER BY dm_rdisk.id LIMIT 1;",
      "SELECT * FROM dm_phydisk WHERE dm_phydisk.serial IN (?);",
      "SELECT * FROM dm_rdisk_attachment WHERE dm_rdisk_attachment.uuid IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *DefunctPhysicalVolumeCommand) handleBindedVolume(ctx context.Context) error {\n\tlogicalVolume, err := app.GetRegistry(ctx).Repositories.LogicalVolume.FindByAppIDAndUUID(ctx, *c.appId, *c.lvUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif logicalVolume.PhysicalVolume.Serial != c.Serial {\n\t\treturn errors.New(\n\t\t\trdiskDomain.ErrInvalidSerial,\n\t\t\tfmt.Sprintf(\"serial not match %s != %s\", string(logicalVolume.PhysicalVolume.Serial), c.Serial))\n\t}\n\n\tif logicalVolume.MustDefunctWithAuthorization() && !c.validateAuthorizeToken(ctx) {\n\t\treturn errors.New(rdiskDomain.ErrUnAuthorizedDefunct, \"unauthorized defunct, vol is binded to a account disk\")\n\t}\n\n\tc.lv = logicalVolume\n\tc.pv = logicalVolume.PhysicalVolume\n\tif err := c.checkPhysicalVolume(ctx); err != nil {\n\t\treturn err\n\t}\n\tc.drgroups, err = app.GetRegistry(ctx).Repositories.DRGroup.FindByMember(ctx, c.lv.AppID, c.lv.UUID.String())\n\tif err != nil {\n\t\tif errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\tc.drgroups = nil\n\t\t} else {\n\t\t\treturn err\n\t\t}\n\t}\n\n\tlogs.Warn(ctx).Str(\"token\", c.AuthorizeToken).\n\t\tStr(\"serial\", string(c.Serial)).\n\t\tStr(\"uuid\", c.lvUUID.String()).\n\t\tInt64(\"app_id\", int64(*c.appId)).\n\t\tMsg(\"authorized defunct binded volume\")\n\n\tif _, err := app.GetRegistry(ctx).StateMachines.LogicalVolume.Fire(ctx, c.lv.State,\n\t\trdiskDomain.LVEMarkDefunct, c); err != nil {\n\n\t\tlogs.Error(ctx).Err(err).\n\t\t\tStringer(\"serial\", c.Serial).\n\t\t\tInt64(\"app_id\", int64(*c.appId)).\n\t\t\tStringer(\"uuid\", c.lvUUID).\n\t\t\tMsg(\"failed to mark logical volume as defunct\")\n\t\treturn err\n\t}\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.status, DmPhyDisk.size, DmPhyDisk.zone_id, DmPhyDisk.extra, DmPhyDisk.created, DmPhyDisk.updated, Attachments.id, Attachments.uuid, Attachments.instance_id, Attachments.device, Attachments.created, Attachments.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial LEFT JOIN dm_rdisk_attachment Attachments ON dm_rdisk.uuid = Attachments.uuid WHERE uuid = ? AND app_id = ? ORDER BY dm_rdisk.id LIMIT 1;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
    "orm_code": "func (logicalVolumeRepositoryImpl) FindByAppIDAndUUID(ctx context.Context, appID users.AppID, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ? AND app_id = ?\", id.String(), appID)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func StepThenLogicalVolStateShouldBe(logicalVol *rdiskDomain.LogicalVolume, registry *app.Registry, db *gorm.DB, database string, value interface{}) *rdiskDomain.LogicalVolume {\n\tdb.Exec(fmt.Sprintf(\"USE `%s`\", database))\n\tuow := registry.Repositories.UoWFactory.New()\n\tworkerCtx := registry.Repositories.UoWFactory.With(context.Background(), uow)\n\tnewLogicalVol, err := registry.Repositories.LogicalVolume.FindByAppIDAndUUID(workerCtx, logicalVol.AppID, logicalVol.UUID)\n\terr = uow.Commit(workerCtx)\n\tif err != nil {\n\t\tpanic(err)\n\t}\n\tif newLogicalVol.State != rdiskDomain.LogicalVolumeState(value.(int)) {\n\t\tpanic(\"LogicalVol state error\")\n\t}\n\treturn newLogicalVol\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? AND app_id = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CbsAppIdConsumer) Handle(ctx context.Context, delivery *rabbitmq.Delivery) error {\n\tu, chargeTime, err := c.ParseDelivery(ctx, delivery)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif u == nil {\n\t\tlogs.Info(c.Ctx).\n\t\t\tTime(\"chargeTime\", chargeTime).\n\t\t\tMsg(\"USER_INFO_NOT_FOUND\")\n\t\treturn nil\n\t}\n\n\tchargeDetail := c.GetChargeDetailForSingleUser(u, chargeTime)\n\tif chargeDetail == nil {\n\t\tlogs.Info(c.Ctx).\n\t\t\tUint64(\"appId\", uint64(u.AppId)).\n\t\t\tTime(\"chargeTime\", chargeTime).\n\t\t\tMsg(\"NO_RESOURCE_TO_CHARGE\")\n\t\treturn nil\n\t}\n\treturn c.ProcessChargeDetail(chargeDetail)\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *DefunctPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tif err := c.ensureLocks(ctx); err != nil {\n\t\treturn err\n\t}\n\tif c.lvUUID != nil {\n\t\t// 涉及到逻辑卷时，需要先标记逻辑卷为故障\n\t\treturn c.handleBindedVolume(ctx)\n\t} else {\n\t\t// 不涉及到逻辑卷时，直接标记物理卷为故障\n\t\treturn c.handleIdleVolume(ctx)\n\t}\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *DetachLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByAppIDAndUUID(ctx, c.AppID, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEDetachLogicalVolume, c)\n\n\t// 如果没有挂载到指定的主机上，则直接返回成功\n\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotAttachedToHost) {\n\t\tlogs.Info(ctx).Str(\"uuid\", c.UUID.String()).Str(\"host_ip\", c.IP.String()).\n\t\t\tMsg(\"volume not attached to host\")\n\t\treturn nil\n\t}\n\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CreateBenchmarkCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tvolSm     = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\tvolRepo   = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\terr       error\n\t)\n\n\tc.relatedVolume, err = volRepo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = volSm.Fire(ctx, c.relatedVolume.State, domain.PVEStartBenchmark, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBenchmark = benchmark.New(benchmark.DiskInfo{\n\t\tSerial: string(c.relatedVolume.Serial),\n\t\tHostIP: c.relatedVolume.IP,\n\t\tBDF:    string(c.relatedVolume.BDF),\n\t})\n\n\tif err = benchRepo.Add(ctx, c.relatedBenchmark); err != nil {\n\t\tdelegate := &benchmarkDelegate{cmd: c}\n\t\tif _err := delegate.TaskFinishCallback(ctx, c.relatedBenchmark); _err != nil {\n\t\t\tlogs.Warn(ctx).Err(_err).Str(\"serial\", string(c.relatedVolume.Serial)).Msg(\"failed to rollback: create bdev\")\n\t\t}\n\t\treturn err\n\t}\n\n\t_, err = benchSm.Fire(ctx, c.relatedBenchmark.Status, benchmark.EventCreateBench,\n\t\tbenchmark.Data{Benchmark: c.relatedBenchmark, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (d *DeleteLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\td.volume, err = repo.FindByID(ctx, d.UUID)\n\tif err != nil {\n\t\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotExists) {\n\t\t\treturn nil\n\t\t}\n\t\treturn err\n\t}\n\n\tif e := d.volume.CheckDelete(); e != nil {\n\t\treturn e\n\t}\n\n\tif d.volume.AppID != d.AppID {\n\t\treturn errors.New(rdiskDomain.ErrAppIDMismatch, \"refuse to delet: app id mismatch\")\n\t}\n\n\td.drgroup, err = app.GetRegistry(ctx).Repositories.DRGroup.FindByMember(ctx, d.AppID, d.volume.UUID.String())\n\tif err != nil {\n\t\tif errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\td.drgroup = nil\n\t\t} else {\n\t\t\treturn err\n\t\t}\n\t}\n\n\tif err := d.checkDRGroupMatch(ctx); err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, d.volume.State, rdiskDomain.LVEMarkToRecycle, d)\n\treturn\n}",
    "sql_statement_list": [
      "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated FROM dm_rdisk WHERE uuid = ? ORDER BY dm_rdisk.id LIMIT 1;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *ConfirmRecycledPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEConfirmRecycled, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *DeleteRDiskBackupCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tsm   = app.GetRegistry(ctx).StateMachines.Backup\n\t\trepo = app.GetRegistry(ctx).Repositories.Backup\n\t)\n\n\tc.relatedVolume, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil || c.relatedVolume == nil || c.relatedVolume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\tc.relatedBackup, err = repo.FindByUUID(ctx, c.BackupID.String())\n\tif err != nil || c.relatedBackup == nil || c.relatedBackup.AppID != c.AppID {\n\t\treturn errors.New(backupDomain.ErrBackupNotExist, \"backup not exists\")\n\t}\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tc.relatedBackup.Status,\n\t\tbackupDomain.EventSoftDeleteBackup,\n\t\tbackupDomain.Data{Delegate: &backupDelegate{Data: c}, Backup: c.relatedBackup})\n\n\treturn\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "当主查询找到记录时执行预加载Attachments",
            "sql": "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
          }
        ]
      },
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "当主查询找到记录时执行预加载DmPhyDisk",
            "sql": "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
          }
        ]
      }
    ],
    "sql_types": [
      "SELECT",
      "PARAM_DEPENDENT",
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CreateRDiskBackupCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tlvSm  = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t\tbakSm = app.GetRegistry(ctx).StateMachines.Backup\n\t\trepo  = app.GetRegistry(ctx).Repositories.Backup\n\t)\n\tc.relatedVolume, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil || c.relatedVolume == nil || c.relatedVolume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\t_, err = lvSm.Fire(ctx, c.relatedVolume.State, rdiskDomain.LVEBackupStarted, c)\n\tif err != nil {\n\t\treturn\n\t}\n\n\tlv := c.relatedVolume\n\tbackup := backupDomain.New(\n\t\tlv.AppID,\n\t\tbackupDomain.DiskInfo{\n\t\t\tVolumeUUID: lv.UUID,\n\t\t\tVolumeSize: uint64(lv.Size),\n\t\t\tHostIP:     lv.PhysicalVolume.IP,\n\t\t\tHostBDF:    string(lv.PhysicalVolume.BDF),\n\t\t\tSerial:     string(lv.PhysicalVolume.Serial),\n\t\t},\n\t)\n\tif err := repo.Add(ctx, backup); err != nil {\n\t\treturn err\n\t}\n\tc.relatedBackup = backup\n\t_, err = bakSm.Fire(ctx, backupDomain.StatusInit, backupDomain.EventStartBackup, backupDomain.Data{Delegate: &backupDelegate{Data: c}, Backup: backup})\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT `dm_rdisk`.`id`, `dm_rdisk`.`uuid`, `dm_rdisk`.`status`, `dm_rdisk`.`app_id`, `dm_rdisk`.`size`, `dm_rdisk`.`phydisk_serial`, `dm_rdisk`.`extra`, `dm_rdisk`.`zone_id`, `dm_rdisk`.`volume_type`, `dm_rdisk`.`disk_type`, `dm_rdisk`.`read_iops`, `dm_rdisk`.`read_bandwidth`, `dm_rdisk`.`write_iops`, `dm_rdisk`.`write_bandwidth`, `dm_rdisk`.`rw_iops`, `dm_rdisk`.`rw_bandwidth`, `dm_rdisk`.`created`, `dm_rdisk`.`updated` FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *AttachLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByAppIDAndUUID(ctx, c.AppID, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEAttachLogicalVolume, c)\n\n\t// 如果已经挂载到了指定的主机上，则直接返回成功\n\tif errors.IsCode(err, rdiskDomain.ErrVolumeAlreadyAttachedToHost) {\n\t\tlogs.Info(ctx).Str(\"uuid\", c.UUID.String()).Str(\"host_ip\", c.IP.String()).\n\t\t\tMsg(\"volume already attached to host\")\n\t\treturn nil\n\t}\n\n\treturn err\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *ConfirmDeleteLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\t// 如果逻辑卷不存在，则直接返回成功\n\t\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotExists) {\n\t\t\treturn nil\n\t\t}\n\t\treturn err\n\t}\n\n\tif c.volume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrAppIDMismatch, \"failed to confirm delete: app id mismatch\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEDeleteLogicalVolume, c)\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT `id`, `uuid`, `status`, `app_id`, `size`, `phydisk_serial`, `extra`, `zone_id`, `volume_type`, `disk_type`, `read_iops`, `read_bandwidth`, `write_iops`, `write_bandwidth`, `rw_iops`, `rw_bandwidth`, `created`, `updated` FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT `serial`, `id`, `status`, `zone_id`, `disk_type`, `size`, `read_iops`, `read_bandwidth`, `write_iops`, `write_bandwidth`, `rw_iops`, `rw_bandwidth`, `created`, `updated` FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);",
      "SELECT `id`, `uuid`, `instance_id`, `device`, `attached_at`, `detached_at`, `status` FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *OfflinePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEOfflinePhysicalVolume, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *DeletePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\t// 如果物理卷不存在，则直接幂等返回\n\t\treturn nil\n\t}\n\n\tvar event = domain.PVEDeletePhysicalVolume\n\tif c.Force && (c.relatedVolume.State == domain.PVSDefunct) {\n\t\t// 这里的实现不太好，状态机的逻辑不应该侵入 cmd\n\t\t// 时间太赶了，后续重构优化吧\n\t\tevent = domain.PVEForceDeleteForDefunct\n\t}\n\n\tif c.relatedVolume.HasBindedPV() {\n\t\treturn errors.New(domain.ErrVolumeBusy, \"logic volume has binded to this physical volume\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, event, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "查询逻辑卷及其关联数据",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated` FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;"
          }
        ]
      },
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "预加载DmPhyDisk关联数据",
            "sql": "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
          }
        ]
      },
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "预加载Attachments关联数据",
            "sql": "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT",
      "PARAM_DEPENDENT",
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CleanupLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVECleanupLogicalVolume, c)\n\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *ConfirmInitPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\tif c.relatedVolume.IP.String() != c.Host.String() {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume host ip mistmatch\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVECreatePhysicalVolumeOnHost, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CreatePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\n\t// 获取物理卷状态机\n\tsm := app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\trepo := app.GetRegistry(ctx).Repositories.PhysicalVolume\n\n\t// 检查物理卷是否已经存在，如果存在则直接幂等返回\n\tvol1, err := repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil && !errors.IsCode(err, domain.ErrPhysicalVolumeNotExists) {\n\t\tlogs.Warn(ctx).Err(err).Str(\"serial\", c.Serial).Msg(\"failed query existing physical volume\")\n\t\treturn errors.Newf(domain.ErrQueryPhysicalVolumeFailed, \"failed query existing physical volume: %v\", err)\n\t}\n\tvol2, err := repo.FindByIPAndBDF(ctx, c.Host, domain.BDF(c.BDF))\n\tif err != nil && !errors.IsCode(err, domain.ErrPhysicalVolumeNotExists) {\n\t\tlogs.Warn(ctx).Err(err).Str(\"host\", c.Host.String()).Str(\"bdf\", c.BDF).Msg(\"failed query existing physical volume\")\n\t\treturn errors.Newf(domain.ErrQueryPhysicalVolumeFailed, \"failed query existing physical volume: %v\", err)\n\t}\n\tfor _, vol := range []*domain.PhysicalVolume{vol1, vol2} {\n\t\texisted, err := c.checkExisting(ctx, vol)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\tif existed {\n\t\t\treturn nil\n\t\t}\n\t}\n\n\t// 触发事件，创建物理卷\n\t_, err = sm.Fire(ctx,\n\t\tdomain.PVSUnInited,\n\t\tdomain.PVECreatePhysicalVolume,\n\t\tc,\n\t)\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// 创建 Bdev 以及格式化移动到创建物理卷的状态机中\n\n\t// _, err = sm.Fire(ctx,\n\t// \tc.GetPhysicalVolume().State,\n\t// \tdomain.PVECreatePhysicalVolumeOnHost,\n\t// \tc,\n\t// )\n\t// if err != nil {\n\t// \treturn err\n\t// }\n\n\treturn nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "查询逻辑卷及其关联数据",
            "sql": "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;"
          }
        ]
      },
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "预加载Attachments关联数据",
            "sql": "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?) ORDER BY `dm_rdisk_attachment`.`uuid`;"
          }
        ]
      },
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "预加载DmPhyDisk关联数据",
            "sql": "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?) ORDER BY `dm_phydisk`.`serial`;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT",
      "PARAM_DEPENDENT",
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *DeleteBenchmarkCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\terr       error\n\t)\n\n\tbench, err := benchRepo.FindByUUID(ctx, c.BenchmarkUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif bench.DiskInfo.Serial != c.Serial {\n\t\treturn errors.Newf(benchmark.ErrTaskNotFound, \"benchmark serial not match %s, want %s\", c.Serial, bench.DiskInfo.Serial)\n\t}\n\n\t_, err = benchSm.Fire(ctx, bench.Status, benchmark.EventDeleteBench, benchmark.Data{Benchmark: bench, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif err := benchRepo.Delete(ctx, bench); err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CreateLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tpvRepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tlvRepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm     = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\t// 1. 查找底层物理卷\n\tc.selectedPhysicalVolume, err = pvRepo.FindBySerial(ctx, rdiskDomain.Serial(c.PhysicalVolumeSerial))\n\tif err != nil {\n\t\treturn\n\t}\n\n\t// 检查底层物理卷大小是否满足要求\n\tif c.selectedPhysicalVolume.Size < rdiskDomain.Size(c.DiskSize) {\n\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume size %d is smaller than requested size %d\", c.selectedPhysicalVolume.Size, c.DiskSize)\n\t}\n\n\t// 检查底层物理卷性能等级是否满足要求\n\tif c.PerformanceRank != \"\" {\n\t\tif string(c.selectedPhysicalVolume.PerformanceRank) != c.PerformanceRank {\n\t\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume performance rank %s is not match requested rank %s\", c.selectedPhysicalVolume.PerformanceRank, c.PerformanceRank)\n\t\t}\n\t} else {\n\t\tif c.selectedPhysicalVolume.PerformanceRank != rdiskDomain.DefaultPerformanceRank {\n\t\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume performance rank %s is not default rank %s\", c.selectedPhysicalVolume.PerformanceRank, rdiskDomain.DefaultPerformanceRank)\n\t\t}\n\t}\n\n\t// 2. 创建逻辑卷\n\tvol := rdiskDomain.NewLogicalVolume(users.AppID(c.AppID), rdiskDomain.Size(c.DiskSize), rdiskDomain.ZoneID(c.ZoneID))\n\tif c.VolumeType != \"\" {\n\t\tvol.VolumeType = rdiskDomain.VolumeType(c.VolumeType)\n\t}\n\tif c.DiskType != \"\" {\n\t\tvol.DiskType = rdiskDomain.DiskType(c.DiskType)\n\t}\n\terr = lvRepo.Add(ctx, vol)\n\tif err != nil {\n\t\treturn\n\t}\n\tc.createdLogicalVolume = vol\n\n\t// 3. 触发状态机，联动更新逻辑卷和物理卷状态\n\t_, err = sm.Fire(ctx, rdiskDomain.LVSUnInited, rdiskDomain.LVECreateLogicalVolume, c)\n\treturn\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *UpdateRunningBackupTaskCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepos = app.GetRegistry(ctx).Repositories\n\t\tsm    = app.GetRegistry(ctx).StateMachines.Backup\n\t)\n\n\tbak, err := repos.Backup.FindByUUID(ctx, c.UUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvol, err := repos.LogicalVolume.FindByID(ctx, bak.DiskInfo.VolumeUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBackup = bak\n\tc.relatedVolume = vol\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tbak.Status,\n\t\tbackupDomain.EventUpdateBackupProgress,\n\t\tbackupDomain.Data{Backup: bak, Delegate: &backupDelegate{Data: c}})\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *UpdateLogicalVolumeDRGroupCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tlvView  = app.GetRegistry(ctx).Viewers.LogicalVolume\n\t\tdrgRepo = app.GetRegistry(ctx).Repositories.DRGroup\n\t\tsm      = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t\terr     error\n\t)\n\n\t// 0. 初始化\n\tc.drgroupRef = make(map[string]*drgroup.DRGroup)\n\n\t// 1. 加载所有逻辑卷所在的置放群组\n\tallVolumeUUIDs := make([]string, 0, len(c.UUIDs))\n\tfor _, _uuid := range c.UUIDs {\n\t\tallVolumeUUIDs = append(allVolumeUUIDs, _uuid.String())\n\t}\n\tif groups, err := drgRepo.FindByMembers(ctx, c.AppID, allVolumeUUIDs); err == nil {\n\t\tif err != nil {\n\t\t\tif !errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t\tfor _, group := range groups {\n\t\t\tc.drgroupRef[group.Name] = group\n\t\t\tc.curDRGroupNames = append(c.curDRGroupNames, group.Name)\n\t\t}\n\t} else {\n\t\treturn err\n\t}\n\n\t// 2. 确认已上锁的置放群组和当前一致\n\tif !c.checkLockedDRGroupNames() {\n\t\treturn errors.New(drgroup.ErrGroupModified, \"drgroup changed\")\n\t}\n\n\t// 3. 加载所有逻辑卷的状态，不需要完整实体，因为不会修改 Volume\n\tc.relatedLogicalVolume, err = lvView.FindByIDs(ctx, c.AppID, c.UUIDs)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif len(c.relatedLogicalVolume) < len(c.UUIDs) {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\t// 4. 加载所有目标置放群组，key 为 name\n\tfor _, spec := range c.Specs {\n\t\tvar group *drgroup.DRGroup\n\t\tif _, ok := c.drgroupRef[spec.Name]; ok {\n\t\t\tgroup = c.drgroupRef[spec.Name]\n\t\t} else {\n\t\t\tgroup, err = c.getOrCreateDRGroup(ctx, drgRepo, spec)\n\t\t\tif err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t\tc.drgroupRef[group.Name] = group\n\t\t}\n\n\t\tif spec.Affinity > 0 {\n\t\t\tgroup.Affinity = spec.Affinity\n\t\t}\n\t\tif spec.Type != \"\" {\n\t\t\tgroup.Type = drgroup.LocType(spec.Type)\n\t\t}\n\t}\n\n\t// 5. 对所有逻辑卷执行置放群组变更事件，检查状态是否允许，\n\t//    实际的更新还是在这里执行。\n\tfor _, vol := range c.relatedLogicalVolume {\n\t\terr := sm.Check(ctx, vol.State, rdiskDomain.LVEUpdateDrGroup, c)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\t// 将逻辑卷从原有的置放群组中移除\n\t\tfor _, name := range c.curDRGroupNames {\n\t\t\tc.drgroupRef[name].RemoveMember(vol.UUID.String())\n\t\t}\n\t\t// 将逻辑卷添加到新的置放群组中\n\t\tfor _, spec := range c.Specs {\n\t\t\tsubGroup := spec.SubGroup\n\t\t\tif subGroup == \"\" {\n\t\t\t\t// 如果没有指定子组，则使用远端 SSD UUID 作为子组名称\n\t\t\t\t// 相当于每块盘都是一个子组，相当于没有使用子组功能\n\t\t\t\tsubGroup = vol.UUID.String()\n\t\t\t}\n\t\t\tif err := c.drgroupRef[spec.Name].AddMember(vol.UUID.String(), subGroup, vol.PhysicalVolume.IP.String()); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t}\n\n\tif c.DryRun {\n\t\treturn errors.New(errors.ErrDryRunSuccessExit, \"dry run check success\")\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *OnlinePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEOnlinePhysicalVolume, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "我理解您的要求，您希望我将SQL语句分析结果格式化为标准JSON格式。但是我注意到您提供的\"需要格式化的内容\"部分是空的（显示为`[]`）。\n\n请您提供需要格式化的SQL语句内容，我将按照您指定的JSON格式要求进行处理：\n\n1. 将SQL语句组织为数组\n2. 固定SQL语句直接作为字符串\n3. 参数相关的变化SQL语句作为对象，包含不同场景的变体\n4. 移除注释和非SQL内容\n5. 确保所有SQL语句以分号结尾\n6. 返回纯JSON格式\n\n请提供具体的SQL内容，我将立即为您格式化。;"
    ],
    "sql_types": [
      "OTHER"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *UpdateBenchmarkTask) Handle(ctx context.Context) error {\n\tvar (\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\tvolRepo   = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\terr       error\n\t)\n\n\tc.relatedVolume, err = volRepo.FindBySerial(ctx, rdisk.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBenchmark, err = benchRepo.FindByUUID(ctx, c.BenchmarkUUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = benchSm.Fire(ctx, c.relatedBenchmark.Status, benchmark.EventUpdateBench, benchmark.Data{Benchmark: c.relatedBenchmark, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *UpdateLogicalVolumeFlowControlCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif c.volume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not found\")\n\t}\n\n\tspec := c.volume.FlowControlSpec\n\tif !c.UpdateRequest.UpdateSpec(&spec, c.volume.GetDefaultFlowControlSpec()) {\n\t\t// 没有任何更新，直接返回成功\n\t\treturn nil\n\t}\n\tc.volume.SetFlowControlSpec(spec)\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEUpdateFlowControl, c)\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *CleanupDefunctCommand) Handle(ctx context.Context) error {\n\tvar err error\n\tc.lv, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvar sm = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\tvar event = rdiskDomain.LVECleanupDefunct\n\n\tfor _, attachment := range c.lv.Attachments {\n\t\tlogs.Info(ctx).Stringer(\"uuid\", c.UUID).Stringer(\"host\", attachment.IP).Msg(\"cleanup defuncting volume\")\n\t\tsubCmd := &cleanDefunctSubCommand{Parent: c, HostIP: attachment.IP}\n\t\t_, err = sm.Fire(ctx, c.lv.State, event, subCmd)\n\t\tif err != nil {\n\t\t\t// 这里不需要返回错误，因为只要有一个挂载点清理失败，其他挂载点还是需要继续清理的\n\t\t\t// 失败的挂载点会在后台继续清理\n\t\t\tlogs.Error(ctx).Err(err).Stringer(\"uuid\", c.UUID).Stringer(\"host\", attachment.IP).\n\t\t\t\tMsg(\"failed to cleanup defunct volume, retry later.\")\n\t\t}\n\t}\n\n\tif len(c.lv.Attachments) == 0 {\n\t\t// 没有挂载点，直接清理\n\t\t_, err = sm.Fire(ctx, c.lv.State, event, &cleanDefunctSubCommand{Parent: c, HostIP: net.IP{}})\n\t\tif err != nil {\n\t\t\t// 这里不需要返回错误，后续自动重试即可\n\t\t\tlogs.Error(ctx).Err(err).Stringer(\"uuid\", c.UUID).Msg(\"failed to complete cleanup defunct volume\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *ConfirmDRGroupExistsCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.DRGroup\n\t)\n\tfor _, spec := range c.DRGroup {\n\t\t_, err := repo.FindByName(ctx, users.AppID(c.AppID), spec.Name)\n\t\tif err != nil {\n\t\t\tif errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\t\tgroup := drgroup.New(spec.Name, users.AppID(c.AppID))\n\t\t\t\tif spec.Affinity > 0 {\n\t\t\t\t\tgroup.Affinity = spec.Affinity\n\t\t\t\t}\n\t\t\t\tif spec.Type != \"\" {\n\t\t\t\t\tgroup.Type = drgroup.LocType(spec.Type)\n\t\t\t\t}\n\t\t\t\terr = repo.Add(ctx, group)\n\t\t\t\tif err != nil {\n\t\t\t\t\treturn err\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t}\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *UpdatePhyRDiskCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEUpdatePhysicalVolume, c)\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "主记录存在时预加载Attachments",
            "sql": "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);"
          },
          {
            "scenario": "主记录不存在时不执行Attachments预加载",
            "sql": ""
          }
        ]
      },
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "主记录存在时预加载DmPhyDisk",
            "sql": "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
          },
          {
            "scenario": "主记录不存在时不执行DmPhyDisk预加载",
            "sql": ""
          }
        ]
      }
    ],
    "sql_types": [
      "SELECT",
      "PARAM_DEPENDENT",
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
    "orm_code": "func (l logicalVolumeRepositoryImpl) FindByID(ctx context.Context, id uuid.UUID) (*rdiskDomain.LogicalVolume, error) {\n\tuow := getUow(ctx)\n\tvol := metadb.DmRdisk{}\n\tresult := uow.tx.\n\t\tPreload(\"Attachments\").\n\t\tPreload(\"DmPhyDisk\").\n\t\tFirst(&vol, \"uuid = ?\", id.String())\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tlv, err := fromDmRDiskToModel(ctx, &vol)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tlv = uow.trackedLogicalVolumes.Add(lv)\n\tif lv.PhysicalVolume != nil {\n\t\tlv.PhysicalVolume = uow.trackedPhyVolumes.Add(lv.PhysicalVolume)\n\t}\n\treturn lv, nil\n}",
    "caller": "func (c *RecycleBackupDataCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepos = app.GetRegistry(ctx).Repositories\n\t\tsm    = app.GetRegistry(ctx).StateMachines.Backup\n\t)\n\n\tbak, err := repos.Backup.FindByUUID(ctx, c.UUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvol, err := repos.LogicalVolume.FindByID(ctx, bak.DiskInfo.VolumeUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBackup = bak\n\tc.relatedVolume = vol\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tbak.Status,\n\t\tbackupDomain.EventDeleteBackup,\n\t\tbackupDomain.Data{Backup: bak, Delegate: &backupDelegate{Data: c}})\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE uuid = ? ORDER BY `dm_rdisk`.`id` LIMIT 1;",
      "SELECT * FROM `dm_rdisk_attachment` WHERE `dm_rdisk_attachment`.`uuid` IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:31:52:FindByNames",
    "orm_code": "func (d drgroupRepositoryImpl) FindByNames(ctx context.Context, appId users.AppID, names []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\tresult := uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = uow.trackedDRGroups.Add(fromDmDRGroupToModel(&group[i]))\n\t}\n\treturn results, nil\n}",
    "caller": "",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name in ?;",
      "SELECT * FROM `dm_drgroup_members` WHERE (`dm_drgroup_members`.`app_id`,`dm_drgroup_members`.`group_name`) IN (SELECT `dm_drgroup`.`app_id`,`dm_drgroup`.`name` FROM `dm_drgroup` WHERE app_id = ? AND name in ?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:31:52:FindByNames",
    "orm_code": "func (d drgroupRepositoryImpl) FindByNames(ctx context.Context, appId users.AppID, names []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\tresult := uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = uow.trackedDRGroups.Add(fromDmDRGroupToModel(&group[i]))\n\t}\n\treturn results, nil\n}",
    "caller": "func (d drgroupRepositoryImpl) FindByName(ctx context.Context, appId users.AppID, name string) (*drgroup.DRGroup, error) {\n\tresults, err := d.FindByNames(ctx, appId, []string{name})\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tif len(results) < 1 {\n\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t}\n\treturn results[0], nil\n}",
    "sql_statement_list": [
      "SELECT d.id, d.status, d.app_id, d.name, d.affinity, d.loc_type, d.satisfied, d.member_cnt, d.extra, d.created, d.updated, m.id, m.app_id, m.group_name, m.member_id, m.created, m.updated FROM dm_drgroup d LEFT JOIN dm_drgroup_members m ON d.app_id = m.app_id AND d.name = m.group_name WHERE d.app_id = ? AND d.name IN (?);"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:31:52:FindByNames",
    "orm_code": "func (d drgroupRepositoryImpl) FindByNames(ctx context.Context, appId users.AppID, names []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\tresult := uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = uow.trackedDRGroups.Add(fromDmDRGroupToModel(&group[i]))\n\t}\n\treturn results, nil\n}",
    "caller": "func (d *drgroupViewerImpl) FindByName(ctx context.Context, appId users.AppID, name string) (*drgroup.View, error) {\n\tvar (\n\t\tresultView drgroup.View\n\t\tdataObject metadb.DmDrgroup\n\t)\n\n\tresult := d.db.WithContext(ctx).First(&dataObject, \"app_id = ? and name = ?\", appId, name)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"group not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\td.translate(&dataObject, &resultView)\n\treturn &resultView, nil\n}",
    "sql_statement_list": [
      "SELECT `dm_drgroup`.`id`,`dm_drgroup`.`status`,`dm_drgroup`.`app_id`,`dm_drgroup`.`name`,`dm_drgroup`.`affinity`,`dm_drgroup`.`loc_type`,`dm_drgroup`.`satisfied`,`dm_drgroup`.`member_cnt`,`dm_drgroup`.`extra`,`dm_drgroup`.`created`,`dm_drgroup`.`updated`,`DmDrgroupMembers`.`id`,`DmDrgroupMembers`.`app_id`,`DmDrgroupMembers`.`group_name`,`DmDrgroupMembers`.`member_id`,`DmDrgroupMembers`.`member_type`,`DmDrgroupMembers`.`location`,`DmDrgroupMembers`.`created`,`DmDrgroupMembers`.`updated` FROM `dm_drgroup` LEFT JOIN `dm_drgroup_members` `DmDrgroupMembers` ON `dm_drgroup`.`app_id` = `DmDrgroupMembers`.`app_id` AND `dm_drgroup`.`name` = `DmDrgroupMembers`.`group_name` WHERE app_id = ? and name in ?;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:31:52:FindByNames",
    "orm_code": "func (d drgroupRepositoryImpl) FindByNames(ctx context.Context, appId users.AppID, names []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\tresult := uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = uow.trackedDRGroups.Add(fromDmDRGroupToModel(&group[i]))\n\t}\n\treturn results, nil\n}",
    "caller": "func (m *MockRepository) FindByName(arg0 context.Context, arg1 users.AppID, arg2 string) (*drgroup.DRGroup, error) {\n\tm.ctrl.T.Helper()\n\tret := m.ctrl.Call(m, \"FindByName\", arg0, arg1, arg2)\n\tret0, _ := ret[0].(*drgroup.DRGroup)\n\tret1, _ := ret[1].(error)\n\treturn ret0, ret1\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name IN ?;",
      "SELECT * FROM `dm_drgroup_members` WHERE (`app_id`,`group_name`) IN (SELECT `app_id`,`name` FROM `dm_drgroup` WHERE app_id = ? AND name IN ?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:31:52:FindByNames",
    "orm_code": "func (d drgroupRepositoryImpl) FindByNames(ctx context.Context, appId users.AppID, names []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\tresult := uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = uow.trackedDRGroups.Add(fromDmDRGroupToModel(&group[i]))\n\t}\n\treturn results, nil\n}",
    "caller": "func (mr *MockRepositoryMockRecorder) FindByName(arg0, arg1, arg2 interface{}) *gomock.Call {\n\tmr.mock.ctrl.T.Helper()\n\treturn mr.mock.ctrl.RecordCallWithMethodType(mr.mock, \"FindByName\", reflect.TypeOf((*MockRepository)(nil).FindByName), arg0, arg1, arg2)\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name IN ?;",
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "当主查询返回结果时执行预加载查询",
            "sql": "SELECT * FROM `dm_drgroup_members` WHERE (app_id,group_name) IN ((?,?));"
          },
          {
            "scenario": "当主查询返回多条结果时执行预加载查询",
            "sql": "SELECT * FROM `dm_drgroup_members` WHERE (app_id,group_name) IN ((?,?),(?,?),(?,?));"
          }
        ]
      }
    ],
    "sql_types": [
      "SELECT",
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:31:52:FindByNames",
    "orm_code": "func (d drgroupRepositoryImpl) FindByNames(ctx context.Context, appId users.AppID, names []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\tresult := uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = uow.trackedDRGroups.Add(fromDmDRGroupToModel(&group[i]))\n\t}\n\treturn results, nil\n}",
    "caller": "func (m *MockViewer) FindByName(arg0 context.Context, arg1 users.AppID, arg2 string) (*drgroup.View, error) {\n\tm.ctrl.T.Helper()\n\tret := m.ctrl.Call(m, \"FindByName\", arg0, arg1, arg2)\n\tret0, _ := ret[0].(*drgroup.View)\n\tret1, _ := ret[1].(error)\n\treturn ret0, ret1\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM `dm_drgroup_members` WHERE (`app_id`,`group_name`) IN ((?),(?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:31:52:FindByNames",
    "orm_code": "func (d drgroupRepositoryImpl) FindByNames(ctx context.Context, appId users.AppID, names []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\tresult := uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = uow.trackedDRGroups.Add(fromDmDRGroupToModel(&group[i]))\n\t}\n\treturn results, nil\n}",
    "caller": "func (mr *MockViewerMockRecorder) FindByName(arg0, arg1, arg2 interface{}) *gomock.Call {\n\tmr.mock.ctrl.T.Helper()\n\treturn mr.mock.ctrl.RecordCallWithMethodType(mr.mock, \"FindByName\", reflect.TypeOf((*MockViewer)(nil).FindByName), arg0, arg1, arg2)\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name IN ?;",
      "SELECT * FROM `dm_drgroup_members` WHERE (`app_id`,`group_name`) IN (SELECT `app_id`,`name` FROM `dm_drgroup` WHERE app_id = ? AND name IN ?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup_members` WHERE app_id = ? AND member_id IN (?);",
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "主查询dm_drgroup表",
            "sql": "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name IN (?);"
          },
          {
            "scenario": "预加载Members关联查询",
            "sql": "SELECT * FROM `dm_drgroup_members` WHERE `dm_drgroup_members`.`app_id` IN (?) AND `dm_drgroup_members`.`group_name` IN (?);"
          }
        ]
      }
    ],
    "sql_types": [
      "SELECT",
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *CbsAppIdConsumer) Handle(ctx context.Context, delivery *rabbitmq.Delivery) error {\n\tu, chargeTime, err := c.ParseDelivery(ctx, delivery)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif u == nil {\n\t\tlogs.Info(c.Ctx).\n\t\t\tTime(\"chargeTime\", chargeTime).\n\t\t\tMsg(\"USER_INFO_NOT_FOUND\")\n\t\treturn nil\n\t}\n\n\tchargeDetail := c.GetChargeDetailForSingleUser(u, chargeTime)\n\tif chargeDetail == nil {\n\t\tlogs.Info(c.Ctx).\n\t\t\tUint64(\"appId\", uint64(u.AppId)).\n\t\t\tTime(\"chargeTime\", chargeTime).\n\t\t\tMsg(\"NO_RESOURCE_TO_CHARGE\")\n\t\treturn nil\n\t}\n\treturn c.ProcessChargeDetail(chargeDetail)\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_drgroup_members WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM dm_drgroup WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM dm_drgroup_members WHERE (app_id, group_name) IN (SELECT app_id, name FROM dm_drgroup WHERE app_id = ? AND name IN (?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *DefunctPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tif err := c.ensureLocks(ctx); err != nil {\n\t\treturn err\n\t}\n\tif c.lvUUID != nil {\n\t\t// 涉及到逻辑卷时，需要先标记逻辑卷为故障\n\t\treturn c.handleBindedVolume(ctx)\n\t} else {\n\t\t// 不涉及到逻辑卷时，直接标记物理卷为故障\n\t\treturn c.handleIdleVolume(ctx)\n\t}\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_drgroup_members WHERE app_id = ? AND member_id IN (?);",
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "查询DRGroup信息",
            "sql": "SELECT * FROM dm_drgroup WHERE app_id = ? AND name IN (?);"
          },
          {
            "scenario": "预加载Members关联数据",
            "sql": "SELECT * FROM dm_drgroup_members WHERE (app_id, group_name) IN ((?, ?));"
          }
        ]
      }
    ],
    "sql_types": [
      "SELECT",
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *DetachLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByAppIDAndUUID(ctx, c.AppID, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEDetachLogicalVolume, c)\n\n\t// 如果没有挂载到指定的主机上，则直接返回成功\n\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotAttachedToHost) {\n\t\tlogs.Info(ctx).Str(\"uuid\", c.UUID.String()).Str(\"host_ip\", c.IP.String()).\n\t\t\tMsg(\"volume not attached to host\")\n\t\treturn nil\n\t}\n\n\treturn err\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *CreateBenchmarkCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tvolSm     = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\tvolRepo   = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\terr       error\n\t)\n\n\tc.relatedVolume, err = volRepo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = volSm.Fire(ctx, c.relatedVolume.State, domain.PVEStartBenchmark, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBenchmark = benchmark.New(benchmark.DiskInfo{\n\t\tSerial: string(c.relatedVolume.Serial),\n\t\tHostIP: c.relatedVolume.IP,\n\t\tBDF:    string(c.relatedVolume.BDF),\n\t})\n\n\tif err = benchRepo.Add(ctx, c.relatedBenchmark); err != nil {\n\t\tdelegate := &benchmarkDelegate{cmd: c}\n\t\tif _err := delegate.TaskFinishCallback(ctx, c.relatedBenchmark); _err != nil {\n\t\t\tlogs.Warn(ctx).Err(_err).Str(\"serial\", string(c.relatedVolume.Serial)).Msg(\"failed to rollback: create bdev\")\n\t\t}\n\t\treturn err\n\t}\n\n\t_, err = benchSm.Fire(ctx, c.relatedBenchmark.Status, benchmark.EventCreateBench,\n\t\tbenchmark.Data{Benchmark: c.relatedBenchmark, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (d *DeleteLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\td.volume, err = repo.FindByID(ctx, d.UUID)\n\tif err != nil {\n\t\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotExists) {\n\t\t\treturn nil\n\t\t}\n\t\treturn err\n\t}\n\n\tif e := d.volume.CheckDelete(); e != nil {\n\t\treturn e\n\t}\n\n\tif d.volume.AppID != d.AppID {\n\t\treturn errors.New(rdiskDomain.ErrAppIDMismatch, \"refuse to delet: app id mismatch\")\n\t}\n\n\td.drgroup, err = app.GetRegistry(ctx).Repositories.DRGroup.FindByMember(ctx, d.AppID, d.volume.UUID.String())\n\tif err != nil {\n\t\tif errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\td.drgroup = nil\n\t\t} else {\n\t\t\treturn err\n\t\t}\n\t}\n\n\tif err := d.checkDRGroupMatch(ctx); err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, d.volume.State, rdiskDomain.LVEMarkToRecycle, d)\n\treturn\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_drgroup_members WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM dm_drgroup WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM dm_drgroup_members WHERE (app_id,group_name) IN ((?,?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *ConfirmRecycledPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEConfirmRecycled, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *DeleteRDiskBackupCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tsm   = app.GetRegistry(ctx).StateMachines.Backup\n\t\trepo = app.GetRegistry(ctx).Repositories.Backup\n\t)\n\n\tc.relatedVolume, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil || c.relatedVolume == nil || c.relatedVolume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\tc.relatedBackup, err = repo.FindByUUID(ctx, c.BackupID.String())\n\tif err != nil || c.relatedBackup == nil || c.relatedBackup.AppID != c.AppID {\n\t\treturn errors.New(backupDomain.ErrBackupNotExist, \"backup not exists\")\n\t}\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tc.relatedBackup.Status,\n\t\tbackupDomain.EventSoftDeleteBackup,\n\t\tbackupDomain.Data{Delegate: &backupDelegate{Data: c}, Backup: c.relatedBackup})\n\n\treturn\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *CreateRDiskBackupCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tlvSm  = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t\tbakSm = app.GetRegistry(ctx).StateMachines.Backup\n\t\trepo  = app.GetRegistry(ctx).Repositories.Backup\n\t)\n\tc.relatedVolume, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil || c.relatedVolume == nil || c.relatedVolume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\t_, err = lvSm.Fire(ctx, c.relatedVolume.State, rdiskDomain.LVEBackupStarted, c)\n\tif err != nil {\n\t\treturn\n\t}\n\n\tlv := c.relatedVolume\n\tbackup := backupDomain.New(\n\t\tlv.AppID,\n\t\tbackupDomain.DiskInfo{\n\t\t\tVolumeUUID: lv.UUID,\n\t\t\tVolumeSize: uint64(lv.Size),\n\t\t\tHostIP:     lv.PhysicalVolume.IP,\n\t\t\tHostBDF:    string(lv.PhysicalVolume.BDF),\n\t\t\tSerial:     string(lv.PhysicalVolume.Serial),\n\t\t},\n\t)\n\tif err := repo.Add(ctx, backup); err != nil {\n\t\treturn err\n\t}\n\tc.relatedBackup = backup\n\t_, err = bakSm.Fire(ctx, backupDomain.StatusInit, backupDomain.EventStartBackup, backupDomain.Data{Delegate: &backupDelegate{Data: c}, Backup: backup})\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_drgroup_members WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM dm_drgroup WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM dm_drgroup_members WHERE (app_id, group_name) IN (SELECT app_id, name FROM dm_drgroup WHERE app_id = ? AND name IN (?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *AttachLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByAppIDAndUUID(ctx, c.AppID, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEAttachLogicalVolume, c)\n\n\t// 如果已经挂载到了指定的主机上，则直接返回成功\n\tif errors.IsCode(err, rdiskDomain.ErrVolumeAlreadyAttachedToHost) {\n\t\tlogs.Info(ctx).Str(\"uuid\", c.UUID.String()).Str(\"host_ip\", c.IP.String()).\n\t\t\tMsg(\"volume already attached to host\")\n\t\treturn nil\n\t}\n\n\treturn err\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *ConfirmDeleteLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\t// 如果逻辑卷不存在，则直接返回成功\n\t\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotExists) {\n\t\t\treturn nil\n\t\t}\n\t\treturn err\n\t}\n\n\tif c.volume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrAppIDMismatch, \"failed to confirm delete: app id mismatch\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEDeleteLogicalVolume, c)\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup_members` WHERE app_id = ? AND member_id IN (?);",
      "SELECT `dm_drgroup`.`id`,`dm_drgroup`.`status`,`dm_drgroup`.`app_id`,`dm_drgroup`.`name`,`dm_drgroup`.`affinity`,`dm_drgroup`.`loc_type`,`dm_drgroup`.`satisfied`,`dm_drgroup`.`member_cnt`,`dm_drgroup`.`extra`,`dm_drgroup`.`created`,`dm_drgroup`.`updated` FROM `dm_drgroup` WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM `dm_drgroup_members` WHERE `dm_drgroup_members`.`app_id` IN (?) AND `dm_drgroup_members`.`group_name` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *OfflinePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEOfflinePhysicalVolume, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup_members` WHERE app_id = ? and member_id in ?;",
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? and name in ?;"
    ],
    "sql_types": [
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *DeletePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\t// 如果物理卷不存在，则直接幂等返回\n\t\treturn nil\n\t}\n\n\tvar event = domain.PVEDeletePhysicalVolume\n\tif c.Force && (c.relatedVolume.State == domain.PVSDefunct) {\n\t\t// 这里的实现不太好，状态机的逻辑不应该侵入 cmd\n\t\t// 时间太赶了，后续重构优化吧\n\t\tevent = domain.PVEForceDeleteForDefunct\n\t}\n\n\tif c.relatedVolume.HasBindedPV() {\n\t\treturn errors.New(domain.ErrVolumeBusy, \"logic volume has binded to this physical volume\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, event, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_drgroup_members WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM dm_drgroup WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM dm_drgroup_members WHERE (app_id, group_name) IN (SELECT app_id, name FROM dm_drgroup WHERE app_id = ? AND name IN (?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *CleanupLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVECleanupLogicalVolume, c)\n\n\treturn err\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *ConfirmInitPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\tif c.relatedVolume.IP.String() != c.Host.String() {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume host ip mistmatch\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVECreatePhysicalVolumeOnHost, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup_members` WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM `dm_drgroup_members` WHERE (`app_id`,`group_name`) IN (SELECT `app_id`,`name` FROM `dm_drgroup` WHERE app_id = ? AND name IN (?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *CreatePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\n\t// 获取物理卷状态机\n\tsm := app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\trepo := app.GetRegistry(ctx).Repositories.PhysicalVolume\n\n\t// 检查物理卷是否已经存在，如果存在则直接幂等返回\n\tvol1, err := repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil && !errors.IsCode(err, domain.ErrPhysicalVolumeNotExists) {\n\t\tlogs.Warn(ctx).Err(err).Str(\"serial\", c.Serial).Msg(\"failed query existing physical volume\")\n\t\treturn errors.Newf(domain.ErrQueryPhysicalVolumeFailed, \"failed query existing physical volume: %v\", err)\n\t}\n\tvol2, err := repo.FindByIPAndBDF(ctx, c.Host, domain.BDF(c.BDF))\n\tif err != nil && !errors.IsCode(err, domain.ErrPhysicalVolumeNotExists) {\n\t\tlogs.Warn(ctx).Err(err).Str(\"host\", c.Host.String()).Str(\"bdf\", c.BDF).Msg(\"failed query existing physical volume\")\n\t\treturn errors.Newf(domain.ErrQueryPhysicalVolumeFailed, \"failed query existing physical volume: %v\", err)\n\t}\n\tfor _, vol := range []*domain.PhysicalVolume{vol1, vol2} {\n\t\texisted, err := c.checkExisting(ctx, vol)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\tif existed {\n\t\t\treturn nil\n\t\t}\n\t}\n\n\t// 触发事件，创建物理卷\n\t_, err = sm.Fire(ctx,\n\t\tdomain.PVSUnInited,\n\t\tdomain.PVECreatePhysicalVolume,\n\t\tc,\n\t)\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// 创建 Bdev 以及格式化移动到创建物理卷的状态机中\n\n\t// _, err = sm.Fire(ctx,\n\t// \tc.GetPhysicalVolume().State,\n\t// \tdomain.PVECreatePhysicalVolumeOnHost,\n\t// \tc,\n\t// )\n\t// if err != nil {\n\t// \treturn err\n\t// }\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *DeleteBenchmarkCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\terr       error\n\t)\n\n\tbench, err := benchRepo.FindByUUID(ctx, c.BenchmarkUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif bench.DiskInfo.Serial != c.Serial {\n\t\treturn errors.Newf(benchmark.ErrTaskNotFound, \"benchmark serial not match %s, want %s\", c.Serial, bench.DiskInfo.Serial)\n\t}\n\n\t_, err = benchSm.Fire(ctx, bench.Status, benchmark.EventDeleteBench, benchmark.Data{Benchmark: bench, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif err := benchRepo.Delete(ctx, bench); err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *CreateLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tpvRepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tlvRepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm     = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\t// 1. 查找底层物理卷\n\tc.selectedPhysicalVolume, err = pvRepo.FindBySerial(ctx, rdiskDomain.Serial(c.PhysicalVolumeSerial))\n\tif err != nil {\n\t\treturn\n\t}\n\n\t// 检查底层物理卷大小是否满足要求\n\tif c.selectedPhysicalVolume.Size < rdiskDomain.Size(c.DiskSize) {\n\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume size %d is smaller than requested size %d\", c.selectedPhysicalVolume.Size, c.DiskSize)\n\t}\n\n\t// 检查底层物理卷性能等级是否满足要求\n\tif c.PerformanceRank != \"\" {\n\t\tif string(c.selectedPhysicalVolume.PerformanceRank) != c.PerformanceRank {\n\t\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume performance rank %s is not match requested rank %s\", c.selectedPhysicalVolume.PerformanceRank, c.PerformanceRank)\n\t\t}\n\t} else {\n\t\tif c.selectedPhysicalVolume.PerformanceRank != rdiskDomain.DefaultPerformanceRank {\n\t\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume performance rank %s is not default rank %s\", c.selectedPhysicalVolume.PerformanceRank, rdiskDomain.DefaultPerformanceRank)\n\t\t}\n\t}\n\n\t// 2. 创建逻辑卷\n\tvol := rdiskDomain.NewLogicalVolume(users.AppID(c.AppID), rdiskDomain.Size(c.DiskSize), rdiskDomain.ZoneID(c.ZoneID))\n\tif c.VolumeType != \"\" {\n\t\tvol.VolumeType = rdiskDomain.VolumeType(c.VolumeType)\n\t}\n\tif c.DiskType != \"\" {\n\t\tvol.DiskType = rdiskDomain.DiskType(c.DiskType)\n\t}\n\terr = lvRepo.Add(ctx, vol)\n\tif err != nil {\n\t\treturn\n\t}\n\tc.createdLogicalVolume = vol\n\n\t// 3. 触发状态机，联动更新逻辑卷和物理卷状态\n\t_, err = sm.Fire(ctx, rdiskDomain.LVSUnInited, rdiskDomain.LVECreateLogicalVolume, c)\n\treturn\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *UpdateRunningBackupTaskCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepos = app.GetRegistry(ctx).Repositories\n\t\tsm    = app.GetRegistry(ctx).StateMachines.Backup\n\t)\n\n\tbak, err := repos.Backup.FindByUUID(ctx, c.UUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvol, err := repos.LogicalVolume.FindByID(ctx, bak.DiskInfo.VolumeUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBackup = bak\n\tc.relatedVolume = vol\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tbak.Status,\n\t\tbackupDomain.EventUpdateBackupProgress,\n\t\tbackupDomain.Data{Backup: bak, Delegate: &backupDelegate{Data: c}})\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *UpdateLogicalVolumeDRGroupCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tlvView  = app.GetRegistry(ctx).Viewers.LogicalVolume\n\t\tdrgRepo = app.GetRegistry(ctx).Repositories.DRGroup\n\t\tsm      = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t\terr     error\n\t)\n\n\t// 0. 初始化\n\tc.drgroupRef = make(map[string]*drgroup.DRGroup)\n\n\t// 1. 加载所有逻辑卷所在的置放群组\n\tallVolumeUUIDs := make([]string, 0, len(c.UUIDs))\n\tfor _, _uuid := range c.UUIDs {\n\t\tallVolumeUUIDs = append(allVolumeUUIDs, _uuid.String())\n\t}\n\tif groups, err := drgRepo.FindByMembers(ctx, c.AppID, allVolumeUUIDs); err == nil {\n\t\tif err != nil {\n\t\t\tif !errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t\tfor _, group := range groups {\n\t\t\tc.drgroupRef[group.Name] = group\n\t\t\tc.curDRGroupNames = append(c.curDRGroupNames, group.Name)\n\t\t}\n\t} else {\n\t\treturn err\n\t}\n\n\t// 2. 确认已上锁的置放群组和当前一致\n\tif !c.checkLockedDRGroupNames() {\n\t\treturn errors.New(drgroup.ErrGroupModified, \"drgroup changed\")\n\t}\n\n\t// 3. 加载所有逻辑卷的状态，不需要完整实体，因为不会修改 Volume\n\tc.relatedLogicalVolume, err = lvView.FindByIDs(ctx, c.AppID, c.UUIDs)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif len(c.relatedLogicalVolume) < len(c.UUIDs) {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\t// 4. 加载所有目标置放群组，key 为 name\n\tfor _, spec := range c.Specs {\n\t\tvar group *drgroup.DRGroup\n\t\tif _, ok := c.drgroupRef[spec.Name]; ok {\n\t\t\tgroup = c.drgroupRef[spec.Name]\n\t\t} else {\n\t\t\tgroup, err = c.getOrCreateDRGroup(ctx, drgRepo, spec)\n\t\t\tif err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t\tc.drgroupRef[group.Name] = group\n\t\t}\n\n\t\tif spec.Affinity > 0 {\n\t\t\tgroup.Affinity = spec.Affinity\n\t\t}\n\t\tif spec.Type != \"\" {\n\t\t\tgroup.Type = drgroup.LocType(spec.Type)\n\t\t}\n\t}\n\n\t// 5. 对所有逻辑卷执行置放群组变更事件，检查状态是否允许，\n\t//    实际的更新还是在这里执行。\n\tfor _, vol := range c.relatedLogicalVolume {\n\t\terr := sm.Check(ctx, vol.State, rdiskDomain.LVEUpdateDrGroup, c)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\t// 将逻辑卷从原有的置放群组中移除\n\t\tfor _, name := range c.curDRGroupNames {\n\t\t\tc.drgroupRef[name].RemoveMember(vol.UUID.String())\n\t\t}\n\t\t// 将逻辑卷添加到新的置放群组中\n\t\tfor _, spec := range c.Specs {\n\t\t\tsubGroup := spec.SubGroup\n\t\t\tif subGroup == \"\" {\n\t\t\t\t// 如果没有指定子组，则使用远端 SSD UUID 作为子组名称\n\t\t\t\t// 相当于每块盘都是一个子组，相当于没有使用子组功能\n\t\t\t\tsubGroup = vol.UUID.String()\n\t\t\t}\n\t\t\tif err := c.drgroupRef[spec.Name].AddMember(vol.UUID.String(), subGroup, vol.PhysicalVolume.IP.String()); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t}\n\n\tif c.DryRun {\n\t\treturn errors.New(errors.ErrDryRunSuccessExit, \"dry run check success\")\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup_members` WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM `dm_drgroup_members` WHERE (`dm_drgroup_members`.`app_id`,`dm_drgroup_members`.`group_name`) IN ((?,?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *OnlinePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEOnlinePhysicalVolume, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *UpdateBenchmarkTask) Handle(ctx context.Context) error {\n\tvar (\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\tvolRepo   = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\terr       error\n\t)\n\n\tc.relatedVolume, err = volRepo.FindBySerial(ctx, rdisk.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBenchmark, err = benchRepo.FindByUUID(ctx, c.BenchmarkUUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = benchSm.Fire(ctx, c.relatedBenchmark.Status, benchmark.EventUpdateBench, benchmark.Data{Benchmark: c.relatedBenchmark, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *UpdateLogicalVolumeFlowControlCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif c.volume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not found\")\n\t}\n\n\tspec := c.volume.FlowControlSpec\n\tif !c.UpdateRequest.UpdateSpec(&spec, c.volume.GetDefaultFlowControlSpec()) {\n\t\t// 没有任何更新，直接返回成功\n\t\treturn nil\n\t}\n\tc.volume.SetFlowControlSpec(spec)\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEUpdateFlowControl, c)\n\treturn err\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *CleanupDefunctCommand) Handle(ctx context.Context) error {\n\tvar err error\n\tc.lv, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvar sm = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\tvar event = rdiskDomain.LVECleanupDefunct\n\n\tfor _, attachment := range c.lv.Attachments {\n\t\tlogs.Info(ctx).Stringer(\"uuid\", c.UUID).Stringer(\"host\", attachment.IP).Msg(\"cleanup defuncting volume\")\n\t\tsubCmd := &cleanDefunctSubCommand{Parent: c, HostIP: attachment.IP}\n\t\t_, err = sm.Fire(ctx, c.lv.State, event, subCmd)\n\t\tif err != nil {\n\t\t\t// 这里不需要返回错误，因为只要有一个挂载点清理失败，其他挂载点还是需要继续清理的\n\t\t\t// 失败的挂载点会在后台继续清理\n\t\t\tlogs.Error(ctx).Err(err).Stringer(\"uuid\", c.UUID).Stringer(\"host\", attachment.IP).\n\t\t\t\tMsg(\"failed to cleanup defunct volume, retry later.\")\n\t\t}\n\t}\n\n\tif len(c.lv.Attachments) == 0 {\n\t\t// 没有挂载点，直接清理\n\t\t_, err = sm.Fire(ctx, c.lv.State, event, &cleanDefunctSubCommand{Parent: c, HostIP: net.IP{}})\n\t\tif err != nil {\n\t\t\t// 这里不需要返回错误，后续自动重试即可\n\t\t\tlogs.Error(ctx).Err(err).Stringer(\"uuid\", c.UUID).Msg(\"failed to complete cleanup defunct volume\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *ConfirmDRGroupExistsCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.DRGroup\n\t)\n\tfor _, spec := range c.DRGroup {\n\t\t_, err := repo.FindByName(ctx, users.AppID(c.AppID), spec.Name)\n\t\tif err != nil {\n\t\t\tif errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\t\tgroup := drgroup.New(spec.Name, users.AppID(c.AppID))\n\t\t\t\tif spec.Affinity > 0 {\n\t\t\t\t\tgroup.Affinity = spec.Affinity\n\t\t\t\t}\n\t\t\t\tif spec.Type != \"\" {\n\t\t\t\t\tgroup.Type = drgroup.LocType(spec.Type)\n\t\t\t\t}\n\t\t\t\terr = repo.Add(ctx, group)\n\t\t\t\tif err != nil {\n\t\t\t\t\treturn err\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t}\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_drgroup_members WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM dm_drgroup WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM dm_drgroup_members WHERE (app_id, group_name) IN ((?), (?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *UpdatePhyRDiskCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEUpdatePhysicalVolume, c)\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *RecycleBackupDataCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepos = app.GetRegistry(ctx).Repositories\n\t\tsm    = app.GetRegistry(ctx).StateMachines.Backup\n\t)\n\n\tbak, err := repos.Backup.FindByUUID(ctx, c.UUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvol, err := repos.LogicalVolume.FindByID(ctx, bak.DiskInfo.VolumeUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBackup = bak\n\tc.relatedVolume = vol\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tbak.Status,\n\t\tbackupDomain.EventDeleteBackup,\n\t\tbackupDomain.Data{Backup: bak, Delegate: &backupDelegate{Data: c}})\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup_members` WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM `dm_drgroup_members` WHERE (`app_id`,`group_name`) IN (SELECT `app_id`,`name` FROM `dm_drgroup` WHERE app_id = ? AND name IN (?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *DefunctPhysicalVolumeCommand) Prepare(ctx context.Context) error {\n\tvar err error\n\tc.aquiredLocks, err = c.queryRequiredLocks(ctx)\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup_members` WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM `dm_drgroup_members` WHERE (`app_id`,`group_name`) IN (SELECT `app_id`,`name` FROM `dm_drgroup` WHERE app_id = ? AND name IN (?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (d *DeleteLogicalVolumeCommand) Prepare(ctx context.Context) error {\n\t// 为什么需要先查询逻辑卷所在的置放群组呢？\n\t//\n\t// 为了避免进行并发修改置放群组产生竞争，必须要在启动时就得到置放群组名称以进行加锁。\n\t// 但是入参中带上置放群组名称显然已不合适，所以需要在 Prepare 阶段进行查询。\n\t// 然后在加锁后，在 Handle 阶段还需要进行校验，形成乐观锁的。\n\t// 如果 Handle 阶段查询到的置放群组 Name 和 Prepare 阶段查询到的不一致，则需要报错退出。\n\tviewer := app.GetRegistry(ctx).Viewers.DRGroup\n\n\t// 查找逻辑卷所在的置放群组\n\tgroup, err := viewer.FindByMembers(ctx, d.AppID, []string{d.UUID.String()})\n\tif err != nil {\n\t\tif errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\treturn nil\n\t\t}\n\t\treturn err\n\t}\n\n\tfor _, group := range group {\n\t\td.relatedDRGroupNames = append(d.relatedDRGroupNames, group.Name)\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_drgroup_members WHERE app_id = ? AND member_id IN (?);",
      "SELECT `dm_drgroup`.`id`,`dm_drgroup`.`status`,`dm_drgroup`.`app_id`,`dm_drgroup`.`name`,`dm_drgroup`.`affinity`,`dm_drgroup`.`loc_type`,`dm_drgroup`.`satisfied`,`dm_drgroup`.`member_cnt`,`dm_drgroup`.`extra`,`dm_drgroup`.`created`,`dm_drgroup`.`updated`,`Members`.`id` AS `Members__id`,`Members`.`app_id` AS `Members__app_id`,`Members`.`group_name` AS `Members__group_name`,`Members`.`sub_group` AS `Members__sub_group`,`Members`.`loc` AS `Members__loc`,`Members`.`member_id` AS `Members__member_id`,`Members`.`extra` AS `Members__extra`,`Members`.`created` AS `Members__created`,`Members`.`updated` AS `Members__updated` FROM `dm_drgroup` LEFT JOIN `dm_drgroup_members` `Members` ON `dm_drgroup`.`app_id` = `Members`.`app_id` AND `dm_drgroup`.`name` = `Members`.`group_name` WHERE app_id = ? AND name IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *UpdateLogicalVolumeDRGroupCommand) Prepare(ctx context.Context) error {\n\tview := app.GetRegistry(ctx).Viewers.DRGroup\n\tc.lockedDRGroupNames = make([]string, 0, len(c.Specs)*2)\n\tallGroupNames := make(map[string]interface{})\n\tallMembers := make([]string, 0, len(c.UUIDs))\n\tfor _, _uuid := range c.UUIDs {\n\t\tallMembers = append(allMembers, _uuid.String())\n\t}\n\tcurrentGroups, err := view.FindByMembers(ctx, c.AppID, allMembers)\n\tif err != nil {\n\t\tif errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t} else {\n\t\t\treturn err\n\t\t}\n\t}\n\tfor _, group := range currentGroups {\n\t\tallGroupNames[group.Name] = nil\n\t}\n\tfor _, spec := range c.Specs {\n\t\tallGroupNames[spec.Name] = nil\n\t}\n\tfor name := range allGroupNames {\n\t\tc.lockedDRGroupNames = append(c.lockedDRGroupNames, name)\n\t}\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_drgroup_members WHERE app_id = ? AND member_id IN (?);",
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "预加载Members的主查询",
            "sql": "SELECT * FROM dm_drgroup WHERE app_id = ? AND name IN (?);"
          },
          {
            "scenario": "预加载Members的关联查询",
            "sql": "SELECT * FROM dm_drgroup_members WHERE (app_id, group_name) IN ((?, ?));"
          }
        ]
      }
    ],
    "sql_types": [
      "SELECT",
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (c *DefunctPhysicalVolumeCommand) queryDRGroup(ctx context.Context, lv string, appId users.AppID) ([]*drgroup.View, error) {\n\tgroups, err := app.GetRegistry(ctx).Viewers.DRGroup.FindByMembers(ctx, appId, []string{lv})\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn groups, nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup_members` WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM `dm_drgroup_members` WHERE (`app_id`,`group_name`) IN (?,?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (d drgroupRepositoryImpl) FindByMember(ctx context.Context, appId users.AppID, member string) ([]*drgroup.DRGroup, error) {\n\treturn d.FindByMembers(ctx, appId, []string{member})\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_drgroup_members WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM dm_drgroup WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM dm_drgroup_members WHERE (app_id,group_name) IN (SELECT app_id,name FROM dm_drgroup WHERE app_id = ? AND name IN (?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (m *MockRepository) FindByMember(arg0 context.Context, arg1 users.AppID, arg2 string) ([]*drgroup.DRGroup, error) {\n\tm.ctrl.T.Helper()\n\tret := m.ctrl.Call(m, \"FindByMember\", arg0, arg1, arg2)\n\tret0, _ := ret[0].([]*drgroup.DRGroup)\n\tret1, _ := ret[1].(error)\n\treturn ret0, ret1\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_drgroup_members` WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM `dm_drgroup` WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM `dm_drgroup_members` WHERE (`dm_drgroup_members`.`app_id`,`dm_drgroup_members`.`group_name`) IN ((?),(?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/drgroup.go:58:94:FindByMembers",
    "orm_code": "func (d drgroupRepositoryImpl) FindByMembers(ctx context.Context, appId users.AppID, members []string) ([]*drgroup.DRGroup, error) {\n\tuow := getUow(ctx)\n\tgroup := []metadb.DmDrgroup{}\n\n\tmembersResult := []metadb.DmDrgroupMembers{}\n\tresult := uow.tx.\n\t\tFind(&membersResult, \"app_id = ? and member_id in ?\", appId, members)\n\tif result.Error != nil {\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tnames := make([]string, 0, len(members))\n\tfor i := range membersResult {\n\t\tnames = append(names, membersResult[i].GroupName)\n\t}\n\tresult = uow.tx.\n\t\tPreload(\"Members\").\n\t\tFind(&group, \"app_id = ? and name in ?\", appId, names)\n\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(drgroup.ErrGroupNotExist, \"disaster recovery group not exists\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tif result.RowsAffected == 0 {\n\t\treturn nil, nil\n\t}\n\tresults := make([]*drgroup.DRGroup, len(group))\n\tfor i := range group {\n\t\tresults[i] = fromDmDRGroupToModel(&group[i])\n\t\tresults[i] = uow.trackedDRGroups.Add(results[i])\n\t}\n\treturn results, nil\n}",
    "caller": "func (mr *MockRepositoryMockRecorder) FindByMember(arg0, arg1, arg2 interface{}) *gomock.Call {\n\tmr.mock.ctrl.T.Helper()\n\treturn mr.mock.ctrl.RecordCallWithMethodType(mr.mock, \"FindByMember\", reflect.TypeOf((*MockRepository)(nil).FindByMember), arg0, arg1, arg2)\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_drgroup_members WHERE app_id = ? AND member_id IN (?);",
      "SELECT * FROM dm_drgroup WHERE app_id = ? AND name IN (?);",
      "SELECT * FROM dm_drgroup_members WHERE (app_id,group_name) IN ((?,?));"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 19,
        "code_end_line": 33,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus    int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName      string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity  int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType   string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tExtra     string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 114,
        "code_end_line": 129,
        "code_key": "DmDrgroup",
        "code_value": "type DmDrgroup struct {\n\tID          uint64    `gorm:\"column:id;primaryKey\"`                              // 主键 ID\n\tStatus      int       `gorm:\"column:status\"`                                     // 状态, 目前无用\n\tAppID       int64     `gorm:\"column:app_id;index:dm_drgroup_app_id_name,unique\"` // AppID\n\tName        string    `gorm:\"column:name;index:dm_drgroup_app_id_name,unique\"`   // DRGroup 名称，用户名下唯一\n\tAffinity    int       `gorm:\"column:affinity\"`                                   // 亲和性\n\tLocType     string    `gorm:\"column:loc_type\"`                                   // 位置类型，对应 HOST、RACK、SWITCH 等等\n\tSatisfied   int       `gorm:\"column:satisfied\"`                                  // 组内元素是否满足约束条件\n\tMemberCnt   int       `gorm:\"column:member_cnt\"`                                 // 组内元素数量\n\tSubGroupCnt int       `gorm:\"column:sub_group_cnt\"`                              // 子组数量\n\tExtra       string    `gorm:\"column:extra\"`                                      // 额外信息\n\tCreated     time.Time `gorm:\"column:created\"`\n\tUpdated     time.Time `gorm:\"column:updated\"`\n\n\tMembers []DmDrgroupMembers `gorm:\"foreignKey:AppID,GroupName;references:AppID,Name\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 131,
        "code_end_line": 133,
        "code_key": "TableName",
        "code_value": "func (*DmDrgroup) TableName() string {\n\treturn \"dm_drgroup\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 39,
        "code_end_line": 49,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 55,
        "code_end_line": 57,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/metadb.go",
        "code_start_line": 51,
        "code_end_line": 53,
        "code_key": "DBName",
        "code_value": "func (m DmDrgroupMembers) DBName() string {\n\treturn \"metadb\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 135,
        "code_end_line": 145,
        "code_key": "DmDrgroupMembers",
        "code_value": "type DmDrgroupMembers struct {\n\tID        uint64    `gorm:\"column:id;primaryKey\"`                                                          // 主键 ID\n\tAppID     int64     `gorm:\"column:app_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`     // AppID\n\tGroupName string    `gorm:\"column:group_name;index:dm_drgroup_members_app_id_group_name_member_id,unique\"` // DRGroup 名称，用户名下唯一\n\tSubGroup  string    `gorm:\"column:sub_group\"`                                                              // 子组名称\n\tLoc       string    `gorm:\"column:loc\"`                                                                    // 位置信息，例如母机 IP\n\tMemberID  string    `gorm:\"column:member_id;index:dm_drgroup_members_app_id_group_name_member_id,unique\"`  // DRGroup 成员 ID，例如逻辑卷 UUID\n\tExtra     string    `gorm:\"column:extra\"`                                                                  // 额外信息\n\tCreated   time.Time `gorm:\"column:created\"`\n\tUpdated   time.Time `gorm:\"column:updated\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 147,
        "code_end_line": 149,
        "code_key": "TableName",
        "code_value": "func (DmDrgroupMembers) TableName() string {\n\treturn \"dm_drgroup_members\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/drgroup/models.go",
        "code_start_line": 58,
        "code_end_line": 68,
        "code_key": "DRGroup",
        "code_value": "type DRGroup struct {\n\tID       uint64      // 群组 ID，用作实体 ID\n\tName     string      // 群组名称，在同一个 AppID 下必须唯一\n\tAppID    users.AppID // 群组所属应用 ID\n\tType     LocType     // 群组类型，保留字段\n\tAffinity int         // 亲和度，表示群组内子组在同一台位置上最多只能有多少个\n\n\tsubGroups    map[string]*SubGroup   // 子组\n\tlocationsMap map[string][]*SubGroup // 位置到子组的映射\n\tmembersMap   map[string]*SubGroup   // 成员到子组的映射\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:21:46:FindByStatus",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByStatus(ctx context.Context, status []rdiskDomain.LogicalVolumeState, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tif len(status) == 0 {\n\t\treturn nil, nil\n\t}\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"status in ?\",\n\t\tfunctools.Map(status, func(i rdiskDomain.LogicalVolumeState) int { return int(i) }))\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "无偏移量，使用默认限制10",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated` FROM `dm_rdisk` WHERE status in (?) LIMIT 10;"
          },
          {
            "scenario": "有偏移量，使用自定义限制",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated` FROM `dm_rdisk` WHERE status in (?) OFFSET ? LIMIT ?;"
          },
          {
            "scenario": "无偏移量，使用自定义限制",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated` FROM `dm_rdisk` WHERE status in (?) LIMIT ?;"
          }
        ]
      },
      "SELECT `dm_phy_disk`.`serial`,`dm_phy_disk`.`vendor`,`dm_phy_disk`.`model`,`dm_phy_disk`.`size`,`dm_phy_disk`.`zone_id`,`dm_phy_disk`.`disk_type`,`dm_phy_disk`.`status`,`dm_phy_disk`.`created`,`dm_phy_disk`.`updated` FROM `dm_phy_disk` WHERE `dm_phy_disk`.`serial` IN (?);"
    ],
    "sql_types": [
      "PARAM_DEPENDENT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/benchmark/benchmark.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Status",
        "code_value": "type Status int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/constants.go",
        "code_start_line": 19,
        "code_end_line": 19,
        "code_key": "LogicalVolumeState",
        "code_value": "type LogicalVolumeState int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:21:46:FindByStatus",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByStatus(ctx context.Context, status []rdiskDomain.LogicalVolumeState, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tif len(status) == 0 {\n\t\treturn nil, nil\n\t}\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"status in ?\",\n\t\tfunctools.Map(status, func(i rdiskDomain.LogicalVolumeState) int { return int(i) }))\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*UpdateBenchmarkTask) Work(ctx context.Context) error {\n\tvar (\n\t\tviewer     = app.GetRegistry(ctx).Viewers.Benchmark\n\t\tdispatcher = app.GetRegistry(ctx).Dispatcher\n\t)\n\n\t// 1. Find all running benchmarks\n\trunningStatus := []benchmark.Status{benchmark.StatusRunning}\n\tbenchs, err := viewer.FindByStatus(ctx, runningStatus)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// 2. Fire events to update running benchmarks\n\tlogs.Info(ctx).Int(\"count\", len(benchs)).Msg(\"starts to update benchmark data\")\n\tfor _, b := range benchs {\n\t\tcmd := &commands.UpdateBenchmarkTask{\n\t\t\tSerial:        b.DiskInfo.Serial,\n\t\t\tBenchmarkUUID: b.UUID,\n\t\t}\n\t\terr := dispatcher.Dispatch(ctx, cmd)\n\t\tif err != nil {\n\t\t\tlogs.Warn(ctx).Err(err).Str(\"uuid\", b.UUID.String()).Msg(\"update benchmark task failed\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "有偏移量的分页查询",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`model` AS `DmPhyDisk__model`,`DmPhyDisk`.`capacity` AS `DmPhyDisk__capacity`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE status in (?) OFFSET ? LIMIT ?;"
          },
          {
            "scenario": "无偏移量的分页查询",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`model` AS `DmPhyDisk__model`,`DmPhyDisk`.`capacity` AS `DmPhyDisk__capacity`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE status in (?) LIMIT ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/benchmark/benchmark.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Status",
        "code_value": "type Status int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/constants.go",
        "code_start_line": 19,
        "code_end_line": 19,
        "code_key": "LogicalVolumeState",
        "code_value": "type LogicalVolumeState int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:21:46:FindByStatus",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByStatus(ctx context.Context, status []rdiskDomain.LogicalVolumeState, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tif len(status) == 0 {\n\t\treturn nil, nil\n\t}\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"status in ?\",\n\t\tfunctools.Map(status, func(i rdiskDomain.LogicalVolumeState) int { return int(i) }))\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*CleanupDefunctTask) Work(ctx context.Context) error {\n\tvar err error\n\tvar batchSize uint64 = 1000\n\tvar defunctingVolumes []*rdiskDomain.LogicalVolume\n\tdefunctingVolumes, err = app.GetRegistry(ctx).Viewers.LogicalVolume.FindByStatus(\n\t\tctx, []rdiskDomain.LogicalVolumeState{rdiskDomain.LVSDefuncting}, rdiskDomain.Pagination{Limit: batchSize})\n\tif err != nil {\n\t\tlogs.Error(ctx).Err(err).Msg(\"failed to find defuncting volumes\")\n\t\treturn err\n\t}\n\tif len(defunctingVolumes) == 0 {\n\t\tlogs.Debug(ctx).Msg(\"no defuncting volumes found\")\n\t\treturn nil\n\t}\n\n\tlogs.Info(ctx).Int(\"count\", len(defunctingVolumes)).Msg(\"starts to cleanup defuncting volumes\")\n\n\tvar waitInterval = time.Second * 10\n\tvar dispatcher = app.GetRegistry(ctx).Dispatcher\n\tfor _, volume := range defunctingVolumes {\n\t\tif ctx.Err() != nil {\n\t\t\t// 上下文已经被取消, 退出\n\t\t\treturn ctx.Err()\n\t\t}\n\t\tfunc(volume *rdiskDomain.LogicalVolume) {\n\t\t\tlogs.Info(ctx).Stringer(\"uuid\", volume.UUID).Msg(\"cleanuping defunct volume\")\n\t\t\tsubCtx, cancel := context.WithTimeout(ctx, waitInterval)\n\t\t\tdefer cancel()\n\t\t\tcmd := &commands.CleanupDefunctCommand{UUID: volume.UUID}\n\t\t\tif err := dispatcher.Dispatch(subCtx, cmd); err != nil {\n\t\t\t\tif err == subCtx.Err() {\n\t\t\t\t\t// 等待超时了，在后台 dispatcher 会继续清理，这里直接返回\n\t\t\t\t\tlogs.Info(subCtx).Stringer(\"uuid\", volume.UUID).Msg(\"timeout waiting for cleanup defunct volume, move up to next\")\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tlogs.Error(subCtx).Err(err).Str(\"uuid\", volume.UUID.String()).Msg(\"failed to cleanup defunct volume\")\n\t\t\t\treturn\n\t\t\t}\n\t\t\tlogs.Info(subCtx).Stringer(\"uuid\", volume.UUID).Msg(\"cleanup defunct volume done\")\n\t\t}(volume)\n\t}\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.model, DmPhyDisk.capacity, DmPhyDisk.zone_id, DmPhyDisk.status, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.status IN (?) LIMIT 1000;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/benchmark/benchmark.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Status",
        "code_value": "type Status int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/constants.go",
        "code_start_line": 19,
        "code_end_line": 19,
        "code_key": "LogicalVolumeState",
        "code_value": "type LogicalVolumeState int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:21:46:FindByStatus",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByStatus(ctx context.Context, status []rdiskDomain.LogicalVolumeState, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tif len(status) == 0 {\n\t\treturn nil, nil\n\t}\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"status in ?\",\n\t\tfunctools.Map(status, func(i rdiskDomain.LogicalVolumeState) int { return int(i) }))\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*UpdateBackupTask) Work(ctx context.Context) error {\n\tvar (\n\t\tviewer     = app.GetRegistry(ctx).Viewers.Backup\n\t\tdispatcher = app.GetRegistry(ctx).Dispatcher\n\t)\n\n\t// 1. 查询所有正在备份的备份\n\tstatusList := []backup.BackupStatus{backup.StatusRunning}\n\tbaks, err := viewer.FindByStatus(ctx, statusList)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// 2. 更新备份进度\n\tlogs.Info(ctx).Int(\"count\", len(baks)).Msg(\"starts to update running backup task\")\n\tfor _, bak := range baks {\n\t\tcmd := &commands.UpdateRunningBackupTaskCommand{\n\t\t\tUUID: bak.UUID,\n\t\t}\n\t\terr := dispatcher.Dispatch(ctx, cmd)\n\t\tif err != nil {\n\t\t\tlogs.Warn(ctx).Err(err).Str(\"uuid\", bak.UUID.String()).Msg(\"update backup task failed\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "有OFFSET且LIMIT>0",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`model`,`DmPhyDisk`.`capacity`,`DmPhyDisk`.`status`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE status in (?) LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "无OFFSET且LIMIT>0",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`model`,`DmPhyDisk`.`capacity`,`DmPhyDisk`.`status`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE status in (?) LIMIT ?;"
          },
          {
            "scenario": "有OFFSET且LIMIT<=0使用默认值10",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`model`,`DmPhyDisk`.`capacity`,`DmPhyDisk`.`status`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE status in (?) LIMIT 10 OFFSET ?;"
          },
          {
            "scenario": "无OFFSET且LIMIT<=0使用默认值10",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`model`,`DmPhyDisk`.`capacity`,`DmPhyDisk`.`status`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE status in (?) LIMIT 10;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/benchmark/benchmark.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Status",
        "code_value": "type Status int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/constants.go",
        "code_start_line": 19,
        "code_end_line": 19,
        "code_key": "LogicalVolumeState",
        "code_value": "type LogicalVolumeState int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:21:46:FindByStatus",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByStatus(ctx context.Context, status []rdiskDomain.LogicalVolumeState, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tif len(status) == 0 {\n\t\treturn nil, nil\n\t}\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"status in ?\",\n\t\tfunctools.Map(status, func(i rdiskDomain.LogicalVolumeState) int { return int(i) }))\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*ConfirmInitPhysicalDiskTask) Work(ctx context.Context) error {\n\tvar (\n\t\tviewer     = app.GetRegistry(ctx).Viewers.PhysicalVolume\n\t\tdispatcher = app.GetRegistry(ctx).Dispatcher\n\t)\n\n\t// 1. 查询所有待初始化的物理卷\n\tcriteria := rdiskDomain.PVSearchCriteria{}\n\tcriteria.States = []rdiskDomain.PhysicalVolumeState{rdiskDomain.PVSInited}\n\tpagination := rdiskDomain.Pagination{Limit: 10}\n\n\tresults, err := viewer.Search(ctx, criteria, pagination)\n\tif err != nil {\n\t\tlogs.Warn(ctx).Err(err).Msg(\"search physical volume failed\")\n\t\treturn err\n\t}\n\n\tif len(results) == 0 {\n\t\tlogs.Debug(ctx).Msg(\"no physical volume to be initialized\")\n\t\treturn nil\n\t}\n\n\t// TODO: 是否可以增加一个退避机制，对于长时间没有成功初始化的物理卷，增加重试时间间隔\n\n\t// 2. 发起初始化\n\tlogs.Info(ctx).Int(\"count\", len(results)).Msg(\"starts to initialize disks\")\n\tfor _, vol := range results {\n\t\tcmd := &commands.ConfirmInitPhysicalVolumeCommand{\n\t\t\tSerial: string(vol.Serial),\n\t\t\tHost:   vol.IP,\n\t\t}\n\t\terr := dispatcher.Dispatch(ctx, cmd)\n\t\tif err != nil {\n\t\t\tlogs.Warn(ctx).Err(err).Str(\"serial\", string(vol.Serial)).Str(\"host_ip\", vol.IP.String()).Msg(\"confirm init physical volume failed\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/benchmark/benchmark.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Status",
        "code_value": "type Status int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/constants.go",
        "code_start_line": 19,
        "code_end_line": 19,
        "code_key": "LogicalVolumeState",
        "code_value": "type LogicalVolumeState int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:21:46:FindByStatus",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByStatus(ctx context.Context, status []rdiskDomain.LogicalVolumeState, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tif len(status) == 0 {\n\t\treturn nil, nil\n\t}\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"status in ?\",\n\t\tfunctools.Map(status, func(i rdiskDomain.LogicalVolumeState) int { return int(i) }))\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*RecycleBackupTask) Work(ctx context.Context) error {\n\tvar (\n\t\tviewer     = app.GetRegistry(ctx).Viewers.Backup\n\t\tdispatcher = app.GetRegistry(ctx).Dispatcher\n\t)\n\n\t// 1. 查询所有待删除的备份\n\tstatusList := []backup.BackupStatus{backup.StatusToDelete, backup.StatusFailed}\n\tbaks, err := viewer.FindByStatus(ctx, statusList)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// 2. 发起清理数据\n\tlogs.Info(ctx).Int(\"count\", len(baks)).Msg(\"starts to recycle backup data\")\n\tfor _, bak := range baks {\n\t\tcmd := &commands.RecycleBackupDataCommand{\n\t\t\tUUID: bak.UUID,\n\t\t}\n\t\terr := dispatcher.Dispatch(ctx, cmd)\n\t\tif err != nil {\n\t\t\tlogs.Warn(ctx).Err(err).Str(\"uuid\", bak.UUID.String()).Msg(\"update backup task failed\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "有偏移量的分页查询",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.model, DmPhyDisk.size, DmPhyDisk.type, DmPhyDisk.status, DmPhyDisk.zone_id, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.status IN (?, ?, ?) OFFSET ? LIMIT ?;"
          },
          {
            "scenario": "无偏移量的分页查询",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.model, DmPhyDisk.size, DmPhyDisk.type, DmPhyDisk.status, DmPhyDisk.zone_id, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.status IN (?, ?) LIMIT ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/benchmark/benchmark.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Status",
        "code_value": "type Status int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/constants.go",
        "code_start_line": 19,
        "code_end_line": 19,
        "code_key": "LogicalVolumeState",
        "code_value": "type LogicalVolumeState int",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "无UUID和Serial过滤条件，无偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.status, DmPhyDisk.app_id, DmPhyDisk.size, DmPhyDisk.zone_id, DmPhyDisk.disk_type, DmPhyDisk.read_iops, DmPhyDisk.read_bandwidth, DmPhyDisk.write_iops, DmPhyDisk.write_bandwidth, DmPhyDisk.rw_iops, DmPhyDisk.rw_bandwidth, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.app_id = ? LIMIT ?;"
          },
          {
            "scenario": "包含UUID过滤条件，无Serial过滤，无偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.status, DmPhyDisk.app_id, DmPhyDisk.size, DmPhyDisk.zone_id, DmPhyDisk.disk_type, DmPhyDisk.read_iops, DmPhyDisk.read_bandwidth, DmPhyDisk.write_iops, DmPhyDisk.write_bandwidth, DmPhyDisk.rw_iops, DmPhyDisk.rw_bandwidth, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.uuid IN (?) LIMIT ?;"
          },
          {
            "scenario": "包含Serial过滤条件，无UUID过滤，无偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.status, DmPhyDisk.app_id, DmPhyDisk.size, DmPhyDisk.zone_id, DmPhyDisk.disk_type, DmPhyDisk.read_iops, DmPhyDisk.read_bandwidth, DmPhyDisk.write_iops, DmPhyDisk.write_bandwidth, DmPhyDisk.rw_iops, DmPhyDisk.rw_bandwidth, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.phydisk_serial IN (?) LIMIT ?;"
          },
          {
            "scenario": "包含UUID和Serial过滤条件，无偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.status, DmPhyDisk.app_id, DmPhyDisk.size, DmPhyDisk.zone_id, DmPhyDisk.disk_type, DmPhyDisk.read_iops, DmPhyDisk.read_bandwidth, DmPhyDisk.write_iops, DmPhyDisk.write_bandwidth, DmPhyDisk.rw_iops, DmPhyDisk.rw_bandwidth, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.uuid IN (?) AND dm_rdisk.phydisk_serial IN (?) LIMIT ?;"
          },
          {
            "scenario": "无UUID和Serial过滤条件，包含偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.status, DmPhyDisk.app_id, DmPhyDisk.size, DmPhyDisk.zone_id, DmPhyDisk.disk_type, DmPhyDisk.read_iops, DmPhyDisk.read_bandwidth, DmPhyDisk.write_iops, DmPhyDisk.write_bandwidth, DmPhyDisk.rw_iops, DmPhyDisk.rw_bandwidth, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含UUID过滤条件，无Serial过滤，包含偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.status, DmPhyDisk.app_id, DmPhyDisk.size, DmPhyDisk.zone_id, DmPhyDisk.disk_type, DmPhyDisk.read_iops, DmPhyDisk.read_bandwidth, DmPhyDisk.write_iops, DmPhyDisk.write_bandwidth, DmPhyDisk.rw_iops, DmPhyDisk.rw_bandwidth, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.uuid IN (?) LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含Serial过滤条件，无UUID过滤，包含偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.status, DmPhyDisk.app_id, DmPhyDisk.size, DmPhyDisk.zone_id, DmPhyDisk.disk_type, DmPhyDisk.read_iops, DmPhyDisk.read_bandwidth, DmPhyDisk.write_iops, DmPhyDisk.write_bandwidth, DmPhyDisk.rw_iops, DmPhyDisk.rw_bandwidth, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.phydisk_serial IN (?) LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含UUID和Serial过滤条件，包含偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.serial, DmPhyDisk.status, DmPhyDisk.app_id, DmPhyDisk.size, DmPhyDisk.zone_id, DmPhyDisk.disk_type, DmPhyDisk.read_iops, DmPhyDisk.read_bandwidth, DmPhyDisk.write_iops, DmPhyDisk.write_bandwidth, DmPhyDisk.rw_iops, DmPhyDisk.rw_bandwidth, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.uuid IN (?) AND dm_rdisk.phydisk_serial IN (?) LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (s *UnimplementedMaster) QueryRDiskVol(ctx context.Context, req *QueryRDiskVolRequest) (*QueryRDiskVolResponse, error) {\n\treturn nil, errors.New(\"rpc QueryRDiskVol of service Master is not implemented\")\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (c *MasterClientProxyImpl) QueryRDiskVol(ctx context.Context, req *QueryRDiskVolRequest, opts ...client.Option) (*QueryRDiskVolResponse, error) {\n\tctx, msg := codec.WithCloneMessage(ctx)\n\tdefer codec.PutBackMessage(msg)\n\tmsg.WithClientRPCName(\"/trpc.rdisk.master.Master/QueryRDiskVol\")\n\tmsg.WithCalleeServiceName(MasterServer_ServiceDesc.ServiceName)\n\tmsg.WithCalleeApp(\"rdisk\")\n\tmsg.WithCalleeServer(\"master\")\n\tmsg.WithCalleeService(\"Master\")\n\tmsg.WithCalleeMethod(\"QueryRDiskVol\")\n\tmsg.WithSerializationType(codec.SerializationTypePB)\n\tcallopts := make([]client.Option, 0, len(c.opts)+len(opts))\n\tcallopts = append(callopts, c.opts...)\n\tcallopts = append(callopts, opts...)\n\trsp := &QueryRDiskVolResponse{}\n\tif err := c.client.Invoke(ctx, req, rsp, callopts...); err != nil {\n\t\treturn nil, err\n\t}\n\treturn rsp, nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基本查询，无可选条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT ?;"
          },
          {
            "scenario": "包含UUID过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in ? LIMIT ?;"
          },
          {
            "scenario": "包含Serial过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND phydisk_serial in ? LIMIT ?;"
          },
          {
            "scenario": "包含UUID和Serial过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in ? AND phydisk_serial in ? LIMIT ?;"
          },
          {
            "scenario": "包含分页偏移量",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "完整条件组合（UUID、Serial、分页偏移量）",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in ? AND phydisk_serial in ? LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (m *MockMasterService) QueryRDiskVol(ctx context.Context, req *QueryRDiskVolRequest) (*QueryRDiskVolResponse, error) {\n\tm.ctrl.T.Helper()\n\tret := m.ctrl.Call(m, \"QueryRDiskVol\", ctx, req)\n\tret0, _ := ret[0].(*QueryRDiskVolResponse)\n\tret1, _ := ret[1].(error)\n\treturn ret0, ret1\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基础查询：无UUID和Serial条件，无偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated FROM dm_rdisk WHERE app_id = ? LIMIT ?;"
          },
          {
            "scenario": "包含UUID条件，无Serial条件，无偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated FROM dm_rdisk WHERE app_id = ? AND uuid IN (?) LIMIT ?;"
          },
          {
            "scenario": "无UUID条件，包含Serial条件，无偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated FROM dm_rdisk WHERE app_id = ? AND phydisk_serial IN (?) LIMIT ?;"
          },
          {
            "scenario": "包含UUID和Serial条件，无偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated FROM dm_rdisk WHERE app_id = ? AND uuid IN (?) AND phydisk_serial IN (?) LIMIT ?;"
          },
          {
            "scenario": "基础查询：无UUID和Serial条件，包含偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated FROM dm_rdisk WHERE app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含UUID条件，无Serial条件，包含偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated FROM dm_rdisk WHERE app_id = ? AND uuid IN (?) LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "无UUID条件，包含Serial条件，包含偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated FROM dm_rdisk WHERE app_id = ? AND phydisk_serial IN (?) LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含UUID和Serial条件，包含偏移",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated FROM dm_rdisk WHERE app_id = ? AND uuid IN (?) AND phydisk_serial IN (?) LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (mr *MockMasterServiceMockRecorder) QueryRDiskVol(ctx, req interface{}) *gomock.Call {\n\tmr.mock.ctrl.T.Helper()\n\treturn mr.mock.ctrl.RecordCallWithMethodType(mr.mock, \"QueryRDiskVol\", reflect.TypeOf((*MockMasterService)(nil).QueryRDiskVol), ctx, req)\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基础查询：无UUIDs、无Serials、无Offset",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`read_iops` AS `DmPhyDisk__read_iops`,`DmPhyDisk`.`read_bandwidth` AS `DmPhyDisk__read_bandwidth`,`DmPhyDisk`.`write_iops` AS `DmPhyDisk__write_iops`,`DmPhyDisk`.`write_bandwidth` AS `DmPhyDisk__write_bandwidth`,`DmPhyDisk`.`rw_iops` AS `DmPhyDisk__rw_iops`,`DmPhyDisk`.`rw_bandwidth` AS `DmPhyDisk__rw_bandwidth`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE `dm_rdisk`.`app_id` = ? LIMIT 10;"
          },
          {
            "scenario": "包含UUIDs条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`read_iops` AS `DmPhyDisk__read_iops`,`DmPhyDisk`.`read_bandwidth` AS `DmPhyDisk__read_bandwidth`,`DmPhyDisk`.`write_iops` AS `DmPhyDisk__write_iops`,`DmPhyDisk`.`write_bandwidth` AS `DmPhyDisk__write_bandwidth`,`DmPhyDisk`.`rw_iops` AS `DmPhyDisk__rw_iops`,`DmPhyDisk`.`rw_bandwidth` AS `DmPhyDisk__rw_bandwidth`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE `dm_rdisk`.`app_id` = ? AND `dm_rdisk`.`uuid` IN (?,?) LIMIT 10;"
          },
          {
            "scenario": "包含Serials条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`read_iops` AS `DmPhyDisk__read_iops`,`DmPhyDisk`.`read_bandwidth` AS `DmPhyDisk__read_bandwidth`,`DmPhyDisk`.`write_iops` AS `DmPhyDisk__write_iops`,`DmPhyDisk`.`write_bandwidth` AS `DmPhyDisk__write_bandwidth`,`DmPhyDisk`.`rw_iops` AS `DmPhyDisk__rw_iops`,`DmPhyDisk`.`rw_bandwidth` AS `DmPhyDisk__rw_bandwidth`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE `dm_rdisk`.`app_id` = ? AND `dm_rdisk`.`phydisk_serial` IN (?,?) LIMIT 10;"
          },
          {
            "scenario": "包含UUIDs和Serials条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`read_iops` AS `DmPhyDisk__read_iops`,`DmPhyDisk`.`read_bandwidth` AS `DmPhyDisk__read_bandwidth`,`DmPhyDisk`.`write_iops` AS `DmPhyDisk__write_iops`,`DmPhyDisk`.`write_bandwidth` AS `DmPhyDisk__write_bandwidth`,`DmPhyDisk`.`rw_iops` AS `DmPhyDisk__rw_iops`,`DmPhyDisk`.`rw_bandwidth` AS `DmPhyDisk__rw_bandwidth`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE `dm_rdisk`.`app_id` = ? AND `dm_rdisk`.`uuid` IN (?) AND `dm_rdisk`.`phydisk_serial` IN (?) LIMIT 10;"
          },
          {
            "scenario": "包含Offset",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`read_iops` AS `DmPhyDisk__read_iops`,`DmPhyDisk`.`read_bandwidth` AS `DmPhyDisk__read_bandwidth`,`DmPhyDisk`.`write_iops` AS `DmPhyDisk__write_iops`,`DmPhyDisk`.`write_bandwidth` AS `DmPhyDisk__write_bandwidth`,`DmPhyDisk`.`rw_iops` AS `DmPhyDisk__rw_iops`,`DmPhyDisk`.`rw_bandwidth` AS `DmPhyDisk__rw_bandwidth`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE `dm_rdisk`.`app_id` = ? LIMIT 10 OFFSET 20;"
          },
          {
            "scenario": "包含UUIDs、Serials和Offset的完整条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`read_iops` AS `DmPhyDisk__read_iops`,`DmPhyDisk`.`read_bandwidth` AS `DmPhyDisk__read_bandwidth`,`DmPhyDisk`.`write_iops` AS `DmPhyDisk__write_iops`,`DmPhyDisk`.`write_bandwidth` AS `DmPhyDisk__write_bandwidth`,`DmPhyDisk`.`rw_iops` AS `DmPhyDisk__rw_iops`,`DmPhyDisk`.`rw_bandwidth` AS `DmPhyDisk__rw_bandwidth`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE `dm_rdisk`.`app_id` = ? AND `dm_rdisk`.`uuid` IN (?) AND `dm_rdisk`.`phydisk_serial` IN (?) LIMIT 15 OFFSET 20;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (m *MockMasterClientProxy) QueryRDiskVol(ctx context.Context, req *QueryRDiskVolRequest, opts ...client.Option) (*QueryRDiskVolResponse, error) {\n\tm.ctrl.T.Helper()\n\tvarargs := []interface{}{ctx, req}\n\tfor _, a := range opts {\n\t\tvarargs = append(varargs, a)\n\t}\n\tret := m.ctrl.Call(m, \"QueryRDiskVol\", varargs...)\n\tret0, _ := ret[0].(*QueryRDiskVolResponse)\n\tret1, _ := ret[1].(error)\n\treturn ret0, ret1\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基础查询：无UUIDs、无Serials、无Offset",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT ?;"
          },
          {
            "scenario": "包含UUIDs条件：有UUIDs、无Serials、无Offset",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in (?) LIMIT ?;"
          },
          {
            "scenario": "包含Serials条件：无UUIDs、有Serials、无Offset",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND phydisk_serial in (?) LIMIT ?;"
          },
          {
            "scenario": "包含UUIDs和Serials条件：有UUIDs、有Serials、无Offset",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in (?) AND phydisk_serial in (?) LIMIT ?;"
          },
          {
            "scenario": "包含Offset：无UUIDs、无Serials、有Offset",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "完整条件：有UUIDs、有Serials、有Offset",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in (?) AND phydisk_serial in (?) LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (mr *MockMasterClientProxyMockRecorder) QueryRDiskVol(ctx, req interface{}, opts ...interface{}) *gomock.Call {\n\tmr.mock.ctrl.T.Helper()\n\tvarargs := append([]interface{}{ctx, req}, opts...)\n\treturn mr.mock.ctrl.RecordCallWithMethodType(mr.mock, \"QueryRDiskVol\", reflect.TypeOf((*MockMasterClientProxy)(nil).QueryRDiskVol), varargs...)\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基础查询：无UUID和Serial过滤，无偏移量",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT 10;"
          },
          {
            "scenario": "包含UUID过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in (?) LIMIT 10;"
          },
          {
            "scenario": "包含Serial过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND phydisk_serial in (?) LIMIT 10;"
          },
          {
            "scenario": "同时包含UUID和Serial过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in (?) AND phydisk_serial in (?) LIMIT 10;"
          },
          {
            "scenario": "包含偏移量的分页查询",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT 10 OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*masterApiServerImpl) QueryRDiskVol(ctx context.Context, req *pb.QueryRDiskVolRequest) (*pb.QueryRDiskVolResponse, error) {\n\tview := app.GetRegistry(ctx).Viewers.LogicalVolume\n\tphyView := app.GetRegistry(ctx).Viewers.PhysicalVolume\n\tvar err error\n\n\ttype checker func(*pb.QueryRDiskVolRequest) error\n\tfor _, rule := range []checker{\n\t\t// 不允许不带任何参数的空查询\n\t\tcheckQueryRDiskVolNoEmptyQuery,\n\t\t// 如果带有 BdfIds 参数，必须带有 HostIps 参数缩小范围，单纯 Bdf 查询意义不大，区分度太低了\n\t\tcheckQueryRDiskVolBdfIdsMustComeWithHostIps,\n\t} {\n\t\tif err := rule(req); err != nil {\n\t\t\treturn nil, err\n\t\t}\n\t}\n\n\t// Stage 1 - （如有）确认物理卷 Serials\n\tserials := []rdiskDomain.Serial{}\n\tif len(req.HostIps) > 0 {\n\t\tcriteria := rdiskDomain.PVSearchCriteria{\n\t\t\tIPs:           functools.Map(req.HostIps, net.ParseIP),\n\t\t\tSerials:       functools.Map(req.PhyIds, func(x string) rdiskDomain.Serial { return rdiskDomain.Serial(x) }),\n\t\t\tBDFs:          functools.Map(req.BdfIds, func(x string) rdiskDomain.BDF { return rdiskDomain.BDF(x) }),\n\t\t\tAvailableOnly: false,\n\t\t}\n\t\tphyDisks, err := phyView.Search(ctx, criteria, rdiskDomain.Pagination{Limit: 1000})\n\t\tif err != nil {\n\t\t\treturn nil, err\n\t\t}\n\t\tserials = functools.Map(phyDisks, func(x *rdiskDomain.PhysicalVolume) rdiskDomain.Serial { return x.Serial })\n\t} else if len(req.PhyIds) > 0 {\n\t\tserials = functools.Map(req.PhyIds, func(x string) rdiskDomain.Serial { return rdiskDomain.Serial(x) })\n\t}\n\n\t// Stage 2 - 确认用户 AppId\n\tuuidSlice := functools.Map(req.CbsUuids, uuid.MustParse)\n\tappId := users.AppID(req.AppId)\n\tif req.AppId <= 0 {\n\t\tif appId, err = view.ProbeAppID(ctx, uuidSlice, serials); err != nil {\n\t\t\treturn nil, err\n\t\t}\n\t}\n\n\t// Stage 3 - 发起查询\n\tcriteria := rdiskDomain.LVSearchCriteria{\n\t\tUUIDs:   uuidSlice,\n\t\tSerials: serials,\n\t}\n\tvar limit uint64 = 100\n\tvar offset uint64 = 0\n\tif req.Page != nil {\n\t\tlimit = req.Page.PageSize\n\t\toffset = req.Page.Page * limit\n\t}\n\n\tresults, err := view.Search(ctx, appId, criteria, rdiskDomain.Pagination{Limit: limit, Offset: offset})\n\tif err != nil {\n\t\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotExists) {\n\t\t\treturn &pb.QueryRDiskVolResponse{}, nil\n\t\t}\n\t}\n\n\tif len(results) == 0 {\n\t\treturn &pb.QueryRDiskVolResponse{}, nil\n\t}\n\n\t// Stage 4 - 查询关联的置放群组\n\trelatedUuidStrings := functools.Map(results, func(x *rdiskDomain.LogicalVolume) string { return x.UUID.String() })\n\tdrgroupRelations, err := app.GetRegistry(ctx).Viewers.DRGroup.QueryRelationsMap(ctx, appId, relatedUuidStrings)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Stage 5 - 组装数据返回\n\n\tgroupNameToSpecMap := make(map[string]*pb.AffinitySpec)\n\tresponseDataRef := functools.MapRef(make([]pb.RDisk, len(results)))\n\tfor i := range results {\n\t\tencodeLogicalVolume(results[i], responseDataRef[i])\n\n\t\t// 找到关联的置放群组并返回\n\t\tif drgroupViews, ok := drgroupRelations[results[i].UUID.String()]; ok {\n\t\t\tresponseDataRef[i].AffinitySpec = make([]*pb.AffinitySpec, len(drgroupViews))\n\t\t\tfor j := range drgroupViews {\n\t\t\t\tgroupName := drgroupViews[j].Name\n\t\t\t\tif spec, ok := groupNameToSpecMap[groupName]; ok {\n\t\t\t\t\tresponseDataRef[i].AffinitySpec[j] = spec\n\t\t\t\t} else {\n\t\t\t\t\tspec := encodeDRGroupView(drgroupViews[j], &pb.AffinitySpec{}, results[i].UUID.String())\n\t\t\t\t\tgroupNameToSpecMap[groupName] = spec\n\t\t\t\t\tresponseDataRef[i].AffinitySpec[j] = spec\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t}\n\treturn &pb.QueryRDiskVolResponse{Disks: responseDataRef}, nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "只有AppID条件，无Offset",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, dm_phydisk.serial AS dm_phy_disk__serial, dm_phydisk.ip AS dm_phy_disk__ip, dm_phydisk.bdf AS dm_phy_disk__bdf, dm_phydisk.status AS dm_phy_disk__status, dm_phydisk.available AS dm_phy_disk__available, dm_phydisk.size AS dm_phy_disk__size, dm_phydisk.disk_type AS dm_phy_disk__disk_type, dm_phydisk.created AS dm_phy_disk__created, dm_phydisk.updated AS dm_phy_disk__updated FROM dm_rdisk LEFT JOIN dm_phydisk ON dm_rdisk.phydisk_serial = dm_phydisk.serial WHERE dm_rdisk.app_id = ? LIMIT ?;"
          },
          {
            "scenario": "AppID + UUIDs条件，无Offset",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, dm_phydisk.serial AS dm_phy_disk__serial, dm_phydisk.ip AS dm_phy_disk__ip, dm_phydisk.bdf AS dm_phy_disk__bdf, dm_phydisk.status AS dm_phy_disk__status, dm_phydisk.available AS dm_phy_disk__available, dm_phydisk.size AS dm_phy_disk__size, dm_phydisk.disk_type AS dm_phy_disk__disk_type, dm_phydisk.created AS dm_phy_disk__created, dm_phydisk.updated AS dm_phy_disk__updated FROM dm_rdisk LEFT JOIN dm_phydisk ON dm_rdisk.phydisk_serial = dm_phydisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.uuid IN (?) LIMIT ?;"
          },
          {
            "scenario": "AppID + Serials条件，无Offset",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, dm_phydisk.serial AS dm_phy_disk__serial, dm_phydisk.ip AS dm_phy_disk__ip, dm_phydisk.bdf AS dm_phy_disk__bdf, dm_phydisk.status AS dm_phy_disk__status, dm_phydisk.available AS dm_phy_disk__available, dm_phydisk.size AS dm_phy_disk__size, dm_phydisk.disk_type AS dm_phy_disk__disk_type, dm_phydisk.created AS dm_phy_disk__created, dm_phydisk.updated AS dm_phy_disk__updated FROM dm_rdisk LEFT JOIN dm_phydisk ON dm_rdisk.phydisk_serial = dm_phydisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.phydisk_serial IN (?) LIMIT ?;"
          },
          {
            "scenario": "AppID + UUIDs + Serials条件，无Offset",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, dm_phydisk.serial AS dm_phy_disk__serial, dm_phydisk.ip AS dm_phy_disk__ip, dm_phydisk.bdf AS dm_phy_disk__bdf, dm_phydisk.status AS dm_phy_disk__status, dm_phydisk.available AS dm_phy_disk__available, dm_phydisk.size AS dm_phy_disk__size, dm_phydisk.disk_type AS dm_phy_disk__disk_type, dm_phydisk.created AS dm_phy_disk__created, dm_phydisk.updated AS dm_phy_disk__updated FROM dm_rdisk LEFT JOIN dm_phydisk ON dm_rdisk.phydisk_serial = dm_phydisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.uuid IN (?) AND dm_rdisk.phydisk_serial IN (?) LIMIT ?;"
          },
          {
            "scenario": "AppID条件，有Offset",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, dm_phydisk.serial AS dm_phy_disk__serial, dm_phydisk.ip AS dm_phy_disk__ip, dm_phydisk.bdf AS dm_phy_disk__bdf, dm_phydisk.status AS dm_phy_disk__status, dm_phydisk.available AS dm_phy_disk__available, dm_phydisk.size AS dm_phy_disk__size, dm_phydisk.disk_type AS dm_phy_disk__disk_type, dm_phydisk.created AS dm_phy_disk__created, dm_phydisk.updated AS dm_phy_disk__updated FROM dm_rdisk LEFT JOIN dm_phydisk ON dm_rdisk.phydisk_serial = dm_phydisk.serial WHERE dm_rdisk.app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "AppID + UUIDs + Serials条件，有Offset",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, dm_phydisk.serial AS dm_phy_disk__serial, dm_phydisk.ip AS dm_phy_disk__ip, dm_phydisk.bdf AS dm_phy_disk__bdf, dm_phydisk.status AS dm_phy_disk__status, dm_phydisk.available AS dm_phy_disk__available, dm_phydisk.size AS dm_phy_disk__size, dm_phydisk.disk_type AS dm_phy_disk__disk_type, dm_phydisk.created AS dm_phy_disk__created, dm_phydisk.updated AS dm_phy_disk__updated FROM dm_rdisk LEFT JOIN dm_phydisk ON dm_rdisk.phydisk_serial = dm_phydisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.uuid IN (?) AND dm_rdisk.phydisk_serial IN (?) LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (s *UnimplementedMaster) QueryPhyRDiskInfo(ctx context.Context, req *QueryPhyRDiskInfoRequest) (*QueryPhyRDiskInfoResponse, error) {\n\treturn nil, errors.New(\"rpc QueryPhyRDiskInfo of service Master is not implemented\")\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (c *MasterClientProxyImpl) QueryPhyRDiskInfo(ctx context.Context, req *QueryPhyRDiskInfoRequest, opts ...client.Option) (*QueryPhyRDiskInfoResponse, error) {\n\tctx, msg := codec.WithCloneMessage(ctx)\n\tdefer codec.PutBackMessage(msg)\n\tmsg.WithClientRPCName(\"/trpc.rdisk.master.Master/QueryPhyRDiskInfo\")\n\tmsg.WithCalleeServiceName(MasterServer_ServiceDesc.ServiceName)\n\tmsg.WithCalleeApp(\"rdisk\")\n\tmsg.WithCalleeServer(\"master\")\n\tmsg.WithCalleeService(\"Master\")\n\tmsg.WithCalleeMethod(\"QueryPhyRDiskInfo\")\n\tmsg.WithSerializationType(codec.SerializationTypePB)\n\tcallopts := make([]client.Option, 0, len(c.opts)+len(opts))\n\tcallopts = append(callopts, c.opts...)\n\tcallopts = append(callopts, opts...)\n\trsp := &QueryPhyRDiskInfoResponse{}\n\tif err := c.client.Invoke(ctx, req, rsp, callopts...); err != nil {\n\t\treturn nil, err\n\t}\n\treturn rsp, nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基础查询：无UUID和Serial条件，无分页偏移",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? LIMIT ?;"
          },
          {
            "scenario": "包含UUID条件，无Serial条件，无分页偏移",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND uuid IN (?) LIMIT ?;"
          },
          {
            "scenario": "包含Serial条件，无UUID条件，无分页偏移",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND phydisk_serial IN (?) LIMIT ?;"
          },
          {
            "scenario": "包含UUID和Serial条件，无分页偏移",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND uuid IN (?) AND phydisk_serial IN (?) LIMIT ?;"
          },
          {
            "scenario": "基础查询：无UUID和Serial条件，包含分页偏移",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含UUID条件，无Serial条件，包含分页偏移",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND uuid IN (?) LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含Serial条件，无UUID条件，包含分页偏移",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND phydisk_serial IN (?) LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含UUID和Serial条件，包含分页偏移",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND uuid IN (?) AND phydisk_serial IN (?) LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (m *MockMasterService) QueryPhyRDiskInfo(ctx context.Context, req *QueryPhyRDiskInfoRequest) (*QueryPhyRDiskInfoResponse, error) {\n\tm.ctrl.T.Helper()\n\tret := m.ctrl.Call(m, \"QueryPhyRDiskInfo\", ctx, req)\n\tret0, _ := ret[0].(*QueryPhyRDiskInfoResponse)\n\tret1, _ := ret[1].(error)\n\treturn ret0, ret1\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "无可选过滤条件，无偏移量",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated` FROM `dm_rdisk` WHERE app_id = ? LIMIT ?;"
          },
          {
            "scenario": "包含UUID过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated` FROM `dm_rdisk` WHERE app_id = ? AND uuid in (?) LIMIT ?;"
          },
          {
            "scenario": "包含Serial过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated` FROM `dm_rdisk` WHERE app_id = ? AND phydisk_serial in (?) LIMIT ?;"
          },
          {
            "scenario": "包含UUID和Serial过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated` FROM `dm_rdisk` WHERE app_id = ? AND uuid in (?) AND phydisk_serial in (?) LIMIT ?;"
          },
          {
            "scenario": "包含偏移量的分页查询",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated` FROM `dm_rdisk` WHERE app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "完整条件组合（包含所有过滤条件和偏移量）",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated` FROM `dm_rdisk` WHERE app_id = ? AND uuid in (?) AND phydisk_serial in (?) LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (mr *MockMasterServiceMockRecorder) QueryPhyRDiskInfo(ctx, req interface{}) *gomock.Call {\n\tmr.mock.ctrl.T.Helper()\n\treturn mr.mock.ctrl.RecordCallWithMethodType(mr.mock, \"QueryPhyRDiskInfo\", reflect.TypeOf((*MockMasterService)(nil).QueryPhyRDiskInfo), ctx, req)\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基础查询（可选包含UUID条件、Serial条件、OFFSET）",
            "sql": "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, dm_phy_disk.serial, dm_phy_disk.status, dm_phy_disk.size, dm_phy_disk.disk_type, dm_phy_disk.zone_id, dm_phy_disk.created, dm_phy_disk.updated FROM dm_rdisk LEFT JOIN dm_phy_disk ON dm_rdisk.phydisk_serial = dm_phy_disk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.uuid IN (?) AND dm_rdisk.phydisk_serial IN (?) LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (m *MockMasterClientProxy) QueryPhyRDiskInfo(ctx context.Context, req *QueryPhyRDiskInfoRequest, opts ...client.Option) (*QueryPhyRDiskInfoResponse, error) {\n\tm.ctrl.T.Helper()\n\tvarargs := []interface{}{ctx, req}\n\tfor _, a := range opts {\n\t\tvarargs = append(varargs, a)\n\t}\n\tret := m.ctrl.Call(m, \"QueryPhyRDiskInfo\", varargs...)\n\tret0, _ := ret[0].(*QueryPhyRDiskInfoResponse)\n\tret1, _ := ret[1].(error)\n\treturn ret0, ret1\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基础查询：无UUID和Serial过滤，无偏移",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT ?;"
          },
          {
            "scenario": "包含UUID过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in ? LIMIT ?;"
          },
          {
            "scenario": "包含Serial过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND phydisk_serial in ? LIMIT ?;"
          },
          {
            "scenario": "包含UUID和Serial过滤条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in ? AND phydisk_serial in ? LIMIT ?;"
          },
          {
            "scenario": "包含偏移量的分页查询",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "完整条件：UUID、Serial过滤加偏移量分页",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in ? AND phydisk_serial in ? LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (mr *MockMasterClientProxyMockRecorder) QueryPhyRDiskInfo(ctx, req interface{}, opts ...interface{}) *gomock.Call {\n\tmr.mock.ctrl.T.Helper()\n\tvarargs := append([]interface{}{ctx, req}, opts...)\n\treturn mr.mock.ctrl.RecordCallWithMethodType(mr.mock, \"QueryPhyRDiskInfo\", reflect.TypeOf((*MockMasterClientProxy)(nil).QueryPhyRDiskInfo), varargs...)\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基础查询（无可选条件）",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`type` AS `DmPhyDisk__type`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT 10;"
          },
          {
            "scenario": "包含UUID条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`type` AS `DmPhyDisk__type`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in (?) LIMIT 10;"
          },
          {
            "scenario": "包含Serial条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`type` AS `DmPhyDisk__type`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND phydisk_serial in (?) LIMIT 10;"
          },
          {
            "scenario": "包含UUID和Serial条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`type` AS `DmPhyDisk__type`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in (?) AND phydisk_serial in (?) LIMIT 10;"
          },
          {
            "scenario": "包含分页偏移量",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`type` AS `DmPhyDisk__type`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "完整条件组合（UUID+Serial+分页）",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`type` AS `DmPhyDisk__type`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in (?) AND phydisk_serial in (?) LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*masterApiServerImpl) QueryPhyRDiskInfo(ctx context.Context, req *pb.QueryPhyRDiskInfoRequest) (*pb.QueryPhyRDiskInfoResponse, error) {\n\tvar (\n\t\terr        error\n\t\tresponse   = &pb.QueryPhyRDiskInfoResponse{}\n\t\tview       = app.GetRegistry(ctx).Viewers.PhysicalVolume\n\t\tpagination rdiskDomain.Pagination\n\t)\n\tif req.Page != nil {\n\t\tpagination = rdiskDomain.Pagination{\n\t\t\tLimit:  req.Page.PageSize,\n\t\t\tOffset: req.Page.Page * req.Page.PageSize,\n\t\t}\n\t} else {\n\t\tpagination = rdiskDomain.Pagination{\n\t\t\tLimit:  100,\n\t\t\tOffset: 0,\n\t\t}\n\t}\n\tcriteria := rdiskDomain.PVSearchCriteria{}\n\tif len(req.HostIps) > 0 {\n\t\tcriteria.IPs = functools.Map(req.HostIps, net.ParseIP)\n\t}\n\tif len(req.PhyIds) > 0 {\n\t\tcriteria.Serials = functools.Map(req.PhyIds, func(id string) rdiskDomain.Serial { return rdiskDomain.Serial(id) })\n\t}\n\tif len(req.ZoneIds) > 0 {\n\t\tcriteria.ZoneIDs = functools.Map(req.ZoneIds, func(id uint64) rdiskDomain.ZoneID { return rdiskDomain.ZoneID(id) })\n\t}\n\tcriteria.AvailableOnly = req.AvailableOnly\n\tresults, err := view.Search(ctx, criteria, pagination)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tresponse.PhyDisk = functools.MapRef(make([]pb.PhyRDisk, len(results)))\n\tfunctools.MapTo(results, response.PhyDisk, encodePhysicalVolume)\n\treturn response, nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基础查询：无UUID和Serial过滤，无偏移",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`ip`,`DmPhyDisk`.`port`,`DmPhyDisk`.`status`,`DmPhyDisk`.`app_id`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`available_size`,`DmPhyDisk`.`total_size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`read_iops`,`DmPhyDisk`.`read_bandwidth`,`DmPhyDisk`.`write_iops`,`DmPhyDisk`.`write_bandwidth`,`DmPhyDisk`.`rw_iops`,`DmPhyDisk`.`rw_bandwidth`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT ?;"
          },
          {
            "scenario": "包含UUID过滤，无Serial过滤，无偏移",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`ip`,`DmPhyDisk`.`port`,`DmPhyDisk`.`status`,`DmPhyDisk`.`app_id`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`available_size`,`DmPhyDisk`.`total_size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`read_iops`,`DmPhyDisk`.`read_bandwidth`,`DmPhyDisk`.`write_iops`,`DmPhyDisk`.`write_bandwidth`,`DmPhyDisk`.`rw_iops`,`DmPhyDisk`.`rw_bandwidth`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in ? LIMIT ?;"
          },
          {
            "scenario": "包含Serial过滤，无UUID过滤，无偏移",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`ip`,`DmPhyDisk`.`port`,`DmPhyDisk`.`status`,`DmPhyDisk`.`app_id`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`available_size`,`DmPhyDisk`.`total_size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`read_iops`,`DmPhyDisk`.`read_bandwidth`,`DmPhyDisk`.`write_iops`,`DmPhyDisk`.`write_bandwidth`,`DmPhyDisk`.`rw_iops`,`DmPhyDisk`.`rw_bandwidth`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND phydisk_serial in ? LIMIT ?;"
          },
          {
            "scenario": "包含UUID和Serial过滤，无偏移",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`ip`,`DmPhyDisk`.`port`,`DmPhyDisk`.`status`,`DmPhyDisk`.`app_id`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`available_size`,`DmPhyDisk`.`total_size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`read_iops`,`DmPhyDisk`.`read_bandwidth`,`DmPhyDisk`.`write_iops`,`DmPhyDisk`.`write_bandwidth`,`DmPhyDisk`.`rw_iops`,`DmPhyDisk`.`rw_bandwidth`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in ? AND phydisk_serial in ? LIMIT ?;"
          },
          {
            "scenario": "基础查询：无UUID和Serial过滤，有偏移",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`ip`,`DmPhyDisk`.`port`,`DmPhyDisk`.`status`,`DmPhyDisk`.`app_id`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`available_size`,`DmPhyDisk`.`total_size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`read_iops`,`DmPhyDisk`.`read_bandwidth`,`DmPhyDisk`.`write_iops`,`DmPhyDisk`.`write_bandwidth`,`DmPhyDisk`.`rw_iops`,`DmPhyDisk`.`rw_bandwidth`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含UUID过滤，无Serial过滤，有偏移",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`ip`,`DmPhyDisk`.`port`,`DmPhyDisk`.`status`,`DmPhyDisk`.`app_id`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`available_size`,`DmPhyDisk`.`total_size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`read_iops`,`DmPhyDisk`.`read_bandwidth`,`DmPhyDisk`.`write_iops`,`DmPhyDisk`.`write_bandwidth`,`DmPhyDisk`.`rw_iops`,`DmPhyDisk`.`rw_bandwidth`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含Serial过滤，无UUID过滤，有偏移",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`ip`,`DmPhyDisk`.`port`,`DmPhyDisk`.`status`,`DmPhyDisk`.`app_id`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`available_size`,`DmPhyDisk`.`total_size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`read_iops`,`DmPhyDisk`.`read_bandwidth`,`DmPhyDisk`.`write_iops`,`DmPhyDisk`.`write_bandwidth`,`DmPhyDisk`.`rw_iops`,`DmPhyDisk`.`rw_bandwidth`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND phydisk_serial in ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含UUID和Serial过滤，有偏移",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`ip`,`DmPhyDisk`.`port`,`DmPhyDisk`.`status`,`DmPhyDisk`.`app_id`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`available_size`,`DmPhyDisk`.`total_size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`read_iops`,`DmPhyDisk`.`read_bandwidth`,`DmPhyDisk`.`write_iops`,`DmPhyDisk`.`write_bandwidth`,`DmPhyDisk`.`rw_iops`,`DmPhyDisk`.`rw_bandwidth`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in ? AND phydisk_serial in ? LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*UpdateBenchmarkTask) Work(ctx context.Context) error {\n\tvar (\n\t\tviewer     = app.GetRegistry(ctx).Viewers.Benchmark\n\t\tdispatcher = app.GetRegistry(ctx).Dispatcher\n\t)\n\n\t// 1. Find all running benchmarks\n\trunningStatus := []benchmark.Status{benchmark.StatusRunning}\n\tbenchs, err := viewer.FindByStatus(ctx, runningStatus)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// 2. Fire events to update running benchmarks\n\tlogs.Info(ctx).Int(\"count\", len(benchs)).Msg(\"starts to update benchmark data\")\n\tfor _, b := range benchs {\n\t\tcmd := &commands.UpdateBenchmarkTask{\n\t\t\tSerial:        b.DiskInfo.Serial,\n\t\t\tBenchmarkUUID: b.UUID,\n\t\t}\n\t\terr := dispatcher.Dispatch(ctx, cmd)\n\t\tif err != nil {\n\t\t\tlogs.Warn(ctx).Err(err).Str(\"uuid\", b.UUID.String()).Msg(\"update benchmark task failed\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基础查询（无可选条件，无偏移）",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`model`,`DmPhyDisk`.`vendor`,`DmPhyDisk`.`size`,`DmPhyDisk`.`interface_type`,`DmPhyDisk`.`status`,`DmPhyDisk`.`health_status`,`DmPhyDisk`.`temperature`,`DmPhyDisk`.`power_on_hours`,`DmPhyDisk`.`total_lbas_written`,`DmPhyDisk`.`total_lbas_read`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT 10;"
          },
          {
            "scenario": "包含UUID条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`model`,`DmPhyDisk`.`vendor`,`DmPhyDisk`.`size`,`DmPhyDisk`.`interface_type`,`DmPhyDisk`.`status`,`DmPhyDisk`.`health_status`,`DmPhyDisk`.`temperature`,`DmPhyDisk`.`power_on_hours`,`DmPhyDisk`.`total_lbas_written`,`DmPhyDisk`.`total_lbas_read`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in (?) LIMIT 10;"
          },
          {
            "scenario": "包含Serial条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`model`,`DmPhyDisk`.`vendor`,`DmPhyDisk`.`size`,`DmPhyDisk`.`interface_type`,`DmPhyDisk`.`status`,`DmPhyDisk`.`health_status`,`DmPhyDisk`.`temperature`,`DmPhyDisk`.`power_on_hours`,`DmPhyDisk`.`total_lbas_written`,`DmPhyDisk`.`total_lbas_read`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND phydisk_serial in (?) LIMIT 10;"
          },
          {
            "scenario": "包含UUID和Serial条件",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`model`,`DmPhyDisk`.`vendor`,`DmPhyDisk`.`size`,`DmPhyDisk`.`interface_type`,`DmPhyDisk`.`status`,`DmPhyDisk`.`health_status`,`DmPhyDisk`.`temperature`,`DmPhyDisk`.`power_on_hours`,`DmPhyDisk`.`total_lbas_written`,`DmPhyDisk`.`total_lbas_read`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid in (?) AND phydisk_serial in (?) LIMIT 10;"
          },
          {
            "scenario": "包含OFFSET的分页查询",
            "sql": "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`model`,`DmPhyDisk`.`vendor`,`DmPhyDisk`.`size`,`DmPhyDisk`.`interface_type`,`DmPhyDisk`.`status`,`DmPhyDisk`.`health_status`,`DmPhyDisk`.`temperature`,`DmPhyDisk`.`power_on_hours`,`DmPhyDisk`.`total_lbas_written`,`DmPhyDisk`.`total_lbas_read`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? LIMIT 10 OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*CleanupDefunctTask) Work(ctx context.Context) error {\n\tvar err error\n\tvar batchSize uint64 = 1000\n\tvar defunctingVolumes []*rdiskDomain.LogicalVolume\n\tdefunctingVolumes, err = app.GetRegistry(ctx).Viewers.LogicalVolume.FindByStatus(\n\t\tctx, []rdiskDomain.LogicalVolumeState{rdiskDomain.LVSDefuncting}, rdiskDomain.Pagination{Limit: batchSize})\n\tif err != nil {\n\t\tlogs.Error(ctx).Err(err).Msg(\"failed to find defuncting volumes\")\n\t\treturn err\n\t}\n\tif len(defunctingVolumes) == 0 {\n\t\tlogs.Debug(ctx).Msg(\"no defuncting volumes found\")\n\t\treturn nil\n\t}\n\n\tlogs.Info(ctx).Int(\"count\", len(defunctingVolumes)).Msg(\"starts to cleanup defuncting volumes\")\n\n\tvar waitInterval = time.Second * 10\n\tvar dispatcher = app.GetRegistry(ctx).Dispatcher\n\tfor _, volume := range defunctingVolumes {\n\t\tif ctx.Err() != nil {\n\t\t\t// 上下文已经被取消, 退出\n\t\t\treturn ctx.Err()\n\t\t}\n\t\tfunc(volume *rdiskDomain.LogicalVolume) {\n\t\t\tlogs.Info(ctx).Stringer(\"uuid\", volume.UUID).Msg(\"cleanuping defunct volume\")\n\t\t\tsubCtx, cancel := context.WithTimeout(ctx, waitInterval)\n\t\t\tdefer cancel()\n\t\t\tcmd := &commands.CleanupDefunctCommand{UUID: volume.UUID}\n\t\t\tif err := dispatcher.Dispatch(subCtx, cmd); err != nil {\n\t\t\t\tif err == subCtx.Err() {\n\t\t\t\t\t// 等待超时了，在后台 dispatcher 会继续清理，这里直接返回\n\t\t\t\t\tlogs.Info(subCtx).Stringer(\"uuid\", volume.UUID).Msg(\"timeout waiting for cleanup defunct volume, move up to next\")\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tlogs.Error(subCtx).Err(err).Str(\"uuid\", volume.UUID.String()).Msg(\"failed to cleanup defunct volume\")\n\t\t\t\treturn\n\t\t\t}\n\t\t\tlogs.Info(subCtx).Stringer(\"uuid\", volume.UUID).Msg(\"cleanup defunct volume done\")\n\t\t}(volume)\n\t}\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*UpdateBackupTask) Work(ctx context.Context) error {\n\tvar (\n\t\tviewer     = app.GetRegistry(ctx).Viewers.Backup\n\t\tdispatcher = app.GetRegistry(ctx).Dispatcher\n\t)\n\n\t// 1. 查询所有正在备份的备份\n\tstatusList := []backup.BackupStatus{backup.StatusRunning}\n\tbaks, err := viewer.FindByStatus(ctx, statusList)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// 2. 更新备份进度\n\tlogs.Info(ctx).Int(\"count\", len(baks)).Msg(\"starts to update running backup task\")\n\tfor _, bak := range baks {\n\t\tcmd := &commands.UpdateRunningBackupTaskCommand{\n\t\t\tUUID: bak.UUID,\n\t\t}\n\t\terr := dispatcher.Dispatch(ctx, cmd)\n\t\tif err != nil {\n\t\t\tlogs.Warn(ctx).Err(err).Str(\"uuid\", bak.UUID.String()).Msg(\"update backup task failed\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*ConfirmInitPhysicalDiskTask) Work(ctx context.Context) error {\n\tvar (\n\t\tviewer     = app.GetRegistry(ctx).Viewers.PhysicalVolume\n\t\tdispatcher = app.GetRegistry(ctx).Dispatcher\n\t)\n\n\t// 1. 查询所有待初始化的物理卷\n\tcriteria := rdiskDomain.PVSearchCriteria{}\n\tcriteria.States = []rdiskDomain.PhysicalVolumeState{rdiskDomain.PVSInited}\n\tpagination := rdiskDomain.Pagination{Limit: 10}\n\n\tresults, err := viewer.Search(ctx, criteria, pagination)\n\tif err != nil {\n\t\tlogs.Warn(ctx).Err(err).Msg(\"search physical volume failed\")\n\t\treturn err\n\t}\n\n\tif len(results) == 0 {\n\t\tlogs.Debug(ctx).Msg(\"no physical volume to be initialized\")\n\t\treturn nil\n\t}\n\n\t// TODO: 是否可以增加一个退避机制，对于长时间没有成功初始化的物理卷，增加重试时间间隔\n\n\t// 2. 发起初始化\n\tlogs.Info(ctx).Int(\"count\", len(results)).Msg(\"starts to initialize disks\")\n\tfor _, vol := range results {\n\t\tcmd := &commands.ConfirmInitPhysicalVolumeCommand{\n\t\t\tSerial: string(vol.Serial),\n\t\t\tHost:   vol.IP,\n\t\t}\n\t\terr := dispatcher.Dispatch(ctx, cmd)\n\t\tif err != nil {\n\t\t\tlogs.Warn(ctx).Err(err).Str(\"serial\", string(vol.Serial)).Str(\"host_ip\", vol.IP.String()).Msg(\"confirm init physical volume failed\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "无可选条件",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? LIMIT ?;"
          },
          {
            "scenario": "仅有UUID条件",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND uuid in (?) LIMIT ?;"
          },
          {
            "scenario": "仅有Serial条件",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND phydisk_serial in (?) LIMIT ?;"
          },
          {
            "scenario": "仅有Offset条件",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "UUID + Serial条件",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND uuid in (?) AND phydisk_serial in (?) LIMIT ?;"
          },
          {
            "scenario": "UUID + Offset条件",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND uuid in (?) LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "Serial + Offset条件",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND phydisk_serial in (?) LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "所有条件都存在",
            "sql": "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND uuid in (?) AND phydisk_serial in (?) LIMIT ? OFFSET ?;"
          }
        ]
      },
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (??);"
    ],
    "sql_types": [
      "PARAM_DEPENDENT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (*RecycleBackupTask) Work(ctx context.Context) error {\n\tvar (\n\t\tviewer     = app.GetRegistry(ctx).Viewers.Backup\n\t\tdispatcher = app.GetRegistry(ctx).Dispatcher\n\t)\n\n\t// 1. 查询所有待删除的备份\n\tstatusList := []backup.BackupStatus{backup.StatusToDelete, backup.StatusFailed}\n\tbaks, err := viewer.FindByStatus(ctx, statusList)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// 2. 发起清理数据\n\tlogs.Info(ctx).Int(\"count\", len(baks)).Msg(\"starts to recycle backup data\")\n\tfor _, bak := range baks {\n\t\tcmd := &commands.RecycleBackupDataCommand{\n\t\t\tUUID: bak.UUID,\n\t\t}\n\t\terr := dispatcher.Dispatch(ctx, cmd)\n\t\tif err != nil {\n\t\t\tlogs.Warn(ctx).Err(err).Str(\"uuid\", bak.UUID.String()).Msg(\"update backup task failed\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "基础查询：无UUID/Serial条件，无偏移量",
            "sql": "SELECT r.id, r.uuid, r.status, r.app_id, r.size, r.phydisk_serial, r.extra, r.zone_id, r.volume_type, r.disk_type, r.read_iops, r.read_bandwidth, r.write_iops, r.write_bandwidth, r.rw_iops, r.rw_bandwidth, r.created, r.updated, p.serial, p.status, p.size, p.zone_id, p.disk_type, p.created, p.updated FROM dm_rdisk r LEFT JOIN dm_phydisk p ON r.phydisk_serial = p.serial WHERE r.app_id = ? LIMIT ?;"
          },
          {
            "scenario": "包含UUID条件，无Serial条件，无偏移量",
            "sql": "SELECT r.id, r.uuid, r.status, r.app_id, r.size, r.phydisk_serial, r.extra, r.zone_id, r.volume_type, r.disk_type, r.read_iops, r.read_bandwidth, r.write_iops, r.write_bandwidth, r.rw_iops, r.rw_bandwidth, r.created, r.updated, p.serial, p.status, p.size, p.zone_id, p.disk_type, p.created, p.updated FROM dm_rdisk r LEFT JOIN dm_phydisk p ON r.phydisk_serial = p.serial WHERE r.app_id = ? AND r.uuid IN (?) LIMIT ?;"
          },
          {
            "scenario": "无UUID条件，包含Serial条件，无偏移量",
            "sql": "SELECT r.id, r.uuid, r.status, r.app_id, r.size, r.phydisk_serial, r.extra, r.zone_id, r.volume_type, r.disk_type, r.read_iops, r.read_bandwidth, r.write_iops, r.write_bandwidth, r.rw_iops, r.rw_bandwidth, r.created, r.updated, p.serial, p.status, p.size, p.zone_id, p.disk_type, p.created, p.updated FROM dm_rdisk r LEFT JOIN dm_phydisk p ON r.phydisk_serial = p.serial WHERE r.app_id = ? AND r.phydisk_serial IN (?) LIMIT ?;"
          },
          {
            "scenario": "包含UUID和Serial条件，无偏移量",
            "sql": "SELECT r.id, r.uuid, r.status, r.app_id, r.size, r.phydisk_serial, r.extra, r.zone_id, r.volume_type, r.disk_type, r.read_iops, r.read_bandwidth, r.write_iops, r.write_bandwidth, r.rw_iops, r.rw_bandwidth, r.created, r.updated, p.serial, p.status, p.size, p.zone_id, p.disk_type, p.created, p.updated FROM dm_rdisk r LEFT JOIN dm_phydisk p ON r.phydisk_serial = p.serial WHERE r.app_id = ? AND r.uuid IN (?) AND r.phydisk_serial IN (?) LIMIT ?;"
          },
          {
            "scenario": "基础查询：无UUID/Serial条件，包含偏移量",
            "sql": "SELECT r.id, r.uuid, r.status, r.app_id, r.size, r.phydisk_serial, r.extra, r.zone_id, r.volume_type, r.disk_type, r.read_iops, r.read_bandwidth, r.write_iops, r.write_bandwidth, r.rw_iops, r.rw_bandwidth, r.created, r.updated, p.serial, p.status, p.size, p.zone_id, p.disk_type, p.created, p.updated FROM dm_rdisk r LEFT JOIN dm_phydisk p ON r.phydisk_serial = p.serial WHERE r.app_id = ? LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含UUID条件，无Serial条件，包含偏移量",
            "sql": "SELECT r.id, r.uuid, r.status, r.app_id, r.size, r.phydisk_serial, r.extra, r.zone_id, r.volume_type, r.disk_type, r.read_iops, r.read_bandwidth, r.write_iops, r.write_bandwidth, r.rw_iops, r.rw_bandwidth, r.created, r.updated, p.serial, p.status, p.size, p.zone_id, p.disk_type, p.created, p.updated FROM dm_rdisk r LEFT JOIN dm_phydisk p ON r.phydisk_serial = p.serial WHERE r.app_id = ? AND r.uuid IN (?) LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "无UUID条件，包含Serial条件，包含偏移量",
            "sql": "SELECT r.id, r.uuid, r.status, r.app_id, r.size, r.phydisk_serial, r.extra, r.zone_id, r.volume_type, r.disk_type, r.read_iops, r.read_bandwidth, r.write_iops, r.write_bandwidth, r.rw_iops, r.rw_bandwidth, r.created, r.updated, p.serial, p.status, p.size, p.zone_id, p.disk_type, p.created, p.updated FROM dm_rdisk r LEFT JOIN dm_phydisk p ON r.phydisk_serial = p.serial WHERE r.app_id = ? AND r.phydisk_serial IN (?) LIMIT ? OFFSET ?;"
          },
          {
            "scenario": "包含UUID和Serial条件，包含偏移量",
            "sql": "SELECT r.id, r.uuid, r.status, r.app_id, r.size, r.phydisk_serial, r.extra, r.zone_id, r.volume_type, r.disk_type, r.read_iops, r.read_bandwidth, r.write_iops, r.write_bandwidth, r.rw_iops, r.rw_bandwidth, r.created, r.updated, p.serial, p.status, p.size, p.zone_id, p.disk_type, p.created, p.updated FROM dm_rdisk r LEFT JOIN dm_phydisk p ON r.phydisk_serial = p.serial WHERE r.app_id = ? AND r.uuid IN (?) AND r.phydisk_serial IN (?) LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:49:77:Search",
    "orm_code": "func (v *logicalVolumeViewerImpl) Search(ctx context.Context, appID users.AppID, criteria rdiskDomain.LVSearchCriteria, pagination rdiskDomain.Pagination) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar volumes []*metadb.DmRdisk\n\tstmt := v.db.WithContext(ctx).Where(\"app_id = ?\", appID)\n\tif len(criteria.UUIDs) > 0 {\n\t\tstmt = stmt.Where(\"uuid in ?\", functools.Map(criteria.UUIDs, func(i uuid.UUID) string { return i.String() }))\n\t}\n\tif len(criteria.Serials) > 0 {\n\t\tstmt = stmt.Where(\"phydisk_serial in ?\", functools.Map(criteria.Serials, func(i rdiskDomain.Serial) string { return string(i) }))\n\t}\n\tif pagination.Offset > 0 {\n\t\tstmt = stmt.Offset(int(pagination.Offset))\n\t}\n\tif pagination.Limit <= 0 {\n\t\tpagination.Limit = 10\n\t}\n\tresult := stmt.Preload(\"DmPhyDisk\").Limit(int(pagination.Limit)).Find(&volumes)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, nil\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews := functools.MapRef(make([]rdiskDomain.LogicalVolume, len(volumes)))\n\tfor i := range volumes {\n\t\tv.translate(volumes[i], resultViews[i])\n\t}\n\treturn resultViews, nil\n}",
    "caller": "func (c *DefunctPhysicalVolumeCommand) queryLogicalVolumeUUID(ctx context.Context, appId users.AppID) (string, error) {\n\tcriteria := rdiskDomain.LVSearchCriteria{\n\t\tSerials: []rdiskDomain.Serial{c.Serial},\n\t}\n\tpagination := rdiskDomain.Pagination{Limit: 1}\n\tlv, err := app.GetRegistry(ctx).Viewers.LogicalVolume.Search(ctx, appId, criteria, pagination)\n\tif err != nil {\n\t\treturn \"\", err\n\t}\n\tif len(lv) == 0 {\n\t\treturn \"\", nil\n\t}\n\treturn lv[0].UUID.String(), nil\n}",
    "sql_statement_list": [
      "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, dm_phydisk.serial, dm_phydisk.status, dm_phydisk.size, dm_phydisk.disk_type, dm_phydisk.zone_id, dm_phydisk.created, dm_phydisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk ON dm_rdisk.phydisk_serial = dm_phydisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.phydisk_serial IN (?) LIMIT 1;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 25,
        "code_end_line": 25,
        "code_key": "Serial",
        "code_value": "type Serial string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "",
    "sql_statement_list": [
      "SELECT dm_rdisk.id, dm_rdisk.uuid, dm_rdisk.status, dm_rdisk.app_id, dm_rdisk.size, dm_rdisk.phydisk_serial, dm_rdisk.extra, dm_rdisk.zone_id, dm_rdisk.volume_type, dm_rdisk.disk_type, dm_rdisk.read_iops, dm_rdisk.read_bandwidth, dm_rdisk.write_iops, dm_rdisk.write_bandwidth, dm_rdisk.rw_iops, dm_rdisk.rw_bandwidth, dm_rdisk.created, dm_rdisk.updated, DmPhyDisk.id, DmPhyDisk.serial, DmPhyDisk.status, DmPhyDisk.zone_id, DmPhyDisk.size, DmPhyDisk.disk_type, DmPhyDisk.created, DmPhyDisk.updated FROM dm_rdisk LEFT JOIN dm_phydisk DmPhyDisk ON dm_rdisk.phydisk_serial = DmPhyDisk.serial WHERE dm_rdisk.app_id = ? AND dm_rdisk.uuid IN (?);"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *CbsAppIdConsumer) Handle(ctx context.Context, delivery *rabbitmq.Delivery) error {\n\tu, chargeTime, err := c.ParseDelivery(ctx, delivery)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif u == nil {\n\t\tlogs.Info(c.Ctx).\n\t\t\tTime(\"chargeTime\", chargeTime).\n\t\t\tMsg(\"USER_INFO_NOT_FOUND\")\n\t\treturn nil\n\t}\n\n\tchargeDetail := c.GetChargeDetailForSingleUser(u, chargeTime)\n\tif chargeDetail == nil {\n\t\tlogs.Info(c.Ctx).\n\t\t\tUint64(\"appId\", uint64(u.AppId)).\n\t\t\tTime(\"chargeTime\", chargeTime).\n\t\t\tMsg(\"NO_RESOURCE_TO_CHARGE\")\n\t\treturn nil\n\t}\n\treturn c.ProcessChargeDetail(chargeDetail)\n}",
    "sql_statement_list": [
      "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`capacity` AS `DmPhyDisk__capacity`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid IN ?;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *DefunctPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tif err := c.ensureLocks(ctx); err != nil {\n\t\treturn err\n\t}\n\tif c.lvUUID != nil {\n\t\t// 涉及到逻辑卷时，需要先标记逻辑卷为故障\n\t\treturn c.handleBindedVolume(ctx)\n\t} else {\n\t\t// 不涉及到逻辑卷时，直接标记物理卷为故障\n\t\treturn c.handleIdleVolume(ctx)\n\t}\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND uuid IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *DetachLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByAppIDAndUUID(ctx, c.AppID, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEDetachLogicalVolume, c)\n\n\t// 如果没有挂载到指定的主机上，则直接返回成功\n\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotAttachedToHost) {\n\t\tlogs.Info(ctx).Str(\"uuid\", c.UUID.String()).Str(\"host_ip\", c.IP.String()).\n\t\t\tMsg(\"volume not attached to host\")\n\t\treturn nil\n\t}\n\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_rdisk WHERE app_id = ? AND uuid IN (?);",
      "SELECT * FROM dm_phydisk WHERE serial IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *CreateBenchmarkCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tvolSm     = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\tvolRepo   = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\terr       error\n\t)\n\n\tc.relatedVolume, err = volRepo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = volSm.Fire(ctx, c.relatedVolume.State, domain.PVEStartBenchmark, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBenchmark = benchmark.New(benchmark.DiskInfo{\n\t\tSerial: string(c.relatedVolume.Serial),\n\t\tHostIP: c.relatedVolume.IP,\n\t\tBDF:    string(c.relatedVolume.BDF),\n\t})\n\n\tif err = benchRepo.Add(ctx, c.relatedBenchmark); err != nil {\n\t\tdelegate := &benchmarkDelegate{cmd: c}\n\t\tif _err := delegate.TaskFinishCallback(ctx, c.relatedBenchmark); _err != nil {\n\t\t\tlogs.Warn(ctx).Err(_err).Str(\"serial\", string(c.relatedVolume.Serial)).Msg(\"failed to rollback: create bdev\")\n\t\t}\n\t\treturn err\n\t}\n\n\t_, err = benchSm.Fire(ctx, c.relatedBenchmark.Status, benchmark.EventCreateBench,\n\t\tbenchmark.Data{Benchmark: c.relatedBenchmark, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (d *DeleteLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\td.volume, err = repo.FindByID(ctx, d.UUID)\n\tif err != nil {\n\t\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotExists) {\n\t\t\treturn nil\n\t\t}\n\t\treturn err\n\t}\n\n\tif e := d.volume.CheckDelete(); e != nil {\n\t\treturn e\n\t}\n\n\tif d.volume.AppID != d.AppID {\n\t\treturn errors.New(rdiskDomain.ErrAppIDMismatch, \"refuse to delet: app id mismatch\")\n\t}\n\n\td.drgroup, err = app.GetRegistry(ctx).Repositories.DRGroup.FindByMember(ctx, d.AppID, d.volume.UUID.String())\n\tif err != nil {\n\t\tif errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\td.drgroup = nil\n\t\t} else {\n\t\t\treturn err\n\t\t}\n\t}\n\n\tif err := d.checkDRGroupMatch(ctx); err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, d.volume.State, rdiskDomain.LVEMarkToRecycle, d)\n\treturn\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *ConfirmRecycledPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEConfirmRecycled, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`size`,`DmPhyDisk`.`type`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid IN ?;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *DeleteRDiskBackupCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tsm   = app.GetRegistry(ctx).StateMachines.Backup\n\t\trepo = app.GetRegistry(ctx).Repositories.Backup\n\t)\n\n\tc.relatedVolume, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil || c.relatedVolume == nil || c.relatedVolume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\tc.relatedBackup, err = repo.FindByUUID(ctx, c.BackupID.String())\n\tif err != nil || c.relatedBackup == nil || c.relatedBackup.AppID != c.AppID {\n\t\treturn errors.New(backupDomain.ErrBackupNotExist, \"backup not exists\")\n\t}\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tc.relatedBackup.Status,\n\t\tbackupDomain.EventSoftDeleteBackup,\n\t\tbackupDomain.Data{Delegate: &backupDelegate{Data: c}, Backup: c.relatedBackup})\n\n\treturn\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *CreateRDiskBackupCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tlvSm  = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t\tbakSm = app.GetRegistry(ctx).StateMachines.Backup\n\t\trepo  = app.GetRegistry(ctx).Repositories.Backup\n\t)\n\tc.relatedVolume, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil || c.relatedVolume == nil || c.relatedVolume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\t_, err = lvSm.Fire(ctx, c.relatedVolume.State, rdiskDomain.LVEBackupStarted, c)\n\tif err != nil {\n\t\treturn\n\t}\n\n\tlv := c.relatedVolume\n\tbackup := backupDomain.New(\n\t\tlv.AppID,\n\t\tbackupDomain.DiskInfo{\n\t\t\tVolumeUUID: lv.UUID,\n\t\t\tVolumeSize: uint64(lv.Size),\n\t\t\tHostIP:     lv.PhysicalVolume.IP,\n\t\t\tHostBDF:    string(lv.PhysicalVolume.BDF),\n\t\t\tSerial:     string(lv.PhysicalVolume.Serial),\n\t\t},\n\t)\n\tif err := repo.Add(ctx, backup); err != nil {\n\t\treturn err\n\t}\n\tc.relatedBackup = backup\n\t_, err = bakSm.Fire(ctx, backupDomain.StatusInit, backupDomain.EventStartBackup, backupDomain.Data{Delegate: &backupDelegate{Data: c}, Backup: backup})\n\treturn err\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *AttachLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByAppIDAndUUID(ctx, c.AppID, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEAttachLogicalVolume, c)\n\n\t// 如果已经挂载到了指定的主机上，则直接返回成功\n\tif errors.IsCode(err, rdiskDomain.ErrVolumeAlreadyAttachedToHost) {\n\t\tlogs.Info(ctx).Str(\"uuid\", c.UUID.String()).Str(\"host_ip\", c.IP.String()).\n\t\t\tMsg(\"volume already attached to host\")\n\t\treturn nil\n\t}\n\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE app_id = ? and uuid in ? ORDER BY `dm_rdisk`.`id`;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *ConfirmDeleteLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\t// 如果逻辑卷不存在，则直接返回成功\n\t\tif errors.IsCode(err, rdiskDomain.ErrVolumeNotExists) {\n\t\t\treturn nil\n\t\t}\n\t\treturn err\n\t}\n\n\tif c.volume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrAppIDMismatch, \"failed to confirm delete: app id mismatch\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEDeleteLogicalVolume, c)\n\treturn err\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *OfflinePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEOfflinePhysicalVolume, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *DeletePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\t// 如果物理卷不存在，则直接幂等返回\n\t\treturn nil\n\t}\n\n\tvar event = domain.PVEDeletePhysicalVolume\n\tif c.Force && (c.relatedVolume.State == domain.PVSDefunct) {\n\t\t// 这里的实现不太好，状态机的逻辑不应该侵入 cmd\n\t\t// 时间太赶了，后续重构优化吧\n\t\tevent = domain.PVEForceDeleteForDefunct\n\t}\n\n\tif c.relatedVolume.HasBindedPV() {\n\t\treturn errors.New(domain.ErrVolumeBusy, \"logic volume has binded to this physical volume\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, event, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *CleanupLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVECleanupLogicalVolume, c)\n\n\treturn err\n}",
    "sql_statement_list": [
      "SELECT * FROM dm_rdisk WHERE app_id = ? AND uuid IN (?);",
      "SELECT * FROM dm_phydisk WHERE serial IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *ConfirmInitPhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\tif c.relatedVolume.IP.String() != c.Host.String() {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume host ip mistmatch\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVECreatePhysicalVolumeOnHost, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *CreatePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\n\t// 获取物理卷状态机\n\tsm := app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\trepo := app.GetRegistry(ctx).Repositories.PhysicalVolume\n\n\t// 检查物理卷是否已经存在，如果存在则直接幂等返回\n\tvol1, err := repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil && !errors.IsCode(err, domain.ErrPhysicalVolumeNotExists) {\n\t\tlogs.Warn(ctx).Err(err).Str(\"serial\", c.Serial).Msg(\"failed query existing physical volume\")\n\t\treturn errors.Newf(domain.ErrQueryPhysicalVolumeFailed, \"failed query existing physical volume: %v\", err)\n\t}\n\tvol2, err := repo.FindByIPAndBDF(ctx, c.Host, domain.BDF(c.BDF))\n\tif err != nil && !errors.IsCode(err, domain.ErrPhysicalVolumeNotExists) {\n\t\tlogs.Warn(ctx).Err(err).Str(\"host\", c.Host.String()).Str(\"bdf\", c.BDF).Msg(\"failed query existing physical volume\")\n\t\treturn errors.Newf(domain.ErrQueryPhysicalVolumeFailed, \"failed query existing physical volume: %v\", err)\n\t}\n\tfor _, vol := range []*domain.PhysicalVolume{vol1, vol2} {\n\t\texisted, err := c.checkExisting(ctx, vol)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\tif existed {\n\t\t\treturn nil\n\t\t}\n\t}\n\n\t// 触发事件，创建物理卷\n\t_, err = sm.Fire(ctx,\n\t\tdomain.PVSUnInited,\n\t\tdomain.PVECreatePhysicalVolume,\n\t\tc,\n\t)\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t// 创建 Bdev 以及格式化移动到创建物理卷的状态机中\n\n\t// _, err = sm.Fire(ctx,\n\t// \tc.GetPhysicalVolume().State,\n\t// \tdomain.PVECreatePhysicalVolumeOnHost,\n\t// \tc,\n\t// )\n\t// if err != nil {\n\t// \treturn err\n\t// }\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`status`,`DmPhyDisk`.`host`,`DmPhyDisk`.`bdf`,`DmPhyDisk`.`size`,`DmPhyDisk`.`disk_type`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phy_disk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid IN (?,?,?);"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *DeleteBenchmarkCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\terr       error\n\t)\n\n\tbench, err := benchRepo.FindByUUID(ctx, c.BenchmarkUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif bench.DiskInfo.Serial != c.Serial {\n\t\treturn errors.Newf(benchmark.ErrTaskNotFound, \"benchmark serial not match %s, want %s\", c.Serial, bench.DiskInfo.Serial)\n\t}\n\n\t_, err = benchSm.Fire(ctx, bench.Status, benchmark.EventDeleteBench, benchmark.Data{Benchmark: bench, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif err := benchRepo.Delete(ctx, bench); err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *CreateLogicalVolumeCommand) Handle(ctx context.Context) (err error) {\n\tvar (\n\t\tpvRepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tlvRepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm     = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\t// 1. 查找底层物理卷\n\tc.selectedPhysicalVolume, err = pvRepo.FindBySerial(ctx, rdiskDomain.Serial(c.PhysicalVolumeSerial))\n\tif err != nil {\n\t\treturn\n\t}\n\n\t// 检查底层物理卷大小是否满足要求\n\tif c.selectedPhysicalVolume.Size < rdiskDomain.Size(c.DiskSize) {\n\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume size %d is smaller than requested size %d\", c.selectedPhysicalVolume.Size, c.DiskSize)\n\t}\n\n\t// 检查底层物理卷性能等级是否满足要求\n\tif c.PerformanceRank != \"\" {\n\t\tif string(c.selectedPhysicalVolume.PerformanceRank) != c.PerformanceRank {\n\t\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume performance rank %s is not match requested rank %s\", c.selectedPhysicalVolume.PerformanceRank, c.PerformanceRank)\n\t\t}\n\t} else {\n\t\tif c.selectedPhysicalVolume.PerformanceRank != rdiskDomain.DefaultPerformanceRank {\n\t\t\treturn errors.Newf(rdiskDomain.ErrPhysicalVolumeSizeNotMatch, \"physical volume performance rank %s is not default rank %s\", c.selectedPhysicalVolume.PerformanceRank, rdiskDomain.DefaultPerformanceRank)\n\t\t}\n\t}\n\n\t// 2. 创建逻辑卷\n\tvol := rdiskDomain.NewLogicalVolume(users.AppID(c.AppID), rdiskDomain.Size(c.DiskSize), rdiskDomain.ZoneID(c.ZoneID))\n\tif c.VolumeType != \"\" {\n\t\tvol.VolumeType = rdiskDomain.VolumeType(c.VolumeType)\n\t}\n\tif c.DiskType != \"\" {\n\t\tvol.DiskType = rdiskDomain.DiskType(c.DiskType)\n\t}\n\terr = lvRepo.Add(ctx, vol)\n\tif err != nil {\n\t\treturn\n\t}\n\tc.createdLogicalVolume = vol\n\n\t// 3. 触发状态机，联动更新逻辑卷和物理卷状态\n\t_, err = sm.Fire(ctx, rdiskDomain.LVSUnInited, rdiskDomain.LVECreateLogicalVolume, c)\n\treturn\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *UpdateRunningBackupTaskCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepos = app.GetRegistry(ctx).Repositories\n\t\tsm    = app.GetRegistry(ctx).StateMachines.Backup\n\t)\n\n\tbak, err := repos.Backup.FindByUUID(ctx, c.UUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvol, err := repos.LogicalVolume.FindByID(ctx, bak.DiskInfo.VolumeUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBackup = bak\n\tc.relatedVolume = vol\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tbak.Status,\n\t\tbackupDomain.EventUpdateBackupProgress,\n\t\tbackupDomain.Data{Backup: bak, Delegate: &backupDelegate{Data: c}})\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *UpdateLogicalVolumeDRGroupCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\tlvView  = app.GetRegistry(ctx).Viewers.LogicalVolume\n\t\tdrgRepo = app.GetRegistry(ctx).Repositories.DRGroup\n\t\tsm      = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t\terr     error\n\t)\n\n\t// 0. 初始化\n\tc.drgroupRef = make(map[string]*drgroup.DRGroup)\n\n\t// 1. 加载所有逻辑卷所在的置放群组\n\tallVolumeUUIDs := make([]string, 0, len(c.UUIDs))\n\tfor _, _uuid := range c.UUIDs {\n\t\tallVolumeUUIDs = append(allVolumeUUIDs, _uuid.String())\n\t}\n\tif groups, err := drgRepo.FindByMembers(ctx, c.AppID, allVolumeUUIDs); err == nil {\n\t\tif err != nil {\n\t\t\tif !errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t\tfor _, group := range groups {\n\t\t\tc.drgroupRef[group.Name] = group\n\t\t\tc.curDRGroupNames = append(c.curDRGroupNames, group.Name)\n\t\t}\n\t} else {\n\t\treturn err\n\t}\n\n\t// 2. 确认已上锁的置放群组和当前一致\n\tif !c.checkLockedDRGroupNames() {\n\t\treturn errors.New(drgroup.ErrGroupModified, \"drgroup changed\")\n\t}\n\n\t// 3. 加载所有逻辑卷的状态，不需要完整实体，因为不会修改 Volume\n\tc.relatedLogicalVolume, err = lvView.FindByIDs(ctx, c.AppID, c.UUIDs)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif len(c.relatedLogicalVolume) < len(c.UUIDs) {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not exists\")\n\t}\n\n\t// 4. 加载所有目标置放群组，key 为 name\n\tfor _, spec := range c.Specs {\n\t\tvar group *drgroup.DRGroup\n\t\tif _, ok := c.drgroupRef[spec.Name]; ok {\n\t\t\tgroup = c.drgroupRef[spec.Name]\n\t\t} else {\n\t\t\tgroup, err = c.getOrCreateDRGroup(ctx, drgRepo, spec)\n\t\t\tif err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t\tc.drgroupRef[group.Name] = group\n\t\t}\n\n\t\tif spec.Affinity > 0 {\n\t\t\tgroup.Affinity = spec.Affinity\n\t\t}\n\t\tif spec.Type != \"\" {\n\t\t\tgroup.Type = drgroup.LocType(spec.Type)\n\t\t}\n\t}\n\n\t// 5. 对所有逻辑卷执行置放群组变更事件，检查状态是否允许，\n\t//    实际的更新还是在这里执行。\n\tfor _, vol := range c.relatedLogicalVolume {\n\t\terr := sm.Check(ctx, vol.State, rdiskDomain.LVEUpdateDrGroup, c)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\t// 将逻辑卷从原有的置放群组中移除\n\t\tfor _, name := range c.curDRGroupNames {\n\t\t\tc.drgroupRef[name].RemoveMember(vol.UUID.String())\n\t\t}\n\t\t// 将逻辑卷添加到新的置放群组中\n\t\tfor _, spec := range c.Specs {\n\t\t\tsubGroup := spec.SubGroup\n\t\t\tif subGroup == \"\" {\n\t\t\t\t// 如果没有指定子组，则使用远端 SSD UUID 作为子组名称\n\t\t\t\t// 相当于每块盘都是一个子组，相当于没有使用子组功能\n\t\t\t\tsubGroup = vol.UUID.String()\n\t\t\t}\n\t\t\tif err := c.drgroupRef[spec.Name].AddMember(vol.UUID.String(), subGroup, vol.PhysicalVolume.IP.String()); err != nil {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t}\n\n\tif c.DryRun {\n\t\treturn errors.New(errors.ErrDryRunSuccessExit, \"dry run check success\")\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE app_id = ? AND uuid IN (?);",
      "SELECT * FROM `dm_phydisk` WHERE `serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *OnlinePhysicalVolumeCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEOnlinePhysicalVolume, c)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT * FROM `dm_rdisk` WHERE app_id = ? and uuid in ? AND `dm_rdisk`.`id` IN (SELECT `dm_rdisk`.`id` FROM `dm_rdisk` WHERE app_id = ? and uuid in ?);",
      "SELECT * FROM `dm_phydisk` WHERE `dm_phydisk`.`serial` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *UpdateBenchmarkTask) Handle(ctx context.Context) error {\n\tvar (\n\t\tbenchSm   = app.GetRegistry(ctx).StateMachines.Benchmark\n\t\tvolRepo   = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tbenchRepo = app.GetRegistry(ctx).Repositories.Benchmark\n\t\terr       error\n\t)\n\n\tc.relatedVolume, err = volRepo.FindBySerial(ctx, rdisk.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBenchmark, err = benchRepo.FindByUUID(ctx, c.BenchmarkUUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\t_, err = benchSm.Fire(ctx, c.relatedBenchmark.Status, benchmark.EventUpdateBench, benchmark.Data{Benchmark: c.relatedBenchmark, Delegate: &benchmarkDelegate{cmd: c}})\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *UpdateLogicalVolumeFlowControlCommand) Handle(ctx context.Context) (err error) {\n\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.LogicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\t)\n\n\tc.volume, err = repo.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\tif c.volume.AppID != c.AppID {\n\t\treturn errors.New(rdiskDomain.ErrVolumeNotExists, \"volume not found\")\n\t}\n\n\tspec := c.volume.FlowControlSpec\n\tif !c.UpdateRequest.UpdateSpec(&spec, c.volume.GetDefaultFlowControlSpec()) {\n\t\t// 没有任何更新，直接返回成功\n\t\treturn nil\n\t}\n\tc.volume.SetFlowControlSpec(spec)\n\t_, err = sm.Fire(ctx, c.volume.State, rdiskDomain.LVEUpdateFlowControl, c)\n\treturn err\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *CleanupDefunctCommand) Handle(ctx context.Context) error {\n\tvar err error\n\tc.lv, err = app.GetRegistry(ctx).Repositories.LogicalVolume.FindByID(ctx, c.UUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvar sm = app.GetRegistry(ctx).StateMachines.LogicalVolume\n\tvar event = rdiskDomain.LVECleanupDefunct\n\n\tfor _, attachment := range c.lv.Attachments {\n\t\tlogs.Info(ctx).Stringer(\"uuid\", c.UUID).Stringer(\"host\", attachment.IP).Msg(\"cleanup defuncting volume\")\n\t\tsubCmd := &cleanDefunctSubCommand{Parent: c, HostIP: attachment.IP}\n\t\t_, err = sm.Fire(ctx, c.lv.State, event, subCmd)\n\t\tif err != nil {\n\t\t\t// 这里不需要返回错误，因为只要有一个挂载点清理失败，其他挂载点还是需要继续清理的\n\t\t\t// 失败的挂载点会在后台继续清理\n\t\t\tlogs.Error(ctx).Err(err).Stringer(\"uuid\", c.UUID).Stringer(\"host\", attachment.IP).\n\t\t\t\tMsg(\"failed to cleanup defunct volume, retry later.\")\n\t\t}\n\t}\n\n\tif len(c.lv.Attachments) == 0 {\n\t\t// 没有挂载点，直接清理\n\t\t_, err = sm.Fire(ctx, c.lv.State, event, &cleanDefunctSubCommand{Parent: c, HostIP: net.IP{}})\n\t\tif err != nil {\n\t\t\t// 这里不需要返回错误，后续自动重试即可\n\t\t\tlogs.Error(ctx).Err(err).Stringer(\"uuid\", c.UUID).Msg(\"failed to complete cleanup defunct volume\")\n\t\t}\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`id` AS `DmPhyDisk__id`,`DmPhyDisk`.`serial` AS `DmPhyDisk__serial`,`DmPhyDisk`.`status` AS `DmPhyDisk__status`,`DmPhyDisk`.`size` AS `DmPhyDisk__size`,`DmPhyDisk`.`zone_id` AS `DmPhyDisk__zone_id`,`DmPhyDisk`.`disk_type` AS `DmPhyDisk__disk_type`,`DmPhyDisk`.`created` AS `DmPhyDisk__created`,`DmPhyDisk`.`updated` AS `DmPhyDisk__updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid IN ?;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *ConfirmDRGroupExistsCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.DRGroup\n\t)\n\tfor _, spec := range c.DRGroup {\n\t\t_, err := repo.FindByName(ctx, users.AppID(c.AppID), spec.Name)\n\t\tif err != nil {\n\t\t\tif errors.IsCode(err, drgroup.ErrGroupNotExist) {\n\t\t\t\tgroup := drgroup.New(spec.Name, users.AppID(c.AppID))\n\t\t\t\tif spec.Affinity > 0 {\n\t\t\t\t\tgroup.Affinity = spec.Affinity\n\t\t\t\t}\n\t\t\t\tif spec.Type != \"\" {\n\t\t\t\t\tgroup.Type = drgroup.LocType(spec.Type)\n\t\t\t\t}\n\t\t\t\terr = repo.Add(ctx, group)\n\t\t\t\tif err != nil {\n\t\t\t\t\treturn err\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn err\n\t\t\t}\n\t\t}\n\t}\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT r.id, r.uuid, r.status, r.app_id, r.size, r.phydisk_serial, r.extra, r.zone_id, r.volume_type, r.disk_type, r.read_iops, r.read_bandwidth, r.write_iops, r.write_bandwidth, r.rw_iops, r.rw_bandwidth, r.created, r.updated, p.serial, p.status, p.size, p.slot, p.path, p.type, p.health, p.temperature, p.power_on_hours, p.created, p.updated FROM dm_rdisk r LEFT JOIN dm_phydisk p ON r.phydisk_serial = p.serial WHERE r.app_id = ? AND r.uuid IN ?;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *UpdatePhyRDiskCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepo = app.GetRegistry(ctx).Repositories.PhysicalVolume\n\t\tsm   = app.GetRegistry(ctx).StateMachines.PhysicalVolume\n\t\terr  error\n\t)\n\n\tc.relatedVolume, err = repo.FindBySerial(ctx, domain.Serial(c.Serial))\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tif c.relatedVolume == nil {\n\t\treturn errors.New(domain.ErrPhysicalVolumeNotExists, \"physical volume not exists\")\n\t}\n\n\t_, err = sm.Fire(ctx, c.relatedVolume.State, domain.PVEUpdatePhysicalVolume, c)\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/viewers/logi_vol.go:109:132:FindByIDs",
    "orm_code": "func (v *logicalVolumeViewerImpl) FindByIDs(ctx context.Context, appID users.AppID, id []uuid.UUID) ([]*rdiskDomain.LogicalVolume, error) {\n\tvar (\n\t\tresultViews   []rdiskDomain.LogicalVolume\n\t\tresultViewRef []*rdiskDomain.LogicalVolume\n\t\tdataObjects   []*metadb.DmRdisk\n\t)\n\n\tuuidStrSlice := functools.Map(id, func(i uuid.UUID) string { return i.String() })\n\tresult := v.db.WithContext(ctx).Preload(\"DmPhyDisk\").Find(&dataObjects, \"app_id = ? and uuid in ?\", appID, uuidStrSlice)\n\tif result.Error != nil {\n\t\tif errors.Is(result.Error, gorm.ErrRecordNotFound) {\n\t\t\treturn nil, errors.New(rdiskDomain.ErrVolumeNotExists, \"logical volume not exist\")\n\t\t}\n\t\treturn nil, result.Error\n\t}\n\n\tresultViews = make([]rdiskDomain.LogicalVolume, len(dataObjects))\n\tresultViewRef = make([]*rdiskDomain.LogicalVolume, len(dataObjects))\n\tfor i := range dataObjects {\n\t\tresultViewRef[i] = &resultViews[i]\n\t\tv.translate(dataObjects[i], resultViewRef[i])\n\t}\n\treturn resultViewRef, nil\n}",
    "caller": "func (c *RecycleBackupDataCommand) Handle(ctx context.Context) error {\n\tvar (\n\t\trepos = app.GetRegistry(ctx).Repositories\n\t\tsm    = app.GetRegistry(ctx).StateMachines.Backup\n\t)\n\n\tbak, err := repos.Backup.FindByUUID(ctx, c.UUID.String())\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tvol, err := repos.LogicalVolume.FindByID(ctx, bak.DiskInfo.VolumeUUID)\n\tif err != nil {\n\t\treturn err\n\t}\n\n\tc.relatedBackup = bak\n\tc.relatedVolume = vol\n\n\t_, err = sm.Fire(\n\t\tctx,\n\t\tbak.Status,\n\t\tbackupDomain.EventDeleteBackup,\n\t\tbackupDomain.Data{Backup: bak, Delegate: &backupDelegate{Data: c}})\n\n\tif err != nil {\n\t\treturn err\n\t}\n\n\treturn nil\n}",
    "sql_statement_list": [
      "SELECT `dm_rdisk`.`id`,`dm_rdisk`.`uuid`,`dm_rdisk`.`status`,`dm_rdisk`.`app_id`,`dm_rdisk`.`size`,`dm_rdisk`.`phydisk_serial`,`dm_rdisk`.`extra`,`dm_rdisk`.`zone_id`,`dm_rdisk`.`volume_type`,`dm_rdisk`.`disk_type`,`dm_rdisk`.`read_iops`,`dm_rdisk`.`read_bandwidth`,`dm_rdisk`.`write_iops`,`dm_rdisk`.`write_bandwidth`,`dm_rdisk`.`rw_iops`,`dm_rdisk`.`rw_bandwidth`,`dm_rdisk`.`created`,`dm_rdisk`.`updated`,`DmPhyDisk`.`serial`,`DmPhyDisk`.`capacity`,`DmPhyDisk`.`status`,`DmPhyDisk`.`zone_id`,`DmPhyDisk`.`created`,`DmPhyDisk`.`updated` FROM `dm_rdisk` LEFT JOIN `dm_phydisk` `DmPhyDisk` ON `dm_rdisk`.`phydisk_serial` = `DmPhyDisk`.`serial` WHERE app_id = ? AND uuid IN ?;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/domain/rdisk/models.go",
        "code_start_line": 178,
        "code_end_line": 190,
        "code_key": "LogicalVolume",
        "code_value": "type LogicalVolume struct {\n\tEntityMixin\n\tUUID            uuid.UUID\n\tState           LogicalVolumeState\n\tSize            Size\n\tAppID           users.AppID\n\tZoneID          ZoneID\n\tDiskType        DiskType\n\tVolumeType      VolumeType\n\tFlowControlSpec FlowControlSpec\n\tPhysicalVolume  *PhysicalVolume\n\tAttachments     []*VolumeAttachment\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 5,
        "code_end_line": 27,
        "code_key": "DmRdisk",
        "code_value": "type DmRdisk struct {\n\tID                 uint64    `gorm:\"column:id;primaryKey\"`\n\tUUID               string    `gorm:\"column:uuid;unique\"`\n\tStatus             int       `gorm:\"column:status\"`\n\tAppID              int64     `gorm:\"column:app_id\"`\n\tSize               int64     `gorm:\"column:size\"`\n\tPhydiskSerial      string    `gorm:\"column:phydisk_serial\"`\n\tExtra              string    `gorm:\"column:extra\"`\n\tZoneID             int64     `gorm:\"column:zone_id\"`\n\tVolumeType         string    `gorm:\"column:volume_type\"`\n\tDiskType           string    `gorm:\"column:disk_type\"`\n\tReadIOPS           int64     `gorm:\"column:read_iops\"`\n\tReadBandwidth      int64     `gorm:\"column:read_bandwidth\"`\n\tWriteIOPS          int64     `gorm:\"column:write_iops\"`\n\tWriteBandwidth     int64     `gorm:\"column:write_bandwidth\"`\n\tReadWriteIOPS      int64     `gorm:\"column:rw_iops\"`\n\tReadWriteBandwidth int64     `gorm:\"column:rw_bandwidth\"`\n\tCreated            time.Time `gorm:\"column:created\"`\n\tUpdated            time.Time `gorm:\"column:updated\"`\n\n\tDmPhyDisk   *DmPhydisk          `gorm:\"foreignKey:Serial;references:PhydiskSerial\"`\n\tAttachments []DmRdiskAttachment `gorm:\"foreignKey:UUID;references:UUID\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/db/metadb/model.go",
        "code_start_line": 29,
        "code_end_line": 31,
        "code_key": "TableName",
        "code_value": "func (DmRdisk) TableName() string {\n\treturn \"dm_rdisk\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/models/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      },
      {
        "code_file": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/common/model.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "UUID",
        "code_value": "type UUID string",
        "code_label": null,
        "code_type": 3,
        "code_version": "7a6ce9d47c30a5bf582db3b759442d236a89c6c6"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/5-28-cbs.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/callback_query_preload.go:134:183:handleHasOnePreload",
    "orm_code": "func (scope *Scope) handleHasOnePreload(field *Field, conditions []interface{}) {\n\trelation := field.Relationship\n\n\t// get relations's primary keys\n\tprimaryKeys := scope.getColumnAsArray(relation.AssociationForeignFieldNames, scope.Value)\n\tif len(primaryKeys) == 0 {\n\t\treturn\n\t}\n\n\t// preload conditions\n\tpreloadDB, preloadConditions := scope.generatePreloadDBWithConditions(conditions)\n\n\t// find relations\n\tquery := fmt.Sprintf(\"%v IN (%v)\", toQueryCondition(scope, relation.ForeignDBNames), toQueryMarks(primaryKeys))\n\tvalues := toQueryValues(primaryKeys)\n\tif relation.PolymorphicType != \"\" {\n\t\tquery += fmt.Sprintf(\" AND %v = ?\", scope.Quote(relation.PolymorphicDBName))\n\t\tvalues = append(values, relation.PolymorphicValue)\n\t}\n\n\tresults := makeSlice(field.Struct.Type)\n\tscope.Err(preloadDB.Where(query, values...).Find(results, preloadConditions...).Error)\n\n\t// assign find results\n\tvar (\n\t\tresultsValue       = indirect(reflect.ValueOf(results))\n\t\tindirectScopeValue = scope.IndirectValue()\n\t)\n\n\tif indirectScopeValue.Kind() == reflect.Slice {\n\t\tforeignValuesToResults := make(map[string]reflect.Value)\n\t\tfor i := 0; i < resultsValue.Len(); i++ {\n\t\t\tresult := resultsValue.Index(i)\n\t\t\tforeignValues := toString(getValueFromFields(result, relation.ForeignFieldNames))\n\t\t\tforeignValuesToResults[foreignValues] = result\n\t\t}\n\t\tfor j := 0; j < indirectScopeValue.Len(); j++ {\n\t\t\tindirectValue := indirect(indirectScopeValue.Index(j))\n\t\t\tvalueString := toString(getValueFromFields(indirectValue, relation.AssociationForeignFieldNames))\n\t\t\tif result, found := foreignValuesToResults[valueString]; found {\n\t\t\t\tindirectValue.FieldByName(field.Name).Set(result)\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor i := 0; i < resultsValue.Len(); i++ {\n\t\t\tresult := resultsValue.Index(i)\n\t\t\tscope.Err(field.Set(result))\n\t\t}\n\t}\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "非多态关联的HasOne预加载",
            "sql": "SELECT * FROM target_table WHERE foreign_key IN (?, ?, ?);"
          },
          {
            "scenario": "多态关联的HasOne预加载",
            "sql": "SELECT * FROM target_table WHERE foreign_key IN (?, ?, ?) AND polymorphic_type = ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/field.go",
        "code_start_line": 12,
        "code_end_line": 16,
        "code_key": "Field",
        "code_value": "type Field struct {\n\t*StructField\n\tIsBlank bool\n\tField   reflect.Value\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/STKE__jinzhu-gorm.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/callback_query_preload.go:134:183:handleHasOnePreload",
    "orm_code": "func (scope *Scope) handleHasOnePreload(field *Field, conditions []interface{}) {\n\trelation := field.Relationship\n\n\t// get relations's primary keys\n\tprimaryKeys := scope.getColumnAsArray(relation.AssociationForeignFieldNames, scope.Value)\n\tif len(primaryKeys) == 0 {\n\t\treturn\n\t}\n\n\t// preload conditions\n\tpreloadDB, preloadConditions := scope.generatePreloadDBWithConditions(conditions)\n\n\t// find relations\n\tquery := fmt.Sprintf(\"%v IN (%v)\", toQueryCondition(scope, relation.ForeignDBNames), toQueryMarks(primaryKeys))\n\tvalues := toQueryValues(primaryKeys)\n\tif relation.PolymorphicType != \"\" {\n\t\tquery += fmt.Sprintf(\" AND %v = ?\", scope.Quote(relation.PolymorphicDBName))\n\t\tvalues = append(values, relation.PolymorphicValue)\n\t}\n\n\tresults := makeSlice(field.Struct.Type)\n\tscope.Err(preloadDB.Where(query, values...).Find(results, preloadConditions...).Error)\n\n\t// assign find results\n\tvar (\n\t\tresultsValue       = indirect(reflect.ValueOf(results))\n\t\tindirectScopeValue = scope.IndirectValue()\n\t)\n\n\tif indirectScopeValue.Kind() == reflect.Slice {\n\t\tforeignValuesToResults := make(map[string]reflect.Value)\n\t\tfor i := 0; i < resultsValue.Len(); i++ {\n\t\t\tresult := resultsValue.Index(i)\n\t\t\tforeignValues := toString(getValueFromFields(result, relation.ForeignFieldNames))\n\t\t\tforeignValuesToResults[foreignValues] = result\n\t\t}\n\t\tfor j := 0; j < indirectScopeValue.Len(); j++ {\n\t\t\tindirectValue := indirect(indirectScopeValue.Index(j))\n\t\t\tvalueString := toString(getValueFromFields(indirectValue, relation.AssociationForeignFieldNames))\n\t\t\tif result, found := foreignValuesToResults[valueString]; found {\n\t\t\t\tindirectValue.FieldByName(field.Name).Set(result)\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor i := 0; i < resultsValue.Len(); i++ {\n\t\t\tresult := resultsValue.Index(i)\n\t\t\tscope.Err(field.Set(result))\n\t\t}\n\t}\n}",
    "caller": "func preloadCallback(scope *Scope) {\n\tif _, skip := scope.InstanceGet(\"gorm:skip_query_callback\"); skip {\n\t\treturn\n\t}\n\n\tif ap, ok := scope.Get(\"gorm:auto_preload\"); ok {\n\t\t// If gorm:auto_preload IS NOT a bool then auto preload.\n\t\t// Else if it IS a bool, use the value\n\t\tif apb, ok := ap.(bool); !ok {\n\t\t\tautoPreload(scope)\n\t\t} else if apb {\n\t\t\tautoPreload(scope)\n\t\t}\n\t}\n\n\tif scope.Search.preload == nil || scope.HasError() {\n\t\treturn\n\t}\n\n\tvar (\n\t\tpreloadedMap = map[string]bool{}\n\t\tfields       = scope.Fields()\n\t)\n\n\tfor _, preload := range scope.Search.preload {\n\t\tvar (\n\t\t\tpreloadFields = strings.Split(preload.schema, \".\")\n\t\t\tcurrentScope  = scope\n\t\t\tcurrentFields = fields\n\t\t)\n\n\t\tfor idx, preloadField := range preloadFields {\n\t\t\tvar currentPreloadConditions []interface{}\n\n\t\t\tif currentScope == nil {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// if not preloaded\n\t\t\tif preloadKey := strings.Join(preloadFields[:idx+1], \".\"); !preloadedMap[preloadKey] {\n\n\t\t\t\t// assign search conditions to last preload\n\t\t\t\tif idx == len(preloadFields)-1 {\n\t\t\t\t\tcurrentPreloadConditions = preload.conditions\n\t\t\t\t}\n\n\t\t\t\tfor _, field := range currentFields {\n\t\t\t\t\tif field.Name != preloadField || field.Relationship == nil {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch field.Relationship.Kind {\n\t\t\t\t\tcase \"has_one\":\n\t\t\t\t\t\tcurrentScope.handleHasOnePreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"has_many\":\n\t\t\t\t\t\tcurrentScope.handleHasManyPreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"belongs_to\":\n\t\t\t\t\t\tcurrentScope.handleBelongsToPreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"many_to_many\":\n\t\t\t\t\t\tcurrentScope.handleManyToManyPreload(field, currentPreloadConditions)\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tscope.Err(errors.New(\"unsupported relation\"))\n\t\t\t\t\t}\n\n\t\t\t\t\tpreloadedMap[preloadKey] = true\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tif !preloadedMap[preloadKey] {\n\t\t\t\t\tscope.Err(fmt.Errorf(\"can't preload field %s for %s\", preloadField, currentScope.GetModelStruct().ModelType))\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// preload next level\n\t\t\tif idx < len(preloadFields)-1 {\n\t\t\t\tcurrentScope = currentScope.getColumnAsScope(preloadField)\n\t\t\t\tif currentScope != nil {\n\t\t\t\t\tcurrentFields = currentScope.Fields()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "非多态关联的has_one预加载",
            "sql": "SELECT * FROM associated_table WHERE foreign_key IN (?, ?, ?);"
          },
          {
            "scenario": "多态关联的has_one预加载",
            "sql": "SELECT * FROM associated_table WHERE foreign_key IN (?, ?, ?) AND polymorphic_type = ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/field.go",
        "code_start_line": 12,
        "code_end_line": 16,
        "code_key": "Field",
        "code_value": "type Field struct {\n\t*StructField\n\tIsBlank bool\n\tField   reflect.Value\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/STKE__jinzhu-gorm.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/callback_query_preload.go:186:236:handleHasManyPreload",
    "orm_code": "func (scope *Scope) handleHasManyPreload(field *Field, conditions []interface{}) {\n\trelation := field.Relationship\n\n\t// get relations's primary keys\n\tprimaryKeys := scope.getColumnAsArray(relation.AssociationForeignFieldNames, scope.Value)\n\tif len(primaryKeys) == 0 {\n\t\treturn\n\t}\n\n\t// preload conditions\n\tpreloadDB, preloadConditions := scope.generatePreloadDBWithConditions(conditions)\n\n\t// find relations\n\tquery := fmt.Sprintf(\"%v IN (%v)\", toQueryCondition(scope, relation.ForeignDBNames), toQueryMarks(primaryKeys))\n\tvalues := toQueryValues(primaryKeys)\n\tif relation.PolymorphicType != \"\" {\n\t\tquery += fmt.Sprintf(\" AND %v = ?\", scope.Quote(relation.PolymorphicDBName))\n\t\tvalues = append(values, relation.PolymorphicValue)\n\t}\n\n\tresults := makeSlice(field.Struct.Type)\n\tscope.Err(preloadDB.Where(query, values...).Find(results, preloadConditions...).Error)\n\n\t// assign find results\n\tvar (\n\t\tresultsValue       = indirect(reflect.ValueOf(results))\n\t\tindirectScopeValue = scope.IndirectValue()\n\t)\n\n\tif indirectScopeValue.Kind() == reflect.Slice {\n\t\tpreloadMap := make(map[string][]reflect.Value)\n\t\tfor i := 0; i < resultsValue.Len(); i++ {\n\t\t\tresult := resultsValue.Index(i)\n\t\t\tforeignValues := getValueFromFields(result, relation.ForeignFieldNames)\n\t\t\tpreloadMap[toString(foreignValues)] = append(preloadMap[toString(foreignValues)], result)\n\t\t}\n\n\t\tfor j := 0; j < indirectScopeValue.Len(); j++ {\n\t\t\tobject := indirect(indirectScopeValue.Index(j))\n\t\t\tobjectRealValue := getValueFromFields(object, relation.AssociationForeignFieldNames)\n\t\t\tf := object.FieldByName(field.Name)\n\t\t\tif results, ok := preloadMap[toString(objectRealValue)]; ok {\n\t\t\t\tf.Set(reflect.Append(f, results...))\n\t\t\t} else {\n\t\t\t\tf.Set(reflect.MakeSlice(f.Type(), 0, 0))\n\t\t\t}\n\t\t}\n\t} else {\n\t\tscope.Err(field.Set(resultsValue))\n\t}\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "普通HasMany预加载（无多态关联，无额外条件）",
            "sql": "SELECT * FROM [关联表名] WHERE [外键字段] IN (?, ?, ?);"
          },
          {
            "scenario": "带多态类型的HasMany预加载（无额外条件）",
            "sql": "SELECT * FROM [关联表名] WHERE [外键字段] IN (?, ?, ?) AND [多态类型字段] = ?;"
          },
          {
            "scenario": "普通HasMany预加载带额外预加载条件",
            "sql": "SELECT * FROM [关联表名] WHERE [外键字段] IN (?, ?, ?) AND [额外条件字段] = ?;"
          },
          {
            "scenario": "带多态类型的HasMany预加载且带额外预加载条件",
            "sql": "SELECT * FROM [关联表名] WHERE [外键字段] IN (?, ?, ?) AND [多态类型字段] = ? AND [额外条件字段] = ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/field.go",
        "code_start_line": 12,
        "code_end_line": 16,
        "code_key": "Field",
        "code_value": "type Field struct {\n\t*StructField\n\tIsBlank bool\n\tField   reflect.Value\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/STKE__jinzhu-gorm.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/callback_query_preload.go:186:236:handleHasManyPreload",
    "orm_code": "func (scope *Scope) handleHasManyPreload(field *Field, conditions []interface{}) {\n\trelation := field.Relationship\n\n\t// get relations's primary keys\n\tprimaryKeys := scope.getColumnAsArray(relation.AssociationForeignFieldNames, scope.Value)\n\tif len(primaryKeys) == 0 {\n\t\treturn\n\t}\n\n\t// preload conditions\n\tpreloadDB, preloadConditions := scope.generatePreloadDBWithConditions(conditions)\n\n\t// find relations\n\tquery := fmt.Sprintf(\"%v IN (%v)\", toQueryCondition(scope, relation.ForeignDBNames), toQueryMarks(primaryKeys))\n\tvalues := toQueryValues(primaryKeys)\n\tif relation.PolymorphicType != \"\" {\n\t\tquery += fmt.Sprintf(\" AND %v = ?\", scope.Quote(relation.PolymorphicDBName))\n\t\tvalues = append(values, relation.PolymorphicValue)\n\t}\n\n\tresults := makeSlice(field.Struct.Type)\n\tscope.Err(preloadDB.Where(query, values...).Find(results, preloadConditions...).Error)\n\n\t// assign find results\n\tvar (\n\t\tresultsValue       = indirect(reflect.ValueOf(results))\n\t\tindirectScopeValue = scope.IndirectValue()\n\t)\n\n\tif indirectScopeValue.Kind() == reflect.Slice {\n\t\tpreloadMap := make(map[string][]reflect.Value)\n\t\tfor i := 0; i < resultsValue.Len(); i++ {\n\t\t\tresult := resultsValue.Index(i)\n\t\t\tforeignValues := getValueFromFields(result, relation.ForeignFieldNames)\n\t\t\tpreloadMap[toString(foreignValues)] = append(preloadMap[toString(foreignValues)], result)\n\t\t}\n\n\t\tfor j := 0; j < indirectScopeValue.Len(); j++ {\n\t\t\tobject := indirect(indirectScopeValue.Index(j))\n\t\t\tobjectRealValue := getValueFromFields(object, relation.AssociationForeignFieldNames)\n\t\t\tf := object.FieldByName(field.Name)\n\t\t\tif results, ok := preloadMap[toString(objectRealValue)]; ok {\n\t\t\t\tf.Set(reflect.Append(f, results...))\n\t\t\t} else {\n\t\t\t\tf.Set(reflect.MakeSlice(f.Type(), 0, 0))\n\t\t\t}\n\t\t}\n\t} else {\n\t\tscope.Err(field.Set(resultsValue))\n\t}\n}",
    "caller": "func preloadCallback(scope *Scope) {\n\tif _, skip := scope.InstanceGet(\"gorm:skip_query_callback\"); skip {\n\t\treturn\n\t}\n\n\tif ap, ok := scope.Get(\"gorm:auto_preload\"); ok {\n\t\t// If gorm:auto_preload IS NOT a bool then auto preload.\n\t\t// Else if it IS a bool, use the value\n\t\tif apb, ok := ap.(bool); !ok {\n\t\t\tautoPreload(scope)\n\t\t} else if apb {\n\t\t\tautoPreload(scope)\n\t\t}\n\t}\n\n\tif scope.Search.preload == nil || scope.HasError() {\n\t\treturn\n\t}\n\n\tvar (\n\t\tpreloadedMap = map[string]bool{}\n\t\tfields       = scope.Fields()\n\t)\n\n\tfor _, preload := range scope.Search.preload {\n\t\tvar (\n\t\t\tpreloadFields = strings.Split(preload.schema, \".\")\n\t\t\tcurrentScope  = scope\n\t\t\tcurrentFields = fields\n\t\t)\n\n\t\tfor idx, preloadField := range preloadFields {\n\t\t\tvar currentPreloadConditions []interface{}\n\n\t\t\tif currentScope == nil {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// if not preloaded\n\t\t\tif preloadKey := strings.Join(preloadFields[:idx+1], \".\"); !preloadedMap[preloadKey] {\n\n\t\t\t\t// assign search conditions to last preload\n\t\t\t\tif idx == len(preloadFields)-1 {\n\t\t\t\t\tcurrentPreloadConditions = preload.conditions\n\t\t\t\t}\n\n\t\t\t\tfor _, field := range currentFields {\n\t\t\t\t\tif field.Name != preloadField || field.Relationship == nil {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch field.Relationship.Kind {\n\t\t\t\t\tcase \"has_one\":\n\t\t\t\t\t\tcurrentScope.handleHasOnePreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"has_many\":\n\t\t\t\t\t\tcurrentScope.handleHasManyPreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"belongs_to\":\n\t\t\t\t\t\tcurrentScope.handleBelongsToPreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"many_to_many\":\n\t\t\t\t\t\tcurrentScope.handleManyToManyPreload(field, currentPreloadConditions)\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tscope.Err(errors.New(\"unsupported relation\"))\n\t\t\t\t\t}\n\n\t\t\t\t\tpreloadedMap[preloadKey] = true\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tif !preloadedMap[preloadKey] {\n\t\t\t\t\tscope.Err(fmt.Errorf(\"can't preload field %s for %s\", preloadField, currentScope.GetModelStruct().ModelType))\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// preload next level\n\t\t\tif idx < len(preloadFields)-1 {\n\t\t\t\tcurrentScope = currentScope.getColumnAsScope(preloadField)\n\t\t\t\tif currentScope != nil {\n\t\t\t\t\tcurrentFields = currentScope.Fields()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "非多态has_many关联预加载",
            "sql": "SELECT * FROM {关联表名} WHERE {外键字段} IN (?, ?, ?);"
          },
          {
            "scenario": "多态has_many关联预加载",
            "sql": "SELECT * FROM {关联表名} WHERE {外键字段} IN (?, ?, ?) AND {多态类型字段} = ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/field.go",
        "code_start_line": 12,
        "code_end_line": 16,
        "code_key": "Field",
        "code_value": "type Field struct {\n\t*StructField\n\tIsBlank bool\n\tField   reflect.Value\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/STKE__jinzhu-gorm.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/callback_query_preload.go:239:283:handleBelongsToPreload",
    "orm_code": "func (scope *Scope) handleBelongsToPreload(field *Field, conditions []interface{}) {\n\trelation := field.Relationship\n\n\t// preload conditions\n\tpreloadDB, preloadConditions := scope.generatePreloadDBWithConditions(conditions)\n\n\t// get relations's primary keys\n\tprimaryKeys := scope.getColumnAsArray(relation.ForeignFieldNames, scope.Value)\n\tif len(primaryKeys) == 0 {\n\t\treturn\n\t}\n\n\t// find relations\n\tresults := makeSlice(field.Struct.Type)\n\tscope.Err(preloadDB.Where(fmt.Sprintf(\"%v IN (%v)\", toQueryCondition(scope, relation.AssociationForeignDBNames), toQueryMarks(primaryKeys)), toQueryValues(primaryKeys)...).Find(results, preloadConditions...).Error)\n\n\t// assign find results\n\tvar (\n\t\tresultsValue       = indirect(reflect.ValueOf(results))\n\t\tindirectScopeValue = scope.IndirectValue()\n\t)\n\n\tforeignFieldToObjects := make(map[string][]*reflect.Value)\n\tif indirectScopeValue.Kind() == reflect.Slice {\n\t\tfor j := 0; j < indirectScopeValue.Len(); j++ {\n\t\t\tobject := indirect(indirectScopeValue.Index(j))\n\t\t\tvalueString := toString(getValueFromFields(object, relation.ForeignFieldNames))\n\t\t\tforeignFieldToObjects[valueString] = append(foreignFieldToObjects[valueString], &object)\n\t\t}\n\t}\n\n\tfor i := 0; i < resultsValue.Len(); i++ {\n\t\tresult := resultsValue.Index(i)\n\t\tif indirectScopeValue.Kind() == reflect.Slice {\n\t\t\tvalueString := toString(getValueFromFields(result, relation.AssociationForeignFieldNames))\n\t\t\tif objects, found := foreignFieldToObjects[valueString]; found {\n\t\t\t\tfor _, object := range objects {\n\t\t\t\t\tobject.FieldByName(field.Name).Set(result)\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tscope.Err(field.Set(result))\n\t\t}\n\t}\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "有预加载条件时",
            "sql": "SELECT * FROM [关联表名] WHERE [关联外键字段] IN (?,?,?) AND [额外条件字段] = ?;"
          },
          {
            "scenario": "无预加载条件时",
            "sql": "SELECT * FROM [关联表名] WHERE [关联外键字段] IN (?,?,?);"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/field.go",
        "code_start_line": 12,
        "code_end_line": 16,
        "code_key": "Field",
        "code_value": "type Field struct {\n\t*StructField\n\tIsBlank bool\n\tField   reflect.Value\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/STKE__jinzhu-gorm.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/callback_query_preload.go:239:283:handleBelongsToPreload",
    "orm_code": "func (scope *Scope) handleBelongsToPreload(field *Field, conditions []interface{}) {\n\trelation := field.Relationship\n\n\t// preload conditions\n\tpreloadDB, preloadConditions := scope.generatePreloadDBWithConditions(conditions)\n\n\t// get relations's primary keys\n\tprimaryKeys := scope.getColumnAsArray(relation.ForeignFieldNames, scope.Value)\n\tif len(primaryKeys) == 0 {\n\t\treturn\n\t}\n\n\t// find relations\n\tresults := makeSlice(field.Struct.Type)\n\tscope.Err(preloadDB.Where(fmt.Sprintf(\"%v IN (%v)\", toQueryCondition(scope, relation.AssociationForeignDBNames), toQueryMarks(primaryKeys)), toQueryValues(primaryKeys)...).Find(results, preloadConditions...).Error)\n\n\t// assign find results\n\tvar (\n\t\tresultsValue       = indirect(reflect.ValueOf(results))\n\t\tindirectScopeValue = scope.IndirectValue()\n\t)\n\n\tforeignFieldToObjects := make(map[string][]*reflect.Value)\n\tif indirectScopeValue.Kind() == reflect.Slice {\n\t\tfor j := 0; j < indirectScopeValue.Len(); j++ {\n\t\t\tobject := indirect(indirectScopeValue.Index(j))\n\t\t\tvalueString := toString(getValueFromFields(object, relation.ForeignFieldNames))\n\t\t\tforeignFieldToObjects[valueString] = append(foreignFieldToObjects[valueString], &object)\n\t\t}\n\t}\n\n\tfor i := 0; i < resultsValue.Len(); i++ {\n\t\tresult := resultsValue.Index(i)\n\t\tif indirectScopeValue.Kind() == reflect.Slice {\n\t\t\tvalueString := toString(getValueFromFields(result, relation.AssociationForeignFieldNames))\n\t\t\tif objects, found := foreignFieldToObjects[valueString]; found {\n\t\t\t\tfor _, object := range objects {\n\t\t\t\t\tobject.FieldByName(field.Name).Set(result)\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tscope.Err(field.Set(result))\n\t\t}\n\t}\n}",
    "caller": "func preloadCallback(scope *Scope) {\n\tif _, skip := scope.InstanceGet(\"gorm:skip_query_callback\"); skip {\n\t\treturn\n\t}\n\n\tif ap, ok := scope.Get(\"gorm:auto_preload\"); ok {\n\t\t// If gorm:auto_preload IS NOT a bool then auto preload.\n\t\t// Else if it IS a bool, use the value\n\t\tif apb, ok := ap.(bool); !ok {\n\t\t\tautoPreload(scope)\n\t\t} else if apb {\n\t\t\tautoPreload(scope)\n\t\t}\n\t}\n\n\tif scope.Search.preload == nil || scope.HasError() {\n\t\treturn\n\t}\n\n\tvar (\n\t\tpreloadedMap = map[string]bool{}\n\t\tfields       = scope.Fields()\n\t)\n\n\tfor _, preload := range scope.Search.preload {\n\t\tvar (\n\t\t\tpreloadFields = strings.Split(preload.schema, \".\")\n\t\t\tcurrentScope  = scope\n\t\t\tcurrentFields = fields\n\t\t)\n\n\t\tfor idx, preloadField := range preloadFields {\n\t\t\tvar currentPreloadConditions []interface{}\n\n\t\t\tif currentScope == nil {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// if not preloaded\n\t\t\tif preloadKey := strings.Join(preloadFields[:idx+1], \".\"); !preloadedMap[preloadKey] {\n\n\t\t\t\t// assign search conditions to last preload\n\t\t\t\tif idx == len(preloadFields)-1 {\n\t\t\t\t\tcurrentPreloadConditions = preload.conditions\n\t\t\t\t}\n\n\t\t\t\tfor _, field := range currentFields {\n\t\t\t\t\tif field.Name != preloadField || field.Relationship == nil {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch field.Relationship.Kind {\n\t\t\t\t\tcase \"has_one\":\n\t\t\t\t\t\tcurrentScope.handleHasOnePreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"has_many\":\n\t\t\t\t\t\tcurrentScope.handleHasManyPreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"belongs_to\":\n\t\t\t\t\t\tcurrentScope.handleBelongsToPreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"many_to_many\":\n\t\t\t\t\t\tcurrentScope.handleManyToManyPreload(field, currentPreloadConditions)\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tscope.Err(errors.New(\"unsupported relation\"))\n\t\t\t\t\t}\n\n\t\t\t\t\tpreloadedMap[preloadKey] = true\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tif !preloadedMap[preloadKey] {\n\t\t\t\t\tscope.Err(fmt.Errorf(\"can't preload field %s for %s\", preloadField, currentScope.GetModelStruct().ModelType))\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// preload next level\n\t\t\tif idx < len(preloadFields)-1 {\n\t\t\t\tcurrentScope = currentScope.getColumnAsScope(preloadField)\n\t\t\t\tif currentScope != nil {\n\t\t\t\t\tcurrentFields = currentScope.Fields()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "无预加载条件的belongs_to关联查询",
            "sql": "SELECT * FROM associated_table WHERE foreign_key IN (?, ?, ?);"
          },
          {
            "scenario": "有简单预加载条件的belongs_to关联查询",
            "sql": "SELECT * FROM associated_table WHERE foreign_key IN (?, ?, ?) AND status = ?;"
          },
          {
            "scenario": "有复杂预加载条件的belongs_to关联查询",
            "sql": "SELECT * FROM associated_table WHERE foreign_key IN (?, ?, ?) AND status = ? AND created_at > ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/field.go",
        "code_start_line": 12,
        "code_end_line": 16,
        "code_key": "Field",
        "code_value": "type Field struct {\n\t*StructField\n\tIsBlank bool\n\tField   reflect.Value\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/STKE__jinzhu-gorm.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/callback_query_preload.go:286:410:handleManyToManyPreload",
    "orm_code": "func (scope *Scope) handleManyToManyPreload(field *Field, conditions []interface{}) {\n\tvar (\n\t\trelation         = field.Relationship\n\t\tjoinTableHandler = relation.JoinTableHandler\n\t\tfieldType        = field.Struct.Type.Elem()\n\t\tforeignKeyValue  interface{}\n\t\tforeignKeyType   = reflect.ValueOf(&foreignKeyValue).Type()\n\t\tlinkHash         = map[string][]reflect.Value{}\n\t\tisPtr            bool\n\t)\n\n\tif fieldType.Kind() == reflect.Ptr {\n\t\tisPtr = true\n\t\tfieldType = fieldType.Elem()\n\t}\n\n\tvar sourceKeys = []string{}\n\tfor _, key := range joinTableHandler.SourceForeignKeys() {\n\t\tsourceKeys = append(sourceKeys, key.DBName)\n\t}\n\n\t// preload conditions\n\tpreloadDB, preloadConditions := scope.generatePreloadDBWithConditions(conditions)\n\n\t// generate query with join table\n\tnewScope := scope.New(reflect.New(fieldType).Interface())\n\tpreloadDB = preloadDB.Table(newScope.TableName()).Model(newScope.Value)\n\n\tif len(preloadDB.search.selects) == 0 {\n\t\tpreloadDB = preloadDB.Select(\"*\")\n\t}\n\n\tpreloadDB = joinTableHandler.JoinWith(joinTableHandler, preloadDB, scope.Value)\n\n\t// preload inline conditions\n\tif len(preloadConditions) > 0 {\n\t\tpreloadDB = preloadDB.Where(preloadConditions[0], preloadConditions[1:]...)\n\t}\n\n\trows, err := preloadDB.Rows()\n\n\tif scope.Err(err) != nil {\n\t\treturn\n\t}\n\tdefer rows.Close()\n\n\tcolumns, _ := rows.Columns()\n\tfor rows.Next() {\n\t\tvar (\n\t\t\telem   = reflect.New(fieldType).Elem()\n\t\t\tfields = scope.New(elem.Addr().Interface()).Fields()\n\t\t)\n\n\t\t// register foreign keys in join tables\n\t\tvar joinTableFields []*Field\n\t\tfor _, sourceKey := range sourceKeys {\n\t\t\tjoinTableFields = append(joinTableFields, &Field{StructField: &StructField{DBName: sourceKey, IsNormal: true}, Field: reflect.New(foreignKeyType).Elem()})\n\t\t}\n\n\t\tscope.scan(rows, columns, append(fields, joinTableFields...))\n\n\t\tscope.New(elem.Addr().Interface()).\n\t\t\tInstanceSet(\"gorm:skip_query_callback\", true).\n\t\t\tcallCallbacks(scope.db.parent.callbacks.queries)\n\n\t\tvar foreignKeys = make([]interface{}, len(sourceKeys))\n\t\t// generate hashed forkey keys in join table\n\t\tfor idx, joinTableField := range joinTableFields {\n\t\t\tif !joinTableField.Field.IsNil() {\n\t\t\t\tforeignKeys[idx] = joinTableField.Field.Elem().Interface()\n\t\t\t}\n\t\t}\n\t\thashedSourceKeys := toString(foreignKeys)\n\n\t\tif isPtr {\n\t\t\tlinkHash[hashedSourceKeys] = append(linkHash[hashedSourceKeys], elem.Addr())\n\t\t} else {\n\t\t\tlinkHash[hashedSourceKeys] = append(linkHash[hashedSourceKeys], elem)\n\t\t}\n\t}\n\n\tif err := rows.Err(); err != nil {\n\t\tscope.Err(err)\n\t}\n\n\t// assign find results\n\tvar (\n\t\tindirectScopeValue = scope.IndirectValue()\n\t\tfieldsSourceMap    = map[string][]reflect.Value{}\n\t\tforeignFieldNames  = []string{}\n\t)\n\n\tfor _, dbName := range relation.ForeignFieldNames {\n\t\tif field, ok := scope.FieldByName(dbName); ok {\n\t\t\tforeignFieldNames = append(foreignFieldNames, field.Name)\n\t\t}\n\t}\n\n\tif indirectScopeValue.Kind() == reflect.Slice {\n\t\tfor j := 0; j < indirectScopeValue.Len(); j++ {\n\t\t\tobject := indirect(indirectScopeValue.Index(j))\n\t\t\tkey := toString(getValueFromFields(object, foreignFieldNames))\n\t\t\tfieldsSourceMap[key] = append(fieldsSourceMap[key], object.FieldByName(field.Name))\n\t\t}\n\t} else if indirectScopeValue.IsValid() {\n\t\tkey := toString(getValueFromFields(indirectScopeValue, foreignFieldNames))\n\t\tfieldsSourceMap[key] = append(fieldsSourceMap[key], indirectScopeValue.FieldByName(field.Name))\n\t}\n\n\tfor source, fields := range fieldsSourceMap {\n\t\tfor _, f := range fields {\n\t\t\t//If not 0 this means Value is a pointer and we already added preloaded models to it\n\t\t\tif f.Len() != 0 {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tv := reflect.MakeSlice(f.Type(), 0, 0)\n\t\t\tif len(linkHash[source]) > 0 {\n\t\t\t\tv = reflect.Append(f, linkHash[source]...)\n\t\t\t}\n\n\t\t\tf.Set(v)\n\t\t}\n\t}\n}",
    "caller": "",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/model.go",
        "code_start_line": 9,
        "code_end_line": 14,
        "code_key": "Model",
        "code_value": "type Model struct {\n\tID        uint `gorm:\"primary_key\"`\n\tCreatedAt time.Time\n\tUpdatedAt time.Time\n\tDeletedAt *time.Time `sql:\"index\"`\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/field.go",
        "code_start_line": 12,
        "code_end_line": 16,
        "code_key": "Field",
        "code_value": "type Field struct {\n\t*StructField\n\tIsBlank bool\n\tField   reflect.Value\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/model_struct.go",
        "code_start_line": 60,
        "code_end_line": 76,
        "code_key": "StructField",
        "code_value": "type StructField struct {\n\tDBName          string\n\tName            string\n\tNames           []string\n\tIsPrimaryKey    bool\n\tIsNormal        bool\n\tIsIgnored       bool\n\tIsScanner       bool\n\tHasDefaultValue bool\n\tTag             reflect.StructTag\n\tTagSettings     map[string]string\n\tStruct          reflect.StructField\n\tIsForeignKey    bool\n\tRelationship    *Relationship\n\n\ttagSettingsLock sync.RWMutex\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/STKE__jinzhu-gorm.json",
    "matched_keywords": [
      "ForeignKey",
      "Preload",
      "Callbacks"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/callback_query_preload.go:286:410:handleManyToManyPreload",
    "orm_code": "func (scope *Scope) handleManyToManyPreload(field *Field, conditions []interface{}) {\n\tvar (\n\t\trelation         = field.Relationship\n\t\tjoinTableHandler = relation.JoinTableHandler\n\t\tfieldType        = field.Struct.Type.Elem()\n\t\tforeignKeyValue  interface{}\n\t\tforeignKeyType   = reflect.ValueOf(&foreignKeyValue).Type()\n\t\tlinkHash         = map[string][]reflect.Value{}\n\t\tisPtr            bool\n\t)\n\n\tif fieldType.Kind() == reflect.Ptr {\n\t\tisPtr = true\n\t\tfieldType = fieldType.Elem()\n\t}\n\n\tvar sourceKeys = []string{}\n\tfor _, key := range joinTableHandler.SourceForeignKeys() {\n\t\tsourceKeys = append(sourceKeys, key.DBName)\n\t}\n\n\t// preload conditions\n\tpreloadDB, preloadConditions := scope.generatePreloadDBWithConditions(conditions)\n\n\t// generate query with join table\n\tnewScope := scope.New(reflect.New(fieldType).Interface())\n\tpreloadDB = preloadDB.Table(newScope.TableName()).Model(newScope.Value)\n\n\tif len(preloadDB.search.selects) == 0 {\n\t\tpreloadDB = preloadDB.Select(\"*\")\n\t}\n\n\tpreloadDB = joinTableHandler.JoinWith(joinTableHandler, preloadDB, scope.Value)\n\n\t// preload inline conditions\n\tif len(preloadConditions) > 0 {\n\t\tpreloadDB = preloadDB.Where(preloadConditions[0], preloadConditions[1:]...)\n\t}\n\n\trows, err := preloadDB.Rows()\n\n\tif scope.Err(err) != nil {\n\t\treturn\n\t}\n\tdefer rows.Close()\n\n\tcolumns, _ := rows.Columns()\n\tfor rows.Next() {\n\t\tvar (\n\t\t\telem   = reflect.New(fieldType).Elem()\n\t\t\tfields = scope.New(elem.Addr().Interface()).Fields()\n\t\t)\n\n\t\t// register foreign keys in join tables\n\t\tvar joinTableFields []*Field\n\t\tfor _, sourceKey := range sourceKeys {\n\t\t\tjoinTableFields = append(joinTableFields, &Field{StructField: &StructField{DBName: sourceKey, IsNormal: true}, Field: reflect.New(foreignKeyType).Elem()})\n\t\t}\n\n\t\tscope.scan(rows, columns, append(fields, joinTableFields...))\n\n\t\tscope.New(elem.Addr().Interface()).\n\t\t\tInstanceSet(\"gorm:skip_query_callback\", true).\n\t\t\tcallCallbacks(scope.db.parent.callbacks.queries)\n\n\t\tvar foreignKeys = make([]interface{}, len(sourceKeys))\n\t\t// generate hashed forkey keys in join table\n\t\tfor idx, joinTableField := range joinTableFields {\n\t\t\tif !joinTableField.Field.IsNil() {\n\t\t\t\tforeignKeys[idx] = joinTableField.Field.Elem().Interface()\n\t\t\t}\n\t\t}\n\t\thashedSourceKeys := toString(foreignKeys)\n\n\t\tif isPtr {\n\t\t\tlinkHash[hashedSourceKeys] = append(linkHash[hashedSourceKeys], elem.Addr())\n\t\t} else {\n\t\t\tlinkHash[hashedSourceKeys] = append(linkHash[hashedSourceKeys], elem)\n\t\t}\n\t}\n\n\tif err := rows.Err(); err != nil {\n\t\tscope.Err(err)\n\t}\n\n\t// assign find results\n\tvar (\n\t\tindirectScopeValue = scope.IndirectValue()\n\t\tfieldsSourceMap    = map[string][]reflect.Value{}\n\t\tforeignFieldNames  = []string{}\n\t)\n\n\tfor _, dbName := range relation.ForeignFieldNames {\n\t\tif field, ok := scope.FieldByName(dbName); ok {\n\t\t\tforeignFieldNames = append(foreignFieldNames, field.Name)\n\t\t}\n\t}\n\n\tif indirectScopeValue.Kind() == reflect.Slice {\n\t\tfor j := 0; j < indirectScopeValue.Len(); j++ {\n\t\t\tobject := indirect(indirectScopeValue.Index(j))\n\t\t\tkey := toString(getValueFromFields(object, foreignFieldNames))\n\t\t\tfieldsSourceMap[key] = append(fieldsSourceMap[key], object.FieldByName(field.Name))\n\t\t}\n\t} else if indirectScopeValue.IsValid() {\n\t\tkey := toString(getValueFromFields(indirectScopeValue, foreignFieldNames))\n\t\tfieldsSourceMap[key] = append(fieldsSourceMap[key], indirectScopeValue.FieldByName(field.Name))\n\t}\n\n\tfor source, fields := range fieldsSourceMap {\n\t\tfor _, f := range fields {\n\t\t\t//If not 0 this means Value is a pointer and we already added preloaded models to it\n\t\t\tif f.Len() != 0 {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\tv := reflect.MakeSlice(f.Type(), 0, 0)\n\t\t\tif len(linkHash[source]) > 0 {\n\t\t\t\tv = reflect.Append(f, linkHash[source]...)\n\t\t\t}\n\n\t\t\tf.Set(v)\n\t\t}\n\t}\n}",
    "caller": "func preloadCallback(scope *Scope) {\n\tif _, skip := scope.InstanceGet(\"gorm:skip_query_callback\"); skip {\n\t\treturn\n\t}\n\n\tif ap, ok := scope.Get(\"gorm:auto_preload\"); ok {\n\t\t// If gorm:auto_preload IS NOT a bool then auto preload.\n\t\t// Else if it IS a bool, use the value\n\t\tif apb, ok := ap.(bool); !ok {\n\t\t\tautoPreload(scope)\n\t\t} else if apb {\n\t\t\tautoPreload(scope)\n\t\t}\n\t}\n\n\tif scope.Search.preload == nil || scope.HasError() {\n\t\treturn\n\t}\n\n\tvar (\n\t\tpreloadedMap = map[string]bool{}\n\t\tfields       = scope.Fields()\n\t)\n\n\tfor _, preload := range scope.Search.preload {\n\t\tvar (\n\t\t\tpreloadFields = strings.Split(preload.schema, \".\")\n\t\t\tcurrentScope  = scope\n\t\t\tcurrentFields = fields\n\t\t)\n\n\t\tfor idx, preloadField := range preloadFields {\n\t\t\tvar currentPreloadConditions []interface{}\n\n\t\t\tif currentScope == nil {\n\t\t\t\tcontinue\n\t\t\t}\n\n\t\t\t// if not preloaded\n\t\t\tif preloadKey := strings.Join(preloadFields[:idx+1], \".\"); !preloadedMap[preloadKey] {\n\n\t\t\t\t// assign search conditions to last preload\n\t\t\t\tif idx == len(preloadFields)-1 {\n\t\t\t\t\tcurrentPreloadConditions = preload.conditions\n\t\t\t\t}\n\n\t\t\t\tfor _, field := range currentFields {\n\t\t\t\t\tif field.Name != preloadField || field.Relationship == nil {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch field.Relationship.Kind {\n\t\t\t\t\tcase \"has_one\":\n\t\t\t\t\t\tcurrentScope.handleHasOnePreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"has_many\":\n\t\t\t\t\t\tcurrentScope.handleHasManyPreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"belongs_to\":\n\t\t\t\t\t\tcurrentScope.handleBelongsToPreload(field, currentPreloadConditions)\n\t\t\t\t\tcase \"many_to_many\":\n\t\t\t\t\t\tcurrentScope.handleManyToManyPreload(field, currentPreloadConditions)\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tscope.Err(errors.New(\"unsupported relation\"))\n\t\t\t\t\t}\n\n\t\t\t\t\tpreloadedMap[preloadKey] = true\n\t\t\t\t\tbreak\n\t\t\t\t}\n\n\t\t\t\tif !preloadedMap[preloadKey] {\n\t\t\t\t\tscope.Err(fmt.Errorf(\"can't preload field %s for %s\", preloadField, currentScope.GetModelStruct().ModelType))\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// preload next level\n\t\t\tif idx < len(preloadFields)-1 {\n\t\t\t\tcurrentScope = currentScope.getColumnAsScope(preloadField)\n\t\t\t\tif currentScope != nil {\n\t\t\t\t\tcurrentFields = currentScope.Fields()\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "多对多预加载查询（无额外条件）",
            "sql": "SELECT target_table.*, join_table.source_foreign_key FROM target_table INNER JOIN join_table ON target_table.id = join_table.target_foreign_key WHERE join_table.source_foreign_key IN (?);"
          },
          {
            "scenario": "多对多预加载查询（带预加载条件）",
            "sql": "SELECT target_table.*, join_table.source_foreign_key FROM target_table INNER JOIN join_table ON target_table.id = join_table.target_foreign_key WHERE join_table.source_foreign_key IN (?) AND additional_condition = ?;"
          },
          {
            "scenario": "多对多预加载查询（多个源外键）",
            "sql": "SELECT target_table.*, join_table.source_foreign_key1, join_table.source_foreign_key2 FROM target_table INNER JOIN join_table ON target_table.id = join_table.target_foreign_key WHERE join_table.source_foreign_key1 IN (?) AND join_table.source_foreign_key2 IN (?);"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/model.go",
        "code_start_line": 9,
        "code_end_line": 14,
        "code_key": "Model",
        "code_value": "type Model struct {\n\tID        uint `gorm:\"primary_key\"`\n\tCreatedAt time.Time\n\tUpdatedAt time.Time\n\tDeletedAt *time.Time `sql:\"index\"`\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/field.go",
        "code_start_line": 12,
        "code_end_line": 16,
        "code_key": "Field",
        "code_value": "type Field struct {\n\t*StructField\n\tIsBlank bool\n\tField   reflect.Value\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/model_struct.go",
        "code_start_line": 60,
        "code_end_line": 76,
        "code_key": "StructField",
        "code_value": "type StructField struct {\n\tDBName          string\n\tName            string\n\tNames           []string\n\tIsPrimaryKey    bool\n\tIsNormal        bool\n\tIsIgnored       bool\n\tIsScanner       bool\n\tHasDefaultValue bool\n\tTag             reflect.StructTag\n\tTagSettings     map[string]string\n\tStruct          reflect.StructField\n\tIsForeignKey    bool\n\tRelationship    *Relationship\n\n\ttagSettingsLock sync.RWMutex\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/STKE__jinzhu-gorm.json",
    "matched_keywords": [
      "ForeignKey",
      "Preload",
      "Callbacks"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/scope.go:1021:1040:count",
    "orm_code": "func (scope *Scope) count(value interface{}) *Scope {\n\tif query, ok := scope.Search.selects[\"query\"]; !ok || !countingQueryRegexp.MatchString(fmt.Sprint(query)) {\n\t\tif len(scope.Search.group) != 0 {\n\t\t\tif len(scope.Search.havingConditions) != 0 {\n\t\t\t\tscope.prepareQuerySQL()\n\t\t\t\tscope.Search = &search{}\n\t\t\t\tscope.Search.Select(\"count(*)\")\n\t\t\t\tscope.Search.Table(fmt.Sprintf(\"( %s ) AS count_table\", scope.SQL))\n\t\t\t} else {\n\t\t\t\tscope.Search.Select(\"count(*) FROM ( SELECT count(*) as name \")\n\t\t\t\tscope.Search.group += \" ) AS count_table\"\n\t\t\t}\n\t\t} else {\n\t\t\tscope.Search.Select(\"count(*)\")\n\t\t}\n\t}\n\tscope.Search.ignoreOrderQuery = true\n\tscope.Err(scope.row().Scan(value))\n\treturn scope\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "简单计数（无GROUP BY，无自定义SELECT）",
            "sql": "SELECT count(*) FROM table_name;"
          },
          {
            "scenario": "带GROUP BY但无HAVING条件的计数",
            "sql": "SELECT count(*) FROM ( SELECT count(*) as name FROM table_name GROUP BY group_field ) AS count_table;"
          },
          {
            "scenario": "带GROUP BY和HAVING条件的计数",
            "sql": "SELECT count(*) FROM ( SELECT * FROM table_name WHERE condition = ? GROUP BY group_field HAVING having_condition = ? ) AS count_table;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/search.go",
        "code_start_line": 7,
        "code_end_line": 27,
        "code_key": "search",
        "code_value": "type search struct {\n\tdb               *DB\n\twhereConditions  []map[string]interface{}\n\torConditions     []map[string]interface{}\n\tnotConditions    []map[string]interface{}\n\thavingConditions []map[string]interface{}\n\tjoinConditions   []map[string]interface{}\n\tinitAttrs        []interface{}\n\tassignAttrs      []interface{}\n\tselects          map[string]interface{}\n\tomits            []string\n\torders           []interface{}\n\tpreload          []searchPreload\n\toffset           interface{}\n\tlimit            interface{}\n\tgroup            string\n\ttableName        string\n\traw              bool\n\tUnscoped         bool\n\tignoreOrderQuery bool\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/STKE__jinzhu-gorm.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/scope.go:1021:1040:count",
    "orm_code": "func (scope *Scope) count(value interface{}) *Scope {\n\tif query, ok := scope.Search.selects[\"query\"]; !ok || !countingQueryRegexp.MatchString(fmt.Sprint(query)) {\n\t\tif len(scope.Search.group) != 0 {\n\t\t\tif len(scope.Search.havingConditions) != 0 {\n\t\t\t\tscope.prepareQuerySQL()\n\t\t\t\tscope.Search = &search{}\n\t\t\t\tscope.Search.Select(\"count(*)\")\n\t\t\t\tscope.Search.Table(fmt.Sprintf(\"( %s ) AS count_table\", scope.SQL))\n\t\t\t} else {\n\t\t\t\tscope.Search.Select(\"count(*) FROM ( SELECT count(*) as name \")\n\t\t\t\tscope.Search.group += \" ) AS count_table\"\n\t\t\t}\n\t\t} else {\n\t\t\tscope.Search.Select(\"count(*)\")\n\t\t}\n\t}\n\tscope.Search.ignoreOrderQuery = true\n\tscope.Err(scope.row().Scan(value))\n\treturn scope\n}",
    "caller": "func (association *Association) Count() int {\n\tvar (\n\t\tcount        = 0\n\t\trelationship = association.field.Relationship\n\t\tscope        = association.scope\n\t\tfieldValue   = association.field.Field.Interface()\n\t\tquery        = scope.DB()\n\t)\n\n\tswitch relationship.Kind {\n\tcase \"many_to_many\":\n\t\tquery = relationship.JoinTableHandler.JoinWith(relationship.JoinTableHandler, query, scope.Value)\n\tcase \"has_many\", \"has_one\":\n\t\tprimaryKeys := scope.getColumnAsArray(relationship.AssociationForeignFieldNames, scope.Value)\n\t\tquery = query.Where(\n\t\t\tfmt.Sprintf(\"%v IN (%v)\", toQueryCondition(scope, relationship.ForeignDBNames), toQueryMarks(primaryKeys)),\n\t\t\ttoQueryValues(primaryKeys)...,\n\t\t)\n\tcase \"belongs_to\":\n\t\tprimaryKeys := scope.getColumnAsArray(relationship.ForeignFieldNames, scope.Value)\n\t\tquery = query.Where(\n\t\t\tfmt.Sprintf(\"%v IN (%v)\", toQueryCondition(scope, relationship.AssociationForeignDBNames), toQueryMarks(primaryKeys)),\n\t\t\ttoQueryValues(primaryKeys)...,\n\t\t)\n\t}\n\n\tif relationship.PolymorphicType != \"\" {\n\t\tquery = query.Where(\n\t\t\tfmt.Sprintf(\"%v.%v = ?\", scope.New(fieldValue).QuotedTableName(), scope.Quote(relationship.PolymorphicDBName)),\n\t\t\trelationship.PolymorphicValue,\n\t\t)\n\t}\n\n\tif err := query.Model(fieldValue).Count(&count).Error; err != nil {\n\t\tassociation.Error = err\n\t}\n\treturn count\n}",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "简单计数查询（无GROUP BY，无HAVING）",
            "sql": "SELECT count(*) FROM table_name WHERE conditions;"
          },
          {
            "scenario": "带GROUP BY但无HAVING的计数查询",
            "sql": "SELECT count(*) FROM ( SELECT count(*) as name FROM table_name WHERE conditions GROUP BY group_fields ) AS count_table;"
          },
          {
            "scenario": "带GROUP BY和HAVING的计数查询",
            "sql": "SELECT count(*) FROM ( SELECT columns FROM table_name WHERE conditions GROUP BY group_fields HAVING having_conditions ) AS count_table;"
          },
          {
            "scenario": "已存在有效计数查询",
            "sql": "SELECT existing_count_query FROM table_name WHERE conditions;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/search.go",
        "code_start_line": 7,
        "code_end_line": 27,
        "code_key": "search",
        "code_value": "type search struct {\n\tdb               *DB\n\twhereConditions  []map[string]interface{}\n\torConditions     []map[string]interface{}\n\tnotConditions    []map[string]interface{}\n\thavingConditions []map[string]interface{}\n\tjoinConditions   []map[string]interface{}\n\tinitAttrs        []interface{}\n\tassignAttrs      []interface{}\n\tselects          map[string]interface{}\n\tomits            []string\n\torders           []interface{}\n\tpreload          []searchPreload\n\toffset           interface{}\n\tlimit            interface{}\n\tgroup            string\n\ttableName        string\n\traw              bool\n\tUnscoped         bool\n\tignoreOrderQuery bool\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/STKE__jinzhu-gorm.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/scope.go:1021:1040:count",
    "orm_code": "func (scope *Scope) count(value interface{}) *Scope {\n\tif query, ok := scope.Search.selects[\"query\"]; !ok || !countingQueryRegexp.MatchString(fmt.Sprint(query)) {\n\t\tif len(scope.Search.group) != 0 {\n\t\t\tif len(scope.Search.havingConditions) != 0 {\n\t\t\t\tscope.prepareQuerySQL()\n\t\t\t\tscope.Search = &search{}\n\t\t\t\tscope.Search.Select(\"count(*)\")\n\t\t\t\tscope.Search.Table(fmt.Sprintf(\"( %s ) AS count_table\", scope.SQL))\n\t\t\t} else {\n\t\t\t\tscope.Search.Select(\"count(*) FROM ( SELECT count(*) as name \")\n\t\t\t\tscope.Search.group += \" ) AS count_table\"\n\t\t\t}\n\t\t} else {\n\t\t\tscope.Search.Select(\"count(*)\")\n\t\t}\n\t}\n\tscope.Search.ignoreOrderQuery = true\n\tscope.Err(scope.row().Scan(value))\n\treturn scope\n}",
    "caller": "func (s *DB) Count(value interface{}) *DB {\n\treturn s.NewScope(s.Value).count(value).db\n}",
    "sql_statement_list": [],
    "sql_types": [],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/STKE__jinzhu-gorm/search.go",
        "code_start_line": 7,
        "code_end_line": 27,
        "code_key": "search",
        "code_value": "type search struct {\n\tdb               *DB\n\twhereConditions  []map[string]interface{}\n\torConditions     []map[string]interface{}\n\tnotConditions    []map[string]interface{}\n\thavingConditions []map[string]interface{}\n\tjoinConditions   []map[string]interface{}\n\tinitAttrs        []interface{}\n\tassignAttrs      []interface{}\n\tselects          map[string]interface{}\n\tomits            []string\n\torders           []interface{}\n\tpreload          []searchPreload\n\toffset           interface{}\n\tlimit            interface{}\n\tgroup            string\n\ttableName        string\n\traw              bool\n\tUnscoped         bool\n\tignoreOrderQuery bool\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "4cbeee4734fbad8fd1c6216ff93a20ace0fb9d5b"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/STKE__jinzhu-gorm.json",
    "matched_keywords": [
      "Preload"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/sdns/config.go:27:38:GetIncrConfigs",
    "orm_code": "func (s *impl) GetIncrConfigs(ctx context.Context, t time.Time) ([]mysql.Config, error) {\n\tvar configs []mysql.Config\n\tlimit := 100\n\ts.db.WithContext(ctx).Preload(\"Masters\").\n\t\tPreload(\"NotifyServers\").\n\t\tPreload(clause.Associations).\n\t\tWhere(\"updated_on >= ?\", t.Format(dtime.FormatStyle1)).\n\t\tLimit(limit).\n\t\tFind(&configs)\n\n\treturn configs, nil\n}",
    "caller": "",
    "sql_statement_list": [
      "SELECT * FROM `slave_dns_configs` WHERE updated_on >= ? LIMIT 100;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "Config",
        "code_value": "type Config struct {\n\tID            uint64         `gorm:\"column:id;bigint unsigned;autoIncrement\" json:\"id\"`           //辅助DNS配置ID\n\tDomainID      uint           `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`              //域名ID\n\tDomain        string         `gorm:\"column:domain;varchar\" json:\"domain\"`                         //域名\n\tSyncSwitch    int8           `gorm:\"column:sync_switch;tinyint\" json:\"sync_switch\"`               //同步开关：0 关 1开\n\tStatus        int8           `gorm:\"column:status;tinyint\" json:\"status\"`                         //同步状态：-1 未开启 0 失效 1 成功 2 失败 3 同步中\n\tNotice        int8           `gorm:\"column:notice;tinyint\" json:\"notice\"`                         //连不上主DNS时是否通知：0 不通知 1 通知\n\tLastSyncOn    time.Time      `gorm:\"column:last_sync_on;datetime\" json:\"last_sync_on\"`            //最近同步时间\n\tDeleted       int8           `gorm:\"column:deleted;tinyint\" json:\"deleted\"`                       //删除标识：0 未删除 1 已删除\n\tUpdatedOn     time.Time      `gorm:\"column:updated_on;datetime;autoUpdateTime\" json:\"updated_on\"` //更新时间\n\tCreatedOn     time.Time      `gorm:\"column:created_on;datetime\" json:\"created_on\"`                //创建时间\n\tMasters       []Master       `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // masters列表\n\tNotifyServers []NotifyServer `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // notifyServer列表\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (Config) TableName() string {\n\treturn \"slave_dns_configs\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/sdns/config.go:27:38:GetIncrConfigs",
    "orm_code": "func (s *impl) GetIncrConfigs(ctx context.Context, t time.Time) ([]mysql.Config, error) {\n\tvar configs []mysql.Config\n\tlimit := 100\n\ts.db.WithContext(ctx).Preload(\"Masters\").\n\t\tPreload(\"NotifyServers\").\n\t\tPreload(clause.Associations).\n\t\tWhere(\"updated_on >= ?\", t.Format(dtime.FormatStyle1)).\n\t\tLimit(limit).\n\t\tFind(&configs)\n\n\treturn configs, nil\n}",
    "caller": "func (s *configImpl) GetIncrConfigs(ctx context.Context) []mysql.Config {\n\t// 以查询时间作为更新时间，防止设置\n\tst := time.Now().Format(dtime.FormatStyle1)\n\tlatestUpdateOn := s.sdnsRepo.GetLatestUpdateOn(ctx)\n\tt := dtime.Parse(latestUpdateOn, dtime.FormatStyle1)\n\tvar configs []mysql.Config\n\tconfigs, err := s.sdnsRepo.GetIncrConfigs(ctx, t)\n\tif err != nil {\n\t\tlog.ErrorContextf(ctx, \"GetIncrConfigs err, err:%s\", err.Error())\n\t\treturn configs\n\t}\n\ts.sdnsRepo.SetLatestUpdateOn(ctx, st)\n\n\treturn configs\n}",
    "sql_statement_list": [
      "SELECT `slave_dns_configs`.`id`,`slave_dns_configs`.`domain_id`,`slave_dns_configs`.`domain`,`slave_dns_configs`.`sync_switch`,`slave_dns_configs`.`status`,`slave_dns_configs`.`notice`,`slave_dns_configs`.`last_sync_on`,`slave_dns_configs`.`deleted`,`slave_dns_configs`.`updated_on`,`slave_dns_configs`.`created_on`,`Masters`.`id` AS `Masters__id`,`Masters`.`domain_id` AS `Masters__domain_id`,`Masters`.`master_ip` AS `Masters__master_ip`,`Masters`.`created_on` AS `Masters__created_on`,`Masters`.`updated_on` AS `Masters__updated_on`,`NotifyServers`.`id` AS `NotifyServers__id`,`NotifyServers`.`domain_id` AS `NotifyServers__domain_id`,`NotifyServers`.`notify_ip` AS `NotifyServers__notify_ip`,`NotifyServers`.`created_on` AS `NotifyServers__created_on`,`NotifyServers`.`updated_on` AS `NotifyServers__updated_on` FROM `slave_dns_configs` LEFT JOIN `masters` `Masters` ON `slave_dns_configs`.`domain_id` = `Masters`.`domain_id` LEFT JOIN `notify_servers` `NotifyServers` ON `slave_dns_configs`.`domain_id` = `NotifyServers`.`domain_id` WHERE updated_on >= ? LIMIT 100;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "Config",
        "code_value": "type Config struct {\n\tID            uint64         `gorm:\"column:id;bigint unsigned;autoIncrement\" json:\"id\"`           //辅助DNS配置ID\n\tDomainID      uint           `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`              //域名ID\n\tDomain        string         `gorm:\"column:domain;varchar\" json:\"domain\"`                         //域名\n\tSyncSwitch    int8           `gorm:\"column:sync_switch;tinyint\" json:\"sync_switch\"`               //同步开关：0 关 1开\n\tStatus        int8           `gorm:\"column:status;tinyint\" json:\"status\"`                         //同步状态：-1 未开启 0 失效 1 成功 2 失败 3 同步中\n\tNotice        int8           `gorm:\"column:notice;tinyint\" json:\"notice\"`                         //连不上主DNS时是否通知：0 不通知 1 通知\n\tLastSyncOn    time.Time      `gorm:\"column:last_sync_on;datetime\" json:\"last_sync_on\"`            //最近同步时间\n\tDeleted       int8           `gorm:\"column:deleted;tinyint\" json:\"deleted\"`                       //删除标识：0 未删除 1 已删除\n\tUpdatedOn     time.Time      `gorm:\"column:updated_on;datetime;autoUpdateTime\" json:\"updated_on\"` //更新时间\n\tCreatedOn     time.Time      `gorm:\"column:created_on;datetime\" json:\"created_on\"`                //创建时间\n\tMasters       []Master       `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // masters列表\n\tNotifyServers []NotifyServer `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // notifyServer列表\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (Config) TableName() string {\n\treturn \"slave_dns_configs\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/sdns/config.go:27:38:GetIncrConfigs",
    "orm_code": "func (s *impl) GetIncrConfigs(ctx context.Context, t time.Time) ([]mysql.Config, error) {\n\tvar configs []mysql.Config\n\tlimit := 100\n\ts.db.WithContext(ctx).Preload(\"Masters\").\n\t\tPreload(\"NotifyServers\").\n\t\tPreload(clause.Associations).\n\t\tWhere(\"updated_on >= ?\", t.Format(dtime.FormatStyle1)).\n\t\tLimit(limit).\n\t\tFind(&configs)\n\n\treturn configs, nil\n}",
    "caller": "func (s *impl) GetIncrConfigs(ctx context.Context, t time.Time) ([]mysql.Config, error) {\n\tvar configs []mysql.Config\n\tlimit := 100\n\ts.db.WithContext(ctx).Preload(\"Masters\").\n\t\tPreload(\"NotifyServers\").\n\t\tPreload(clause.Associations).\n\t\tWhere(\"updated_on >= ?\", t.Format(dtime.FormatStyle1)).\n\t\tLimit(limit).\n\t\tFind(&configs)\n\n\treturn configs, nil\n}",
    "sql_statement_list": [
      "SELECT * FROM slave_dns_configs WHERE updated_on >= ? LIMIT 100;",
      "SELECT * FROM masters WHERE domain_id IN (?);",
      "SELECT * FROM notify_servers WHERE domain_id IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "Config",
        "code_value": "type Config struct {\n\tID            uint64         `gorm:\"column:id;bigint unsigned;autoIncrement\" json:\"id\"`           //辅助DNS配置ID\n\tDomainID      uint           `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`              //域名ID\n\tDomain        string         `gorm:\"column:domain;varchar\" json:\"domain\"`                         //域名\n\tSyncSwitch    int8           `gorm:\"column:sync_switch;tinyint\" json:\"sync_switch\"`               //同步开关：0 关 1开\n\tStatus        int8           `gorm:\"column:status;tinyint\" json:\"status\"`                         //同步状态：-1 未开启 0 失效 1 成功 2 失败 3 同步中\n\tNotice        int8           `gorm:\"column:notice;tinyint\" json:\"notice\"`                         //连不上主DNS时是否通知：0 不通知 1 通知\n\tLastSyncOn    time.Time      `gorm:\"column:last_sync_on;datetime\" json:\"last_sync_on\"`            //最近同步时间\n\tDeleted       int8           `gorm:\"column:deleted;tinyint\" json:\"deleted\"`                       //删除标识：0 未删除 1 已删除\n\tUpdatedOn     time.Time      `gorm:\"column:updated_on;datetime;autoUpdateTime\" json:\"updated_on\"` //更新时间\n\tCreatedOn     time.Time      `gorm:\"column:created_on;datetime\" json:\"created_on\"`                //创建时间\n\tMasters       []Master       `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // masters列表\n\tNotifyServers []NotifyServer `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // notifyServer列表\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (Config) TableName() string {\n\treturn \"slave_dns_configs\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/sdns/config.go:27:38:GetIncrConfigs",
    "orm_code": "func (s *impl) GetIncrConfigs(ctx context.Context, t time.Time) ([]mysql.Config, error) {\n\tvar configs []mysql.Config\n\tlimit := 100\n\ts.db.WithContext(ctx).Preload(\"Masters\").\n\t\tPreload(\"NotifyServers\").\n\t\tPreload(clause.Associations).\n\t\tWhere(\"updated_on >= ?\", t.Format(dtime.FormatStyle1)).\n\t\tLimit(limit).\n\t\tFind(&configs)\n\n\treturn configs, nil\n}",
    "caller": "func (s *Impl) UpdateIncrSlaveConfig(ctx context.Context) {\n\tcs := s.configsLogic.GetIncrConfigs(ctx)\n\tlog.InfoContextf(ctx, \"get incr, conf:%+v\", cs)\n\ts.configsLogic.UpdateLocalCache(ctx, cs)\n\tlog.InfoContextf(ctx, \"end to set incr config \")\n\n\treturn\n}",
    "sql_statement_list": [
      "SELECT id, domain_id, domain, sync_switch, status, notice, last_sync_on, deleted, updated_on, created_on FROM slave_dns_configs WHERE updated_on >= ? LIMIT 100;",
      "SELECT * FROM masters WHERE domain_id IN (?);",
      "SELECT * FROM notify_servers WHERE domain_id IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "Config",
        "code_value": "type Config struct {\n\tID            uint64         `gorm:\"column:id;bigint unsigned;autoIncrement\" json:\"id\"`           //辅助DNS配置ID\n\tDomainID      uint           `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`              //域名ID\n\tDomain        string         `gorm:\"column:domain;varchar\" json:\"domain\"`                         //域名\n\tSyncSwitch    int8           `gorm:\"column:sync_switch;tinyint\" json:\"sync_switch\"`               //同步开关：0 关 1开\n\tStatus        int8           `gorm:\"column:status;tinyint\" json:\"status\"`                         //同步状态：-1 未开启 0 失效 1 成功 2 失败 3 同步中\n\tNotice        int8           `gorm:\"column:notice;tinyint\" json:\"notice\"`                         //连不上主DNS时是否通知：0 不通知 1 通知\n\tLastSyncOn    time.Time      `gorm:\"column:last_sync_on;datetime\" json:\"last_sync_on\"`            //最近同步时间\n\tDeleted       int8           `gorm:\"column:deleted;tinyint\" json:\"deleted\"`                       //删除标识：0 未删除 1 已删除\n\tUpdatedOn     time.Time      `gorm:\"column:updated_on;datetime;autoUpdateTime\" json:\"updated_on\"` //更新时间\n\tCreatedOn     time.Time      `gorm:\"column:created_on;datetime\" json:\"created_on\"`                //创建时间\n\tMasters       []Master       `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // masters列表\n\tNotifyServers []NotifyServer `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // notifyServer列表\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (Config) TableName() string {\n\treturn \"slave_dns_configs\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/sdns/config.go:12:24:GetPageNormalConfigs",
    "orm_code": "func (s *impl) GetPageNormalConfigs(ctx context.Context, limit int, page int) ([]mysql.Config, error) {\n\tvar pageConfigs []mysql.Config\n\ts.db.WithContext(ctx).Preload(\"Masters\").\n\t\tPreload(\"NotifyServers\").\n\t\tPreload(clause.Associations).\n\t\tWhere(\"deleted = ?\", 0).\n\t\tWhere(\"sync_switch = ?\", 1).\n\t\tLimit(limit).\n\t\tOffset(page * limit).\n\t\tFind(&pageConfigs)\n\n\treturn pageConfigs, nil\n}",
    "caller": "",
    "sql_statement_list": [
      "SELECT `slave_dns_configs`.`id`, `slave_dns_configs`.`domain_id`, `slave_dns_configs`.`domain`, `slave_dns_configs`.`sync_switch`, `slave_dns_configs`.`status`, `slave_dns_configs`.`notice`, `slave_dns_configs`.`last_sync_on`, `slave_dns_configs`.`deleted`, `slave_dns_configs`.`updated_on`, `slave_dns_configs`.`created_on` FROM `slave_dns_configs` WHERE `slave_dns_configs`.`deleted` = ? AND `slave_dns_configs`.`sync_switch` = ? LIMIT ? OFFSET ?;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "Config",
        "code_value": "type Config struct {\n\tID            uint64         `gorm:\"column:id;bigint unsigned;autoIncrement\" json:\"id\"`           //辅助DNS配置ID\n\tDomainID      uint           `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`              //域名ID\n\tDomain        string         `gorm:\"column:domain;varchar\" json:\"domain\"`                         //域名\n\tSyncSwitch    int8           `gorm:\"column:sync_switch;tinyint\" json:\"sync_switch\"`               //同步开关：0 关 1开\n\tStatus        int8           `gorm:\"column:status;tinyint\" json:\"status\"`                         //同步状态：-1 未开启 0 失效 1 成功 2 失败 3 同步中\n\tNotice        int8           `gorm:\"column:notice;tinyint\" json:\"notice\"`                         //连不上主DNS时是否通知：0 不通知 1 通知\n\tLastSyncOn    time.Time      `gorm:\"column:last_sync_on;datetime\" json:\"last_sync_on\"`            //最近同步时间\n\tDeleted       int8           `gorm:\"column:deleted;tinyint\" json:\"deleted\"`                       //删除标识：0 未删除 1 已删除\n\tUpdatedOn     time.Time      `gorm:\"column:updated_on;datetime;autoUpdateTime\" json:\"updated_on\"` //更新时间\n\tCreatedOn     time.Time      `gorm:\"column:created_on;datetime\" json:\"created_on\"`                //创建时间\n\tMasters       []Master       `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // masters列表\n\tNotifyServers []NotifyServer `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // notifyServer列表\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (Config) TableName() string {\n\treturn \"slave_dns_configs\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/sdns/config.go:12:24:GetPageNormalConfigs",
    "orm_code": "func (s *impl) GetPageNormalConfigs(ctx context.Context, limit int, page int) ([]mysql.Config, error) {\n\tvar pageConfigs []mysql.Config\n\ts.db.WithContext(ctx).Preload(\"Masters\").\n\t\tPreload(\"NotifyServers\").\n\t\tPreload(clause.Associations).\n\t\tWhere(\"deleted = ?\", 0).\n\t\tWhere(\"sync_switch = ?\", 1).\n\t\tLimit(limit).\n\t\tOffset(page * limit).\n\t\tFind(&pageConfigs)\n\n\treturn pageConfigs, nil\n}",
    "caller": "func (s *configImpl) GetAllNormalConfigs(ctx context.Context) []mysql.Config {\n\tvar configs []mysql.Config\n\tlimit := 1000\n\tloop := true\n\tpage := 0\n\tfor loop {\n\t\tpageConfigs, err := s.sdnsRepo.GetPageNormalConfigs(ctx, limit, page)\n\t\tif err != nil {\n\t\t\tlog.ErrorContextf(ctx, \"GetPageNormalConfigs err, err:%s\", err.Error())\n\t\t\tbreak\n\t\t}\n\t\tlog.InfoContextf(ctx, \"page configs length: %d\", len(pageConfigs))\n\t\tif pageConfigs != nil && len(pageConfigs) > 0 {\n\t\t\tpage++\n\t\t\tconfigs = append(configs, pageConfigs...)\n\t\t} else {\n\t\t\tloop = false\n\t\t}\n\t}\n\n\treturn configs\n}",
    "sql_statement_list": [
      "SELECT slave_dns_configs.id, slave_dns_configs.domain_id, slave_dns_configs.domain, slave_dns_configs.sync_switch, slave_dns_configs.status, slave_dns_configs.notice, slave_dns_configs.last_sync_on, slave_dns_configs.deleted, slave_dns_configs.updated_on, slave_dns_configs.created_on, Masters.id, Masters.domain_id, Masters.master_ip, Masters.master_port, Masters.created_on, Masters.updated_on, NotifyServers.id, NotifyServers.domain_id, NotifyServers.notify_ip, NotifyServers.notify_port, NotifyServers.created_on, NotifyServers.updated_on FROM slave_dns_configs LEFT JOIN masters Masters ON slave_dns_configs.domain_id = Masters.domain_id LEFT JOIN notify_servers NotifyServers ON slave_dns_configs.domain_id = NotifyServers.domain_id WHERE slave_dns_configs.deleted = ? AND slave_dns_configs.sync_switch = ? LIMIT ? OFFSET ?;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "Config",
        "code_value": "type Config struct {\n\tID            uint64         `gorm:\"column:id;bigint unsigned;autoIncrement\" json:\"id\"`           //辅助DNS配置ID\n\tDomainID      uint           `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`              //域名ID\n\tDomain        string         `gorm:\"column:domain;varchar\" json:\"domain\"`                         //域名\n\tSyncSwitch    int8           `gorm:\"column:sync_switch;tinyint\" json:\"sync_switch\"`               //同步开关：0 关 1开\n\tStatus        int8           `gorm:\"column:status;tinyint\" json:\"status\"`                         //同步状态：-1 未开启 0 失效 1 成功 2 失败 3 同步中\n\tNotice        int8           `gorm:\"column:notice;tinyint\" json:\"notice\"`                         //连不上主DNS时是否通知：0 不通知 1 通知\n\tLastSyncOn    time.Time      `gorm:\"column:last_sync_on;datetime\" json:\"last_sync_on\"`            //最近同步时间\n\tDeleted       int8           `gorm:\"column:deleted;tinyint\" json:\"deleted\"`                       //删除标识：0 未删除 1 已删除\n\tUpdatedOn     time.Time      `gorm:\"column:updated_on;datetime;autoUpdateTime\" json:\"updated_on\"` //更新时间\n\tCreatedOn     time.Time      `gorm:\"column:created_on;datetime\" json:\"created_on\"`                //创建时间\n\tMasters       []Master       `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // masters列表\n\tNotifyServers []NotifyServer `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // notifyServer列表\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (Config) TableName() string {\n\treturn \"slave_dns_configs\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/sdns/config.go:55:67:GetConfigByDomainID",
    "orm_code": "func (s *impl) GetConfigByDomainID(ctx context.Context, domainID int64) (mysql.Config, error) {\n\tvar config mysql.Config\n\tif domainID <= 0 {\n\t\treturn config, nil\n\t}\n\ts.db.WithContext(ctx).Preload(\"Masters\").\n\t\tPreload(\"NotifyServers\").\n\t\tPreload(clause.Associations).\n\t\tWhere(\"domain_id = ?\", domainID).\n\t\tFirst(&config)\n\n\treturn config, nil\n}",
    "caller": "",
    "sql_statement_list": [
      "SELECT * FROM `slave_dns_configs` WHERE domain_id = ? AND `slave_dns_configs`.`deleted_at` IS NULL ORDER BY `slave_dns_configs`.`id` LIMIT 1;",
      "SELECT * FROM `masters` WHERE `masters`.`domain_id` IN (?) AND `masters`.`deleted_at` IS NULL;",
      "SELECT * FROM `notify_servers` WHERE `notify_servers`.`domain_id` IN (?) AND `notify_servers`.`deleted_at` IS NULL;"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "Config",
        "code_value": "type Config struct {\n\tID            uint64         `gorm:\"column:id;bigint unsigned;autoIncrement\" json:\"id\"`           //辅助DNS配置ID\n\tDomainID      uint           `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`              //域名ID\n\tDomain        string         `gorm:\"column:domain;varchar\" json:\"domain\"`                         //域名\n\tSyncSwitch    int8           `gorm:\"column:sync_switch;tinyint\" json:\"sync_switch\"`               //同步开关：0 关 1开\n\tStatus        int8           `gorm:\"column:status;tinyint\" json:\"status\"`                         //同步状态：-1 未开启 0 失效 1 成功 2 失败 3 同步中\n\tNotice        int8           `gorm:\"column:notice;tinyint\" json:\"notice\"`                         //连不上主DNS时是否通知：0 不通知 1 通知\n\tLastSyncOn    time.Time      `gorm:\"column:last_sync_on;datetime\" json:\"last_sync_on\"`            //最近同步时间\n\tDeleted       int8           `gorm:\"column:deleted;tinyint\" json:\"deleted\"`                       //删除标识：0 未删除 1 已删除\n\tUpdatedOn     time.Time      `gorm:\"column:updated_on;datetime;autoUpdateTime\" json:\"updated_on\"` //更新时间\n\tCreatedOn     time.Time      `gorm:\"column:created_on;datetime\" json:\"created_on\"`                //创建时间\n\tMasters       []Master       `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // masters列表\n\tNotifyServers []NotifyServer `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // notifyServer列表\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (Config) TableName() string {\n\treturn \"slave_dns_configs\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  },
  {
    "function_name": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/slavedns/repo/sdns/config.go:55:67:GetConfigByDomainID",
    "orm_code": "func (s *impl) GetConfigByDomainID(ctx context.Context, domainID int64) (mysql.Config, error) {\n\tvar config mysql.Config\n\tif domainID <= 0 {\n\t\treturn config, nil\n\t}\n\ts.db.WithContext(ctx).Preload(\"Masters\").\n\t\tPreload(\"NotifyServers\").\n\t\tPreload(clause.Associations).\n\t\tWhere(\"domain_id = ?\", domainID).\n\t\tFirst(&config)\n\n\treturn config, nil\n}",
    "caller": "func (s *configImpl) SubscribeManualConfig(ctx context.Context) mysql.Config {\n\tdomainID := s.sdnsRepo.GetCachePopDomain(ctx)\n\t// 获得配置\n\tc, _ := s.sdnsRepo.GetConfigByDomainID(ctx, domainID)\n\n\treturn c\n}",
    "sql_statement_list": [
      "SELECT * FROM `slave_dns_configs` WHERE domain_id = ? ORDER BY `slave_dns_configs`.`id` LIMIT 1;",
      "SELECT * FROM `masters` WHERE `masters`.`domain_id` IN (?);",
      "SELECT * FROM `notify_servers` WHERE `notify_servers`.`domain_id` IN (?);"
    ],
    "sql_types": [
      "SELECT",
      "SELECT",
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 6,
        "code_end_line": 19,
        "code_key": "Config",
        "code_value": "type Config struct {\n\tID            uint64         `gorm:\"column:id;bigint unsigned;autoIncrement\" json:\"id\"`           //辅助DNS配置ID\n\tDomainID      uint           `gorm:\"column:domain_id;int unsigned\" json:\"domain_id\"`              //域名ID\n\tDomain        string         `gorm:\"column:domain;varchar\" json:\"domain\"`                         //域名\n\tSyncSwitch    int8           `gorm:\"column:sync_switch;tinyint\" json:\"sync_switch\"`               //同步开关：0 关 1开\n\tStatus        int8           `gorm:\"column:status;tinyint\" json:\"status\"`                         //同步状态：-1 未开启 0 失效 1 成功 2 失败 3 同步中\n\tNotice        int8           `gorm:\"column:notice;tinyint\" json:\"notice\"`                         //连不上主DNS时是否通知：0 不通知 1 通知\n\tLastSyncOn    time.Time      `gorm:\"column:last_sync_on;datetime\" json:\"last_sync_on\"`            //最近同步时间\n\tDeleted       int8           `gorm:\"column:deleted;tinyint\" json:\"deleted\"`                       //删除标识：0 未删除 1 已删除\n\tUpdatedOn     time.Time      `gorm:\"column:updated_on;datetime;autoUpdateTime\" json:\"updated_on\"` //更新时间\n\tCreatedOn     time.Time      `gorm:\"column:created_on;datetime\" json:\"created_on\"`                //创建时间\n\tMasters       []Master       `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // masters列表\n\tNotifyServers []NotifyServer `gorm:\"foreignKey:DomainID;references:DomainID\"`                     // notifyServer列表\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      },
      {
        "code_file": "/Users/ymhuan/code/git-development/aid-main/aid/risk_sql/code/scripts/dnspod__dnspod_backend/backend/application/ccdb/entity/mysql/slavedns.go",
        "code_start_line": 22,
        "code_end_line": 24,
        "code_key": "TableName",
        "code_value": "func (Config) TableName() string {\n\treturn \"slave_dns_configs\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "2c9bc9914615f326b709cc019502dda7730f6f91"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/gorm_orm_code/dnspod__dnspod_backend.json",
    "matched_keywords": [
      "Preload",
      "Association"
    ]
  }
]