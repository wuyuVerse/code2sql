{
  "metadata": {
    "generation_time": "2025-07-10T15:24:19.157571",
    "model_path": "/home/wuyu/code2sql/saves/qwen3-14b-ft-20250709_171410",
    "eval_data_path": "model/evaluation/fingerprint_eval/data/eval_data.json",
    "total_samples": 114
  },
  "overall_statistics": {
    "total_samples": 114,
    "successful_inference": 114,
    "valid_sql_generated": 99,
    "fingerprint_matched": 12,
    "parse_errors": 0,
    "inference_errors": 0,
    "inference_success_rate": 1.0,
    "valid_sql_rate": 0.868421052631579,
    "fingerprint_match_rate": 0.10526315789473684,
    "parse_error_rate": 0.0,
    "inference_error_rate": 0.0,
    "total_sql_generated": 195,
    "total_valid_sql": 167,
    "total_matched_sql": 26,
    "sql_validity_rate": 0.8564102564102564,
    "sql_match_rate": 0.13333333333333333
  },
  "sql_analysis": {
    "sql_type_distribution": {
      "SELECT": 116,
      "DELETE": 18,
      "OTHER": 13,
      "DDL": 7,
      "INSERT": 15,
      "UPDATE": 26
    },
    "complexity_distribution": {
      "SIMPLE": 117,
      "MEDIUM": 74,
      "COMPLEX": 4
    },
    "length_statistics": {
      "avg_length": 78.42051282051283,
      "min_length": 6,
      "max_length": 432,
      "total_sqls": 195
    },
    "common_patterns": {
      "HAS_PARAMETERS": 171,
      "HAS_WHERE": 159,
      "HAS_LIMIT": 39,
      "HAS_ORDER_BY": 7,
      "HAS_JOIN": 1
    },
    "error_patterns": {}
  },
  "fingerprint_analysis": {
    "total_fingerprints": 195,
    "matched_fingerprints": 26,
    "coverage_rate": 0.13333333333333333,
    "fingerprint_distribution": {
      "0fdf2b4f4a53dfe58ca51876e84148aa": 7,
      "ca399b5161d1459e1ddd896f0b5f1600": 5,
      "45c56aa3ac4b336dc151a67be35ce9d6": 4,
      "b0ca129db83e26402fb0dd198aa16698": 4,
      "e4b00a2ee33535674ea06c75b3a985c6": 2,
      "04cddcdf27d2555bdd3b6350fc6b5cb8": 2,
      "417b025e6acd524e0a27bc7a4e4ef3ec": 1,
      "176d7d4c2e1308a76340c2c430a68ffa": 1
    },
    "unmatched_patterns": {
      "SELECT": 90,
      "DELETE": 18,
      "OTHER": 13,
      "DDL": 7,
      "INSERT": 15,
      "UPDATE": 26
    }
  },
  "quality_analysis": {
    "quality_distribution": {
      "3": 87,
      "5": 12,
      "2": 14,
      "1": 1
    },
    "quality_thresholds": {
      "high_quality": 12,
      "medium_quality": 101,
      "low_quality": 1
    },
    "average_quality_score": 3.0701754385964914
  },
  "representative_examples": {
    "excellent": [
      {
        "sample_id": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/repo/impl/phy.go:20:28:ListRecordByState",
        "prompt": "请基于以下分析要求，直接输出GORM代码对应的SQL语句JSON格式结果：\n\n**首要判断：SQL生成有效性**\n在开始分析前，请判断给定的ORM代码是否真的会生成SQL语句：\n- 代码必须包含实际的数据库操作方法（Find、Create、Update、Delete、Count、First等）\n- 仅有查询构建方法（Where、Select、Join等）而没有执行方法的代码不会生成SQL\n- 如果...",
        "response": "[\"SELECT * FROM dm_phydisk WHERE status = ?;\"]",
        "parsed_sql": [
          "SELECT * FROM dm_phydisk WHERE status = ?;"
        ],
        "valid_sql_count": 1,
        "matched_sql_count": 1
      },
      {
        "sample_id": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:22:47:FindByAppIDAndUUID",
        "prompt": "请基于以下分析要求，直接输出GORM代码对应的SQL语句JSON格式结果：\n\n**首要判断：SQL生成有效性**\n在开始分析前，请判断给定的ORM代码是否真的会生成SQL语句：\n- 代码必须包含实际的数据库操作方法（Find、Create、Update、Delete、Count、First等）\n- 仅有查询构建方法（Where、Select、Join等）而没有执行方法的代码不会生成SQL\n- 如果...",
        "response": "[{\"type\": \"param_dependent\", \"variants\": [{\"scenario\": \"Main query with preloads\", \"sql\": \"SELECT * FROM dm_rdisk WHERE uuid = ? AND app_id = ? LIMIT 1;\"}, {\"scenario\": \"Preload query for Attachments\", \"sql\": \"SELECT * FROM dm_rdisk_attachment WHERE uuid = ?;\"}, {\"scenario\": \"Preload query for DmPhyDisk\", \"sql\": \"SELECT * FROM dm_phydisk WHERE uuid = ?;\"}]}]",
        "parsed_sql": [
          "SELECT * FROM dm_rdisk WHERE uuid = ? AND app_id = ? LIMIT 1;",
          "SELECT * FROM dm_rdisk_attachment WHERE uuid = ?;",
          "SELECT * FROM dm_phydisk WHERE uuid = ?;"
        ],
        "valid_sql_count": 3,
        "matched_sql_count": 2
      },
      {
        "sample_id": "/Users/freedom/llms/singularity/internal/rdisk_master/adapters/repositories/logical_disk.go:49:74:FindByID",
        "prompt": "请基于以下分析要求，直接输出GORM代码对应的SQL语句JSON格式结果：\n\n**首要判断：SQL生成有效性**\n在开始分析前，请判断给定的ORM代码是否真的会生成SQL语句：\n- 代码必须包含实际的数据库操作方法（Find、Create、Update、Delete、Count、First等）\n- 仅有查询构建方法（Where、Select、Join等）而没有执行方法的代码不会生成SQL\n- 如果...",
        "response": "[{\"type\": \"param_dependent\", \"variants\": [{\"scenario\": \"Main query with preloads\", \"sql\": \"SELECT * FROM dm_rdisk WHERE uuid = ? LIMIT 1;\"}]}, {\"type\": \"param_dependent\", \"variants\": [{\"scenario\": \"Preload query for Attachments\", \"sql\": \"SELECT * FROM dm_rdisk_attachment WHERE uuid = ?;\"}]}, {\"type\": \"param_dependent\", \"variants\": [{\"scenario\": \"Preload query for DmPhyDisk\", \"sql\": \"SELECT * FROM dm_phydisk WHERE uuid = ?;\"}]}]",
        "parsed_sql": [
          "SELECT * FROM dm_rdisk WHERE uuid = ? LIMIT 1;",
          "SELECT * FROM dm_rdisk_attachment WHERE uuid = ?;",
          "SELECT * FROM dm_phydisk WHERE uuid = ?;"
        ],
        "valid_sql_count": 3,
        "matched_sql_count": 2
      }
    ],
    "good": [
      {
        "sample_id": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/infra/event_bus/bus.go:47:59:RollbackEvents",
        "prompt": "请基于以下分析要求，直接输出GORM代码对应的SQL语句JSON格式结果：\n\n**首要判断：SQL生成有效性**\n在开始分析前，请判断给定的ORM代码是否真的会生成SQL语句：\n- 代码必须包含实际的数据库操作方法（Find、Create、Update、Delete、Count、First等）\n- 仅有查询构建方法（Where、Select、Join等）而没有执行方法的代码不会生成SQL\n- 如果...",
        "response": "[{\"type\": \"param_dependent\", \"variants\": [{\"scenario\": \"event.GetState(ctx) == Executed时执行回滚操作\", \"sql\": \"SELECT * FROM events WHERE state = ?;\"}]}]",
        "parsed_sql": [
          "SELECT * FROM events WHERE state = ?;"
        ],
        "valid_sql_count": 1,
        "matched_sql_count": 0
      },
      {
        "sample_id": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/desdb/repos/impl/shm.go:17:28:ListRecordByStatus",
        "prompt": "请基于以下分析要求，直接输出GORM代码对应的SQL语句JSON格式结果：\n\n**首要判断：SQL生成有效性**\n在开始分析前，请判断给定的ORM代码是否真的会生成SQL语句：\n- 代码必须包含实际的数据库操作方法（Find、Create、Update、Delete、Count、First等）\n- 仅有查询构建方法（Where、Select、Join等）而没有执行方法的代码不会生成SQL\n- 如果...",
        "response": "[\"SELECT * FROM shm WHERE status = ?;\"]",
        "parsed_sql": [
          "SELECT * FROM shm WHERE status = ?;"
        ],
        "valid_sql_count": 1,
        "matched_sql_count": 0
      },
      {
        "sample_id": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/db/metadb/repo/impl/dmg.go:29:37:ListRecordByStatus",
        "prompt": "请基于以下分析要求，直接输出GORM代码对应的SQL语句JSON格式结果：\n\n**首要判断：SQL生成有效性**\n在开始分析前，请判断给定的ORM代码是否真的会生成SQL语句：\n- 代码必须包含实际的数据库操作方法（Find、Create、Update、Delete、Count、First等）\n- 仅有查询构建方法（Where、Select、Join等）而没有执行方法的代码不会生成SQL\n- 如果...",
        "response": "[\"SELECT id, confKey, confValue, status, createTime, updateTime, creator, modifier FROM dm_drgroup_members WHERE status = ?;\"]",
        "parsed_sql": [
          "SELECT id, confKey, confValue, status, createTime, updateTime, creator, modifier FROM dm_drgroup_members WHERE status = ?;"
        ],
        "valid_sql_count": 1,
        "matched_sql_count": 0
      }
    ],
    "poor": [
      {
        "sample_id": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/domain/cache/expiremap.go:98:100:Remove",
        "prompt": "请基于以下分析要求，直接输出GORM代码对应的SQL语句JSON格式结果：\n\n**首要判断：SQL生成有效性**\n在开始分析前，请判断给定的ORM代码是否真的会生成SQL语句：\n- 代码必须包含实际的数据库操作方法（Find、Create、Update、Delete、Count、First等）\n- 仅有查询构建方法（Where、Select、Join等）而没有执行方法的代码不会生成SQL\n- 如果...",
        "response": "[\"DELETE FROM expired_map WHERE key = ?;\"]",
        "parsed_sql": [
          "DELETE FROM expired_map WHERE key = ?;"
        ],
        "valid_sql_count": 0,
        "matched_sql_count": 0
      },
      {
        "sample_id": "/Users/freedom/llms/singularity/internal/cbs_packing_srv/domain/cache/managers/shm.go:51:54:Remove",
        "prompt": "请基于以下分析要求，直接输出GORM代码对应的SQL语句JSON格式结果：\n\n**首要判断：SQL生成有效性**\n在开始分析前，请判断给定的ORM代码是否真的会生成SQL语句：\n- 代码必须包含实际的数据库操作方法（Find、Create、Update、Delete、Count、First等）\n- 仅有查询构建方法（Where、Select、Join等）而没有执行方法的代码不会生成SQL\n- 如果...",
        "response": "[\"DELETE FROM cache WHERE key = ?;\"]",
        "parsed_sql": [
          "DELETE FROM cache WHERE key = ?;"
        ],
        "valid_sql_count": 0,
        "matched_sql_count": 0
      },
      {
        "sample_id": "/Users/freedom/llms/singularity/pkg/dlock/mysql/dlock.go:644:674:Refresh",
        "prompt": "请基于以下分析要求，直接输出GORM代码对应的SQL语句JSON格式结果：\n\n**首要判断：SQL生成有效性**\n在开始分析前，请判断给定的ORM代码是否真的会生成SQL语句：\n- 代码必须包含实际的数据库操作方法（Find、Create、Update、Delete、Count、First等）\n- 仅有查询构建方法（Where、Select、Join等）而没有执行方法的代码不会生成SQL\n- 如果...",
        "response": "[{\"type\": \"param_dependent\", \"variants\": [{\"scenario\": \"正常执行路径（所有检查都通过）\", \"sql\": \"COMMIT;\"}, {\"scenario\": \"fetchExistingLocksByKeysAndTokens失败\", \"sql\": \"ROLLBACK;\"}, {\"scenario\": \"锁检查失败（checkStrSetEqual返回false）\", \"sql\": \"ROLLBACK;\"}, {\"scenario\": \"更新锁TTL失败\", \"sql\": \"ROLLBACK;\"}]}]",
        "parsed_sql": [
          "COMMIT;",
          "ROLLBACK;",
          "ROLLBACK;",
          "ROLLBACK;"
        ],
        "valid_sql_count": 0,
        "matched_sql_count": 0
      }
    ],
    "failed": []
  },
  "configuration": {
    "data_config": {
      "dataset_dir": "model/evaluation/fingerprint_eval/temp",
      "eval_data_path": "model/evaluation/fingerprint_eval/data/eval_data.json",
      "fingerprint_cache_path": "model/evaluation/fingerprint_eval/data/cbs_528_final.pkl",
      "max_samples": null
    },
    "debug_config": {
      "save_intermediate_results": false,
      "test_mode": false,
      "test_samples": 10,
      "validate_config": true,
      "verbose_logging": true
    },
    "environment_config": {
      "bf16": true,
      "cuda_visible_devices": "0",
      "llamafactory_path": "model/training/LLaMA-Factory",
      "trust_remote_code": true
    },
    "inference_config": {
      "batch_size": 1,
      "cutoff_len": 2048,
      "generate_config": {
        "do_sample": false,
        "max_new_tokens": 512,
        "temperature": 0.1,
        "top_p": 0.9
      },
      "per_device_eval_batch_size": 1,
      "timeout": 3600
    },
    "metrics_config": {
      "detailed_metrics": [
        "sql_validity_rate",
        "sql_match_rate",
        "parse_error_rate",
        "inference_error_rate"
      ],
      "primary_metrics": [
        "inference_success_rate",
        "valid_sql_rate",
        "fingerprint_match_rate"
      ],
      "sql_type_analysis": {
        "enabled": true,
        "types": [
          "SELECT",
          "INSERT",
          "UPDATE",
          "DELETE",
          "OTHER"
        ]
      }
    },
    "model_config": {
      "finetuning_type": "full",
      "model_path": "/home/wuyu/code2sql/saves/qwen3-14b-ft-20250709_171410",
      "template": "qwen"
    },
    "output_config": {
      "keep_temp_files": false,
      "output_dir": "model/evaluation/fingerprint_eval/results",
      "result_prefix": "qwen3_evaluation",
      "save_detailed_results": true
    },
    "validation_config": {
      "enable_fingerprint_validation": true,
      "enable_syntax_validation": true,
      "excluded_sql_types": [
        "transaction_begin",
        "transaction_end",
        "session_setting",
        "show_command",
        "ddl_command",
        "empty_sql",
        "not_sql",
        "invalid_sql"
      ],
      "fingerprint_threshold": 0.8
    }
  }
}