[
  {
    "function_name": "SnapshotList",
    "orm_code": "func (l *SnapshotListLogic) SnapshotList(req *types.SnapshotRequest) (resp *types.SnapshotResponse, err error) {\n\t// 校验参数，子用户权限，构造token\n\tif len(req.ChannelId) < 1 {\n\t\tl.Errorf(\"[SnapshotList] Req:%+v ChannelId empty\", *req)\n\t\treturn nil, utils.InvalidChannelIdError\n\t}\n\terr = utils.CheckUUID(req.ChannelId)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v CheckUUID err:%v\", req.ChannelId, err)\n\t\treturn nil, utils.InvalidChannelIdError\n\t}\n\n\t// 校验时间参数\n\tValidateAndSetParams(req)\n\tif req.Start >= req.End {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v start big than end error\", req.ChannelId)\n\t\treturn nil, utils.TimeStartThanEndError\n\t}\n\tnow := time.Now().Unix()\n\tif req.Start >= now {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v start big than now error\", req.ChannelId)\n\t\treturn nil, utils.TimeStartThanNowError\n\t}\n\tif req.End > now {\n\t\treq.End = now\n\t}\n\n\t// 子用户账号鉴权\n\thasPermission, err := model.CheckSubUinPermission(req.ChannelId, req.SubUin)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v CheckSubUinPermission err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\tif !hasPermission {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v CheckSubUinPermission hasPermission:%v\", req.ChannelId, hasPermission)\n\t\treturn nil, utils.AccessUnauthorizedError\n\t}\n\n\t//  图片域名从推流域名表获取domain_type=2\n\td := &model.Domain{\n\t\tAppId:      req.AppId,\n\t\tClusterId:  base.GetInstance().ClusterId(),\n\t\tDomainType: model.ImageDomainType,\n\t\tReqId:      req.RequestId,\n\t\tFlow:       SnapshotListFlow,\n\t\tCUin:       req.OwnerUin,\n\t\tCSubUin:    req.SubUin,\n\t}\n\terr = d.FindOne()\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v find imageDomain err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\n\t// 通过appId获取PullSecret\n\tauth := &model.AuthConfig{\n\t\tAppId: req.AppId,\n\t}\n\terr = auth.Find()\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v auth.Find err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\ttoken := utils.NewToken(auth.PullSecret, req.AppId, auth.PullExpired*60)\n\n\ttotal, err := model.FindSnapshotListTotalCount(req)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v FindSnapshotListTotalCount err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\n\tpagination := model.ReqPagination(req.Page, req.Size)\n\tresults, err := model.FindSnapshotListByPaginate(req, pagination)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v FindSnapshotListByPaginate err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\tsnapshots := make([]types.SnapshotInfo, 0)\n\tfor _, res := range results {\n\t\tsnapshot := types.SnapshotInfo{\n\t\t\tChannelId:    res.ChannelId,\n\t\t\tFileName:     res.FileName,\n\t\t\tImageSize:    res.FileSize,\n\t\t\tDownloadUrl:  fmt.Sprintf(\"https://%v\", d.PlayDomain) + res.DownloadUrl + fmt.Sprintf(\"&token=%v\", token),\n\t\t\tCreatedTime:  utils.UnixTimestampToString(int64(res.CreatedTime)),\n\t\t\tReceivedTime: utils.UnixTimestampToString(int64(res.ReceivedTime)),\n\t\t}\n\t\tsnapshots = append(snapshots, snapshot)\n\t}\n\n\tresp = &types.SnapshotResponse{\n\t\tSnapshots: snapshots,\n\t\tTotal:     total,\n\t\tPage:      pagination.Page,\n\t\tSize:      pagination.Size,\n\t}\n\n\treturn resp, nil\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "LACK_INFORMATION",
        "variants": [
          {
            "scenario": "缺少表名映射和字段映射的元数据信息，基于结构体名称和函数调用推测生成SQL",
            "sql": "SELECT * FROM domain WHERE app_id = ? AND cluster_id = ? AND domain_type = ? LIMIT 1; SELECT * FROM auth_config WHERE app_id = ?; SELECT COUNT(*) FROM snapshot WHERE channel_id = ? AND created_time >= ? AND created_time <= ?; SELECT * FROM snapshot WHERE channel_id = ? AND created_time >= ? AND created_time <= ? ORDER BY created_time DESC LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "LACK_INFORMATION"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/auth.go",
        "code_start_line": 20,
        "code_end_line": 28,
        "code_key": "AuthConfig",
        "code_value": "type AuthConfig struct {\n\tAppId       int    `json:\"app_id\"`\n\tPushState   int    `json:\"push_state\"`\n\tPushSecret  string `json:\"push_secret\"`\n\tPushExpired int64  `json:\"push_expired\"`\n\tPullState   int    `json:\"pull_state\"`\n\tPullSecret  string `json:\"pull_secret\"`\n\tPullExpired int64  `json:\"pull_expired\"`\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/logic/transfer/snapshotlistlogic.go",
        "code_start_line": 90,
        "code_end_line": 90,
        "code_key": "auth",
        "code_value": "&model.AuthConfig{\n\t\tAppId: req.AppId,\n\t}",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "SnapshotList",
    "orm_code": "func (l *SnapshotListLogic) SnapshotList(req *types.SnapshotRequest) (resp *types.SnapshotResponse, err error) {\n\t// 校验参数，子用户权限，构造token\n\tif len(req.ChannelId) < 1 {\n\t\tl.Errorf(\"[SnapshotList] Req:%+v ChannelId empty\", *req)\n\t\treturn nil, utils.InvalidChannelIdError\n\t}\n\terr = utils.CheckUUID(req.ChannelId)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v CheckUUID err:%v\", req.ChannelId, err)\n\t\treturn nil, utils.InvalidChannelIdError\n\t}\n\n\t// 校验时间参数\n\tValidateAndSetParams(req)\n\tif req.Start >= req.End {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v start big than end error\", req.ChannelId)\n\t\treturn nil, utils.TimeStartThanEndError\n\t}\n\tnow := time.Now().Unix()\n\tif req.Start >= now {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v start big than now error\", req.ChannelId)\n\t\treturn nil, utils.TimeStartThanNowError\n\t}\n\tif req.End > now {\n\t\treq.End = now\n\t}\n\n\t// 子用户账号鉴权\n\thasPermission, err := model.CheckSubUinPermission(req.ChannelId, req.SubUin)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v CheckSubUinPermission err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\tif !hasPermission {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v CheckSubUinPermission hasPermission:%v\", req.ChannelId, hasPermission)\n\t\treturn nil, utils.AccessUnauthorizedError\n\t}\n\n\t//  图片域名从推流域名表获取domain_type=2\n\td := &model.Domain{\n\t\tAppId:      req.AppId,\n\t\tClusterId:  base.GetInstance().ClusterId(),\n\t\tDomainType: model.ImageDomainType,\n\t\tReqId:      req.RequestId,\n\t\tFlow:       SnapshotListFlow,\n\t\tCUin:       req.OwnerUin,\n\t\tCSubUin:    req.SubUin,\n\t}\n\terr = d.FindOne()\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v find imageDomain err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\n\t// 通过appId获取PullSecret\n\tauth := &model.AuthConfig{\n\t\tAppId: req.AppId,\n\t}\n\terr = auth.Find()\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v auth.Find err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\ttoken := utils.NewToken(auth.PullSecret, req.AppId, auth.PullExpired*60)\n\n\ttotal, err := model.FindSnapshotListTotalCount(req)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v FindSnapshotListTotalCount err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\n\tpagination := model.ReqPagination(req.Page, req.Size)\n\tresults, err := model.FindSnapshotListByPaginate(req, pagination)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotList] ChannelId:%v FindSnapshotListByPaginate err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\tsnapshots := make([]types.SnapshotInfo, 0)\n\tfor _, res := range results {\n\t\tsnapshot := types.SnapshotInfo{\n\t\t\tChannelId:    res.ChannelId,\n\t\t\tFileName:     res.FileName,\n\t\t\tImageSize:    res.FileSize,\n\t\t\tDownloadUrl:  fmt.Sprintf(\"https://%v\", d.PlayDomain) + res.DownloadUrl + fmt.Sprintf(\"&token=%v\", token),\n\t\t\tCreatedTime:  utils.UnixTimestampToString(int64(res.CreatedTime)),\n\t\t\tReceivedTime: utils.UnixTimestampToString(int64(res.ReceivedTime)),\n\t\t}\n\t\tsnapshots = append(snapshots, snapshot)\n\t}\n\n\tresp = &types.SnapshotResponse{\n\t\tSnapshots: snapshots,\n\t\tTotal:     total,\n\t\tPage:      pagination.Page,\n\t\tSize:      pagination.Size,\n\t}\n\n\treturn resp, nil\n}",
    "caller": "func SnapshotListHandler(svcCtx *svc.ServiceContext) http.HandlerFunc {\n\treturn func(w http.ResponseWriter, r *http.Request) {\n\t\tvar (\n\t\t\treq      types.SnapshotRequest\n\t\t\tresponse types.Response\n\t\t\terr      error\n\t\t)\n\t\tlog := logx.WithContext(r.Context())\n\t\tdefer func() {\n\t\t\tresponse.RequestId = r.Header.Get(\"request_id\")\n\t\t\tif e := recover(); e != nil {\n\t\t\t\tlog.Errorw(fmt.Sprintf(\"[SnapshotListHandler] recover:%v, panic:%v\", e, string(debug.Stack())), utils.ErrorField(utils.GenericError))\n\t\t\t\tresponse.Code = http.StatusInternalServerError\n\t\t\t\tresponse.StatusCode = utils.OperationErr\n\t\t\t\tresponse.Msg = utils.GenericError.ZhMsg\n\t\t\t\thttpx.OkJson(w, &response)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tresponse.StatusCode = http.StatusOK\n\t\t\tresponse.Msg = \"ok\"\n\t\t\tif err != nil {\n\t\t\t\tlog.Errorw(fmt.Sprintf(\"[SnapshotListHandler] operator failed:%v\", err), utils.ErrorField(err))\n\t\t\t\tresponse.StatusCode, response.Msg, response.Data = utils.ErrorMsg(err)\n\t\t\t\tif response.StatusCode >= utils.OperationErr {\n\t\t\t\t\tresponse.Code = http.StatusInternalServerError\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thttpx.OkJson(w, &response)\n\t\t\treturn\n\t\t}()\n\n\t\tif err = httpx.Parse(r, &req); err != nil {\n\t\t\tlog.Errorw(fmt.Sprintf(\"[SnapshotListHandler] httpx Parse err:%v\", err), utils.ErrorField(utils.ParamCheckError))\n\t\t\terr = utils.ParamCheckError\n\t\t\treturn\n\t\t}\n\t\tl := transfer.NewSnapshotListLogic(r.Context(), svcCtx)\n\t\tresp, errtmp := l.SnapshotList(&req)\n\t\tif resp == nil {\n\t\t\tresponse.Data = &struct{}{}\n\t\t} else {\n\t\t\tresponse.Data = resp\n\t\t}\n\t\terr = errtmp\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "代码只包含对其他模型方法的调用(CheckSubUinPermission、FindOne、Find、FindSnapshotListTotalCount、FindSnapshotListByPaginate)，没有直接的GORM数据库执行操作方法",
            "sql": ""
          }
        ]
      }
    ],
    "sql_statement": "根据代码分析，我发现这段代码中包含了多个数据库操作调用，但这些都是对其他模型方法的调用，而不是直接的GORM ORM操作。让我详细分析每个数据库相关的调用：\n\n1. `model.CheckSubUinPermission(req.ChannelId, req.SubUin)` - 这是一个模型方法调用\n2. `d.FindOne()` - 这是Domain模型的方法调用\n3. `auth.Find()` - 这是AuthConfig模型的方法调用\n4. `model.FindSnapshotListTotalCount(req)` - 这是一个模型函数调用\n5. `model.FindSnapshotListByPaginate(req, pagination)` - 这是一个模型函数调用\n\n这些都是对封装好的模型方法的调用，而不是直接的GORM操作代码。当前函数`SnapshotList`本身并不包含任何直接的GORM数据库执行操作（如Find、Create、Update、Delete、Count、First等），它只是调用了其他模型的方法。\n\n由于这段代码不包含实际的GORM ORM操作，只包含对其他模型方法的调用，因此不会直接生成SQL语句。\n\n`<NO SQL GENERATE>: 代码只包含对其他模型方法的调用(CheckSubUinPermission、FindOne、Find、FindSnapshotListTotalCount、FindSnapshotListByPaginate)，没有直接的GORM数据库执行操作方法`",
    "verified_sql": "```json\n[{\n  \"type\": \"NO_SQL_GENERATE\",\n  \"variants\": [{\n    \"scenario\": \"代码只包含对其他模型方法的调用(CheckSubUinPermission、FindOne、Find、FindSnapshotListTotalCount、FindSnapshotListByPaginate)，没有直接的GORM数据库执行操作方法\",\n    \"sql\": \"\"\n  }]\n}]\n```",
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/auth.go",
        "code_start_line": 20,
        "code_end_line": 28,
        "code_key": "AuthConfig",
        "code_value": "type AuthConfig struct {\n\tAppId       int    `json:\"app_id\"`\n\tPushState   int    `json:\"push_state\"`\n\tPushSecret  string `json:\"push_secret\"`\n\tPushExpired int64  `json:\"push_expired\"`\n\tPullState   int    `json:\"pull_state\"`\n\tPullSecret  string `json:\"pull_secret\"`\n\tPullExpired int64  `json:\"pull_expired\"`\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/logic/transfer/snapshotlistlogic.go",
        "code_start_line": 90,
        "code_end_line": 90,
        "code_key": "auth",
        "code_value": "&model.AuthConfig{\n\t\tAppId: req.AppId,\n\t}",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "SnapshotDownload",
    "orm_code": "func (l *SnapshotDownloadLogic) SnapshotDownload(req *types.DownloadRequest) ([]byte, string, error) {\n\tif len(req.Token) < 1 || len(req.Source) < 1 || len(req.AppId) < 1 {\n\t\tl.Errorf(\"[SnapshotDownload] Param Invalid:%+v\", *req)\n\t\treturn nil, \"\", utils.InvalidParamValueError\n\t}\n\t// 解析source\n\tdecodedUri, err := url.QueryUnescape(req.Source)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] Param Source Decode Invalid:%+v\", *req)\n\t\treturn nil, \"\", utils.InvalidParamValueError\n\t}\n\tchannelId, sessionId, fileName, ok := utils.IsValidSourceFormat(decodedUri)\n\tif !ok {\n\t\tl.Errorf(\"[SnapshotDownload] Param Source Format Invalid:%+v\", *req)\n\t\treturn nil, \"\", utils.InvalidParamValueError\n\t}\n\tappId, err := strconv.Atoi(req.AppId)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] Param AppId Invalid:%+v\", *req)\n\t\treturn nil, \"\", utils.InvalidParamValueError\n\t}\n\n\t// 通过appId获取PullSecret\n\tauth := &model.AuthConfig{\n\t\tAppId: appId,\n\t}\n\terr = auth.Find()\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] appId:%v source:%v auth.Find err:%v\", req.AppId, req.Source, err)\n\t\treturn nil, \"\", err\n\t}\n\n\t// 校验token\n\terr = model.TokenValid(req.Token, auth.PullSecret)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] appId:%v source:%v TokenValid err:%v\", req.AppId, req.Source, err)\n\t\treturn nil, \"\", err\n\t}\n\n\tcosAccess := &model.COSAccessTask{\n\t\tChannelId: channelId,\n\t\tAppId:     appId,\n\t\tRegion:    base.GetInstance().Region(),\n\t}\n\twl := &model.WhiteList{\n\t\tAppId:  appId,\n\t\tRegion: base.GetInstance().Region(),\n\t\tReqId:  sessionId,\n\t\tFlow:   SnapshotDownloadFlow,\n\t\tCUin:   SnapshotDownloadFlow,\n\t}\n\terr = wl.FindOne()\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] appId:%v source:%v find WhiteList err:%v\", req.AppId, req.Source, err)\n\t\treturn nil, \"\", err\n\t}\n\tif wl.Id != 0 {\n\t\tcosAccess.Uin = wl.Uin\n\t\tcosAccess.OBucket = wl.BucketId\n\t} else {\n\t\taccount := &model.Account{}\n\t\taccount.ReqId = sessionId\n\t\taccount.Flow = SnapshotDownloadFlow\n\t\taccount.CUin = account.Flow\n\t\terr = account.FindOne()\n\t\tif err != nil {\n\t\t\tl.Errorf(\"[SnapshotDownload] appId:%v source:%v find account err:%v\", req.AppId, req.Source, err)\n\t\t\treturn nil, \"\", err\n\t\t}\n\t\tcosAccess.CommonAppId = account.AppId\n\t\tcosAccess.OBucket = fmt.Sprintf(\"%v-%v-%v-%v\", account.Prefix,\n\t\t\tcosAccess.AppId, cosAccess.Region, account.AppId)\n\t}\n\tcosAccess.Name = decodedUri\n\t// 读取COS\n\terr = cosAccess.GetObjectStore()\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] appId:%v source:%v GetObjectStore err:%v\", req.AppId, req.Source, err)\n\t\treturn nil, \"\", err\n\t}\n\n\treturn cosAccess.Data, fileName, nil\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "WhiteList存在的情况",
            "sql": "SELECT app_id, push_state, push_secret, push_expired, pull_state, pull_secret, pull_expired FROM auth_config WHERE app_id = ?; SELECT id, app_id, region, req_id, flow, cuin, uin, bucket_id FROM white_list WHERE app_id = ? AND region = ? AND req_id = ? AND flow = ? AND cuin = ? LIMIT 1;"
          },
          {
            "scenario": "WhiteList不存在的情况",
            "sql": "SELECT app_id, push_state, push_secret, push_expired, pull_state, pull_secret, pull_expired FROM auth_config WHERE app_id = ?; SELECT id, app_id, region, req_id, flow, cuin, uin, bucket_id FROM white_list WHERE app_id = ? AND region = ? AND req_id = ? AND flow = ? AND cuin = ? LIMIT 1; SELECT id, req_id, flow, cuin, app_id, prefix FROM account WHERE req_id = ? AND flow = ? AND cuin = ? LIMIT 1;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/auth.go",
        "code_start_line": 20,
        "code_end_line": 28,
        "code_key": "AuthConfig",
        "code_value": "type AuthConfig struct {\n\tAppId       int    `json:\"app_id\"`\n\tPushState   int    `json:\"push_state\"`\n\tPushSecret  string `json:\"push_secret\"`\n\tPushExpired int64  `json:\"push_expired\"`\n\tPullState   int    `json:\"pull_state\"`\n\tPullSecret  string `json:\"pull_secret\"`\n\tPullExpired int64  `json:\"pull_expired\"`\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/logic/transfer/snapshotdownloadlogic.go",
        "code_start_line": 59,
        "code_end_line": 59,
        "code_key": "auth",
        "code_value": "&model.AuthConfig{\n\t\tAppId: appId,\n\t}",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "SnapshotDownload",
    "orm_code": "func (l *SnapshotDownloadLogic) SnapshotDownload(req *types.DownloadRequest) ([]byte, string, error) {\n\tif len(req.Token) < 1 || len(req.Source) < 1 || len(req.AppId) < 1 {\n\t\tl.Errorf(\"[SnapshotDownload] Param Invalid:%+v\", *req)\n\t\treturn nil, \"\", utils.InvalidParamValueError\n\t}\n\t// 解析source\n\tdecodedUri, err := url.QueryUnescape(req.Source)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] Param Source Decode Invalid:%+v\", *req)\n\t\treturn nil, \"\", utils.InvalidParamValueError\n\t}\n\tchannelId, sessionId, fileName, ok := utils.IsValidSourceFormat(decodedUri)\n\tif !ok {\n\t\tl.Errorf(\"[SnapshotDownload] Param Source Format Invalid:%+v\", *req)\n\t\treturn nil, \"\", utils.InvalidParamValueError\n\t}\n\tappId, err := strconv.Atoi(req.AppId)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] Param AppId Invalid:%+v\", *req)\n\t\treturn nil, \"\", utils.InvalidParamValueError\n\t}\n\n\t// 通过appId获取PullSecret\n\tauth := &model.AuthConfig{\n\t\tAppId: appId,\n\t}\n\terr = auth.Find()\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] appId:%v source:%v auth.Find err:%v\", req.AppId, req.Source, err)\n\t\treturn nil, \"\", err\n\t}\n\n\t// 校验token\n\terr = model.TokenValid(req.Token, auth.PullSecret)\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] appId:%v source:%v TokenValid err:%v\", req.AppId, req.Source, err)\n\t\treturn nil, \"\", err\n\t}\n\n\tcosAccess := &model.COSAccessTask{\n\t\tChannelId: channelId,\n\t\tAppId:     appId,\n\t\tRegion:    base.GetInstance().Region(),\n\t}\n\twl := &model.WhiteList{\n\t\tAppId:  appId,\n\t\tRegion: base.GetInstance().Region(),\n\t\tReqId:  sessionId,\n\t\tFlow:   SnapshotDownloadFlow,\n\t\tCUin:   SnapshotDownloadFlow,\n\t}\n\terr = wl.FindOne()\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] appId:%v source:%v find WhiteList err:%v\", req.AppId, req.Source, err)\n\t\treturn nil, \"\", err\n\t}\n\tif wl.Id != 0 {\n\t\tcosAccess.Uin = wl.Uin\n\t\tcosAccess.OBucket = wl.BucketId\n\t} else {\n\t\taccount := &model.Account{}\n\t\taccount.ReqId = sessionId\n\t\taccount.Flow = SnapshotDownloadFlow\n\t\taccount.CUin = account.Flow\n\t\terr = account.FindOne()\n\t\tif err != nil {\n\t\t\tl.Errorf(\"[SnapshotDownload] appId:%v source:%v find account err:%v\", req.AppId, req.Source, err)\n\t\t\treturn nil, \"\", err\n\t\t}\n\t\tcosAccess.CommonAppId = account.AppId\n\t\tcosAccess.OBucket = fmt.Sprintf(\"%v-%v-%v-%v\", account.Prefix,\n\t\t\tcosAccess.AppId, cosAccess.Region, account.AppId)\n\t}\n\tcosAccess.Name = decodedUri\n\t// 读取COS\n\terr = cosAccess.GetObjectStore()\n\tif err != nil {\n\t\tl.Errorf(\"[SnapshotDownload] appId:%v source:%v GetObjectStore err:%v\", req.AppId, req.Source, err)\n\t\treturn nil, \"\", err\n\t}\n\n\treturn cosAccess.Data, fileName, nil\n}",
    "caller": "func SnapshotDownloadHandler(svcCtx *svc.ServiceContext) http.HandlerFunc {\n\treturn func(w http.ResponseWriter, r *http.Request) {\n\t\tvar (\n\t\t\treq      types.DownloadRequest\n\t\t\tresponse types.Response\n\t\t\terr      error\n\t\t)\n\t\tlog := logx.WithContext(r.Context())\n\t\tdefer func() {\n\t\t\tresponse.RequestId = r.Header.Get(\"request_id\")\n\t\t\tif e := recover(); e != nil {\n\t\t\t\tlog.Errorw(fmt.Sprintf(\"[SnapshotDownloadHandler] recover:%v, panic:%v\", e, string(debug.Stack())), utils.ErrorField(utils.GenericError))\n\t\t\t\tresponse.Code = http.StatusInternalServerError\n\t\t\t\tresponse.StatusCode = utils.OperationErr\n\t\t\t\tresponse.Msg = utils.GenericError.EnMsg\n\t\t\t\thttpx.OkJson(w, &response)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tresponse.StatusCode = http.StatusOK\n\t\t\tresponse.Msg = \"ok\"\n\t\t\tif err != nil {\n\t\t\t\tlog.Errorw(fmt.Sprintf(\"[SnapshotDownloadHandler] operator failed: %v\", err), utils.ErrorField(err))\n\t\t\t\tresponse.StatusCode, response.Msg, response.Data = utils.ErrorMsg(err)\n\t\t\t\tif response.StatusCode >= utils.OperationErr {\n\t\t\t\t\tresponse.Code = http.StatusInternalServerError\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlog.Info(fmt.Sprintf(\"[SnapshotDownloadHandler] appId:%v source:%v operator succeed\", req.AppId, req.Source))\n\t\t\t}\n\n\t\t\thttpx.OkJson(w, &response)\n\t\t\treturn\n\t\t}()\n\n\t\tif err = httpx.Parse(r, &req); err != nil {\n\t\t\tlog.Errorw(fmt.Sprintf(\"[SnapshotDownloadHandler] httpx Parse err:%v\", err), utils.ErrorField(utils.ParamCheckError))\n\t\t\terr = utils.ParamCheckError\n\t\t\treturn\n\t\t}\n\n\t\tl := transfer.NewSnapshotDownloadLogic(r.Context(), svcCtx)\n\t\tf, filename, errTmp := l.SnapshotDownload(&req)\n\t\tif errTmp != nil {\n\t\t\terr = errTmp\n\t\t\treturn\n\t\t} else {\n\t\t\tw.WriteHeader(http.StatusOK)\n\t\t\t//w.Header().Set(\"Content-Disposition\", \"attachment; filename=\"+filename)\n\t\t\tw.Header().Set(\"Content-Type\", \"application/octet-stream\")\n\t\t\tw.Header().Set(\"Content-Disposition\", fmt.Sprintf(\"attachment; filename*=utf-8''%s\", url.QueryEscape(filename)))\n\t\t\tw.Header().Set(\"Content-Transfer-Encoding\", \"binary\")\n\t\t\tw.Write(f)\n\t\t}\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "LACK_INFORMATION",
        "variants": [
          {
            "scenario": "缺少模型定义、表名映射和字段映射配置，基于结构体名称和字段名称推测",
            "sql": "SELECT * FROM auth_config WHERE app_id = ?; SELECT * FROM white_list WHERE app_id = ? AND region = ? AND req_id = ? AND flow = ? AND c_uin = ? LIMIT 1; SELECT * FROM account WHERE req_id = ? AND flow = ? AND c_uin = ? LIMIT 1;"
          }
        ]
      },
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "WhiteList查询返回记录存在(wl.Id != 0)，跳过Account查询",
            "sql": "SELECT * FROM auth_config WHERE app_id = ?; SELECT * FROM white_list WHERE app_id = ? AND region = ? AND req_id = ? AND flow = ? AND c_uin = ? LIMIT 1;"
          },
          {
            "scenario": "WhiteList查询返回记录不存在(wl.Id == 0)，执行Account查询",
            "sql": "SELECT * FROM auth_config WHERE app_id = ?; SELECT * FROM white_list WHERE app_id = ? AND region = ? AND req_id = ? AND flow = ? AND c_uin = ? LIMIT 1; SELECT * FROM account WHERE req_id = ? AND flow = ? AND c_uin = ? LIMIT 1;"
          }
        ]
      }
    ],
    "sql_statement": "基于对代码的分析，我发现这段代码包含多个数据库操作调用，会生成多条SQL语句。\n\n## 调用者上下文分析\n\n调用者`SnapshotDownloadHandler`是一个HTTP处理函数，它：\n1. 解析HTTP请求参数到`types.DownloadRequest`结构体\n2. 调用`SnapshotDownload`函数处理业务逻辑\n3. 根据调用者的约束，只分析通过调用`SnapshotDownload`函数产生的SQL\n\n## SQL生成分析\n\n代码中包含4个数据库操作调用，会按顺序执行以下SQL语句：\n\n### SQL语句1：AuthConfig查询\n```go\nauth := &model.AuthConfig{AppId: appId}\nerr = auth.Find()\n```\n\n**生成SQL：**\n```sql\nSELECT * FROM auth_config WHERE app_id = ?;\n```\n\n### SQL语句2：WhiteList查询  \n```go\nwl := &model.WhiteList{...}\nerr = wl.FindOne()\n```\n\n**生成SQL：**\n```sql\nSELECT * FROM white_list WHERE app_id = ? AND region = ? AND req_id = ? AND flow = ? AND c_uin = ? LIMIT 1;\n```\n\n### SQL语句3：Account查询（条件执行）\n```go\nif wl.Id != 0 {\n    // 跳过Account查询\n} else {\n    account := &model.Account{}\n    // 设置查询条件\n    err = account.FindOne()\n}\n```\n\n**生成SQL（仅在wl.Id == 0时执行）：**\n```sql\nSELECT * FROM account WHERE req_id = ? AND flow = ? AND c_uin = ? LIMIT 1;\n```\n\n### SQL语句4：COSAccessTask操作\n```go\ncosAccess := &model.COSAccessTask{...}\nerr = cosAccess.GetObjectStore()\n```\n\n**生成SQL：**\n```sql\nSELECT * FROM cos_access_task WHERE channel_id = ? AND app_id = ? AND region = ? AND name = ?;\n```\n\n## 执行路径分析\n\n根据调用者上下文，存在两种执行场景：\n\n**场景1：WhiteList存在（wl.Id != 0）**\n- 执行SQL 1：查询AuthConfig\n- 执行SQL 2：查询WhiteList  \n- 跳过SQL 3：不查询Account\n- 执行SQL 4：查询COSAccessTask\n\n**场景2：WhiteList不存在（wl.Id == 0）**\n- 执行SQL 1：查询AuthConfig\n- 执行SQL 2：查询WhiteList\n- 执行SQL 3：查询Account\n- 执行SQL 4：查询COSAccessTask\n\n## 字段映射说明\n\n由于缺少具体的模型定义和表名映射配置，所有表名和字段名都是基于Go结构体名称按驼峰转下划线规则推测：\n- `AuthConfig` → `auth_config`\n- `WhiteList` → `white_list` \n- `Account` → `account`\n- `COSAccessTask` → `cos_access_task`\n- `AppId` → `app_id`\n- `ChannelId` → `channel_id`\n- `ReqId` → `req_id`",
    "verified_sql": "基于对代码的详细分析，我发现原始分析存在一些问题需要修正：\n\n## 边界条件检查\n代码中确实缺少具体的模型定义、表名映射和字段映射信息，但可以基于上下文进行合理推测。\n\n## 主要修正点\n\n1. **SQL语句数量修正**：原分析提到4条SQL，但实际上第4个`GetObjectStore()`方法从命名和上下文看应该是读取对象存储（如腾讯云COS），不是数据库操作\n2. **条件执行逻辑修正**：Account查询的条件判断应该更准确地反映代码逻辑\n3. **字段映射完善**：补充遗漏的字段映射\n\n## 修正后的JSON输出\n\n```json\n[\n  {\n    \"type\": \"LACK_INFORMATION\",\n    \"variants\": [\n      {\n        \"scenario\": \"缺少模型定义、表名映射和字段映射配置，基于结构体名称和字段名称推测\",\n        \"sql\": \"SELECT * FROM auth_config WHERE app_id = ?; SELECT * FROM white_list WHERE app_id = ? AND region = ? AND req_id = ? AND flow = ? AND c_uin = ? LIMIT 1; SELECT * FROM account WHERE req_id = ? AND flow = ? AND c_uin = ? LIMIT 1;\"\n      }\n    ]\n  },\n  {\n    \"type\": \"param_dependent\", \n    \"variants\": [\n      {\n        \"scenario\": \"WhiteList查询返回记录存在(wl.Id != 0)，跳过Account查询\",\n        \"sql\": \"SELECT * FROM auth_config WHERE app_id = ?; SELECT * FROM white_list WHERE app_id = ? AND region = ? AND req_id = ? AND flow = ? AND c_uin = ? LIMIT 1;\"\n      },\n      {\n        \"scenario\": \"WhiteList查询返回记录不存在(wl.Id == 0)，执行Account查询\",\n        \"sql\": \"SELECT * FROM auth_config WHERE app_id = ?; SELECT * FROM white_list WHERE app_id = ? AND region = ? AND req_id = ? AND flow = ? AND c_uin = ? LIMIT 1; SELECT * FROM account WHERE req_id = ? AND flow = ? AND c_uin = ? LIMIT 1;\"\n      }\n    ]\n  }\n]\n```",
    "sql_types": [
      "LACK_INFORMATION",
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/auth.go",
        "code_start_line": 20,
        "code_end_line": 28,
        "code_key": "AuthConfig",
        "code_value": "type AuthConfig struct {\n\tAppId       int    `json:\"app_id\"`\n\tPushState   int    `json:\"push_state\"`\n\tPushSecret  string `json:\"push_secret\"`\n\tPushExpired int64  `json:\"push_expired\"`\n\tPullState   int    `json:\"pull_state\"`\n\tPullSecret  string `json:\"pull_secret\"`\n\tPullExpired int64  `json:\"pull_expired\"`\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/logic/transfer/snapshotdownloadlogic.go",
        "code_start_line": 59,
        "code_end_line": 59,
        "code_key": "auth",
        "code_value": "&model.AuthConfig{\n\t\tAppId: appId,\n\t}",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "CloudSnapshotList",
    "orm_code": "func (l *CloudSnapshotListLogic) CloudSnapshotList(req *types.SnapshotRequest) (resp *types.SnapshotResponse, err error) {\n\t// 校验参数，子用户权限，构造token\n\tif len(req.ChannelId) < 1 {\n\t\tl.Errorf(\"[CloudSnapshotList] Req:%+v ChannelId empty\", *req)\n\t\treturn nil, utils.InvalidChannelIdError\n\t}\n\terr = utils.CheckUUID(req.ChannelId)\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v CheckUUID err:%v\", req.ChannelId, err)\n\t\treturn nil, utils.InvalidChannelIdError\n\t}\n\n\t// 校验时间参数\n\ttransfer.ValidateAndSetParams(req)\n\tif req.Start >= req.End {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v start big than end error\", req.ChannelId)\n\t\treturn nil, utils.TimeStartThanEndError\n\t}\n\tnow := time.Now().Unix()\n\tif req.Start >= now {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v start big than now error\", req.ChannelId)\n\t\treturn nil, utils.TimeStartThanNowError\n\t}\n\tif req.End > now {\n\t\treq.End = now\n\t}\n\n\t// 子用户账号鉴权\n\thasPermission, err := model.CheckSubUinPermission(req.ChannelId, req.SubUin)\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v CheckSubUinPermission err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\tif !hasPermission {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v CheckSubUinPermission hasPermission:%v\", req.ChannelId, hasPermission)\n\t\treturn nil, utils.AccessUnauthorizedError\n\t}\n\n\t//  图片域名从推流域名表获取domain_type=2\n\td := &model.Domain{\n\t\tAppId:      req.AppId,\n\t\tClusterId:  base.GetInstance().ClusterId(),\n\t\tDomainType: model.ImageDomainType,\n\t\tReqId:      req.RequestId,\n\t\tFlow:       transfer.SnapshotListFlow,\n\t\tCUin:       req.OwnerUin,\n\t\tCSubUin:    req.SubUin,\n\t}\n\terr = d.FindOne()\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v find imageDomain err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\n\t// 通过appId获取PullSecret\n\tauth := &model.AuthConfig{\n\t\tAppId: req.AppId,\n\t}\n\terr = auth.Find()\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v auth.Find err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\ttoken := utils.NewToken(auth.PullSecret, req.AppId, auth.PullExpired*60)\n\n\ttotal, err := model.FindSnapshotListTotalCount(req)\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v FindSnapshotListTotalCount err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\n\tpagination := model.ReqPagination(req.PageNumber, req.PageSize)\n\tresults, err := model.FindSnapshotListByPaginate(req, pagination)\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v FindSnapshotListByPaginate err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\tsnapshots := make([]types.SnapshotInfo, 0)\n\tfor _, res := range results {\n\t\tsnapshot := types.SnapshotInfo{\n\t\t\tChannelId:    res.ChannelId,\n\t\t\tFileName:     res.FileName,\n\t\t\tImageSize:    res.FileSize,\n\t\t\tDownloadUrl:  fmt.Sprintf(\"https://%v\", d.PlayDomain) + res.DownloadUrl + fmt.Sprintf(\"&token=%v\", token),\n\t\t\tCreatedTime:  utils.UnixTimestampToString(int64(res.CreatedTime)),\n\t\t\tReceivedTime: utils.UnixTimestampToString(int64(res.ReceivedTime)),\n\t\t}\n\t\tsnapshots = append(snapshots, snapshot)\n\t}\n\n\tresp = &types.SnapshotResponse{\n\t\tSnapshots: snapshots,\n\t\tTotal:     total,\n\t}\n\n\treturn resp, nil\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "LACK_INFORMATION",
        "variants": [
          {
            "scenario": "缺少model结构体的TableName()函数定义、字段映射信息和具体的FindOne()、Find()、FindSnapshotListTotalCount()、FindSnapshotListByPaginate()、CheckSubUinPermission()函数实现，基于GORM命名规范推测",
            "sql": "SELECT * FROM domains WHERE app_id = ? AND cluster_id = ? AND domain_type = ? LIMIT 1; SELECT * FROM auth_configs WHERE app_id = ?; SELECT COUNT(*) FROM snapshots WHERE channel_id = ? AND created_time >= ? AND created_time <= ?; SELECT * FROM snapshots WHERE channel_id = ? AND created_time >= ? AND created_time <= ? ORDER BY created_time DESC LIMIT ? OFFSET ?; SELECT COUNT(*) FROM user_permissions WHERE channel_id = ? AND sub_uin = ? AND status = 1;"
          }
        ]
      }
    ],
    "sql_types": [
      "LACK_INFORMATION"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/auth.go",
        "code_start_line": 20,
        "code_end_line": 28,
        "code_key": "AuthConfig",
        "code_value": "type AuthConfig struct {\n\tAppId       int    `json:\"app_id\"`\n\tPushState   int    `json:\"push_state\"`\n\tPushSecret  string `json:\"push_secret\"`\n\tPushExpired int64  `json:\"push_expired\"`\n\tPullState   int    `json:\"pull_state\"`\n\tPullSecret  string `json:\"pull_secret\"`\n\tPullExpired int64  `json:\"pull_expired\"`\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/logic/transfer/v2/cloudsnapshotlistlogic.go",
        "code_start_line": 87,
        "code_end_line": 87,
        "code_key": "auth",
        "code_value": "&model.AuthConfig{\n\t\tAppId: req.AppId,\n\t}",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "CloudSnapshotList",
    "orm_code": "func (l *CloudSnapshotListLogic) CloudSnapshotList(req *types.SnapshotRequest) (resp *types.SnapshotResponse, err error) {\n\t// 校验参数，子用户权限，构造token\n\tif len(req.ChannelId) < 1 {\n\t\tl.Errorf(\"[CloudSnapshotList] Req:%+v ChannelId empty\", *req)\n\t\treturn nil, utils.InvalidChannelIdError\n\t}\n\terr = utils.CheckUUID(req.ChannelId)\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v CheckUUID err:%v\", req.ChannelId, err)\n\t\treturn nil, utils.InvalidChannelIdError\n\t}\n\n\t// 校验时间参数\n\ttransfer.ValidateAndSetParams(req)\n\tif req.Start >= req.End {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v start big than end error\", req.ChannelId)\n\t\treturn nil, utils.TimeStartThanEndError\n\t}\n\tnow := time.Now().Unix()\n\tif req.Start >= now {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v start big than now error\", req.ChannelId)\n\t\treturn nil, utils.TimeStartThanNowError\n\t}\n\tif req.End > now {\n\t\treq.End = now\n\t}\n\n\t// 子用户账号鉴权\n\thasPermission, err := model.CheckSubUinPermission(req.ChannelId, req.SubUin)\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v CheckSubUinPermission err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\tif !hasPermission {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v CheckSubUinPermission hasPermission:%v\", req.ChannelId, hasPermission)\n\t\treturn nil, utils.AccessUnauthorizedError\n\t}\n\n\t//  图片域名从推流域名表获取domain_type=2\n\td := &model.Domain{\n\t\tAppId:      req.AppId,\n\t\tClusterId:  base.GetInstance().ClusterId(),\n\t\tDomainType: model.ImageDomainType,\n\t\tReqId:      req.RequestId,\n\t\tFlow:       transfer.SnapshotListFlow,\n\t\tCUin:       req.OwnerUin,\n\t\tCSubUin:    req.SubUin,\n\t}\n\terr = d.FindOne()\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v find imageDomain err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\n\t// 通过appId获取PullSecret\n\tauth := &model.AuthConfig{\n\t\tAppId: req.AppId,\n\t}\n\terr = auth.Find()\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v auth.Find err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\ttoken := utils.NewToken(auth.PullSecret, req.AppId, auth.PullExpired*60)\n\n\ttotal, err := model.FindSnapshotListTotalCount(req)\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v FindSnapshotListTotalCount err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\n\tpagination := model.ReqPagination(req.PageNumber, req.PageSize)\n\tresults, err := model.FindSnapshotListByPaginate(req, pagination)\n\tif err != nil {\n\t\tl.Errorf(\"[CloudSnapshotList] ChannelId:%v FindSnapshotListByPaginate err:%v\", req.ChannelId, err)\n\t\treturn nil, err\n\t}\n\tsnapshots := make([]types.SnapshotInfo, 0)\n\tfor _, res := range results {\n\t\tsnapshot := types.SnapshotInfo{\n\t\t\tChannelId:    res.ChannelId,\n\t\t\tFileName:     res.FileName,\n\t\t\tImageSize:    res.FileSize,\n\t\t\tDownloadUrl:  fmt.Sprintf(\"https://%v\", d.PlayDomain) + res.DownloadUrl + fmt.Sprintf(\"&token=%v\", token),\n\t\t\tCreatedTime:  utils.UnixTimestampToString(int64(res.CreatedTime)),\n\t\t\tReceivedTime: utils.UnixTimestampToString(int64(res.ReceivedTime)),\n\t\t}\n\t\tsnapshots = append(snapshots, snapshot)\n\t}\n\n\tresp = &types.SnapshotResponse{\n\t\tSnapshots: snapshots,\n\t\tTotal:     total,\n\t}\n\n\treturn resp, nil\n}",
    "caller": "func CloudSnapshotListHandler(svcCtx *svc.ServiceContext) http.HandlerFunc {\n\treturn func(w http.ResponseWriter, r *http.Request) {\n\t\tvar (\n\t\t\treq      types.SnapshotRequest\n\t\t\tresponse types.ResponseV2\n\t\t\terr      error\n\t\t)\n\t\tlog := logx.WithContext(r.Context())\n\t\tdefer func() {\n\t\t\tresponse.Response.RequestId = r.Header.Get(\"request_id\")\n\t\t\tif e := recover(); e != nil {\n\t\t\t\tlog.Errorw(fmt.Sprintf(\"[CloudSnapshotListHandler] recover:%v, panic:%v\", e, string(debug.Stack())), utils.ErrorField(utils.GenericError))\n\t\t\t\tresponse.Response.Error = utils.ErrorMsgV2(utils.GenericError)\n\t\t\t\thttpx.OkJson(w, &response)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tif err != nil {\n\t\t\t\tlog.Errorw(fmt.Sprintf(\"[CloudSnapshotListHandler] operator failed:%v\", err), utils.ErrorField(err))\n\t\t\t\tresponse.Response.Error = utils.ErrorMsgV2(err)\n\t\t\t\tresponse.Response.Data = nil\n\t\t\t}\n\t\t\thttpx.OkJson(w, &response)\n\t\t\treturn\n\t\t}()\n\t\tif err = httpx.Parse(r, &req); err != nil {\n\t\t\tlog.Errorw(fmt.Sprintf(\"[CloudSnapshotListHandler] httpx Parse err:%v\", err), utils.ErrorField(utils.ParamCheckError))\n\t\t\terr = utils.ParamCheckError\n\t\t\treturn\n\t\t}\n\t\tl := v2.NewCloudSnapshotListLogic(r.Context(), svcCtx)\n\t\tresp, errTmp := l.CloudSnapshotList(&req)\n\t\terr = errTmp\n\t\tresponse.Response.Data = resp.Snapshots\n\t\tresponse.Response.TotalCount = resp.Total\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "LACK_INFORMATION",
        "variants": [
          {
            "scenario": "缺少表名映射、字段映射和模型结构定义，基于代码上下文推测Domain、AuthConfig和Snapshot模型的表结构",
            "sql": "SELECT * FROM domains WHERE app_id = ? AND cluster_id = ? AND domain_type = ? LIMIT 1; SELECT * FROM auth_configs WHERE app_id = ?; SELECT COUNT(*) FROM snapshots WHERE channel_id = ? AND created_time >= ? AND created_time <= ?; SELECT * FROM snapshots WHERE channel_id = ? AND created_time >= ? AND created_time <= ? ORDER BY created_time DESC LIMIT ? OFFSET ?;"
          }
        ]
      }
    ],
    "sql_statement": "基于对代码的分析，我发现这段代码包含多个数据库查询操作。让我按照边界条件检查和SQL分析的要求进行详细分析。\n\n**第一步：边界条件判断**\n\n代码包含以下实际的数据库执行操作：\n- `d.FindOne()` - Domain模型的查询操作\n- `auth.Find()` - AuthConfig模型的查询操作  \n- `model.FindSnapshotListTotalCount(req)` - 快照总数统计查询\n- `model.FindSnapshotListByPaginate(req, pagination)` - 分页查询快照列表\n\n这些都是实际的数据库执行方法，会生成SQL语句。\n\n**第二步：SQL分析**\n\n根据调用者上下文约束，我只分析CloudSnapshotList函数中的数据库操作产生的SQL。\n\n## 执行路径分析\n\n该函数会依次执行4个数据库查询操作，每个操作都会生成对应的SQL语句：\n\n### 1. Domain查询 - d.FindOne()\n**场景**: 查询图片域名配置\n```sql\nSELECT * FROM domain WHERE app_id = ? AND cluster_id = ? AND domain_type = ? LIMIT 1;\n```\n\n### 2. AuthConfig查询 - auth.Find()  \n**场景**: 根据AppId获取认证配置\n```sql\nSELECT * FROM auth_config WHERE app_id = ?;\n```\n\n### 3. 快照总数统计 - model.FindSnapshotListTotalCount(req)\n**场景**: 统计符合条件的快照总数\n```sql\nSELECT COUNT(*) FROM snapshot WHERE channel_id = ? AND created_time >= ? AND created_time <= ?;\n```\n\n### 4. 分页查询快照列表 - model.FindSnapshotListByPaginate(req, pagination)\n**场景**: 分页获取快照详细信息\n```sql\nSELECT * FROM snapshot WHERE channel_id = ? AND created_time >= ? AND created_time <= ? ORDER BY created_time DESC LIMIT ? OFFSET ?;\n```\n\n## 最终结果\n\n```json\n{\n  \"type\": \"sequential_execution\",\n  \"variants\": [\n    {\n      \"scenario\": \"查询图片域名配置\",\n      \"sql\": \"SELECT * FROM domain WHERE app_id = ? AND cluster_id = ? AND domain_type = ? LIMIT 1;\"\n    },\n    {\n      \"scenario\": \"查询认证配置\",\n      \"sql\": \"SELECT * FROM auth_config WHERE app_id = ?;\"\n    },\n    {\n      \"scenario\": \"统计快照总数\",\n      \"sql\": \"SELECT COUNT(*) FROM snapshot WHERE channel_id = ? AND created_time >= ? AND created_time <= ?;\"\n    },\n    {\n      \"scenario\": \"分页查询快照列表\",\n      \"sql\": \"SELECT * FROM snapshot WHERE channel_id = ? AND created_time >= ? AND created_time <= ? ORDER BY created_time DESC LIMIT ? OFFSET ?;\"\n    }\n  ]\n}\n```\n\n这4条SQL语句会按顺序执行，每条都是必需的，不存在条件分支导致的SQL结构变化。所有查询都使用相同的参数结构，只是查询的表和条件不同。",
    "verified_sql": "我需要检查这个SQL分析结果。让我按照要求进行验证：\n\n**第一步：边界条件检查**\n- 分析结果没有包含`<LACK INFORMATION>:`或`<NO SQL GENERATE>:`标记\n- 代码中确实包含实际的数据库执行操作，会生成SQL语句\n- 不属于边界条件情况\n\n**第二步：正常SQL验证**\n\n检查原始分析中的问题：\n\n1. **表名验证**：原分析使用了推测的表名（domain、auth_config、snapshot），但没有提供元数据验证这些表名是否正确\n2. **字段名验证**：使用了推测的字段名，但缺少实际的字段映射信息\n3. **SQL结构验证**：分析正确识别了4个数据库操作\n4. **返回格式问题**：原分析使用了错误的JSON格式（`sequential_execution`类型不在标准格式中）\n\n由于缺少具体的表名和字段映射信息，这属于信息缺失情况。根据要求，我需要返回LACK_INFORMATION类型，并强制推测SQL语句。\n\n```json\n[{\n  \"type\": \"LACK_INFORMATION\",\n  \"variants\": [{\n    \"scenario\": \"缺少表名映射、字段映射和模型结构定义，基于代码上下文推测Domain、AuthConfig和Snapshot模型的表结构\",\n    \"sql\": \"SELECT * FROM domains WHERE app_id = ? AND cluster_id = ? AND domain_type = ? LIMIT 1; SELECT * FROM auth_configs WHERE app_id = ?; SELECT COUNT(*) FROM snapshots WHERE channel_id = ? AND created_time >= ? AND created_time <= ?; SELECT * FROM snapshots WHERE channel_id = ? AND created_time >= ? AND created_time <= ? ORDER BY created_time DESC LIMIT ? OFFSET ?;\"\n  }]\n}]\n```",
    "sql_types": [
      "LACK_INFORMATION"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/auth.go",
        "code_start_line": 20,
        "code_end_line": 28,
        "code_key": "AuthConfig",
        "code_value": "type AuthConfig struct {\n\tAppId       int    `json:\"app_id\"`\n\tPushState   int    `json:\"push_state\"`\n\tPushSecret  string `json:\"push_secret\"`\n\tPushExpired int64  `json:\"push_expired\"`\n\tPullState   int    `json:\"pull_state\"`\n\tPullSecret  string `json:\"pull_secret\"`\n\tPullExpired int64  `json:\"pull_expired\"`\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/logic/transfer/v2/cloudsnapshotlistlogic.go",
        "code_start_line": 87,
        "code_end_line": 87,
        "code_key": "auth",
        "code_value": "&model.AuthConfig{\n\t\tAppId: req.AppId,\n\t}",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "FindOne",
    "orm_code": "func (d *Domain) FindOne() error {\n\tkey := fmt.Sprintf(ImageDomainRedisKey, d.ClusterId, d.AppId)\n\terr := GetModel(key, d)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", d.Flow, d.ReqId, d.CUin, d.CSubUin, d.CAppId)\n\t\terr = db.Clauses(clause).Where(\"app_id = ? and cluster_id = ? and domain_type = ? and deleted_at is NULL\",\n\t\t\td.AppId, d.ClusterId, d.DomainType).Find(d).Error\n\t\tif err != nil && !errors.Is(err, gorm.ErrRecordNotFound) {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(key, d, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "根据不同的AppId和Region参数查询白名单记录",
            "sql": "SELECT `id`, `bucket_id`, `app_id`, `region`, `uin` FROM `ivc_bucket_whitelist` WHERE app_id = ? AND region = ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/domain.go",
        "code_start_line": 54,
        "code_end_line": 54,
        "code_key": "db",
        "code_value": "base.GetInstance().IvcDriver()",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/base/conf.go",
        "code_start_line": 67,
        "code_end_line": 69,
        "code_key": "IvcDriver",
        "code_value": "func (c *Configure) IvcDriver() *gorm.DB {\n\treturn c.ic\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/domain.go",
        "code_start_line": 55,
        "code_end_line": 55,
        "code_key": "clause",
        "code_value": "hit.NewComment(\"select\", d.Flow, d.ReqId, d.CUin, d.CSubUin, d.CAppId)",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/domain.go",
        "code_start_line": 9,
        "code_end_line": 9,
        "code_key": "hit",
        "code_value": "ipts/internal/base/db",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/base/db/db.go",
        "code_start_line": 58,
        "code_end_line": 75,
        "code_key": "NewComment",
        "code_value": "func NewComment(clause, flow, reqId, uin, subUin string, appId int) hints.Hints {\n\tif reqId == \"\" {\n\t\treqId = uuid.NewString()\n\t}\n\tif len(reqId) > 12 {\n\t\tl := len(reqId) - 12\n\t\treqId = reqId[l:]\n\t}\n\tcomment := fmt.Sprintf(\"p=%v,f=%v,o=%v\", ProductName, flow, uin)\n\tif subUin != \"\" {\n\t\tcomment += fmt.Sprintf(\",s=%v\", subUin)\n\t}\n\tif appId != 0 {\n\t\tcomment += fmt.Sprintf(\",a=%v\", appId)\n\t}\n\tcomment += fmt.Sprintf(\",i=%v\", reqId)\n\treturn hints.CommentBefore(clause, comment)\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/domain.go",
        "code_start_line": 20,
        "code_end_line": 33,
        "code_key": "Domain",
        "code_value": "type Domain struct {\n\tAppId          int    `json:\"app_id\" gorm:\"column:app_id\"`\n\tPlayDomain     string `json:\"play_domain\" gorm:\"column:play_domain\"`\n\tInternalDomain string `json:\"internal_domain\" gorm:\"column:internal_domain\"`\n\tDomainType     int    `json:\"domain_type\" gorm:\"column:domain_type\"`\n\tClusterId      string `json:\"cluster_id\" gorm:\"column:cluster_id\"`\n\n\tReqId string `json:\"-\"  gorm:\"-\"`\n\tFlow  string `json:\"-\"  gorm:\"-\"`\n\n\tCUin    string `json:\"-\" gorm:\"-\"`\n\tCSubUin string `json:\"-\" gorm:\"-\"`\n\tCAppId  int    `json:\"-\" gorm:\"-\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/domain.go",
        "code_start_line": 35,
        "code_end_line": 37,
        "code_key": "TableName",
        "code_value": "func (d *Domain) TableName() string {\n\treturn \"ivc_push_domain\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "Find",
    "orm_code": "func (ac *AuthConfig) Find() error {\n\tkey := fmt.Sprintf(AuthConfRedisKey, ac.AppId)\n\terr := GetModel(key, ac)\n\tswitch err {\n\tcase nil:\n\t\treturn nil\n\tcase redis.Nil:\n\t\terr = base.GetInstance().IvcDriver().Table(AuthConfTable).\n\t\t\tSelect(\"id,push_state,push_secret,push_expired,pull_state,pull_secret,pull_expired,app_id\").\n\t\t\tWhere(map[string]interface{}{\"appId\": ac.AppId}).Scan(ac).Error\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\terr = Set(key, ac, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "Redis缓存未命中，从数据库查询认证配置",
            "sql": "SELECT id, push_state, push_secret, push_expired, pull_state, pull_secret, pull_expired, app_id FROM ivc_auth_conf WHERE appId = ?;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/auth.go",
        "code_start_line": 7,
        "code_end_line": 7,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/auth.go",
        "code_start_line": 15,
        "code_end_line": 15,
        "code_key": "AuthConfTable",
        "code_value": "const AuthConfTable           = \"ivc_auth_conf\"",
        "code_label": 21,
        "code_type": 1,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/auth.go",
        "code_start_line": 20,
        "code_end_line": 28,
        "code_key": "AuthConfig",
        "code_value": "type AuthConfig struct {\n\tAppId       int    `json:\"app_id\"`\n\tPushState   int    `json:\"push_state\"`\n\tPushSecret  string `json:\"push_secret\"`\n\tPushExpired int64  `json:\"push_expired\"`\n\tPullState   int    `json:\"pull_state\"`\n\tPullSecret  string `json:\"pull_secret\"`\n\tPullExpired int64  `json:\"pull_expired\"`\n}",
        "code_label": null,
        "code_type": 3,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "代码使用Redis操作而非SQL数据库操作，IvcRedis().Get()执行的是Redis GET命令，不涉及关系型数据库",
            "sql": ""
          }
        ]
      }
    ],
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "func (d *Domain) FindOne() error {\n\tkey := fmt.Sprintf(ImageDomainRedisKey, d.ClusterId, d.AppId)\n\terr := GetModel(key, d)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", d.Flow, d.ReqId, d.CUin, d.CSubUin, d.CAppId)\n\t\terr = db.Clauses(clause).Where(\"app_id = ? and cluster_id = ? and domain_type = ? and deleted_at is NULL\",\n\t\t\td.AppId, d.ClusterId, d.DomainType).Find(d).Error\n\t\tif err != nil && !errors.Is(err, gorm.ErrRecordNotFound) {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(key, d, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "GetModel函数只是Redis操作的封装函数，调用Redis的Get方法进行缓存读取，不涉及任何GORM数据库操作，因此不会生成SQL语句",
            "sql": ""
          }
        ]
      }
    ],
    "sql_statement": "基于对代码的分析，我发现这个函数不会生成任何SQL语句。\n\n<NO SQL GENERATE>: GetModel函数只是一个Redis操作的封装函数，它调用的是Redis的Get方法而不是任何数据库ORM操作，因此不会生成SQL语句。虽然调用者中包含了GORM数据库操作，但GetModel函数本身只处理Redis缓存读取，不涉及SQL生成。",
    "verified_sql": "基于对代码的分析，我需要验证原始分析的准确性。\n\n**边界条件检查**：\n原始分析包含`<NO SQL GENERATE>`标记，声明GetModel函数不会生成SQL语句。\n\n**验证分析**：\n让我仔细检查GetModel函数的代码：\n\n```go\nfunc GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}\n```\n\n这个函数确实只是：\n1. 调用`IvcRedis().Get()`方法从Redis获取数据\n2. 使用`.Scan(model)`将Redis数据扫描到model中\n3. 没有任何GORM数据库操作（如Find、Create、Update、Delete等）\n\n虽然调用者`FindOne()`中包含了GORM数据库操作，但GetModel函数本身确实只处理Redis缓存读取，不涉及任何SQL生成。\n\n**结论**：\n原始分析正确。GetModel函数不会生成SQL语句，因为它只是Redis操作的封装函数。\n\n```json\n[{\n  \"type\": \"NO_SQL_GENERATE\",\n  \"variants\": [{\n    \"scenario\": \"GetModel函数只是Redis操作的封装函数，调用Redis的Get方法进行缓存读取，不涉及任何GORM数据库操作，因此不会生成SQL语句\",\n    \"sql\": \"\"\n  }]\n}]\n```",
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "func (a *Account) FindOne() error {\n\terr := GetModel(AccountRedisKey, a)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", a.Flow, a.ReqId, a.CUin, a.CSubUin, a.CAppId)\n\t\terr = db.Clauses(clause).First(a).Error\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(AccountRedisKey, a, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "sql_statement_list": [
      "SELECT `app_id`, `prefix` FROM `ivc_common_account` ORDER BY `ivc_common_account`.`app_id` LIMIT 1;"
    ],
    "sql_statement": "<NO SQL GENERATE>: GetModel函数只执行Redis缓存读取操作，使用的是Redis的Get().Scan()方法，不涉及任何数据库SQL操作，因此不会生成SQL语句",
    "verified_sql": "经过仔细分析，我发现原始分析存在严重错误。让我重新检查：\n\n**边界条件检查结果**：\n原始分析标记为`<NO SQL GENERATE>`，但这是错误的判断。\n\n**重新分析**：\n1. `GetModel`函数确实只执行Redis操作，不生成SQL\n2. 但是调用者`FindOne()`函数中包含了数据库操作：`db.Clauses(clause).First(a).Error`\n3. 这个`First(a)`操作会生成一条SELECT SQL语句\n4. 根据Account结构体的TableName()方法，表名为\"ivc_common_account\"\n5. 字段映射根据gorm column标签：app_id, prefix\n6. ReqId, Flow, CUin, CSubUin, CAppId字段有`gorm:\"-\"`标签，不会包含在SQL中\n\n**修正后的分析**：\n调用者上下文中确实会生成SQL语句，原始分析遗漏了调用者中的数据库操作。\n\n```json\n[\"SELECT `app_id`, `prefix` FROM `ivc_common_account` ORDER BY `ivc_common_account`.`app_id` LIMIT 1;\"]\n```",
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "func (wl *WhiteList) FindOne() error {\n\tregion := regionMap[wl.Region]\n\tkey := fmt.Sprintf(WhiteListRedisKey, wl.AppId, region)\n\terr := GetModel(key, wl)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", wl.Flow, wl.ReqId, wl.CUin, wl.CSubUin, wl.CAppId)\n\t\terr = db.Clauses(clause).Where(\"app_id = ? and region = ?\",\n\t\t\twl.AppId, region).Find(wl).Error\n\t\tif err != nil && !errors.Is(err, gorm.ErrRecordNotFound) {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(key, wl, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "sql_statement_list": [
      "SELECT id, bucket_id, app_id, region, uin FROM ivc_bucket_whitelist WHERE app_id = ? AND region = ?;"
    ],
    "sql_statement": "<NO SQL GENERATE>: GetModel函数是Redis操作，不是数据库ORM操作，不会生成SQL语句。该函数调用的是Redis的Get方法进行缓存查询，而不是数据库查询操作。",
    "verified_sql": "根据分析，原始判断是错误的。虽然`GetModel`函数本身确实是Redis操作，但这里需要分析的是**调用者上下文**中的SQL生成情况。\n\n在`FindOne()`方法中，当Redis缓存未命中时（`errors.Is(err, redis.Nil)`），会执行数据库查询操作：\n\n```go\ndb := base.GetInstance().IvcDriver()\nclause := hit.NewComment(\"select\", wl.Flow, wl.ReqId, wl.CUin, wl.CSubUin, wl.CAppId)\nerr = db.Clauses(clause).Where(\"app_id = ? and region = ?\", wl.AppId, region).Find(wl).Error\n```\n\n这是一个完整的GORM查询操作，会生成SQL语句。\n\n```json\n[\n  \"SELECT id, bucket_id, app_id, region, uin FROM ivc_bucket_whitelist WHERE app_id = ? AND region = ?;\"\n]\n```",
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "func (d *Domain) FindOne() error {\n\tkey := fmt.Sprintf(ImageDomainRedisKey, d.ClusterId, d.AppId)\n\terr := GetModel(key, d)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", d.Flow, d.ReqId, d.CUin, d.CSubUin, d.CAppId)\n\t\terr = db.Clauses(clause).Where(\"app_id = ? and cluster_id = ? and domain_type = ? and deleted_at is NULL\",\n\t\t\td.AppId, d.ClusterId, d.DomainType).Find(d).Error\n\t\tif err != nil && !errors.Is(err, gorm.ErrRecordNotFound) {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(key, d, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "GetModel函数只执行Redis缓存读取操作，使用IvcRedis().Get()方法，不涉及任何GORM数据库操作，因此不会生成SQL语句",
            "sql": ""
          }
        ]
      }
    ],
    "sql_statement": "<NO SQL GENERATE>: GetModel函数只是一个Redis缓存操作，使用的是Redis的Get方法而非数据库ORM操作，不会生成任何SQL语句\n\n虽然调用者FindOne函数中包含了GORM数据库操作，但根据约束要求，只分析GetModel函数本身的SQL生成能力。GetModel函数的实现是：\n\n```go\nreturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n```\n\n这是一个纯粹的Redis缓存读取操作，调用的是Redis客户端的Get方法，不涉及任何SQL数据库操作，因此不会生成SQL语句。",
    "verified_sql": "我来检查这个SQL语句分析。\n\n**第一步：边界条件检查**\n\n分析结果包含`<NO SQL GENERATE>:`标记，说明判断为不生成SQL。让我验证这个判断是否准确：\n\n1. **代码分析**：\n   ```go\n   func GetModel(key string, model interface{}) error {\n       return base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n   }\n   ```\n\n2. **操作类型验证**：\n   - 这是一个Redis缓存操作，使用的是`IvcRedis().Get()`方法\n   - 没有任何GORM数据库操作（如Find、Create、Update、Delete等）\n   - 没有数据库连接或SQL执行相关的代码\n\n3. **调用者上下文验证**：\n   - 虽然调用者`FindOne()`函数中包含GORM操作，但根据要求只分析`GetModel`函数本身\n   - `GetModel`函数确实只是Redis缓存读取，不涉及SQL生成\n\n4. **判断确认**：\n   - 确认不生成SQL的判断是准确的\n   - 这是纯粹的Redis操作，不会产生任何SQL语句\n\n```json\n[{\n  \"type\": \"NO_SQL_GENERATE\",\n  \"variants\": [{\n    \"scenario\": \"GetModel函数只执行Redis缓存读取操作，使用IvcRedis().Get()方法，不涉及任何GORM数据库操作，因此不会生成SQL语句\",\n    \"sql\": \"\"\n  }]\n}]\n```",
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "func (a *Account) FindOne() error {\n\terr := GetModel(AccountRedisKey, a)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", a.Flow, a.ReqId, a.CUin, a.CSubUin, a.CAppId)\n\t\terr = db.Clauses(clause).First(a).Error\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(AccountRedisKey, a, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "GetModel函数只执行Redis缓存读取操作，使用Redis的GET命令而非数据库SQL操作",
            "sql": ""
          }
        ]
      }
    ],
    "sql_statement": "<NO SQL GENERATE>: GetModel函数只是从Redis缓存中读取数据，使用的是Redis的GET操作而不是数据库操作，不会生成任何SQL语句。该函数调用的是`base.GetInstance().IvcRedis().Get()`方法，这是Redis客户端操作，不涉及关系型数据库的SQL生成。",
    "verified_sql": "```json\n[{\n  \"type\": \"NO_SQL_GENERATE\",\n  \"variants\": [{\n    \"scenario\": \"GetModel函数只执行Redis缓存读取操作，使用Redis的GET命令而非数据库SQL操作\",\n    \"sql\": \"\"\n  }]\n}]\n```",
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "func (wl *WhiteList) FindOne() error {\n\tregion := regionMap[wl.Region]\n\tkey := fmt.Sprintf(WhiteListRedisKey, wl.AppId, region)\n\terr := GetModel(key, wl)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", wl.Flow, wl.ReqId, wl.CUin, wl.CSubUin, wl.CAppId)\n\t\terr = db.Clauses(clause).Where(\"app_id = ? and region = ?\",\n\t\t\twl.AppId, region).Find(wl).Error\n\t\tif err != nil && !errors.Is(err, gorm.ErrRecordNotFound) {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(key, wl, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "GetModel函数只执行Redis缓存读取操作，使用Redis客户端的Get和Scan方法，不涉及任何GORM数据库操作，因此不会生成SQL语句",
            "sql": ""
          }
        ]
      }
    ],
    "sql_statement": "<NO SQL GENERATE>: GetModel函数只是对Redis的操作，使用的是Redis客户端的Get和Scan方法，不涉及任何数据库ORM操作，不会生成SQL语句。虽然调用者中包含GORM的数据库操作，但GetModel函数本身只处理Redis缓存读取。",
    "verified_sql": "根据分析，我需要验证原始判断是否正确。\n\n查看代码：\n```go\nfunc GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}\n```\n\n这个函数确实只执行Redis操作：\n- `IvcRedis().Get()` - Redis客户端的GET操作\n- `.Scan(model)` - 将Redis结果扫描到模型中\n\n没有任何GORM数据库操作（如Find、Create、Update、Delete等），也没有数据库连接或SQL执行相关的代码。\n\n虽然调用者`FindOne()`中包含GORM操作，但`GetModel`函数本身确实不会生成任何SQL语句。\n\n原始分析判断正确。\n\n```json\n[{\n  \"type\": \"NO_SQL_GENERATE\",\n  \"variants\": [{\n    \"scenario\": \"GetModel函数只执行Redis缓存读取操作，使用Redis客户端的Get和Scan方法，不涉及任何GORM数据库操作，因此不会生成SQL语句\",\n    \"sql\": \"\"\n  }]\n}]\n```",
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "func (d *Domain) FindOne() error {\n\tkey := fmt.Sprintf(ImageDomainRedisKey, d.ClusterId, d.AppId)\n\terr := GetModel(key, d)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", d.Flow, d.ReqId, d.CUin, d.CSubUin, d.CAppId)\n\t\terr = db.Clauses(clause).Where(\"app_id = ? and cluster_id = ? and domain_type = ? and deleted_at is NULL\",\n\t\t\td.AppId, d.ClusterId, d.DomainType).Find(d).Error\n\t\tif err != nil && !errors.Is(err, gorm.ErrRecordNotFound) {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(key, d, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "GetModel函数只执行Redis缓存读取操作，使用Redis客户端的Get().Scan()方法，不涉及任何数据库ORM操作",
            "sql": ""
          }
        ]
      }
    ],
    "sql_statement": "<NO SQL GENERATE>: GetModel函数只是一个Redis缓存读取操作，使用的是Redis客户端的Get().Scan()方法，不涉及任何数据库ORM操作，不会生成SQL语句。该函数的作用是从Redis缓存中根据key获取数据并反序列化到model对象中。\n\n虽然调用者FindOne()函数中包含了GORM的数据库查询操作，但根据约束要求，只分析GetModel函数本身的SQL生成能力，而GetModel函数纯粹是Redis操作，不会产生任何SQL语句。",
    "verified_sql": "我需要仔细检查这个分析结果。\n\n让我验证边界条件标记的处理：\n\n1. **分析结果包含 `<NO SQL GENERATE>:` 标记**\n2. **验证不生成SQL的判断是否准确**：\n   - 检查代码：`return base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)`\n   - 这确实是Redis操作，使用的是Redis客户端的Get().Scan()方法\n   - 没有任何GORM数据库操作（Find、Create、Update、Delete等）\n   - 没有查询构建方法\n   - 确认这是纯Redis缓存操作，不涉及SQL数据库\n\n3. **确认判断正确**：GetModel函数确实不会生成SQL语句，原始分析判断准确。\n\n根据边界条件处理规则，应该返回标准的NO_SQL_GENERATE格式：\n\n```json\n[{\n  \"type\": \"NO_SQL_GENERATE\",\n  \"variants\": [{\n    \"scenario\": \"GetModel函数只执行Redis缓存读取操作，使用Redis客户端的Get().Scan()方法，不涉及任何数据库ORM操作\",\n    \"sql\": \"\"\n  }]\n}]\n```",
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "func (a *Account) FindOne() error {\n\terr := GetModel(AccountRedisKey, a)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", a.Flow, a.ReqId, a.CUin, a.CSubUin, a.CAppId)\n\t\terr = db.Clauses(clause).First(a).Error\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(AccountRedisKey, a, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "该函数是Redis缓存操作，使用IvcRedis().Get()方法执行Redis GET命令，不是数据库ORM操作，不包含任何GORM执行方法",
            "sql": ""
          }
        ]
      }
    ],
    "sql_statement": "<NO SQL GENERATE>: 该函数是Redis缓存操作，不是数据库ORM操作，不会生成SQL语句\n\n分析说明：\n1. `GetModel`函数使用的是`IvcRedis().Get()`方法，这是Redis缓存的读取操作\n2. 该函数执行的是Redis的GET命令，不是SQL数据库操作\n3. 虽然调用者`FindOne()`中包含了数据库操作(`db.Clauses(clause).First(a).Error`)，但根据约束要求，只分析`GetModel`函数本身产生的操作\n4. `GetModel`函数本身不包含任何GORM数据库操作方法(如Find、Create、Update、Delete等)，因此不会生成SQL语句",
    "verified_sql": "我来检查这个分析结果。\n\n**第一步：边界条件检查**\n分析结果包含`<NO SQL GENERATE>:`标记，说明判断该函数不会生成SQL。\n\n**验证NO_SQL_GENERATE判断**：\n1. **代码分析**：`GetModel`函数确实只包含`base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)`\n2. **操作类型**：这是Redis缓存的GET操作，不是数据库ORM操作\n3. **方法检查**：没有任何GORM执行方法（Find、Create、Update、Delete、First、Take等）\n4. **调用者上下文**：虽然调用者`FindOne()`中有数据库操作，但按照约束要求只分析`GetModel`函数本身\n5. **判断准确性**：原始分析正确，该函数确实不会生成SQL语句\n\n**返回标准格式**：\n\n```json\n[{\n  \"type\": \"NO_SQL_GENERATE\",\n  \"variants\": [{\n    \"scenario\": \"该函数是Redis缓存操作，使用IvcRedis().Get()方法执行Redis GET命令，不是数据库ORM操作，不包含任何GORM执行方法\",\n    \"sql\": \"\"\n  }]\n}]\n```",
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "func (wl *WhiteList) FindOne() error {\n\tregion := regionMap[wl.Region]\n\tkey := fmt.Sprintf(WhiteListRedisKey, wl.AppId, region)\n\terr := GetModel(key, wl)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", wl.Flow, wl.ReqId, wl.CUin, wl.CSubUin, wl.CAppId)\n\t\terr = db.Clauses(clause).Where(\"app_id = ? and region = ?\",\n\t\t\twl.AppId, region).Find(wl).Error\n\t\tif err != nil && !errors.Is(err, gorm.ErrRecordNotFound) {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(key, wl, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "函数只包含Redis缓存操作，没有数据库ORM执行方法",
            "sql": ""
          }
        ]
      }
    ],
    "sql_statement": "<NO SQL GENERATE>: 代码只包含Redis缓存操作，没有实际的数据库ORM操作方法\n\n分析说明：\n1. `GetModel`函数只是一个Redis缓存读取操作，使用的是`IvcRedis().Get()`方法，这是Redis客户端操作，不是数据库ORM操作\n2. 虽然调用者`FindOne()`中包含了GORM数据库操作，但根据调用者上下文约束，我们只分析通过调用`GetModel`函数产生的SQL语句\n3. `GetModel`函数本身不包含任何GORM的数据库执行方法（如Find、Create、Update、Delete等），因此不会生成任何SQL语句\n4. 调用者中的数据库操作（`db.Clauses(clause).Where(...).Find(wl)`）属于调用者自身的SQL生成，不属于`GetModel`函数的分析范围",
    "verified_sql": "```json\n[{\n  \"type\": \"NO_SQL_GENERATE\",\n  \"variants\": [{\n    \"scenario\": \"函数只包含Redis缓存操作，没有数据库ORM执行方法\",\n    \"sql\": \"\"\n  }]\n}]\n```",
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "func (ac *AuthConfig) Find() error {\n\tkey := fmt.Sprintf(AuthConfRedisKey, ac.AppId)\n\terr := GetModel(key, ac)\n\tswitch err {\n\tcase nil:\n\t\treturn nil\n\tcase redis.Nil:\n\t\terr = base.GetInstance().IvcDriver().Table(AuthConfTable).\n\t\t\tSelect(\"id,push_state,push_secret,push_expired,pull_state,pull_secret,pull_expired,app_id\").\n\t\t\tWhere(map[string]interface{}{\"appId\": ac.AppId}).Scan(ac).Error\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\terr = Set(key, ac, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "GetModel函数只执行Redis缓存读取操作，使用redis.Get()方法而非数据库ORM操作，不会生成任何SQL语句",
            "sql": ""
          }
        ]
      }
    ],
    "sql_statement": "<NO SQL GENERATE>: GetModel函数只是从Redis缓存中读取数据，使用的是Redis的Get操作而不是数据库ORM操作，不会生成任何SQL语句。虽然调用者AuthConfig.Find()中包含数据库操作，但根据约束要求，只分析GetModel函数本身，该函数仅执行Redis缓存读取操作。",
    "verified_sql": "```json\n[{\n  \"type\": \"NO_SQL_GENERATE\",\n  \"variants\": [{\n    \"scenario\": \"GetModel函数只执行Redis缓存读取操作，使用redis.Get()方法而非数据库ORM操作，不会生成任何SQL语句\",\n    \"sql\": \"\"\n  }]\n}]\n```",
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "GetModel",
    "orm_code": "func GetModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().Get(context.Background(), key).Scan(model)\n}",
    "caller": "func (c *Cluster) FindById() error {\n\tkey := fmt.Sprintf(ClusterConfBaseRedisKey, c.Id)\n\terr := GetModel(key, c)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", c.Flow, c.ReqId, c.Uin, c.SubUin, c.AppId)\n\t\terr = db.Clauses(clause).First(c).Error\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(key, c, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "该函数是Redis缓存操作，使用IvcRedis().Get()方法进行键值读取，不是数据库ORM操作，不会生成SQL语句",
            "sql": ""
          }
        ]
      }
    ],
    "sql_statement": "<NO SQL GENERATE>: 该代码是Redis缓存操作，不是数据库ORM操作，不会生成SQL语句\n\n分析说明：\n1. `GetModel`函数使用的是`IvcRedis().Get()`方法，这是Redis缓存的GET操作，不是数据库查询\n2. 虽然调用者`FindById()`中包含了数据库操作`db.Clauses(clause).First(c).Error`，但这不是通过调用`GetModel`函数产生的\n3. `GetModel`函数本身只执行Redis缓存读取操作，不涉及任何SQL数据库操作\n4. Redis操作使用的是键值存储协议，不会生成SQL语句\n\n因此，`GetModel`函数不会生成任何SQL语句。",
    "verified_sql": "```json\n[{\n  \"type\": \"NO_SQL_GENERATE\",\n  \"variants\": [{\n    \"scenario\": \"该函数是Redis缓存操作，使用IvcRedis().Get()方法进行键值读取，不是数据库ORM操作，不会生成SQL语句\",\n    \"sql\": \"\"\n  }]\n}]\n```",
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "HGetModel",
    "orm_code": "func HGetModel(key, field string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().HGet(context.Background(), key, field).Scan(model)\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "这是Redis操作代码，不是数据库ORM操作，使用Redis的HGet命令而非SQL语句",
            "sql": ""
          }
        ]
      }
    ],
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "HGetAllModel",
    "orm_code": "func HGetAllModel(key string, model interface{}) error {\n\treturn base.GetInstance().IvcRedis().HGetAll(context.Background(), key).Scan(model)\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "这是一个Redis操作函数，不是数据库ORM操作，HGetAll是Redis的哈希表操作方法，用于获取Redis中哈希键的所有字段和值，不会生成任何SQL语句",
            "sql": ""
          }
        ]
      }
    ],
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "LIndexModel",
    "orm_code": "func LIndexModel(key string, index int64, m interface{}) error {\n\treturn base.GetInstance().IvcRedis().LIndex(context.Background(), key, index).Scan(m)\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "代码使用Redis操作而非关系型数据库操作，LIndex是Redis的列表索引操作，不会生成SQL语句",
            "sql": ""
          }
        ]
      }
    ],
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/redis.go",
        "code_start_line": 10,
        "code_end_line": 10,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "FindById",
    "orm_code": "func (c *Cluster) FindById() error {\n\tkey := fmt.Sprintf(ClusterConfBaseRedisKey, c.Id)\n\terr := GetModel(key, c)\n\tswitch {\n\tcase err == nil:\n\t\treturn nil\n\tcase errors.Is(err, redis.Nil):\n\t\tdb := base.GetInstance().IvcDriver()\n\t\tclause := hit.NewComment(\"select\", c.Flow, c.ReqId, c.Uin, c.SubUin, c.AppId)\n\t\terr = db.Clauses(clause).First(c).Error\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\n\t\terr = Set(key, c, Timeout10)\n\t\tif err != nil {\n\t\t\treturn err\n\t\t}\n\t\treturn nil\n\tdefault:\n\t\treturn err\n\t}\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "param_dependent",
        "variants": [
          {
            "scenario": "Redis缓存未命中时的主键查询",
            "sql": "/* p=ProductName,f=flow_value,o=uin_value,s=sub_uin_value,a=app_id_value,i=req_id_suffix */ SELECT id, region FROM ivc_cluster_conf WHERE id = ? ORDER BY id LIMIT 1;"
          }
        ]
      }
    ],
    "sql_types": [
      "PARAM_DEPENDENT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/cluster.go",
        "code_start_line": 50,
        "code_end_line": 50,
        "code_key": "db",
        "code_value": "base.GetInstance().IvcDriver()",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/base/conf.go",
        "code_start_line": 67,
        "code_end_line": 69,
        "code_key": "IvcDriver",
        "code_value": "func (c *Configure) IvcDriver() *gorm.DB {\n\treturn c.ic\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/cluster.go",
        "code_start_line": 51,
        "code_end_line": 51,
        "code_key": "clause",
        "code_value": "hit.NewComment(\"select\", c.Flow, c.ReqId, c.Uin, c.SubUin, c.AppId)",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/cluster.go",
        "code_start_line": 9,
        "code_end_line": 9,
        "code_key": "hit",
        "code_value": "ipts/internal/base/db",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/base/db/db.go",
        "code_start_line": 58,
        "code_end_line": 75,
        "code_key": "NewComment",
        "code_value": "func NewComment(clause, flow, reqId, uin, subUin string, appId int) hints.Hints {\n\tif reqId == \"\" {\n\t\treqId = uuid.NewString()\n\t}\n\tif len(reqId) > 12 {\n\t\tl := len(reqId) - 12\n\t\treqId = reqId[l:]\n\t}\n\tcomment := fmt.Sprintf(\"p=%v,f=%v,o=%v\", ProductName, flow, uin)\n\tif subUin != \"\" {\n\t\tcomment += fmt.Sprintf(\",s=%v\", subUin)\n\t}\n\tif appId != 0 {\n\t\tcomment += fmt.Sprintf(\",a=%v\", appId)\n\t}\n\tcomment += fmt.Sprintf(\",i=%v\", reqId)\n\treturn hints.CommentBefore(clause, comment)\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/cluster.go",
        "code_start_line": 20,
        "code_end_line": 29,
        "code_key": "Cluster",
        "code_value": "type Cluster struct {\n\tId     string `json:\"id\" gorm:\"primary_key\"`\n\tRegion string `json:\"region\" gorm:\"column:region\"`\n\tReqId  string `json:\"-\" gorm:\"-\"`\n\tFlow   string `json:\"-\" gorm:\"-\"`\n\n\tUin    string `json:\"-\" gorm:\"-\"`\n\tSubUin string `json:\"-\" gorm:\"-\"`\n\tAppId  int    `json:\"-\" gorm:\"-\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/cluster.go",
        "code_start_line": 31,
        "code_end_line": 33,
        "code_key": "TableName",
        "code_value": "func (c *Cluster) TableName() string {\n\treturn \"ivc_cluster_conf\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "ListByRegion",
    "orm_code": "func (wl *WhiteList) ListByRegion() ([]WhiteList, error) {\n\tvar wls []WhiteList\n\tregion := regionMap[wl.Region]\n\tclause := hit.NewComment(\"select\", wl.Flow, wl.ReqId, wl.CUin, wl.CSubUin, wl.CAppId)\n\terr := base.GetInstance().IvcDriver().Clauses(clause).Model(new(WhiteList)).Where(\"region = ?\", region).Find(&wls).Error\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\treturn wls, nil\n}",
    "caller": "",
    "sql_statement_list": [
      "/* p=ProductName,f=wl.Flow,o=wl.CUin,s=wl.CSubUin,a=wl.CAppId,i=wl.ReqId */ SELECT id, bucket_id, app_id, region, uin FROM ivc_bucket_whitelist WHERE region = ?;"
    ],
    "sql_types": [
      "OTHER"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 8,
        "code_end_line": 8,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 198,
        "code_end_line": 198,
        "code_key": "clause",
        "code_value": "hit.NewComment(\"select\", wl.Flow, wl.ReqId, wl.CUin, wl.CSubUin, wl.CAppId)",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 9,
        "code_end_line": 9,
        "code_key": "hit",
        "code_value": "ipts/internal/base/db",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/base/db/db.go",
        "code_start_line": 58,
        "code_end_line": 75,
        "code_key": "NewComment",
        "code_value": "func NewComment(clause, flow, reqId, uin, subUin string, appId int) hints.Hints {\n\tif reqId == \"\" {\n\t\treqId = uuid.NewString()\n\t}\n\tif len(reqId) > 12 {\n\t\tl := len(reqId) - 12\n\t\treqId = reqId[l:]\n\t}\n\tcomment := fmt.Sprintf(\"p=%v,f=%v,o=%v\", ProductName, flow, uin)\n\tif subUin != \"\" {\n\t\tcomment += fmt.Sprintf(\",s=%v\", subUin)\n\t}\n\tif appId != 0 {\n\t\tcomment += fmt.Sprintf(\",a=%v\", appId)\n\t}\n\tcomment += fmt.Sprintf(\",i=%v\", reqId)\n\treturn hints.CommentBefore(clause, comment)\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 144,
        "code_end_line": 155,
        "code_key": "WhiteList",
        "code_value": "type WhiteList struct {\n\tId       int    `json:\"id\" gorm:\"primary_key\"`\n\tBucketId string `json:\"bucket_id\" gorm:\"column:bucket_id\"`\n\tAppId    int    `json:\"app_id\" gorm:\"column:app_id\"`\n\tRegion   string `json:\"region\" gorm:\"column:region\"`\n\tUin      string `json:\"uin\" gorm:\"column:uin\"`\n\tReqId    string `json:\"-\"  gorm:\"-\"`\n\tFlow     string `json:\"-\"  gorm:\"-\"`\n\tCUin     string `json:\"-\"  gorm:\"-\"`\n\tCSubUin  string `json:\"-\"  gorm:\"-\"`\n\tCAppId   int    `json:\"-\"  gorm:\"-\"`\n}",
        "code_label": 3,
        "code_type": 3,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 157,
        "code_end_line": 159,
        "code_key": "TableName",
        "code_value": "func (wl *WhiteList) TableName() string {\n\treturn \"ivc_bucket_whitelist\"\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 197,
        "code_end_line": 197,
        "code_key": "region",
        "code_value": "regionMap[wl.Region]",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 21,
        "code_end_line": 57,
        "code_key": "regionMap",
        "code_value": "var regionMap = map[string]string{\n\t\t\"ap-shanghai\":           \"1\",\n\t\t\"ap-guangzhou\":          \"2\",\n\t\t\"ap-beijing-1\":          \"3\",\n\t\t\"ap-singapore\":          \"4\",\n\t\t\"ap-chengdu\":            \"5\",\n\t\t\"ap-hongkong\":           \"6\",\n\t\t\"ap-toronto\":            \"7\",\n\t\t\"ap-frankfurt\":          \"8\",\n\t\t\"ap-beijing\":            \"9\",\n\t\t\"ap-seoul\":              \"10\",\n\t\t\"ap-mumbai\":             \"11\",\n\t\t\"ap-ashburn\":            \"12\",\n\t\t\"ap-siliconvalley\":      \"13\",\n\t\t\"ap-bangkok\":            \"14\",\n\t\t\"ap-moscow\":             \"15\",\n\t\t\"ap-tokyo\":              \"16\",\n\t\t\"ap-shenzhen-fsi\":       \"17\",\n\t\t\"ap-shanghai-fsi\":       \"18\",\n\t\t\"ap-nanjing\":            \"19\",\n\t\t\"ap-taipei\":             \"20\",\n\t\t\"ap-ap-beijing-fsi\":     \"21\",\n\t\t\"ap-p-shanghai-fsi-3\":   \"22\",\n\t\t\"ap-qingyuan\":           \"23\",\n\t\t\"ap-guangzhou-dev\":      \"42\",\n\t\t\"ap-chongqing-dev\":      \"25\",\n\t\t\"ap-tianjin-dev\":        \"26\",\n\t\t\"ap-jakarta\":            \"27\",\n\t\t\"ap-nanjing-dev\":        \"28\",\n\t\t\"ap-shanghai-dev\":       \"29\",\n\t\t\"ap-qingyuan-xinan\":     \"30\",\n\t\t\"ap-saopaulo\":           \"31\",\n\t\t\"ap-shanghai-adc\":       \"32\",\n\t\t\"ap-beijing-cdz-tmap-1\": \"33\",\n\t\t\"ap-guangzhou-2\":        \"102\",\n\t\t\"ap-chongqing\":          \"109\",\n\t}",
        "code_label": null,
        "code_type": 1,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/base/conf.go",
        "code_start_line": 87,
        "code_end_line": 89,
        "code_key": "Region",
        "code_value": "func (c *Configure) Region() string {\n\treturn c.cc.Region\n}",
        "code_label": null,
        "code_type": 2,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 196,
        "code_end_line": 196,
        "code_key": "wls",
        "code_value": "[]WhiteList",
        "code_label": null,
        "code_type": 31,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "CheckSubUinPermission",
    "orm_code": "func CheckSubUinPermission(channelId, subUin string) (bool, error) {\n\t// 定义 SQL 查询语句\n\tquery := \"SELECT COUNT(*) AS has_permission FROM ivc_user_resource ur \" +\n\t\t\"JOIN ivc_channel c ON ur.device_id = c.device_id WHERE c.id = ? AND ur.sub_uin = ?;\"\n\tval := make([]interface{}, 0)\n\tval = append(val, channelId, subUin)\n\tvar count int\n\terr := base.GetInstance().IvcDriver().Raw(query, val...).Scan(&count).Error\n\tif err != nil {\n\t\treturn false, err\n\t}\n\n\t// 判断是否有权限\n\treturn count > 0, nil\n}",
    "caller": "",
    "sql_statement_list": [
      "SELECT COUNT(*) AS has_permission FROM ivc_user_resource ur JOIN ivc_channel c ON ur.device_id = c.device_id WHERE c.id = ? AND ur.sub_uin = ?;"
    ],
    "sql_types": [
      "SELECT"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 8,
        "code_end_line": 8,
        "code_key": "base",
        "code_value": "ipts/internal/base",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 209,
        "code_end_line": 209,
        "code_key": "query",
        "code_value": "\"SELECT COUNT(*) AS has_permission FROM ivc_user_resource ur \" +\n\t\t\"JOIN ivc_channel c ON ur.device_id = c.device_id WHERE c.id = ? AND ur.sub_uin = ?;\"",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 211,
        "code_end_line": 211,
        "code_key": "val",
        "code_value": "make([]interface{}, 0)",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/account.go",
        "code_start_line": 213,
        "code_end_line": 213,
        "code_key": "count",
        "code_value": "int",
        "code_label": null,
        "code_type": 31,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 1,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  },
  {
    "function_name": "FindSnapshotListByPaginate",
    "orm_code": "func FindSnapshotListByPaginate(req *types.SnapshotRequest, pagination *Pagination) ([]types.SnapshotSource, error) {\n\tcollection := base.GetInstance().IvcMongo().Database(base.GetInstance().MetaDataDBName()).Collection(collectionName)\n\n\t// 计算跳过的文档数量\n\tskip := (pagination.Page - 1) * pagination.Size\n\n\t// 构建查询选项\n\tfindOptions := options.Find().SetSkip(skip).SetLimit(pagination.Size).\n\t\tSetSort(bson.D{{Key: \"received_time\", Value: -1}}) // 按创建时间倒序\n\tfilter := bson.M{\n\t\t\"channel_id\": req.ChannelId,\n\t\t\"received_time\": bson.M{\n\t\t\t\"$ge\": req.Start,\n\t\t\t\"$le\": req.End,\n\t\t},\n\t}\n\n\t// 执行查询\n\tctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)\n\tdefer cancel()\n\tcursor, err := collection.Find(ctx, filter, findOptions)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"find failed: %v\", err)\n\t}\n\tdefer cursor.Close(ctx)\n\n\tvar results []types.SnapshotSource\n\tif err = cursor.All(ctx, &results); err != nil {\n\t\treturn nil, fmt.Errorf(\"decode failed: %v\", err)\n\t}\n\n\treturn results, nil\n}",
    "caller": "",
    "sql_statement_list": [
      {
        "type": "NO_SQL_GENERATE",
        "variants": [
          {
            "scenario": "这是MongoDB代码，使用go.mongodb.org/mongo-driver/mongo包进行MongoDB操作，而不是基于GORM框架的SQL数据库ORM操作，因此不会生成SQL语句",
            "sql": ""
          }
        ]
      }
    ],
    "sql_types": [
      "NO_SQL_GENERATE"
    ],
    "code_meta_data": [
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/snapshot.go",
        "code_start_line": 16,
        "code_end_line": 16,
        "code_key": "options",
        "code_value": "go.mongodb.org/mongo-driver/mongo/options",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/snapshot.go",
        "code_start_line": 132,
        "code_end_line": 132,
        "code_key": "collection",
        "code_value": "base.GetInstance().IvcMongo().Database(base.GetInstance().MetaDataDBName()).Collection(collectionName)",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/snapshot.go",
        "code_start_line": 20,
        "code_end_line": 20,
        "code_key": "collectionName",
        "code_value": "const collectionName     = \"ivc_snapshots\"",
        "code_label": 21,
        "code_type": 1,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/snapshot.go",
        "code_start_line": 149,
        "code_end_line": 149,
        "code_key": "ctx",
        "code_value": "context.WithTimeout(context.Background(), 10*time.Second)",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/snapshot.go",
        "code_start_line": 4,
        "code_end_line": 4,
        "code_key": "context",
        "code_value": "context",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/snapshot.go",
        "code_start_line": 6,
        "code_end_line": 6,
        "code_key": "time",
        "code_value": "time",
        "code_label": null,
        "code_type": 4,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/snapshot.go",
        "code_start_line": 140,
        "code_end_line": 140,
        "code_key": "filter",
        "code_value": "bson.M{\n\t\t\"channel_id\": req.ChannelId,\n\t\t\"received_time\": bson.M{\n\t\t\t\"$ge\": req.Start,\n\t\t\t\"$le\": req.End,\n\t\t},\n\t}",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      },
      {
        "code_file": "/Users/ymhuan/code/aid-db/temp/aid-main/aid/risk_sql/code/scripts/IVC__ipts/internal/model/snapshot.go",
        "code_start_line": 138,
        "code_end_line": 138,
        "code_key": "findOptions",
        "code_value": "options.Find().SetSkip(skip).SetLimit(pagination.Size).\n\t\tSetSort(bson.D{{Key: \"received_time\", Value: -1}})",
        "code_label": null,
        "code_type": 35,
        "code_version": "12f635a0f43324755f4683f7af672284d6bb32f0"
      }
    ],
    "sql_pattern_cnt": 2,
    "source_file": "/data/shawn/venus_api/orm2sql/ivc_temp/IVC__ipts.json"
  }
]