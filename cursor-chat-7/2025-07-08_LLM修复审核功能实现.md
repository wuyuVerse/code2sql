# 2025-07-08 LLM 修复审核功能实现

## 主题
将数据清洗工作流 `_apply_fix_recommendations()` 集成 **LLM 实时审核**，并统一将所有异步调用并发上限提升至 **200**。

## 主要需求
1. 并发上限统一 200（`Semaphore` / `max_concurrent`）
2. 修复应用阶段新增 LLM 审核：
   - 仅两种结果：`accepted` / `rejected`
   - 若 `rejected`，LLM 返回 `replacement` 供系统直接使用
3. 统计日志增加 `accepted_fix_count`、`rejected_fix_count`

## 关键改动
| 文件 | 变更 | 说明 |
|------|------|------|
| `config/data_clean/fix_review_prompts.py` | **新建** | 含 `REMOVAL_REVIEW_PROMPT`、`ADDITION_REVIEW_PROMPT` 两个模板 |
| `data_processing/cleaning/redundant_sql_validator.py` | **1 行** | 默认 `max_concurrent` 改为 200 |
| `data_processing/workflow/workflow_manager.py` | **≈140 行** | 1) 新增 `_llm_review_fix_sync()`<br>2) 在 `_apply_fix_recommendations()` 插桩审核逻辑<br>3) 并发值改 200，新增统计输出 |

## 审核逻辑
```python
review = self._llm_review_fix_sync(orm_code, caller, action, sql_text)
if review['accepted']:
    # 正常落地修复
else:
    replacement = review['replacement']  # 转入 add_missing_map 或替换原值
```

## 日志示例
```
修复应用完成:
  - 删除冗余SQL: 45 个
  - 删除错误新增SQL: 12 个
  - 添加缺失SQL: 30 个
  - 修改记录数: 58
  - accepted_fix_count: 55
  - rejected_fix_count: 3
```

## 后续改进
- 失败回滚脚本自动生成
- LLM 异常时的重试与降级策略
- 进一步细化统计与质量评分 