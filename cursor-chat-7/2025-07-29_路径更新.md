# 2025-07-29 路径更新任务

## 任务描述
用户要求检查config文件夹下的所有路径，确认根目录位置变化为`/data/cloud_disk_1/home/wuyu/code2sql`，并更新相关配置文件中的路径。

## 检查结果

### 需要更新的文件列表：

1. **config/rl/qwen/qwen2_14b_rf.yaml** - 包含多个硬编码路径
2. **config/rl/qwen/zuowei.sh** - 包含多个硬编码路径  
3. **config/training/qwen/qwen3_14b_ft.yaml** - 包含模型路径
4. **config/training/qwen/qwen3_14b_ft_full.yaml** - 包含模型路径
5. **config/training/qwen/qwen3_14b_ft_gpu4567.yaml** - 包含模型路径

### 具体需要更新的路径：

**在 `config/rl/qwen/qwen2_14b_rf.yaml` 中：**
- 第37行：`path: "/home/wuyu/code2sql/saves/v5-tmp"` → `/data/cloud_disk_1/home/wuyu/code2sql/saves/v5-tmp`
- 第77行：`path: "/home/wuyu/code2sql/model/rl/code2sql_reward_v2.py"` → `/data/cloud_disk_1/home/wuyu/code2sql/model/rl/code2sql_reward_v2.py`
- 第37行：`data.train_files: " /home/wuyu/code2sql/model/data/orm2sql_rl_data/..."` → `/data/cloud_disk_1/home/wuyu/code2sql/model/data/orm2sql_rl_data/...`
- 第38行：`data.val_files: " /home/wuyu/code2sql/model/data/orm2sql_rl_data/..."` → `/data/cloud_disk_1/home/wuyu/code2sql/model/data/orm2sql_rl_data/...`
- 第89行：`default_local_dir: "/home/wuyu/code2sql/saves/rl/checkpoints"` → `/data/cloud_disk_1/home/wuyu/code2sql/saves/rl/checkpoints`
- 第95行：`HF_MODULES_CACHE: "/home/wuyu/code2sql/saves/rl/hf_modules_cache"` → `/data/cloud_disk_1/home/wuyu/code2sql/saves/rl/hf_modules_cache`
- 第96行：`TRANSFORMERS_CACHE: "/home/wuyu/code2sql/saves/rl/transformers_cache"` → `/data/cloud_disk_1/home/wuyu/code2sql/saves/rl/transformers_cache`
- 第97行：`HF_HOME: "/home/wuyu/code2sql/saves/rl/huggingface"` → `/data/cloud_disk_1/home/wuyu/code2sql/saves/rl/huggingface`
- 第99行：`VERL_SAVE_DIR: "/home/wuyu/code2sql/saves/rl"` → `/data/cloud_disk_1/home/wuyu/code2sql/saves/rl`

**在 `config/rl/qwen/zuowei.sh` 中：**
- 第3行：`export PYTHONPATH="/data/local_disk3/zuowei/verl-main:$PYTHONPATH"` → `/data/cloud_disk_1/home/wuyu/code2sql/verl-main`
- 第15行：`LOG_DIR="/data/local_disk3/zuowei/logs"` → `/data/cloud_disk_1/home/wuyu/code2sql/logs`
- 第25行：`data.train_files=/data/local_disk3/zuowei/verl_train_dataset_train_no_think.parquet` → `/data/cloud_disk_1/home/wuyu/code2sql/verl_train_dataset_train_no_think.parquet`
- 第26行：`data.val_files=/data/local_disk3/zuowei/verl_train_dataset_val_no_think.parquet` → `/data/cloud_disk_1/home/wuyu/code2sql/verl_train_dataset_val_no_think.parquet`
- 第32行：`actor_rollout_ref.model.path=/data/local_disk3/zuowei/models/Qwen3-32B` → `/data/cloud_disk_1/home/wuyu/code2sql/models/Qwen3-32B`
- 第58行：`custom_reward_function.path=/data/local_disk3/zuowei/verl-main/reward_lib/composite_reward.py` → `/data/cloud_disk_1/home/wuyu/code2sql/verl-main/reward_lib/composite_reward.py`

**在训练配置文件中：**
- `config/training/qwen/qwen3_14b_ft.yaml` 第2行：`model_path: /data/local_disk0/wuyu/model/qwen/Qwen3-14B` → `/data/cloud_disk_1/home/wuyu/code2sql/model/qwen/Qwen3-14B`
- `config/training/qwen/qwen3_14b_ft_full.yaml` 第2行：`model_path: /data/local_disk0/wuyu/model/qwen/Qwen3-14B` → `/data/cloud_disk_1/home/wuyu/code2sql/model/qwen/Qwen3-14B`
- `config/training/qwen/qwen3_14b_ft_gpu4567.yaml` 第2行：`model_path: /data/local_disk0/wuyu/model/qwen/Qwen3-14B` → `/data/cloud_disk_1/home/wuyu/code2sql/model/qwen/Qwen3-14B`

## 更新方案
所有路径都需要从原来的根目录更新为新的根目录：`/data/cloud_disk_1/home/wuyu/code2sql`

## 状态
- [x] 完成config文件夹全面检查
- [x] 识别需要更新的文件和路径
- [x] 制定更新方案
- [x] 等待用户确认开始更新
- [x] 执行路径更新操作

## 更新完成
所有路径已成功更新为新的根目录：`/data/cloud_disk_1/home/wuyu/code2sql`

### 已更新的文件：
1. ✅ config/rl/qwen/qwen2_14b_rf.yaml - 更新了9个路径
2. ✅ config/rl/qwen/zuowei.sh - 更新了6个路径
3. ✅ config/training/qwen/qwen3_14b_ft.yaml - 更新了1个路径
4. ✅ config/training/qwen/qwen3_14b_ft_full.yaml - 更新了1个路径
5. ✅ config/training/qwen/qwen3_14b_ft_gpu4567.yaml - 更新了1个路径

总计更新了18个路径配置。

## 第二阶段：data_processing文件夹路径检查

### 发现的硬编码路径：

1. **data_processing/make_data.py** 第45行：
   - `FULL_SCENARIO_PATH = "/data/local_disk0/shawn/api_benchmark/evaluate/full_scenario.json"`
   - 需要更新为：`/data/cloud_disk_1/home/wuyu/code2sql/full_scenario.json`

2. **data_processing/synthetic_data_generator/get_sql.py** 第1000-1001行：
   - `input_file = '/data/local_disk0/shawn/api_benchmark/evaluate/const_scenarios.json'`
   - `output_file = '/data/local_disk0/shawn/api_benchmark/evaluate/const_scenarios_sql.json'`
   - 需要更新为：`/data/cloud_disk_1/home/wuyu/code2sql/const_scenarios.json` 和 `/data/cloud_disk_1/home/wuyu/code2sql/const_scenarios_sql.json`

3. **config/data_processing/validation/rerun_config.yaml** 第1行：
   - `input_file: /home/wuyu/code2sql/workflow_output/workflow_20250703_155430/final_processed_dataset.json`
   - 需要更新为：`/data/cloud_disk_1/home/wuyu/code2sql/workflow_output/workflow_20250703_155430/final_processed_dataset.json`

### 建议的配置化方案：

1. **创建路径配置文件**：在 `config/data_processing/` 下创建 `paths.yaml`
2. **将硬编码路径移到配置文件**：
   - 数据文件路径
   - 输出文件路径
   - 工作流输出路径
   - 模型路径等

### 需要修改的文件：
1. data_processing/make_data.py
2. data_processing/synthetic_data_generator/get_sql.py  
3. config/data_processing/validation/rerun_config.yaml

## 第二阶段更新完成
所有data_processing文件夹中的硬编码路径已成功更新为新的根目录：`/data/cloud_disk_1/home/wuyu/code2sql`

### 已更新的文件：
1. ✅ data_processing/make_data.py - 更新了1个路径
2. ✅ data_processing/synthetic_data_generator/get_sql.py - 更新了2个路径
3. ✅ config/data_processing/validation/rerun_config.yaml - 更新了1个路径

总计更新了4个路径配置。

## 第三阶段：model文件夹路径检查

### 发现的硬编码路径：

1. **model/rl/outputs/2025-07-21/15-25-39/.hydra/overrides.yaml** 和 **hydra.yaml**：
   - 包含多个 `/home/wuyu/code2sql/` 路径
   - 包含 `/data/local_disk0/shawn/github/verl/verl/trainer/config` 路径

2. **model/training/LLaMA-Factory/swanlog/** 目录下的配置文件：
   - 包含 `/data/local_disk0/wuyu/model/qwen/Qwen3-14B` 路径

3. **model/training/logs/** 目录下的日志文件：
   - 包含 `/home/wuyu/code2sql/` 和 `/data/local_disk0/wuyu/model/qwen/Qwen3-14B` 路径

### 需要更新的路径：

1. **model/rl/outputs/** 目录下的配置文件：
   - 将 `/home/wuyu/code2sql/` 更新为 `/data/cloud_disk_1/home/wuyu/code2sql/`
   - 将 `/data/local_disk0/shawn/github/verl/verl/trainer/config` 更新为 `/data/cloud_disk_1/home/wuyu/code2sql/verl/verl/trainer/config`

2. **model/training/LLaMA-Factory/swanlog/** 目录下的配置文件：
   - 将 `/data/local_disk0/wuyu/model/qwen/Qwen3-14B` 更新为 `/data/cloud_disk_1/home/wuyu/code2sql/model/qwen/Qwen3-14B`

### 注意事项：
- 大部分发现的路径都在日志文件和输出文件中，这些是历史记录，不需要修改
- 主要需要关注的是配置文件和脚本中的硬编码路径
- 建议只更新实际影响运行的配置文件，不更新历史日志文件 