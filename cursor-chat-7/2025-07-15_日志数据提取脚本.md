# 2025-07-15 日志数据提取脚本

## 任务描述
用户需要从日志文件中提取数据，数据格式为：`function_name`, `orm_code`, `caller`, `code_meta_data`, `source_file`, `code_line` 的JSON格式。

## 问题分析
1. 日志文件很大（38,552行），包含大量的系统日志信息
2. 需要提取的关键信息在 "Try to call backend code2sql for prompt" 行中
3. 日志中没有行号信息（code_line），只有文件路径
4. 部分记录的 source_file 可能为 null 或空

## 解决方案
创建了 `extract_log_data.py` 脚本，具备以下功能：

### 主要功能
1. **函数名提取**：从ORM代码块中提取函数名
2. **ORM代码提取**：从提示内容中提取完整的ORM代码块
3. **调用者信息提取**：提取调用者信息（如果存在）
4. **元数据提取**：提取代码元数据信息
5. **源文件提取**：从API请求中提取文件路径
6. **数据过滤**：过滤掉 source_file 为空的记录

### 关键特性
- 使用正则表达式精确匹配数据模式
- 向前查找API请求行来获取 source_file 信息
- 自动过滤无效数据
- 输出JSON格式，便于后续处理
- 提供详细的统计信息

## 执行结果
- **总记录数**：235条原始记录
- **有效记录数**：134条（过滤后）
- **过滤掉的记录**：101条（source_file为空）
- **输出文件**：`extracted_data.json`

## 数据格式示例
```json
{
  "function_name": "DeleteGBinviteWhitelist",
  "orm_code": "func (c *GBinvite) DeleteGBinviteWhitelist() error {...}",
  "caller": null,
  "code_meta_data": "type GBinvite struct {...}",
  "source_file": "https://git.woa.com/IVC/ivc-urs/blob/c9bb087a681a6287be10c9b6e8e232a6cfc363c7/internal/model/gbinvite.go",
  "code_line": null
}
```

## 技术要点
1. **正则表达式优化**：使用精确的模式匹配提取数据
2. **错误处理**：处理文件不存在、编码错误等异常情况
3. **性能优化**：只查找前100行来匹配API请求，避免全文件扫描
4. **数据验证**：确保提取的数据完整性

## 后续改进建议
1. 可以添加更多的数据验证规则
2. 可以支持批量处理多个日志文件
3. 可以添加数据导出为其他格式的功能
4. 可以添加更详细的错误日志记录 