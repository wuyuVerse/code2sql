# 2025-07-22 解决ORM提示词格式化错误

## 问题描述

在运行合成数据生成器时，遇到 `Replacement index 0 out of range for positional args tuple` 错误，该错误发生在ORM代码生成阶段，具体是在格式化 `PROMPT_ORM_IF_ELSE_CALLER` 模板时。

## 问题分析

通过添加调试输出，发现错误发生在以下代码段：
```python
orm_prompt = PROMPT_ORM_IF_ELSE_CALLER.format(
    example=example_str,
    **var_names
)
```

调试输出显示：
- `var_names` 参数正常，包含了所有需要的命名参数
- `example_str` 参数也正常
- 错误发生在字符串格式化过程中

## 根本原因

在 `config/data_processing/synthetic_data_generator/prompts.py` 文件中，`PROMPT_ORM_IF_ELSE_CALLER` 模板包含了Go语言类型声明 `map[string]interface{}`：

```python
8. ORM方法必须接收map[string]interface{}类型的filter参数
```

在Python的字符串格式化中，大括号 `{}` 被解释为格式化占位符。当模板中同时存在命名参数（如 `{method_examples}`）和字面量大括号时，会导致格式化冲突，产生 `Replacement index 0 out of range for positional args tuple` 错误。

## 解决方案

将模板中的 `map[string]interface{}` 改为 `map[string]interface{{}}`，这样双大括号会被解释为字面量的大括号，而不是格式化占位符。

### 修复的文件

**config/data_processing/synthetic_data_generator/prompts.py**

修复了两个位置：
1. 第68行：`8. ORM方法必须接收map[string]interface{}类型的filter参数`
2. 第142行：`4. filter参数必须是map[string]interface{}类型`

都改为使用双大括号：
```python
8. ORM方法必须接收map[string]interface{{}}类型的filter参数
4. filter参数必须是map[string]interface{{}}类型
```

## 验证结果

通过测试确认格式化现在可以正常工作：
```python
result = PROMPT_ORM_IF_ELSE_CALLER.format(example='test example', **var_names)
print('Formatting successful')  # 成功输出
```

## 技术要点

1. **Python字符串格式化**：在字符串模板中，单个大括号 `{}` 是格式化占位符，双大括号 `{{}}` 是字面量大括号
2. **Go语言类型声明**：`map[string]interface{}` 在Go中是有效的类型声明，但在Python字符串格式化中需要特殊处理
3. **调试技巧**：通过添加try-catch和调试输出来定位具体的格式化错误位置

## 经验总结

在处理包含其他编程语言语法的字符串模板时，需要特别注意大括号的转义处理，避免与Python的字符串格式化语法冲突。 