# 2025-07-07 verl环境配置

## 任务概述
在 `/rl/model/rl` 目录下克隆 verl 仓库，并按照官方文档配置 Python 3.10 环境。

## 执行步骤

### 1. 克隆仓库
```bash
cd model/rl
git clone https://github.com/volcengine/verl.git
```

### 2. 创建Python 3.10虚拟环境
```bash
cd verl
uv venv --python python3.10 .venv-verl
```

### 3. 解决pip版本问题
- 使用 `python -m pip` 替代 `pip` 确保使用正确的Python版本
- 通过 `python -m ensurepip --upgrade` 安装pip到虚拟环境
- 创建pip符号链接：`ln -sf pip3 pip`

### 4. 修改安装脚本
修改 `scripts/install_vllm_sglang_mcore.sh`：
- 将所有 `pip install` 改为 `python -m pip install`
- 将flashinfer下载部分改为使用本地文件
- 注释掉网络下载，直接使用本地 `flashinfer_python-0.2.2.post1+cu124torch2.6-cp38-abi3-linux_x86_64.whl`

### 5. 创建激活脚本
创建 `activate_verl.sh` 用于快速激活环境。

## 环境信息
- Python版本：3.10.14
- 系统CUDA版本：12.2
- GPU：8张NVIDIA H20
- 虚拟环境路径：`/home/wuyu/code2sql/model/rl/verl/.venv-verl`

## 使用方法
```bash
# 激活环境
source activate_verl.sh

# 运行安装脚本（FSDP版本，不包含Megatron）
USE_MEGATRON=0 bash scripts/install_vllm_sglang_mcore.sh

# 安装verl
python -m pip install --no-deps -e .
```

## 遇到的问题及解决方案
1. **Python版本兼容性**：uv默认使用Python 3.13，但verl需要Python 3.10
   - 解决：明确指定 `--python python3.10`
2. **pip版本问题**：虚拟环境中的pip指向系统版本
   - 解决：使用 `python -m pip` 确保使用虚拟环境的pip
3. **网络下载问题**：flashinfer包下载失败
   - 解决：手动下载并修改脚本使用本地文件

## 下一步
- 运行修改后的安装脚本
- 安装verl包
- 验证环境配置 