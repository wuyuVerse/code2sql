# 场景优化总结

## 修改内容

### 1. 场景分离
将原来的`where_condition_with_fixed_values`场景分离为两个独立场景：

#### 1.1 `where_condition_with_fixed_values` - 纯固定条件
- **场景描述**：ORM方法在where条件中直接指定了具体的值，而不是通过参数传递
- **特征**：只包含固定条件，如`status=0`, `deleted_at IS NULL`等
- **用途**：用于过滤有效数据、排除特定值等基础过滤

#### 1.2 `where_condition_mixed` - 混合条件
- **场景描述**：ORM方法在where条件中同时包含固定值和动态条件
- **特征**：包含固定条件+if-else等动态条件判断
- **用途**：固定条件用于基础过滤，动态条件根据传入参数进行灵活查询

### 2. 提示词优化

#### 2.1 固定条件场景提示词
- **ORM提示词**：`PROMPT_ORM_WHERE_FIXED_VALUES`
- **Caller提示词**：`PROMPT_CALLER_WHERE_FIXED_VALUES`
- **特点**：强调固定值的直接写入，不需要参数传递

#### 2.2 混合条件场景提示词
- **ORM提示词**：`PROMPT_ORM_WHERE_MIXED`
- **Caller提示词**：`PROMPT_CALLER_WHERE_MIXED`
- **特点**：强调固定条件+动态条件的组合逻辑

### 3. 配置更新

#### 3.1 `config.py`场景描述更新
```python
"where_condition_with_fixed_values": "ORM方法在where条件中直接指定了具体的值，而不是通过参数传递。这些值在代码中是固定的，通常用于过滤有效数据、排除特定值等。例如：status=0（有效状态）, income_industry_id<>0（非空行业ID）, deleted_at IS NULL（未删除记录）等",
"where_condition_mixed": "ORM方法在where条件中同时包含固定值和动态条件。固定值直接在代码中指定（如status=0, deleted_at IS NULL），同时包含if-else等动态条件判断。固定条件用于基础过滤，动态条件根据传入参数进行灵活查询",
```

#### 3.2 `prompts.py`新增提示词
- 添加了`PROMPT_ORM_WHERE_MIXED`和`PROMPT_CALLER_WHERE_MIXED`
- 修复了`PROMPT_CALLER_WHERE_FIXED_VALUES`的描述

## 技术细节

### 1. 场景识别逻辑
在`get_sql.py`中的`identify_orm_scenario`函数需要更新，以正确识别这两种场景：

```python
def identify_orm_scenario(function_info):
    scenario = function_info.get('scenario', '')
    
    if scenario == 'where_condition_with_fixed_values':
        return 'where_condition_with_fixed_values', CODE_ORM_MYSQL_SQL_EXTRACT
    elif scenario == 'where_condition_mixed':
        return 'where_condition_mixed', CODE_ORM_MYSQL_SQL_EXTRACT
    # ... 其他场景
```

### 2. SQL生成逻辑
- **固定条件场景**：生成包含固定值的SQL，如`WHERE status = 0 AND deleted_at IS NULL`
- **混合条件场景**：生成包含固定值+动态条件的SQL，如`WHERE status = 0 AND deleted_at IS NULL AND type_id = ?`

## 使用建议

### 1. 场景选择
- **纯固定条件**：适用于基础的数据过滤，如查询有效记录、排除已删除数据等
- **混合条件**：适用于需要基础过滤+灵活查询的场景，如查询有效记录并按条件筛选

### 2. 代码生成
- 确保生成的ORM代码符合场景特征
- 固定条件应该有明确的业务含义
- 动态条件应该能够根据传入参数进行灵活判断

## 总结

通过场景分离，我们实现了更精确的ORM代码生成：
1. **纯固定条件**：专注于基础数据过滤
2. **混合条件**：结合基础过滤和动态查询
3. **提示词优化**：针对不同场景提供专门的指导
4. **配置完善**：场景描述更加准确和详细

这样的分离使得生成的代码更加符合实际业务需求，提高了代码质量和可维护性。 