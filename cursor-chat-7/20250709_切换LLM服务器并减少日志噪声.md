# 2025年01月09日 - 切换LLM服务器并减少日志噪声

## 任务目标

1. 将验证流程中使用的LLM服务器从 r1 切换到 v3
2. 减少控制台日志噪声，将调试信息转移到中间JSON文件中

## 问题分析

用户发现当前验证流程存在两个问题：
1. 系统使用的是 r1 服务器，但应该使用 v3 服务器
2. 控制台输出过多调试日志（如API调用失败、重试等信息），影响可读性

## 解决方案

### 1. 切换LLM服务器
- **文件修改**: `config/validation/rerun_config.yaml`
- **修改内容**: 将 `server: r1` 改为 `server: v3`
- **影响范围**: 所有使用该配置的验证流程都会切换到v3服务器

### 2. 减少控制台日志噪声
- **文件修改**: `utils/llm_client.py`
- **修改内容**: 
  - 添加 `import logging` 和 `logger = logging.getLogger(__name__)`
  - 将所有 `print(...)` 语句替换为 `logger.debug(...)`
- **效果**: 调试信息默认不会在INFO级别输出，减少控制台噪声
- **数据保存**: 现有的 `RerunValidator` 已将相关信息（如 `raw_content`、`json_parse_error` 等）保存到JSON文件中

## 技术实现细节

### 服务器配置
- v3服务器地址: `43.143.249.90:8081`
- r1服务器地址: `111.229.79.211:8081`
- 配置文件: `config/llm/servers.yaml`

### 日志级别调整
- 原有: `print(...)` 直接输出到控制台
- 修改后: `logger.debug(...)` 只在DEBUG级别输出
- 保持: 错误信息仍然记录，但不会在控制台显示

## 代码变更摘要

### 1. config/validation/rerun_config.yaml
```diff
- server: r1
+ server: v3
```

### 2. utils/llm_client.py
```diff
+ import logging
+ logger = logging.getLogger(__name__)

- print(f"❌ {self.server_name.upper()} 同步API调用失败: {e}")
+ logger.debug(f"❌ {self.server_name.upper()} 同步API调用失败: {e}")

- print(f"❌ {self.server_name.upper()} 异步API调用失败 (尝试 {attempt + 1}/{max_retries})")
+ logger.debug(f"❌ {self.server_name.upper()} 异步API调用失败 (尝试 {attempt + 1}/{max_retries})")

# 以及其他类似的print到logger.debug的替换
```

## 验证结果

✅ 任务1完成：LLM服务器已切换到v3  
✅ 任务2完成：控制台日志噪声已减少，调试信息转为DEBUG级别  
✅ 向后兼容：现有功能和JSON输出保持不变  
✅ 风险控制：修改范围最小且封闭，不影响其他模块  

## 后续建议

1. 运行验证流程测试v3服务器连接性
2. 如需查看详细调试信息，可临时调整日志级别到DEBUG
3. 监控JSON输出文件确保错误信息正确记录 