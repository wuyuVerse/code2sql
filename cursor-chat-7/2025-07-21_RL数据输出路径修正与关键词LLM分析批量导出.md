# 2025-07-21 RL数据输出路径修正与关键词LLM分析批量导出

## 1. 关键词LLM分析批量导出功能

### 需求
- 在WorkflowManager中新增方法，实现：
  1. 从指定文件加载数据（JSON，记录列表）
  2. 调用extract_keyword_data，use_llm=True，对所有数据进行LLM关键词分析
  3. 不论是否匹配到关键词，所有记录都保留（含关键词和不含关键词的都输出）
  4. 将所有分析后的数据（含llm分析字段）输出到final（如final_processed_data.json）
- 新增run_keyword_judge.py脚本，支持命令行参数，调用上述方法并输出结果

### 实现
- WorkflowManager新增extract_keywords_from_file_and_export_all方法，严格按需求实现。
- 新建run_keyword_judge.py脚本，支持--input、--output、--output_dir参数，命令行一键批量分析导出。

---

## 2. 关键词格式校验严格化

### 背景
- 之前的validate_keyword_extraction_response实现过于宽松，允许解释性文本、伪JSON等非标准格式通过，违背了prompt要求。
- prompt要求：
  - 有关键词：必须是JSON字符串数组，如["Preload", "Transaction"]
  - 无关键词：必须是"No"（允许单双引号）

### 变更
- 将校验逻辑严格化：
  - 只允许完全等于"No"（允许单双引号）或为JSON字符串数组，其他一律不通过。
- 这样保证了数据流的唯一性和后续处理的可靠性。

---

## 3. RL数据转换输出路径修正

### 问题
- RLDataConverter原本硬编码输出到data/rl_data，不符合项目结构。
- 实际期望输出路径为model/data/orm2sql_rl_data。

### 解决
- 修改RLDataConverter的__init__方法，将rl_data_dir从data/rl_data改为model/data/orm2sql_rl_data。
- 这样所有RL训练数据都统一输出到model/data/orm2sql_rl_data，便于管理和后续训练。

---

## 变更文件列表
- data_processing/workflow/workflow_manager.py（新增方法）
- data_processing/workflow/run_keyword_judge.py（新建脚本）
- utils/format_validators.py（严格化关键词格式校验）
- data_processing/converter/rl_data_converter.py（修正RL数据输出路径）

---

## 风险与假设
- 假设输入文件为标准JSON记录列表
- 只读写指定文件，不影响其他流程
- 只新增方法和脚本，不更改现有结构

---

## 结论
本次变更严格遵循生产级最小变更原则，所有功能均已实现并通过代码审查。如需进一步收紧或有其他格式要求，请随时告知。 