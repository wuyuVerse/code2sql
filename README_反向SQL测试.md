# åå‘SQLç”Ÿæˆæµ‹è¯•æŒ‡å—

## æ¦‚è¿°

æœ¬æµ‹è¯•å¥—ä»¶ç”¨äºéªŒè¯åå‘SQLç”Ÿæˆå™¨çš„åŠŸèƒ½ï¼Œæ”¯æŒæµ‹è¯•æ‰€æœ‰11ç§åœºæ™¯ï¼Œæ¯ä¸ªåœºæ™¯å¯ä»¥ç”ŸæˆæŒ‡å®šæ•°é‡çš„æ¡ˆä¾‹ã€‚

## æµ‹è¯•è„šæœ¬

### 1. å…¨é¢æµ‹è¯•è„šæœ¬ (`test_comprehensive_reverse_sql.py`)

æµ‹è¯•æ‰€æœ‰11ç§åœºæ™¯ï¼Œæ¯ä¸ªåœºæ™¯ç”Ÿæˆ10ä¸ªæ¡ˆä¾‹ã€‚

**ä½¿ç”¨æ–¹æ³•:**
```bash
# æµ‹è¯•æ‰€æœ‰åœºæ™¯ï¼ˆé»˜è®¤ï¼‰
python test_comprehensive_reverse_sql.py

# æµ‹è¯•æ‰€æœ‰åœºæ™¯ï¼ˆæ˜¾å¼æŒ‡å®šï¼‰
python test_comprehensive_reverse_sql.py --all

# æµ‹è¯•å•ä¸ªåœºæ™¯
python test_comprehensive_reverse_sql.py --scenario if-else+caller --count 5
```

**æ”¯æŒçš„åœºæ™¯:**
1. `if-else+caller` - if-else+calleråœºæ™¯
2. `if-else+orm` - if-else+ormåœºæ™¯
3. `switch` - switchåœºæ™¯
4. `dynamic_query` - åŠ¨æ€æŸ¥è¯¢åœºæ™¯
5. `complex_control` - å¤æ‚æ§åˆ¶æµåœºæ™¯
6. `fixed_params` - å›ºå®šå‚æ•°åœºæ™¯
7. `if-else+switch` - if-else+switchæ··åˆåœºæ™¯
8. `conditional_chain` - æ¡ä»¶é“¾å¼æŸ¥è¯¢åœºæ™¯
9. `multi_branch_transaction` - å¤šåˆ†æ”¯äº‹åŠ¡å¤„ç†åœºæ™¯
10. `state_machine_branch` - çŠ¶æ€æœºå¼åˆ†æ”¯åœºæ™¯
11. `conditional_meta` - æ¡ä»¶åˆ†æ”¯+metaåœºæ™¯

### 2. å¿«é€Ÿæµ‹è¯•è„šæœ¬ (`test_quick_reverse_sql.py`)

å¿«é€Ÿæµ‹è¯•4ä¸ªå…³é”®åœºæ™¯ï¼Œæ¯ä¸ªåœºæ™¯ç”Ÿæˆ3ä¸ªæ¡ˆä¾‹ã€‚

**ä½¿ç”¨æ–¹æ³•:**
```bash
python test_quick_reverse_sql.py
```

**æµ‹è¯•åœºæ™¯:**
- `if-else+caller` - åŸºç¡€if-elseåœºæ™¯
- `switch` - switchåœºæ™¯
- `dynamic_query` - åŠ¨æ€æŸ¥è¯¢åœºæ™¯
- `multi_branch_transaction` - å¤æ‚åœºæ™¯ï¼ˆä¹‹å‰é”™è¯¯ç‡é«˜çš„ï¼‰

## é…ç½®è¯´æ˜

### é‡è¯•é…ç½®

é‡è¯•æ¬¡æ•°å·²ä»3æ¬¡å¢åŠ åˆ°10æ¬¡ï¼Œé…ç½®æ–‡ä»¶ä½äºï¼š
```
config/data_processing/reverse_sql_generator/retry_config.yaml
```

**é…ç½®é¡¹:**
- `max_retries`: æœ€å¤§é‡è¯•æ¬¡æ•° (é»˜è®¤: 10)
- `retry_delay`: é‡è¯•é—´éš”ç§’æ•° (é»˜è®¤: 2)
- `exponential_backoff`: æ˜¯å¦å¯ç”¨æŒ‡æ•°é€€é¿ (é»˜è®¤: true)
- `max_retry_delay`: æœ€å¤§é‡è¯•å»¶è¿Ÿç§’æ•° (é»˜è®¤: 30)

### æµ‹è¯•é…ç½®

**å…¨é¢æµ‹è¯•é…ç½®:**
```python
{
    "base_output_dir": "comprehensive_test_output",
    "scenarios": all_scenarios,  # æ‰€æœ‰11ç§åœºæ™¯
    "count_per_scenario": 10,    # æ¯ä¸ªåœºæ™¯10ä¸ªæ¡ˆä¾‹
    "llm_server": "v3",
    "temperature": 0.7,
    "max_tokens": 4096,
    "parallel": True,
    "max_workers": 4,
    "validate": True
}
```

**å¿«é€Ÿæµ‹è¯•é…ç½®:**
```python
{
    "base_output_dir": "quick_test_output",
    "scenarios": key_scenarios,  # 4ä¸ªå…³é”®åœºæ™¯
    "count_per_scenario": 3,     # æ¯ä¸ªåœºæ™¯3ä¸ªæ¡ˆä¾‹
    "llm_server": "v3",
    "temperature": 0.7,
    "max_tokens": 4096,
    "parallel": True,
    "max_workers": 2,
    "validate": True
}
```

## è¾“å‡ºç»“æœ

### æµ‹è¯•ç»Ÿè®¡

æµ‹è¯•å®Œæˆåä¼šæ˜¾ç¤ºè¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯ï¼š

```
ğŸ“Š æµ‹è¯•ç»“æœç»Ÿè®¡:
  - æ€»ç”Ÿæˆæ¡ˆä¾‹æ•°: 110
  - éªŒè¯é€šè¿‡æ¡ˆä¾‹æ•°: 95
  - æˆåŠŸç‡: 86.4%
  - å·¥ä½œæµæ‘˜è¦æ–‡ä»¶: comprehensive_test_output/workflow_summary.json

ğŸ“ˆ å„åœºæ™¯ç”Ÿæˆç»Ÿè®¡:
  - if-else+caller        :  9/10 ( 90.0%)
  - if-else+orm           :  8/10 ( 80.0%)
  - switch                : 10/10 (100.0%)
  - dynamic_query         :  9/10 ( 90.0%)
  - complex_control       :  7/10 ( 70.0%)
  - fixed_params          : 10/10 (100.0%)
  - if-else+switch        :  8/10 ( 80.0%)
  - conditional_chain     :  9/10 ( 90.0%)
  - multi_branch_transaction:  6/10 ( 60.0%)
  - state_machine_branch  :  9/10 ( 90.0%)
  - conditional_meta      :  8/10 ( 80.0%)
```

### è¾“å‡ºæ–‡ä»¶

æµ‹è¯•ç»“æœä¼šä¿å­˜åœ¨æŒ‡å®šçš„è¾“å‡ºç›®å½•ä¸­ï¼š

```
comprehensive_test_output/
â”œâ”€â”€ reverse_sql_cases.json          # ç”Ÿæˆçš„æ¡ˆä¾‹æ•°æ®
â”œâ”€â”€ workflow_summary.json           # å·¥ä½œæµæ‘˜è¦
â””â”€â”€ logs/                          # è¯¦ç»†æ—¥å¿—
    â”œâ”€â”€ reverse_sql_generation.log
    â””â”€â”€ workflow.log
```

## æ€§èƒ½ä¼˜åŒ–

### 1. é‡è¯•æœºåˆ¶ä¼˜åŒ–

- **å¢åŠ é‡è¯•æ¬¡æ•°**: ä»3æ¬¡å¢åŠ åˆ°10æ¬¡
- **é…ç½®åŒ–ç®¡ç†**: é€šè¿‡YAMLæ–‡ä»¶ç®¡ç†é‡è¯•ç­–ç•¥
- **é”™è¯¯åˆ†ç±»**: åŒºåˆ†å¯é‡è¯•å’Œä¸å¯é‡è¯•çš„é”™è¯¯

### 2. å¹¶è¡Œå¤„ç†

- **åœºæ™¯çº§å¹¶è¡Œ**: ä¸åŒåœºæ™¯å¯ä»¥å¹¶è¡Œå¤„ç†
- **æ¡ˆä¾‹çº§å¹¶è¡Œ**: åŒä¸€åœºæ™¯çš„å¤šä¸ªæ¡ˆä¾‹å¯ä»¥å¹¶è¡Œç”Ÿæˆ
- **Workeræ§åˆ¶**: å¯é…ç½®å¹¶è¡Œworkeræ•°é‡

### 3. åŠ¨æ€å˜ä½“æ•°é‡

- **åœºæ™¯ç›¸å…³**: ä¸åŒåœºæ™¯ç”Ÿæˆä¸åŒæ•°é‡çš„SQLå˜ä½“
- **å¤æ‚åº¦ç›¸å…³**: æ ¹æ®å¤æ‚åº¦è°ƒæ•´å˜ä½“æ•°é‡
- **éšæœºåŒ–**: åœ¨æŒ‡å®šèŒƒå›´å†…éšæœºç”Ÿæˆå˜ä½“æ•°é‡

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **LLMæœåŠ¡å™¨è¿æ¥å¤±è´¥**
   - æ£€æŸ¥æœåŠ¡å™¨åç§°æ˜¯å¦æ­£ç¡® (`v3` æˆ– `r1`)
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

2. **é‡è¯•æ¬¡æ•°è¿‡å¤š**
   - æ£€æŸ¥ `retry_config.yaml` é…ç½®
   - è°ƒæ•´ `max_retries` å‚æ•°

3. **ç‰¹å®šåœºæ™¯å¤±è´¥ç‡é«˜**
   - æ£€æŸ¥åœºæ™¯çš„æç¤ºè¯æ¨¡æ¿
   - è°ƒæ•´åœºæ™¯çš„å˜ä½“æ•°é‡èŒƒå›´
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

4. **å¹¶è¡Œå¤„ç†é—®é¢˜**
   - å‡å°‘ `max_workers` æ•°é‡
   - æ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

### è°ƒè¯•å»ºè®®

1. **ä½¿ç”¨å¿«é€Ÿæµ‹è¯•**: å…ˆç”¨ `test_quick_reverse_sql.py` éªŒè¯åŸºæœ¬åŠŸèƒ½
2. **å•åœºæ™¯æµ‹è¯•**: ä½¿ç”¨ `--scenario` å‚æ•°æµ‹è¯•ç‰¹å®šåœºæ™¯
3. **æŸ¥çœ‹æ—¥å¿—**: æ£€æŸ¥è¾“å‡ºç›®å½•ä¸­çš„è¯¦ç»†æ—¥å¿—
4. **è°ƒæ•´å‚æ•°**: æ ¹æ®æµ‹è¯•ç»“æœè°ƒæ•´é…ç½®å‚æ•°

## é¢„æœŸç»“æœ

### æˆåŠŸç‡ç›®æ ‡

- **æ•´ä½“æˆåŠŸç‡**: > 80%
- **ç®€å•åœºæ™¯**: > 90% (if-else+caller, switch, fixed_params)
- **å¤æ‚åœºæ™¯**: > 70% (multi_branch_transaction, complex_control)

### æ€§èƒ½ç›®æ ‡

- **ç”Ÿæˆé€Ÿåº¦**: æ¯ä¸ªæ¡ˆä¾‹ < 30ç§’
- **å¹¶è¡Œæ•ˆç‡**: 4ä¸ªworkeræ—¶ > 3å€åŠ é€Ÿ
- **å†…å­˜ä½¿ç”¨**: < 2GB

## åç»­ä¼˜åŒ–

1. **æ™ºèƒ½é‡è¯•**: æ ¹æ®é”™è¯¯ç±»å‹è°ƒæ•´é‡è¯•ç­–ç•¥
2. **åŠ¨æ€è°ƒæ•´**: æ ¹æ®å†å²æˆåŠŸç‡è°ƒæ•´å‚æ•°
3. **ç›‘æ§å‘Šè­¦**: æ·»åŠ å®æ—¶ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
4. **ç»“æœåˆ†æ**: è‡ªåŠ¨åˆ†æç”Ÿæˆç»“æœçš„è´¨é‡ 