# LLM提示词配置文件
# 用于code2sql_reward.py中的表名和字段名抽取

# 表名抽取提示词
table_extraction_prompt: |
  请从以下GORM代码中提取所有涉及的表名。

  **函数名称：** {function_name}
  **调用者：** {caller}

  **ORM代码：**
  ```go
  {orm_code}
  ```

  **代码元数据：**
  {meta_data_str}

  **提取表名的规则：**

  1. **优先级顺序**：
     - **优先使用元数据中的TableName函数**：
       1. 检查代码中的元数据，尤其是`TableName()`函数。
       2. 如果`TableName()`函数明确返回表名，则使用该返回值。
       3. 如果`TableName()`函数通过嵌套函数返回表名，应使用嵌套函数的返回值。

     - **检查配置文件中的表名映射**：
       1. 查找项目中的配置文件或配置项，通常配置文件会包含表名映射。
       2. 配置文件可能存在于`conf`、`config`、`setting`等文件或变量中。
       3. 如果配置文件中定义了表名映射，应优先使用这些映射，而不是推测表名。

     - **检查代码中显式指定的表名**：
       1. 检查代码中是否显式使用了`Table("表名")`。
       2. 如果在代码中直接写出了表名（如`Table("user_info")`），应按原样保留该表名。
     
     - **推测表名规则**：
       1. 如果没有明确的表名定义，则按结构体名称推测表名：
          - 使用驼峰命名法将结构体名称拆解成小写字母并用下划线分隔（例如：`UserInfo` -> `user_info`）。
          - 注意：**不要自动复数化**表名，只有在元数据中明确指定了复数形式时才使用复数（如`UserInfo` -> `user_info`，而不是`user_infos`）。
       2. 如果通过函数（如`GenerateTableName()`）生成表名，应根据上下文推测表名。

  2. **表名推测的具体规则**：
     - 如果在代码中明确给出了表名映射，如`Table("user_info")`，使用该显式表名。
     - 如果表名是通过配置文件或常量映射定义的，应优先使用这些映射，而不是根据结构体名称推测表名。
     - 如果表名通过函数（如`GenerateTableName()`）动态生成，则根据函数上下文或结构体名称推测可能的表名。
     - 对于没有显式表名定义的情况，根据结构体名称按驼峰转下划线的规则推测表名。

  3. **表名推测的边界情况**：
     - **如果表名完全无法推测**：
       - 如果无法确定表名并且没有上下文信息来推测，返回`<LACK INFORMATION>`并描述缺失的信息，如：
         ```
         <LACK INFORMATION>: 缺少GenerateTableName函数实现 | 无法推测
         ```
       - 如果缺少部分信息，但可以推测出SQL语句，返回推测的SQL并标明缺失信息：
         ```
         <LACK INFORMATION>: 缺少GenerateTableName函数实现，根据SpaceRouter结构体推测表名 | INSERT INTO space_router (id, name) VALUES (?, ?);
         ```

     - **如果表名已经显式给出**：
       - 返回显式指定的表名，无需推测。

     - **如果表名由函数生成**：
       - 根据函数的上下文和结构体名称推测可能的表名

  请仔细分析代码中的表名引用，按照上述优先级顺序和规则进行提取。

  请以JSON格式输出，格式如下：
  ```json
  {{
      "tables": ["表名1", "表名2", ...],
      "extraction_method": "使用的提取方法（如：TableName函数/配置文件映射/显式指定/结构体推测/函数推测/无法推测）",
      "notes": "提取过程中的重要说明或缺失信息"
  }}
  ```

  只输出JSON格式，不要其他内容：

# 字段名抽取提示词
column_extraction_prompt: |
  请从以下GORM代码中提取所有涉及的字段名。

  **函数名称：** {function_name}
  **调用者：** {caller}

  **ORM代码：**
  ```go
  {orm_code}
  ```

  **代码元数据：**
  {meta_data_str}

  **提取字段名的规则：**

  1. **优先级顺序**：
     - **优先使用结构体tag中的column标签**：
       1. 检查结构体的字段定义是否包含`gorm:"column:字段名"`标签。
       2. 如果字段包含`gorm:"column:字段名"`标签，则使用该字段名作为SQL中的列名。
     
     - **检查配置中的字段名映射**：
       1. 查找元数据中的字段名映射，如常量、类型定义或配置文件。
       2. 配置可能出现在`conf`、`config`、`setting`等文件或变量中。
       3. 如果配置中定义了字段名映射，应优先使用这些映射。
     
     - **直接显式字段名**：
       1. 检查代码中是否直接写出了字段名，如`Where("user_id = ?", userId)`中的`user_id`。
       2. 如果代码中明确写出了字段名，应按原样使用该字段名。

     - **推测字段名规则**：
       1. 如果没有明确的字段名定义，按Go语言结构体字段名称推测字段名：
          - 使用驼峰命名法将Go字段名拆解并转换为下划线形式（例如：`UserName` -> `user_name`）。
       2. 如果没有其他定义，按照常见的命名规范推测字段名。

  2. **字段名推测的具体规则**：
     - **结构体tag中的column标签**优先级最高，应直接使用。
     - **配置映射中的字段名映射**优先于推测。
     - **直接显式写出的字段名**应按原样保留。
     - 如果没有其他定义，按照驼峰转下划线规则推测字段名。

  3. **字段名推测的边界情况**：
     - **如果字段名无法推测**：
       - 如果无法根据任何规则推测字段名，返回`<LACK INFORMATION>`并描述缺失的信息，如：
         ```
         <LACK INFORMATION>: 缺少结构体tag中的字段映射 | 无法推测
         ```
       - 如果能够推测出字段名但信息不完整，返回推测的字段名并标明缺失的信息：
         ```
         <LACK INFORMATION>: 缺少字段tag信息，根据UserName字段推测为user_name | SELECT user_name FROM users;
         ```

     - **如果字段名已显式指定**：
       - 返回显式指定的字段名，无需推测。

     - **如果字段名通过配置映射生成**：
       - 根据配置文件或常量映射返回字段名。

  4. **特别注意**：
     - 直接在SQL语句中写出的字段名（如WHERE子句中的字段）应该按原样保留，不进行任何格式转换。
     - 字段名的推测应尽量与Go语言的结构体字段名保持一致。
     - 不要自行为字段名添加复数后缀。

  请仔细分析代码中的字段名引用，按照上述优先级顺序和规则进行提取。

  请以JSON格式输出，格式如下：
  ```json
  {{
      "columns": ["字段名1", "字段名2", ...],
      "extraction_method": "使用的提取方法（如：结构体tag/配置映射/显式指定/结构体推测/无法推测）",
      "notes": "提取过程中的重要说明或缺失信息"
  }}
  ```

  只输出JSON格式，不要其他内容：

# LLM配置
llm_config:
  # 使用的LLM服务器
  server_name: "v3"
  # 最大token数
  max_tokens: 1024
  # 温度参数
  temperature: 0.0
  # 重试次数
  max_retries: 3
  # 重试间隔（秒）
  retry_delay: 1.0

# 一致性评估配置
consistency_config:
  # 表名权重
  table_weight: 0.6
  # 字段名权重
  column_weight: 0.4
  # 综合奖励中一致性评估的权重
  consistency_weight: 0.4
  # 有效性评估的权重
  validity_weight: 0.6 